var __extends = this.__extends || function (n, t) {
	function r() {
		this.constructor = n
	}
	for (var i in t)
		t.hasOwnProperty(i) && (n[i] = t[i]);
	r.prototype = t.prototype,
	n.prototype = new r
}, GcSpread;
(function (n) {
	(function (n) {
		(function (n) {
			"use strict";
			var t;
			n.PrimitiveTypes = {
				STRING : "string",
				NUMBER : "number",
				BOOLEAN : "boolean",
				OBJECT : "object",
				FUNCTION : "function",
				UNDEFINED : "undefined"
			},
			t = function () {
				function t(n, t, i) {
					this._source = n,
					this._meta = t,
					this._metadata = i
				}
				return t.prototype._getSourceValue = function (t) {
					var u = this._meta.properties[t],
					i = u.getter,
					r;
					if (i !== undefined) {
						if (typeof i === n.PrimitiveTypes.STRING) {
							r = this._source[i];
							if (typeof r !== n.PrimitiveTypes.FUNCTION)
								throw 'metadata invalide. source object "' + this._source + '" have no a function named "' + i + '".';
							i = r
						}
						if (typeof i !== n.PrimitiveTypes.FUNCTION)
							throw 'metadata invalide. expect a "function" for getter of property "' + t + '" of type "' + this._meta + '", but actual is a "' + typeof i + '"';
					} else
						i = this._source[t], typeof i !== n.PrimitiveTypes.FUNCTION && (i = function () {
							return this[t]
						});
					return i.apply(this._source)
				},
				t.prototype._setSourceValue = function (i, r) {
					var e = this._meta.properties[i],
					u = e.setter,
					f;
					if (u !== undefined) {
						if (typeof u === n.PrimitiveTypes.STRING) {
							f = this._source[u];
							if (typeof f !== n.PrimitiveTypes.FUNCTION)
								throw 'metadata invalide. source object "' + this._source + '" have no a function named "' + u + '".';
							u = f
						}
						if (typeof u !== n.PrimitiveTypes.FUNCTION)
							throw 'metadata invalide. expect a "function" for setter of property "' + i + '" of type "' + this._meta + '", but actual is a "' + typeof u + '"';
					} else
						u = this._source[i], typeof u !== n.PrimitiveTypes.FUNCTION && (u = function (n) {
							this[i] = n
						});
					typeof r !== e.type && (r = t._convert(r, e.type)),
					u.call(this._source, r)
				},
				t._convert = function (t, i) {
					if (t === undefined || t === null)
						return t;
					switch (i) {
					case n.PrimitiveTypes.NUMBER:
						return parseFloat(t);
					case n.PrimitiveTypes.BOOLEAN:
						return !!t;
					case n.PrimitiveTypes.STRING:
						return t.toString();
					default:
						return t
					}
				},
				t.prototype._genProperties = function () {
					var n = this;
					Object.getOwnPropertyNames(this._meta.properties).forEach(function (t) {
						n[t] = n._genProperty(t)
					})
				},
				t.prototype._genProperty = function (n) {
					throw "not implemented.";
				},
				t.undefinedValue = {},
				t.indeterminateValue = {},
				t
			}
			(),
			n.BaseMetaObject = t;
			var u = function (n) {
				function i(t, i, r) {
					n.call(this, t, i, r),
					this._values = {},
					this._genProperties()
				}
				return __extends(i, n),
				i.prototype._value = function (n, r) {
					var f,
					u;
					if (r === undefined) {
						r = this._values[n];
						if (r === undefined)
							return r = this._getSourceValue(n), f = this._metadata[this._meta.properties[n].type], f !== undefined && (r = this._values[n] = new i(r, f, this._metadata)), r;
						else if (r === t.undefinedValue)
							return undefined;
						return r
					}
					return u = this._meta.properties[n].type,
					typeof r !== u && (r = t._convert(r, u)),
					this._values[n] = r,
					$(this).trigger($.Event("change", {
							property : n
						})),
					this
				},
				i.prototype.reset = function (n) {
					this._values[n] = undefined
				},
				i.prototype.commit = function () {
					var n = this;
					Object.getOwnPropertyNames(this._values).forEach(function (r) {
						var u = n._values[r];
						if (u !== undefined) {
							if (u instanceof i) {
								u.commit();
								return
							}
							u === t.undefinedValue && (u = undefined),
							n._setSourceValue(r, u)
						}
					})
				},
				i.prototype._genProperty = function (n) {
					return this._value.bind(this, n)
				},
				i
			}
			(t),
			f = function (n) {
				function i(t, i, r) {
					n.call(this, t, i, r),
					this._genProperties()
				}
				return __extends(i, n),
				i.prototype._genProperty = function (n) {
					var r = this,
					u = this._metadata[this._meta.properties[n].type];
					return function (f) {
						var o,
						e;
						if (f === undefined)
							return o = r._getSourceValue(n), u !== undefined ? new i(o, u, r._metadata) : o;
						if (u !== undefined)
							throw "Complex property don't support set.";
						return e = r._meta.properties[n].type,
						typeof f !== e && (f = t._convert(f, e)),
						r._setSourceValue(n, f),
						$(r).trigger($.Event("change", {
								property : n
							})),
						this
					}
				},
				i
			}
			(t),
			i = function (n) {
				function i(t, i, r) {
					n.call(this, t, i, r),
					this._values = {},
					this._genProperties()
				}
				return __extends(i, n),
				i.prototype.reset = function (n) {
					this._values[n] = undefined
				},
				i.prototype.commit = function () {
					var n = this;
					Object.getOwnPropertyNames(this._values).forEach(function (r) {
						var u = n._values[r];
						if (u !== undefined) {
							if (u instanceof i) {
								u.commit();
								return
							}
							u === t.undefinedValue && (u = undefined),
							n._setSourceValue(r, u)
						}
					})
				},
				i.prototype._genProperty = function (n) {
					var i = this,
					r = this._meta.properties[n];
					return ko.computed({
						read : function () {
							var r = i._values[n];
							return r === undefined ? i._getSourceValue(n) : r === t.undefinedValue ? undefined : r
						},
						write : function (u) {
							var f = u;
							f === undefined ? f = t.undefinedValue : typeof f !== r.type && (f = t._convert(f, r.type)),
							i._values[n] = f
						}
					})
				},
				i
			}
			(t),
			r = function () {
				function n(n) {
					this._metadata = n
				}
				return n.prototype.genWrapper = function (t, i) {
					var r = t[n.internalWrapper],
					u;
					if (r !== undefined)
						return r;
					return u = this._metadata[i],
					u === undefined ? t : (r = new f(t, u, this._metadata), t[n.internalWrapper] = r, r)
				},
				n.prototype.genShadow = function (n, t) {
					var i = this._metadata[t];
					return i === undefined ? n : new u(n, i, this._metadata)
				},
				n.prototype.genKoShadow = function (n, t) {
					var r = this._metadata[t];
					return r === undefined ? n : new i(n, r, this._metadata)
				},
				n.internalWrapper = "__gc_metadata_wrapper",
				n
			}
			();
			n.MetaFactor = r
		})(n.designer || (n.designer = {}));
		var t = n.designer
	})(n.Sheets || (n.Sheets = {}));
	var t = n.Sheets
})(GcSpread || (GcSpread = {}))
