var GcSpread;
(function (n) {
	(function (n) {
		(function (t) {
			(function (i) {
				"use strict";
				function g(i) {
					i && (o = new n.FormulaTextBox($("#formulaBarText").get(0))),
					o.spread(t.wrapper.spread),
					r(undefined, $(".ok-btn"), !1),
					r(undefined, $(".cancel-btn"), !1),
					p(i);
					var u = t.wrapper.spread.getActiveSheet(),
					e = u.getActiveColumnIndex(),
					f = u.getActiveRowIndex();
					t.util.triggerSheetEvent(u, n.Events.EnterCell, {
						sheet : u,
						sheetName : u.getName(),
						row : f,
						col : e
					}),
					t.util.triggerSheetEvent(u, n.Events.SelectionChanged, null)
				}
				function p(i) {
					t.wrapper.spread.bind(n.Events.InvalidOperation, function (n, i) {
						(i.invalidType === 0 || i.invalidType === 4) && (t.MessageBox.show(i.message, t.res.title, 2, 0, function () {
								$(".fill-content").focus()
							}), h = !0)
					}),
					t.wrapper.spread.bind(n.Events.EnterCell, function (n, i) {
						var o = t.wrapper.spread.getActiveSheet(),
						s = o.getActiveColumnIndex(),
						h = o.getActiveRowIndex(),
						e = o.getCell(h, s);
						r(!0, $(".functions-btn")),
						c = e.value(),
						f = e.formula(),
						d = {
							sheetIndex : t.wrapper.spread.getActiveSheetIndex(),
							row : e.row,
							col : e.col
						},
						u = !0
					}),
					t.wrapper.spread.bind(n.Events.SelectionChanging, function (n, i) {
						var e = t.wrapper.spread.getActiveSheet(),
						r = e.getSelections()[e.getSelections().length - 1],
						f,
						u;
						r !== null && r !== undefined && (f = s(r), u = $("[name=namedRangeSelector]"), u.val(f))
					}),
					t.wrapper.spread.bind(n.Events.SelectionChanged, function (n, i) {
						var o = $("[name=namedRangeSelector]"),
						f = t.wrapper.spread.getActiveSheet(),
						r = f.getSelections()[f.getSelections().length - 1],
						u;
						r !== null && r !== undefined && (u = a ? s(r) : e(t.wrapper.spread, t.wrapper.spread.getActiveSheet().getActiveRowIndex() + 1, t.wrapper.spread.getActiveSheet().getActiveColumnIndex() + 1, r), o.val(u))
					}),
					t.wrapper.spread.bind(n.Events.ActiveSheetChanged, function (i, r) {
						var u = t.wrapper.spread.getActiveSheet();
						t.util.triggerSheetEvent(u, n.Events.SelectionChanging, undefined),
						t.util.triggerSheetEvent(u, n.Events.SelectionChanged, undefined),
						t.util.triggerSheetEvent(u, n.Events.EnterCell, undefined)
					});
					if (i) {
						t.wrapper.spreadElement.bind("FileOpened", function (i, r) {
							var u = t.wrapper.spread.getActiveSheet();
							t.util.triggerSheetEvent(u, n.Events.SelectionChanging, undefined),
							t.util.triggerSheetEvent(u, n.Events.SelectionChanged, undefined),
							t.util.triggerSheetEvent(u, n.Events.EnterCell, undefined),
							o.text(k(u, u.getActiveRowIndex(), u.getActiveColumnIndex()))
						}),
						$(document).bind("keydown", function (n) {
							n.shiftKey && (a = !0)
						}),
						$(document).bind("keyup", function (n) {
							if (!n.shiftKey) {
								a = !1;
								var r = $("[name=namedRangeSelector]"),
								i;
								i = e(t.wrapper.spread, t.wrapper.spread.getActiveSheet().getActiveRowIndex() + 1, t.wrapper.spread.getActiveSheet().getActiveColumnIndex() + 1),
								r.val(i)
							}
						}),
						$(".fill-content").bind("keyup", function (n) {
							var i = $(".fill-content"),
							t = i.text();
							t !== "" && t.substring(0, 1) !== "=" ? r(!1, $(".functions-btn")) : r(!0, $(".functions-btn"))
						}),
						$(".fill-content").focus(function (n) {
							u = !1,
							r(undefined, $(".ok-btn"), !0),
							r(undefined, $(".cancel-btn"), !0)
						}),
						$(".functions-btn").click(function () {
							l || (l = new t.InsertFunctionDialog),
							l.open()
						}),
						$(".cancel-btn").click(function () {
							v(),
							t.wrapper.setFocusToSpread()
						}),
						$(".ok-btn").click(function () {
							t.wrapper.setFocusToSpread(),
							y(null)
						});
						var b,
						p = !1;
						$(".splitter").mousedown(function (n) {
							b = n.pageX,
							p = !0
						}),
						$(document).mousemove(function (n) {
							if (p) {
								var t = n.pageX - b,
								r = $(".named-range-selector"),
								u = $(".union-container"),
								i = $("#formulaBarText");
								r.width() + t < 0 && (t = r.width()),
								i.width() - t < 0 && (t = i.width()),
								r.width(r.width() + t),
								i.css("left", parseFloat(i.css("left")) + t),
								u.width(u.width() + t),
								b = n.pageX,
								w()
							}
						}),
						$(document).mouseup(function (n) {
							p = !1
						}),
						$(window).resize(w),
						$(window).resize()
					}
				}
				function w() {
					var r = $(".formulaBar"),
					e = $("#formulaBarText"),
					f = r.find("td"),
					u = r.width(),
					i = 0,
					n = [],
					t;
					f.each(function (t, r) {
						var u = $(r).outerWidth();
						i += u,
						n.push(u)
					}),
					t = u - i - 10,
					e.css({
						width : t + n[n.length - 1] - 10
					})
				}
				function s(n) {
					var u = "",
					r = n.rowCount,
					i = n.colCount,
					o = n.row + 1,
					f = n.col + 1;
					return u = r == 1 && i == 1 ? e(t.wrapper.spread, o, f) : r < 0 && i > 0 ? i + "C" : i < 0 && r > 0 ? r + "R" : r < 0 && i < 0 ? t.wrapper.spread.getActiveSheet().getRowCount() + "R x " + t.wrapper.spread.getActiveSheet().getColumnCount() + "C" : r + "R x " + i + "C"
				}
				function e(i, r, u, f) {
					var s,
					a,
					l,
					y,
					o,
					e,
					c,
					h,
					v;
					if (r < 1 || u < 1)
						return null;
					else {
						s = "";
						if (f) {
							l = i.getActiveSheet().getSpans();
							if (l !== null)
								for (c = 0; c < l.length; c++)
									l[c].row === f.row && l[c].col === f.col && l[c].rowCount === f.rowCount && l[c].colCount === f.colCount && (a = !0);
							y = new n.Calc.ParserContext(null, t.wrapper.spread.referenceStyle(), 0, 0),
							o = i.getCustomNames();
							if (o !== undefined)
								for (h = 0; h < o.length; h++)
									o[h].getExpression()instanceof n.Calc.Expressions.ReferenceExpression && (e = o[h].getExpression().getRange(0, 0), e !== null && e !== undefined && (e.row === f.row && e.column === f.col && e.row + e.rowCount === f.row + f.rowCount && e.column + e.columnCount === f.col + f.colCount || e.row === f.row && e.column === f.col && a) && (s = o[h].getName()));
							if (s === "")
								for (c = 0; c < i.sheets.length; c++) {
									o = i.sheets[c].getCustomNames();
									if (o !== undefined)
										for (h = 0; h < o.length; h++)
											o[h].getExpression()instanceof n.Calc.Expressions.ReferenceExpression && (e = o[h].getExpression().getRange(0, 0), (e.row === f.row && e.column === f.col && e.row + e.rowCount === f.row + f.rowCount && e.column + e.columnCount === f.column + f.colCount || e.row === f.row && e.column === f.col && a) && (s = o[h].getName()))
								}
						}
						if (s === "")
							switch (i.referenceStyle()) {
							case 0:
								while (u > 0)
									v = u % 26, v == 0 ? (s = "Z" + s, u--) : s = String.fromCharCode("A".charCodeAt(0) + v - 1) + s, u = parseInt((u / 26).toString());
								s += r.toString();
								break;
							case 1:
								s = "R" + r.toString() + "C" + u.toString();
								break;
							default:
								break
							}
						return s
					}
				}
				function y(i) {
					var l = t.wrapper.spread.getActiveSheet(),
					p = l.getActiveColumnIndex(),
					y = l.getActiveRowIndex(),
					a = l.getCell(y, p),
					e,
					v,
					s,
					o;
					if (i != undefined)
						e = t.wrapper.spread.sheets[i.sheetIndex].getCell(i.row, i.col);
					else if (a != null)
						e = a;
					else
						return !1;
					if (!u) {
						v = $(".fill-content"),
						s = v.text().toString();
						if (s !== "") {
							if (s.substring(0, 1) == "=") {
								o = new n.UndoRedo.CellEditUndoAction(e.sheet, {
										row : e.row,
										col : e.col,
										newValue : s,
										autoFormat : !0
									}),
								e.sheet._doCommand(o);
								if (h === !0)
									return h = !1, !1
							}
						} else
							e.value(""), o = new n.UndoRedo.CellEditUndoAction(e.sheet, {
									row : e.row,
									col : e.col,
									newValue : "",
									autoFormat : !0
								}), e.sheet._doCommand(o)
					}
					return r(!0, $(".functions-btn")),
					r(undefined, $(".ok-btn"), !1),
					r(undefined, $(".cancel-btn"), !1),
					c = e.value(),
					f = e.formula(),
					u = !0,
					!0
				}
				function v() {
					var e = $(".fill-content"),
					i = t.wrapper.spread.getActiveSheet(),
					s = i.getActiveColumnIndex(),
					o = i.getActiveRowIndex(),
					n = i.getCell(o, s);
					if (n != null) {
						if (u)
							return
					} else
						return;
					r(!0, $(".functions-btn")),
					r(undefined, $(".ok-btn"), !1),
					r(undefined, $(".cancel-btn"), !1),
					n.value(c),
					n.formula(f),
					u = !0,
					t.wrapper.spread.focus(!0),
					e.text(b(n, f))
				}
				function b(n, t) {
					var i = "",
					r;
					return t === "" || t === null ? (r = n.value(), i = r != null ? r instanceof Date ? r.toLocaleString() : r.toString() : n.text()) : i = t.substring(0, 1) != "=" ? "=" + t : t,
					i == null ? "" : i
				}
				function r(n, t, i) {
					n !== undefined ? n ? (t.prop("disabled", !1), t.fadeTo("faster", 1)) : (t.prop("disabled", !0), t.fadeTo("faster", .2)) : i ? t.fadeTo("faster", 1) : t.fadeTo("faster", 0)
				}
				function k(n, t, i) {
					var r = "",
					u;
					return n && (r = n.getFormula(t, i), r ? r = "=" + r : (r = n.getText(t, i), u = n.parent ? n.parent.canUserEditFormula() : !0, r[0] === "=" && u && (r = "'" + r))),
					r
				}
				var c,
				f,
				d,
				u,
				l,
				a = !1,
				h = !1,
				o;
				i.initFormulaBar = g,
				i.addEvents = p,
				i.GetSelectedRangeString = s,
				i.GetCellPositionString = e,
				i.CommitFormula = y,
				i.CancelFormula = v,
				i.GetTextOfFormulaTextBox = b,
				i.setButtonStatus = r
			})(t.formulaBar || (t.formulaBar = {}));
			var i = t.formulaBar
		})(n.designer || (n.designer = {}));
		var t = n.designer
	})(n.Sheets || (n.Sheets = {}));
	var t = n.Sheets
})(GcSpread || (GcSpread = {}))
