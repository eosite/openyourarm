/*! glaf-web-1.0.0.js 2017-10-31 */

function FlowProcessFunc(e){e=$.extend(!0,FlowProcess.args||{},e||{});var t=contextPath+"/mx/form/workflow/defined/flowProcess";$.ajax({url:t,data:e,type:"post",dataType:"json",success:FlowProcess.sfn||function(e){e&&(e.errMsg?alert(e.errMsg):(alert("操作成功!"),FlowProcessFunc.close(),FlowProcess.callback&&FlowProcess.callback(e),FlowProcess.callback=null))},error:FlowProcess.efn||function(e){alert("服务器处理出错!")}})}function FlowProcessFunc0(e,t,a){if(!t.processId)return alert("流程实例id不能为空"),!1;if(!confirm(a+"流程?"))return!1;var n=contextPath+"/mx/form/workflow/defined/flowProcess";$.ajax({url:n,data:t,type:"post",dataType:"json",success:function(t){t&&(t.errMsg?alert(t.errMsg):alert("操作成功!"),pubsub.execChilds(e))},error:function(e){alert("服务器处理出错!")}})}function pageInit(){if($("[data-role]").each(function(e,t){var a=$(t).attr("data-role");$(t).data("textboxbt")||"textboxbt"!=a?$(t).data("touchspin")||"touchspin"!=a?$(t).data("textareabt")||"textareabt"!=a?$(t).data("progressbarbt")||"progressbarbt"!=a?$(t).data("datetimepickerbt")||"datetimepickerbt"!=a?$(t).data("datepickerbt")||0!=$(t).closest("div.input-daterange").length||"datepickerbt"!=a?$(t).data("daterangepicker")||"daterangepicker"!=a?$(t).data("calendarbt")||"calendarbt"!=a||$(t).calendarExt():$(t).daterangepickerExt():$(t).datepickerExt():$(t).datetimepickerExt():$(t).progressBarExt():$(t).textAreaBtExt():$(t).touchSpinExt():$(t).textboxBtExt()}),pageParameters){var e=pageParameters;e&&(mtxx.params=e,initPageDetailSuccess(e.detail))}else initPageDetailSuccess();$("body").delegate("input[memory=true]","click",function(){window.memoryObj=$(this)})}function initPageDetail(p){var params=eval("("+p+")");if(params){mtxx.params=params;var $body=$(document.body),url=contextPath+"/mx/form/data/initPageDetail",jdom;$.ajax({url:url,data:params,dataType:"json",type:"post",success:initPageDetailSuccess})}}function initPageDetailSuccess(e){if((window.$ret=e)&&e.data){if(e.jdoms=[],$.each(e.data,function(t,a){if(jdom=$("#"+t),jdom[0]){var n;n=a[0].value||0==a[0].value?a[0].value:jdom.val(),jdom.mtbootstrap("setValue",n,a),t.startsWith("ztree")||jdom.data("params",a[0]),e.jdoms.push({jdom:jdom,id:t})}}),e.handleColumns){var t=document.body;!$.data(t,"saveMsg")&&$.data(t,"saveMsg",[]);var a=new MtButton({handlecolumns:JSON.stringify(e.handleColumns)});$.data(document.body,"saveMsg").push(a)}linkAge(e),initPageFlow(e)}initProgressBarFunc(),initImageUploadFunc(),initImageUploadFunc2(),initMutilFileViewsFunc(),initPageLevel(),jqCb.fire()}function initPageFlow(e){e.__idValue=e.__idValue||e.idValue,e.jdoms.length&&$.ajax({url:contextPath+"/mx/form/data/initPageFlow",type:"post",dataType:"JSON",data:{idValue:e.__idValue,pageId:mtxx.params.id,processId:mtxx.params.processId},success:function(t){t.flowDefined&&$.data(document.body,"flowFilter",new FlowFilter(t.flowDefined).exec(e.jdoms))}})}function FlowFilter(e){this.flow=e,this.elements=e.elements,this.unValisaves=[],this.exec=function(e){var t=this;if($.each(e,function(e,a){t.filter(a.jdom,a.id)}),t.elements&&($.each(t.elements,function(e,a){if(!a.ready){var n=$("#"+e);n[0]&&t.filter(n,e)}}),t.unValisaves.length)){$.each(t.unValisaves,function(e,t){t.removeAttr("valisave"),$("[valisave=true]",t).removeAttr("valisave")})}return t},this.target=function(e){addVariables(e,this.flow._taskId)},this.filter=function(e,t){if(!this.elements)return!0;var a=this.elements[t];if(a){a.ready=!0;try{var n=e.mtbootstrap("getValue");a.defaultVal&&!n&&e.mtbootstrap("setValue",a.defaultVal)}catch(e){console.log(e)}if(!a.show)return e.hide(),!1;if(!a.write){try{e.attr("id")&&e.closest("tr").attr("tid")&&e.closest("tbody").find("[tempid='"+e.attr("id")+"']").mtbootstrap("disable",!0),e.mtbootstrap("disable",!0)}catch(a){e.is("div")&&(e=e.find("."+t)),e.attr({readonly:!0})}this.unValisaves.push(e)}a.read}return!0},function(e){var t=e.flow;mtxx.params.flow=t,t.targets&&t.targets.length&&$.each(t.targets,function(e,a){t._taskId&&t._taskId!=a.taskId&&addVariables(a.eleId,a.taskId)}),t.targetTasks&&t.targetTasks.length&&(mtxx.params.flow.targetTasksVars=[],$.each(t.targetTasks,function(e,a){t._taskId&&t._taskId==a.taskId&&addVar(a.eleId,a.taskId,mtxx.params.flow.targetTasksVars)}))}(this)}function processGetData(){var e=$("[fieldname=id]:hidden").val(),t=mtxx.params.flow,a={id:e,pageRuleId:$(".pageruleid").val(),targetTask:null},n=function(e,t){e&&e.length&&$.each(e,function(e,a){if(a.datas){var n=a.datas.expActVal,r=new RegExp("~M{([^\\}]*)}","g").exec(n);if(r&&r[1])try{var i=$("#"+r[1]).mtbootstrap("getValue");t[a.varname]=i,t[a.varcode]=i}catch(e){console.log(e)}}})};n(t.variables,a);var r={};return n(t.targetTasksVars,r),a.targetTask=function(e){var t=null;for(var a in e)if(t=e[a])break;return t}(r),a}function getFlowDataSetParams(){var e,t=$.data(document.body,"flowFilter"),a=window.getIdValues();return t&&(e=t.flow)&&e.taskWdataSet?$.extend(a,pubsub.getParameters(e.taskWdataSet[0].datas)):null}function getIdValues(){var e={};return $("input.id-field:hidden[fieldname]").each(function(t,a){e[$(a).attr("fieldname")]=$(a).val()}),e}function getSelectType(e){var t=e.attr("surl");if(t){var a=t.split("=");return a[a.length-1]}return e.attr("select-type")||"user"}function addVariables(e,t){!mtxx.params.flow&&(mtxx.params.flow={}),!mtxx.params.flow.variables&&(mtxx.params.flow.variables=[]),addVar(e,t,mtxx.params.flow.variables)}function addVar(e,t,a){var n=getSelectType($("#"+e));a.push({datas:{expActVal:"~M{"+e+"}"},varcode:t,varname:t+"_"+n})}function objectISNotEmpty(e){if(e)for(var t in e)return!0;return!1}function linkAge(e){e&&(e.controlRule&&(pubsub.pub("linkageControl",e.controlRule),pubsub.pub("linkagePage",e.controlRule)),e.tables&&$.each(e.tables,function(e,t){if(t.length)for(var a=0;a<t.length;a++){var n=t[a];$("<input>",{class:(e||"")+" id-field",type:"hidden",fieldName:n.fieldName,value:n.value}).appendTo("body")}}),e.pageRuleId&&$("<input>",{class:"pageruleid",type:"hidden",value:e.pageRuleId}).appendTo("body"),e.batchRules&&e.batchRules[0]&&(e.batchRules[0].cell||new BatchFunc(e.batchRules)))}function odblClick_(e){var t,a=$(e),n=a.closest(".nlayout_elem"),r=contextPath+(t=$(e).attr("surl")||"/mx/form/defined/jsgis")+(t.indexOf("?")>-1?"&":"?")+$.param({targetId:"form"==n.attr("data-role")?a.attr("id"):n.attr("id"),fn:"odblClickCallFunc_"});window.open(r)}function getControlInput(e){return $(e.find("input."+e.attr("id")).get(0)||e)}function odblClickCallFunc_(datas){var $that=$(this),$this=window.getControlInput($that);if(datas)for(var data=datas.data,rules=datas.rule||$this.attr("dbrule"),rs=eval(rules),i=0;i<rs.length;i++){var r=rs[i];if("FID"==r.name)$("#"+r.output).val(data.layerId+"-"+data.FID);else{var $output=$("#"+r.output);window.getControlInput($output).val(data[r.name])}}else if($this[0]){var rules=$this.attr("dbrule");if(rules){for(var rs=eval(rules),data={},i=0;i<rs.length;i++){var r=rs[i];data[r.name]=$("#"+r.output).val()}return data}}}function initImageUploadFunc2(){$("body").delegate(".clickView","click",zoomViewImg),$("body").delegate(".dblclickView","dblclick",zoomViewImg),imageUploadInitFunc()}function zoomViewImg(e){function t(e){n=e?$(window).width():n,r=e?$(window).height():r;var t=$(".img_view_wrap > img");s.css({"line-height":r+"px"}),r/n<t.height()/t.width()?(t.height()>=r||e)&&t.width("").height(r-5):(t.width()>=n||e)&&t.width(n-5).height("")}var a=$(this),n=$(window).width(),r=$(window).height();if(a.hasClass("showWin")){var i=contextPath+"/mx/form/defined/viewImg?srcl=";window.open(i+a.attr("src").replace(/&/gi,"@"),"查看图片","width="+screen.width+",height="+screen.height+",modal=true,status=no,scrollbars=no,resizable=no")}else{var o=$("body");o.append('<div class="hock_wrap" style="display: block; width: 100%;height: 100%; opacity: 0.5;position: absolute;background:#000;top:0;left:0;z-index:9999"></div>'),o.append('<div class="img_view_wrap hock_wrap" style="width: 100%;height:100%;vertical-align:middle;align-items: center;line-height:100%;text-align:center;position: absolute;top:0;left:0;z-index:99999"><img src="'+a.attr("src")+'" style="vertical-align:middle"></div>');var s=$(".img_view_wrap");$(window).resize(t),t(),$(".hock_wrap").on("click",function(e){$(".hock_wrap").remove()})}}function initMutilFileViewsFunc(){var e={childList:!0,arrtibutes:!0,subtree:!0,characterData:!0};new MutationObserver(function(){$(".mt-fileView").each(function(){var e=$(this);if("multi"==e.attr("model")){for(var t=e.html(),a=e.attr("tval"),n=e.attr("split"),r=0,i=e.attr("key"),o=e.attr("url"),s=e.attr("model"),l=e.attr("fid"),u=e.attr("dbid"),c=t.split(","),d=a.split(","),p=c.length,b="";r<p;r++)c[r]&&(b+="<a href='#' fid='"+l+"' kid='"+d[r]+"' dbid='"+u+"' model='"+s+"' key='"+i+"' url='"+o+"' onclick='viewFiles(this)'>"+c[r]+"</a>"+n);b&&(b=b.substr(0,b.length-1),e.after(b),e.remove())}})}).observe(document.body,e),document.body.appendChild(document.createElement("div"))}function initPageBatch(e,t){var a=contextPath+"/mx/form/data/initPageBatch";$.ajax({url:a,type:"post",dataType:"json",data:e,async:!0,success:t})}function BatchFunc(e){this.rules=e,console.log(e),this.deleteCollection=[],this.init()}function Batch(e,t){this.tr=e,this.rows=0,this.template=null,this.tdIndex=t,this.fieldIds=e.data("fieldIds"),this.rule=e.data("rule"),this.fields=new Array,this.init()}function initProgressBarFunc(){var e={childList:!0,arrtibutes:!0,subtree:!0,characterData:!0};new MutationObserver(function(){$(".mt-progressbar").each(function(){var e=$(this),t=JSON.parse(e.attr("data").replace(/\'/gi,'"')),a=e.attr("tval"),n=$('<div class="progress"><div class="progress-bar progress-bar-primary progress-bar-striped"><span class="sr-only">40%</span></div></div>');e.closest(".grid")[0]&&(n.css("margin-bottom","0px"),n.find(".progress-bar").css("color","black")),e.after(n[0]);try{var r={type:t.model,showStatus:t.showState,value:parseFloat(a)};t.min&&(r.min=parseFloat(t.min)),t.max&&(r.max=parseFloat(t.max)),n.attr("style",e.attr("style")),n.progressBarExt(r)}catch(e){console.log(e)}e.remove()}),$(".mt-fileView").each(function(){var e=$(this);if("multi"==e.attr("model")){for(var t=e.html(),a=e.attr("tval"),n=e.attr("split")||" ",r=0,i=e.attr("key"),o=e.attr("url"),s=e.attr("model"),l=e.attr("dbid"),u=e.attr("fid"),c=t.split(","),d=a.split(","),p=c.length,b="";r<p;r++)c[r]&&(b+="<a href='#' fid='"+u+"' kid='"+d[r]+"' dbid='"+l+"' model='"+s+"' key='"+i+"' url='"+o+"' onclick='viewFiles(this)'>"+c[r]+"</a>"+n);b&&(b=b.substr(0,b.length-1),e.after(b),e.remove())}})}).observe(document.body,e),document.body.appendChild(document.createElement("div"))}function getUrlToSplitter(){var e=window.location.href,t=/(https?:\/\/)?(\w+\.?)+(\:\d+)?/.exec(e);return t?t[0]:""}function getUrlNoHttp(){var e=window.location.href,t=/(https?:\/\/)?((\w+\.?)+(\:\d+)?)/.exec(e);return t?t[2]:""}function viewFile(e){var t=$(e),a=t.parents("[rid]").attr("rid")||"",n=t.attr("model"),r="";r="SOA"==n?"http://"+t.attr("soahost")+":"+t.attr("soaport")+"/"+t.attr("soapath"):contextPath+"/mx/form/defined/viewFile?model="+n+"&rp="+t.attr("tval")+"&id="+a+"&key="+t.attr("key")+"&url="+t.attr("url")+"&fid="+t.attr("fid"),window.open(r,"查看附件","modal=true,status=no")}function viewFiles(e){function t(e,t){var a=[".doc",".docx",".xls",".xlsx",".ppt"];"tif"==t?a=[".tif",".tiff"]:"pdf"==t?a=[".pdf"]:"txt"==t&&(a=[".txt"]);for(var n=0;n<a.length;n++)if(-1!=e.toLowerCase().indexOf(a[n]))return!0;return!1}var a=$(e),n=a.html(),r=a.parents("[rid]").attr("rid")||"",i=a.attr("fid"),o=(a.attr("model"),a.attr("kid")),s=a.attr("key"),l=a.attr("dbid"),u=a.attr("url"),c="?id="+o,d=contextPath+"/mx/form/defined/viewImg";i&&s&&u&&(c="?model=FTP&rp="+o+"&id="+r+"&key="+s+"&url="+u+"&fid="+i+"&databaseId="+(l||"")),t(n,"doc")?d=contextPath+"/mx/form/defined/viewFile":t(n,"tif")?d=contextPath+"/mx/form/defined/viewTif":t(n,"pdf")?d=contextPath+"/mx/form/defined/viewPdf":t(n,"txt")&&(d=contextPath+"/mx/form/defined/viewText"),window.WebViewJavascriptBridge?window.open(d+c):window.open(d+c,"查看图片","modal=true,status=no,scrollbars=yes,resizable=yes")}function getUserInfoArray(){var e=$.cookie("userInfo");return e?e.split(","):[]}function getLastUserInfo(){return $.cookie("userInfo")||""}function getParam(e,t){if(pageParameters){var a,n,r,i=pageParameters.detail;if(i&&(a=i.data)&&(n=a[e])&&n.length)for(var o=0,s=n.length;o<s;o++)if((r=n[o]).param==t)return r.inparam?i[r.inparam]:r.value}return null}function getParams(e){if(pageParameters){var t,a,n,r=pageParameters.detail,i={};if(r&&(t=r.data)){if(e){if((a=t[e])&&a.length)for(var o=0,s=a.length;o<s;o++)i[(n=a[o]).param]=n.inparam?r[n.inparam]:n.value}else for(var l in t)if((a=t[l])&&a.length)for(var o=0,s=a.length;o<s;o++)"__defaultValue__"==(n=a[o]).type?i[n.param]=n.columnName:i[n.param]=n.inparam?r[n.inparam]:n.value;return i}}return null}function imageUploadInitFunc(){$("body").delegate(".image_upload_div","change",function(){var e=$(this),t=e.find(".image_upload_input_file")[0],a=e.attr("maxfilesize"),n=t.files[0];if(n)if(n.size>a)alert("上传的文件不能超过"+a/1048576+"M");else{var r={randomparent:e.attr("randomparent"),type:"image"};e.attr("attachmentId")&&(r.attachmentId=e.attr("attachmentId")),$.ajaxFileUpload({url:e.attr("saveurl"),secureuri:!1,fileElementId:t.id,data:r,dataType:"json",success:function(t,a){if(t&&200==t.statusCode){alert("上传成功！"),e.attr("attachmentId",t.attachmentId);var r=e.find(".imageupload_class");r.attr("src",window.URL.createObjectURL(n)).show();var i="/glaf/mx/form/imageUpload?method=downloadById&_"+(new Date).getTime()+"&id="+t.attachmentId,o=new Image;o.onload=function(){EXIF.getData(this,function(){r.data("tags",EXIF.getAllTags(this))})},o.src=i;var s=e.attr("outputName");s&&imageuploadFunc.setOutPutName(s,t.names)}else alert("上传失败！")},error:function(e,t,a){alert("上传失败！Error="+a),console.log("出错 "+t+"; data="+JSON.stringify(e)+"; e="+a)}})}})}function MyAjax(e){var t=e.success;e.success=function(a){t&&$.isFunction(t)&&t(a);var n=e.data;n&&("string"==typeof n&&(n=JSON.parse(n)),n.params&&"string"==typeof n.params&&(n.params=JSON.parse(n.params))),"string"==typeof a&&(a=JSON.parse(a));var r=[{tmplId:"operatorTmpl",name:"操作名称",value:e.operation},{tmplId:"requestParamsTmpl",name:"请求参数",value:n.params||n},{tmplId:"responseResultTmpl",name:"返回结果",value:a}];a&&"500"==a.statusCode?r.push({tmplId:"responseStatusTmpl",name:"结果状态",value:!1}):r.push({tmplId:"responseStatusTmpl",name:"结果状态",value:!0}),mtDebugger.pushQueue("info","operatorTmpl",r)},$.ajax(e)}function SearchCallback(e,t,a,n,r){if(e.callbackParam=e.callbackParam||{},a.total){var i=a.data,o=i[0],s={};$.each(r.callback,function(t,a){e.callbackParam[a.param]=o[a.columnName],a.dataId&&0==a.dataId.indexOf("ary")?(!s[a.dataId]&&(e.callbackParam[a.dataId]=[])&&(s[a.dataId]=!0),$.each(i,function(t,n){e.callbackParam[a.dataId][t]||(e.callbackParam[a.dataId][t]={}),e.callbackParam[a.dataId][t][a.param]=n[a.columnName]})):a.dataId&&0==a.dataId.indexOf("obj")&&(!s[a.dataId]&&(e.callbackParam[a.dataId]={})&&(s[a.dataId]=!0),e.callbackParam[a.dataId][a.param]=o[a.columnName])}),t.isAlt||alert("操作成功完成！")}else $.each(r.callback,function(t,a){e.callbackParam[a.param]=""}),a.message?alert(a.message):t.isAlt||alert("没有查询结果.");pubsub.execChilds(n)}function ClosePageTab(e){var t,a=GetTabWin.find();if(null!=a){var n=function(e){var t=a.$("#link_"+e).closest("li").find("div a");return!a.closePage(t.get(0))};e?n(e):(t=a.__child)&&a.$("iframe").each(function(){if(this.contentWindow===t){var e=a.$(this).closest("div").attr("id");return!n(e)}})}}function GetPageParameter(e){return(pageParameters||{})[e]}function SetPageParameter(e,t){var a=pageParameters;a&&(a[e]=t)}function initPageConfigFunc(e){var t=[];e.bgImage&&0==e.bgImage.length||(e.bgImage&&1==e.bgImage.length?$.backstretch([contextPath+e.bgImage[0].name],{fade:1e3*e.fade,duration:1e3*e.duration}):e.bgImage&&($.each(e.bgImage,function(e,a){t[e]=contextPath+a.name}),$.backstretch(t,{fade:1e3*e.fade,duration:1e3*e.duration})))}function initPageLevel(){var parent,parentPageLevel;try{parent=window.opener||window.parent,parentPageLevel=parent.pageLevel}catch(e){}if(pageLevel=parentPageLevel?parentPageLevel+1:1,1!=pageLevel)if(isWeighting){var pageedJson=null;try{pageedJson=JSON.parse(pageed)}catch(e){pageedJson=eval(pageed)}pageed=$.extend({},parent.pageed||{}),pageed[pageLevel]=pageedJson}else pageed=$.extend({},parent.pageed||{});else if(pageed){var pageedJson=null;try{pageedJson=JSON.parse(pageed)}catch(e){pageedJson=eval(pageed)}pageed={},pageed[pageLevel]=pageedJson}if(pageed)for(var plevel in pageed){for(var pageEvents=pageed[plevel],len=pageEvents.length,pageEvent,triggers,trigger,thref=window.location.href,pageParamsObj=pageParameters||{},pageId=pageParamsObj.id,stockMoObj={},i=0;i<len;i++){pageEvent=pageEvents[i],triggers=pageEvent.trigger;for(var j=0;j<triggers.length;j++)if(!((trigger=triggers[j]).level!=pageLevel&&trigger.level!=pageLevel-plevel+1||-1==thref.indexOf(trigger.pageId)&&pageId!=trigger.pageId)){var $this=$("#"+trigger.eleId),r=trigger.eleId.length>31?"page":pubsub.getRole(trigger.eleId),nb="button"==r?"default":r,t=$this.attr("data-role")||nb;trigger.otype&&trigger.oid&&($this=$("#"+trigger.oid),t=trigger.otype);var columnnameKey="columnname",columnname=$this.attr(columnnameKey),ety=null;if(columnname){var $table=$this.closest("table"),eventType=trigger.eventType,index=$this.closest("tr").index();if("listenVal"==eventType){var moObj=stockMoObj[$table.attr("tbid")]||(stockMoObj[$table.attr("tbid")]={target:$table,stock:[]}),stock=moObj.stock;stock.push({columnname:columnname,pageEvent:pageEvent,index:index}),eventType="change"}else if("listenKey"==eventType){var moObj=stockMoObj[$table.attr("tbid")]||(stockMoObj[$table.attr("tbid")]={target:$table,stock:[]}),stock=moObj.stock;stock.push({columnname:columnname,pageEvent:pageEvent,index:index}),eventType="keyup"}else if("listenEnter"==eventType){var moObj=stockMoObj[$table.attr("tbid")]||(stockMoObj[$table.attr("tbid")]={target:$table,stock:[]}),stock=moObj.stock;stock.push({columnname:columnname,pageEvent:pageEvent,index:index}),eventType="keyup",ety="listenEnter"}null!=ety?$table.on(eventType+"."+columnname,"["+columnnameKey+"="+columnname+"]",{index:index,pageEvent:pageEvent},function(e){"13"==e.keyCode&&(pubsub.elongateStockIndex=$(this).closest("tr").index()-e.data.index,pubsub.pub(e.data.pageEvent,""),pubsub.elongateStockIndex=null)}):$table.on(eventType+"."+columnname,"["+columnnameKey+"="+columnname+"]",{index:index,pageEvent:pageEvent},function(e){pubsub.elongateStockIndex=$(this).closest("tr").index()-e.data.index,pubsub.pub(e.data.pageEvent,""),pubsub.elongateStockIndex=null})}else{var fn=pubsubobjects[t]||pubsubobjects.default;fn.call($this,{pageEvent:pageEvent,trigger:trigger,eventType:trigger.eventType})}}}for(var tbid in stockMoObj){var stock=stockMoObj[tbid];stock.target.data("moStock",stock);var ink=new MutationObserver(function(e){$.each(e,function(e,t){var a=t.target.getAttribute?t.target.getAttribute("columnname")||$(t.target).closest("[data-role]").attr("columnname"):null,n=$(t.target).closest("table").data("moStock").stock;a&&-1!=t.attributeName.indexOf("setvalue")?$.each(n,function(e,n){n.columnname==a&&(pubsub.elongateStockIndex=$(t.target).closest("tr").index()-n.index,pubsub.pub(n.pageEvent,""),pubsub.elongateStockIndex=null)}):t.removedNodes.length&&$.each(n,function(e,a){pubsub.elongateStockIndex=$(t.previousSibling).closest("tr").index()-a.index,pubsub.pub(a.pageEvent,""),pubsub.elongateStockIndex=null})})});ink.observe(stock.target[0],{attributes:!0,subtree:!0,childList:!0,attributesFilter:["setvalue"]})}}initPageValidate({validate_type_foucs:function(e){e.attr("valiBlur","true"),e.on("blur",function(e){$(this).valid()})},validate_type_save:function(e){e.attr("valiSave","true")},bindEvent:function(){var e=$("body").children();$("body").append('<form id="validateform" >'),$("body").find("#validateform").append(e),$("#validateform").validate({onfocusout:!1,errorElement:"em",errorPlacement:function(e,t){$(t).data("isJqfileupload2")&&(t=$(t).parent()),e.addClass("help-block"),e.insertAfter(t);var a=e.css("color");$(t).data("isICheck")?($(t).closest("label").parent().addClass("has-error"),$(t).closest("label").parent().append(e)):$(t).data("isSelect2")?e.insertAfter($(t).next().next()):$(t).data("isDatepicker")&&e.insertAfter($(t).parent()),$(t).data("isDatepicker")?t.parent("div").parent("div").addClass("has-feedback"):t.parent("div").addClass("has-feedback");var n=$(t).next("span.glyphicon")[0];if($(t).data("isDatepicker")&&(n=$(t).parent("div").next("span.glyphicon")[0]),!n&&!$(t).data("isICheck")){var r="";($(t).hasClass("nlayout_elem")||$(t).data("isDatepicker"))&&(r=" nlayout_elem"),$("<span class='glyphicon glyphicon-remove form-control-feedback"+r+"'></span>").insertAfter(t),n=$(t).next("span.glyphicon")[0],$(t).data("isDatepicker")&&(n=$(n).insertAfter(t.parent("div")));var i=$(n);i.css("line-height",i.height()+"px"),$(t).data("isSelect2")&&i.css({"z-index":100,right:0}),$(t).data("isDatepicker")&&(i.css({"background-color":"white","border-left":"1px solid "+a}),$(t).next().find("button").css({color:a,border:"1px solid "+a}))}},success:function(e,t){$(t).data("isJqfileupload2")&&(t=$(t).parent());var a=$(t).next("span.glyphicon")[0];$(t).data("isDatepicker")&&(a=$(t).parent("div").next("span.glyphicon")[0]);var n=$(a).css("color");if(!a&&!$(t).data("isICheck")){var r="";($(t).hasClass("nlayout_elem")||$(t).data("isDatepicker"))&&(r=" nlayout_elem"),$("<span class='glyphicon glyphicon-ok form-control-feedback"+r+"'></span>").insertAfter(t),a=$(t).next("span.glyphicon")[0],$(t).data("isDatepicker")&&(a=$(a).insertAfter(t.parent("div")));var i=$(a);i.css("line-height",i.height()+"px"),$(t).data("isSelect2")&&i.css({"z-index":100,right:0}),$(t).data("isDatepicker")&&(i.css({"background-color":"white","border-left":"1px solid "+n}),$(t).next().find("button").css({color:n,border:"1px solid "+n}))}},highlight:function(e,t,a){if($(e).data("isDatepicker"))$(e).parent("div").parent("div").addClass("has-error").removeClass("has-success"),$(e).parent("div").next("span.glyphicon").addClass("glyphicon-remove").removeClass("glyphicon-ok");else if($(e).data("isICheck"));else if($(e).data("isJqfileupload2")){var n=$(e).parent();n.parent("div").addClass("has-error").removeClass("has-success"),n.next("span.glyphicon").addClass("glyphicon-remove").removeClass("glyphicon-ok")}else $(e).parent("div").addClass("has-error").removeClass("has-success"),$(e).next("span.glyphicon").addClass("glyphicon-remove").removeClass("glyphicon-ok")},unhighlight:function(e,t,a){if($(e).data("mtValidate"))if($(e).data("isDatepicker")){$(e).parent("div").parent("div").addClass("has-success").removeClass("has-error"),$(e).parent("div").next("span.glyphicon").addClass("glyphicon-ok").removeClass("glyphicon-remove");var n=$(e).parent("div").next("span.glyphicon");if(n){var r=$(n).css("color");$(n).css({"background-color":"white","border-left":"1px solid "+r}),$(e).next().find("button").css({color:r,border:"1px solid "+r})}}else if($(e).data("isICheck"));else if($(e).data("isJqfileupload2")){var i=$(e).parent();i.parent("div").addClass("has-success").removeClass("has-error"),i.next("span.glyphicon").addClass("glyphicon-ok").removeClass("glyphicon-remove")}else $(e).parent("div").addClass("has-success").removeClass("has-error"),$(e).next("span.glyphicon").addClass("glyphicon-ok").removeClass("glyphicon-remove")}});var t=$("[mtValidate=true]");$.each(t,function(e,t){var a=$(t),n="true"==a.attr("valiBlur"),r=a.data("rule-method");a.data("isICheck")&&n?(r=a.attr("name"),$("input[name="+a.attr("name")+"]").on("ifChanged",function(e){a.valid()})):a.data("isJqfileupload2")?n&&a.change(function(e){a.valid()}):a.attr("name",r),a.data("isDatepicker")&&n&&a.change(function(e){a.valid()}),a.data("isSelect2")&&n&&a.change(function(e){a.valid()});var i=a.data("mt-vail-er-msg")||a.data("mtValidate").tip;setCustomRule(a,i)})}})}function initPageValidate(e){function t(t,a){var n=a.type.split(",");$.each(n,function(a,n){switch(n){case"validate_type_foucs":e.validate_type_foucs(t);break;case"validate_type_save":e.validate_type_save(t)}})}window.parent;if(mtValidate&&"[]"!==mtValidate){for(var a,n,r,i,o,s=JSON.parse(mtValidate),l=s.length,u={},c=0;c<l;c++){i=(n=(a=s[c]).trigger).length;for(var d=0;d<i;d++)if(r=n[d],r.level=r.inlev=pageLevel,o=pubsub.getJQObj(r,!0)){var p=o.attr("data-role")||"",b=o.attr("id"),f=o.attr("cname");if(o){if("gridbt"==p){u[b]||(u[b]=[]),u[b].push({mtValidate:a,dataRole:p,ruleId:b,"rule-method":b,mtValiObj:r,"attr-mtValidate":"true","attr-mtTitle":f});continue}var g=o.find("input");if(-1!=p.indexOf("metroselect")){var m=o.find("select")[0],h=o.attr("id");(o=$(m)).attr("name",h),o.data("isSelect2",!0)}else-1!=p.indexOf("icheck")?(o=$(g[0])).data("isICheck",!0):-1!=p.indexOf("datepicker")?(o=$(g[0])).data("isDatepicker",!0):-1!=p.indexOf("textareabt")?(o=o.find("textarea")).data("isTextareabt",!0):-1!=p.indexOf("touchspin")?(o=$(g[0])).data("isTouchspin",!0):-1!=p.indexOf("datetimepickerbt")?(o=$(g[0])).data("isDatepicker",!0):-1!=p.indexOf("jqfileupload2")&&(o=$(g[0])).data("isJqfileupload2",!0);o.data("dataRole",p),o.data("ruleId",b),o.data("rule-method",b),o.data("mtValidate",a).data("mtValiObj",r).attr("mtValidate","true").attr("mtTitle",f),t(o,a)}}}for(var v in u){var y=$("#"+v),x=u[v];y.on("click",function(e){console.log(e);var a=$(e.target),n=a.attr("name");n&&$.each(x,function(e,r){if(n==r.mtValiObj.inid&&!a.attr("mtValidate")){var i,o=a.closest("td"),s=$("#"+r.ruleId).find("thead tr th");$.each(s,function(e,t){t.getAttribute("tid")==o.attr("hid")&&(i=t.innerText)}),a.data("dataRole",r.dataRole),a.data("ruleId",r.ruleId),a.data("rule-method",r.ruleId),a.data("mtValidate",r.mtValidate).data("mtValiObj",r.mtValiObj).attr("mtValidate","true").attr("mtTitle",i),t(a,r.mtValidate),setCustomRule(a,a.data("mt-vail-er-msg")||a.data("mtValidate").tip)}})})}e.bindEvent()}}function configMtbutton(e){if(e&&!e.isVisible&&$("#"+e.id).css("display","none"),e&&!e.isEnabled&&$("#"+e.id).attr("disabled","disabled"),e&&e.sureDialog){if(!$().confirmation)return;$("#"+e.id).off(".mtbutton"),$("#"+e.id).confirmation({container:"body",placement:e.dialogPosition,title:"是否确定?",btnOkClass:"btn btn-sm btn-success",btnOkLabel:"确定",btnCancelClass:"btn btn-sm btn-danger",btnCancelLabel:"取消",onConfirm:function(t,a){kendoButtonFunc(e,"mtbutton")}})}}function kendoButtonFunc(e){if(!e.buttonType)return!1;var t=e.functions;t||(t=new MtButton(e)),e.buttonType in t?t[e.buttonType]():alert(e.buttonType+" 方法未找到")}function MtButton(e){this.buttonKey="MtButton",this.$target=$("#"+e.id),this.viewModel=e,this.init(),function(e){e.$target.get(0)&&$.data(e.$target.get(0),e.buttonKey,e)}(this)}function getFormValiate(){var e=$("[valiSave=true]");return!e.get(0)||e.valid()}function getBootstrapData(e){if(!e||!e[0])return null;var t=e.attr("data-role");return{dataRole:t||"text",bootstrap:e.data(roleList[t])}}function getOpenDialogToggle(e){if(pageParameters){var t=pageParameters,a=e.opener||e.parent;if(t&&t.btnId)return a.$("#"+t.btnId).data("MtButton")}return null}function MtButtonClose(e,t){if(pageParameters){var a=pageParameters,n=e.opener||e.parent;if(!a||!a.btnId)return MtButtonClose(n);var r=n.$("#"+a.btnId).data(t.buttonKey);a.newWin&&r&&r.dialogRel.close()}return!1}function expandNodesFunc(e,t,a){var e=e;(a=a)&&a>=2&&t&&t.length>0&&$.each(t,function(t,n){e.expandNode(n,!0,!1,!0),expandNodesFunc(e,n.children,a-1)})}function getParentByParam(node,field,exp,outFiled,isDeep){var pNode=node.getParentNode(),depVal,retVal="";return pNode&&(eval("'"+pNode[field]+"'"+exp)?(retVal=pNode[outFiled],isDeep&&(depVal=getParentByParam(pNode,field,exp,outFiled,isDeep))&&(retVal=depVal)):retVal=getParentByParam(pNode,field,exp,outFiled,isDeep)),retVal}function getChildByParam(node,field,exp,outFiled,isDeep){var childrens=node.children;if(childrens&&childrens.length){for(var children,retVal="",childVal,i=0;i<childrens.length;i++)if(children=childrens[i],eval("'"+children[field]+"'"+exp)){if(retVal=children[outFiled],!isDeep)return retVal}else(childVal=getChildByParam(children,field,exp,outFiled,isDeep))&&(retVal=childVal);return retVal}return""}function getTreeUpNode(e,t,a,n,r){try{return getParentByParam(e[1],t,a,n,r)}catch(e){console.log(e)}return""}function getTreeDownNode(e,t,a,n,r){try{return getChildByParam(e[1],t,a,n,r)}catch(e){console.log(e)}return""}function getTreeNode(e,t,a,n){r=t[1];if(0==a)var r=r.getParentNode()}function isMobile(){for(var e=navigator.userAgent,t=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),a=!1,n=0;n<t.length;n++)if(e.indexOf(t[n])>0){a=!0;break}return a}function initImageUploadFunc(){$("[data-role=imageupload]").each(function(){initImageUpload(this,this.id,$(this).attr("randomparent"))}),$("body").delegate(".clickViewImg","click",zoomViewImg),$("body").delegate(".dblclickViewImg","dblclick",zoomViewImg)}function initImageUpload(e,t,a){if(e){var n=!0;a||(a=(new UUID).createUUID(),n=!1),e.setAttribute("randomparent",a);var r=$(e).attr("downloadUrl"),i=$("#"+t).find(".imageupload_class");i.attr("src",r+"&_"+(new Date).getTime()+"&randomparent="+a),i[0]&&(i[0].onload=function(){EXIF.getData(i[0],function(){$(this).data("tags",EXIF.getAllTags(this))})}),n&&i.show()}}function uploadSuccessDo(e,t){for(var a=t.result,n="",r="",i=$(this).data("spFileUpload").opts.outputNames,o=$(this).data("spFileUpload").opts.outputIds,s=0;s<a.length;s++)n+=a[s].fileName+",",r+=a[s].id+",";if(i&&n)for(var l=i.split(","),u=0;u<l.length;u++){outputName=l[u];b=(p=$("#"+outputName)).val();p.val((b?b+",":"")+n.substr(0,n.length-1))}if(o&&r)for(var c=o.split(","),u=0;u<c.length;u++){var d=c[u],p=$("#"+d),b=p.val();p.val((b?b+",":"")+r.substr(0,r.length-1))}}function deleteDo(e){for(var t=e,a="",n="",r=$(this).data("spFileUpload").opts.outputNames,i=$(this).data("spFileUpload").opts.outputIds,o=0;o<t.length;o++)a+=t[o].fileName+",",n+=t[o].id+",";if(r&&a)for(var s=r.split(","),l=0;l<s.length;l++){outputName=s[l];d=((c=$("#"+outputName)).val()+",").replace(a,"");c.val(d.substr(0,d.length-1))}if(i&&n)for(var s=i.split(","),l=0;l<s.length;l++){var u=s[l],c=$("#"+u),d=(c.val()+",").replace(n,"");c.val(d.substr(0,d.length-1))}}function c_gv(e){return $("#"+e).val()}function c_gn(e){for(var t=$("[name="+e+"]"),a=0;a<t.length;a++);}function jsif(e,t,a){return e?t:a}function SETVARIABLE(e,t){var a={id:e,index_id:t};return e.startsWith("criterion_")?a.type="cri_params":a.type="cri",a}function CRITERIONSTAT(e,t){return{id:e,ctype:t,type:"stat"}}function getMtValue(e,t){var a=e;return t&&t.length>1&&t[2]&&t[2].length>1&&$.each(t[2],function(){a=this.value}),a}function openDialog(e,t){e.preventDefault();var a=$(e.target).closest("a");a[0]||(a=$(e.currentTarget));var n=a.attr("dialogHeight"),r=a.attr("dialogWidth"),i=a.attr("isModel"),o=a.attr("ahref"),s=a.attr("title")||a.text(),l=(window.screen.availHeight-30-n)/2,u=(window.screen.availWidth-10-r)/2;if("true"==i){o.startsWith(contextPath)&&(o=o.replace(contextPath,""));var c={url:o,name:s,id:"xx"},d={link:JSON.stringify(c),model:!0,title:s,jumpType:"childPage",width:r,height:n};pageFunc.newWindow("","",[d])}else{var p="height="+n+",width="+r+",top="+l+",left="+u+",toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no";window.open(o,s,p)}}var FlowProcess={SUBMIT:0,STOP:1,CANCEL:2,ACTIVE:3,REJECT:4};FlowProcess.callWindow=function(e,t,a,n){$.extend(FlowProcess,{args:e,sfn:t,efn:a});var r=contextPath+"/mx/form/defined/ex/flowProcessFeedback?taskId="+(e.taskId||"")+"&"+$.param({processId:e.processId,type:e.type,fn:n||"FlowProcessFunc"}),i=$("<iframe>",{frameborder:"no",width:"100%",height:400});FlowProcess.dialog=window.show({css:{width:650,height:450},message:i,onshown:function(e){i.attr("src",r)}})},FlowProcessFunc.close=function(){FlowProcess.dialog&&FlowProcess.dialog.close()},FlowProcess.stop=function(e){if(!confirm("你确定终止流程吗?"))return!1;FlowProcess.callWindow({type:FlowProcess.STOP,processId:e.processId})},FlowProcess.stop0=function(e,t){return FlowProcessFunc0(e,$.extend(!0,{},t,{type:FlowProcess.STOP}),"终止")},FlowProcess.cancel=function(e){if(!confirm("你确定挂起流程吗?"))return!1;FlowProcessFunc({type:FlowProcess.CANCEL,processId:e.processId})},FlowProcess.cancel0=function(e,t){return FlowProcessFunc0(e,$.extend(!0,{},t,{type:FlowProcess.CANCEL}),"挂起")},FlowProcess.active=function(e){if(!confirm("你确定激活流程吗?"))return!1;FlowProcessFunc({type:FlowProcess.ACTIVE,processId:e.processId})},FlowProcess.active0=function(e,t){return FlowProcessFunc0(e,$.extend(!0,{},t,{type:FlowProcess.ACTIVE}),"激活")},FlowProcess.reject=function(e){FlowProcess.callWindow({type:FlowProcess.REJECT,processId:e.processId,taskId:e.taskId})},FlowProcess.reject0=function(e,t){return t.taskId?FlowProcessFunc0(e,$.extend(!0,{},t,{type:FlowProcess.REJECT}),"撤回/退回"):(alert("流程任务id不能为空"),!1)},FlowProcess.submit=function(e){FlowProcess.callWindow({type:FlowProcess.SUBMIT,processId:e.processId,taskId:e.taskId})},FlowProcess.mtAssign0=function(e,t){if(!t.processId)return alert("流程实例id不能为空"),!1;var a=contextPath+"/mx/form/workflow/defined/assign";$.ajax({url:a,data:t,type:"post",dataType:"json",success:function(t){t&&(t.errMsg?alert(t.errMsg):alert("操作成功!"),pubsub.execChilds(e))},error:function(e){alert("服务器处理出错!")}})},FlowProcess.mtSubmit0=function(e,t){function a(t){var a,n=window;$.isPlainObject(e)&&(a=e),$.isArray(e)&&(a=e[0]),n.callbackParam=n.callbackParam||{},$.each(a.callback,function(e,a){n.callbackParam[a.param]=t[a.param]}),pubsub.execChilds(e)}if(window.$ParentFlow){if(0!=t.approve)return window.$ParentFlow.submit(a);if(1!=t.notOpen)return window.$ParentFlow.back(FlowProcess.callback=a)}if(!t.processId)return alert("流程实例id不能为空"),!1;if(0==t.approve&&1==t.notOpen)return t.approve=null,t.notOpen=null,FlowProcessFunc0(e,$.extend(!0,{},t,{type:FlowProcess.REJECT}),"撤回/退回");if(!confirm((0==t.approve?"退回":"提交")+"流程?"))return!1;var n=contextPath+"/mx/form/workflow/defined/submit";$.ajax({url:n,data:t,type:"post",dataType:"json",success:function(t){t&&(t.errMsg?alert(t.errMsg):alert("操作成功!"),pubsub.execChilds(e))},error:function(e){alert("服务器处理出错!")}})};var mtxx={},baseFunc=function(){return{thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){var a=pubsub.getJQObj(e);a.attr("data-role")&&"a"==a.attr("data-role")?a.css("display","block"):a.show()},tdisabled:function(e,t){pubsub.getJQObj(e).attr("disabled","disabled")},tenabled:function(e,t){pubsub.getJQObj(e).removeAttr("disabled")},_init_:function(rule,param,args){var $id=pubsub.getJQObj(rule);eval("("+__gobalInit__[$id.attr("id")]+")")($.isArray(param)?{}:param),pubsub.execChilds(rule)},setIndex:function(e,t){for(var a=pubsub.getJQObj(e),n="",i=0;i<e.length;i++)r=e[i],n=t[r.param]||"";a.css("z-Index",n)}}};BatchFunc.prototype={constructor:BatchFunc,init:function(){var e=this,t=e.rules;e.initTools();for(var a=0;a<t.length;a++){var n=t[a],r=n.tableMsg,i=n.tableName,o=n.dataSetId,s=n.typeField,l=n.topTableName,u=$("."+l+"[fieldName=id]");if(u[0]||(u=$("."+l+"[fieldName=topid]")),r){var c,d={stuff:new Object};if(window.batch=e,o&&u.val()){n.topId=u.val();var p=contextPath+"/mx/form/data/initPageBatch";$.ajax({url:p,type:"post",dataType:"json",data:{dataSetId:o,topId:u.val()},async:!1,success:function(e){var t=e.rows;t&&t.length&&$.each(t,function(e,t){var a=new Object;for(var n in t)a[n.replace(i+"_0_","")]=t[n];c=a[s]||"sys-0",d[c]||(d[c]=new Array),d[c].push(a)})}})}for(var b=(new Date).getTime(),f=0;f<r.length;f++){var g=r[f],m=$("#"+g.cid).closest("table"),h=g.trIndex,v=g.tdIndex;m.unbind("click.elements").on("click.elements","td [columnname]",function(e){var t=$(e.target).closest("tr"),a=m.find("tr[tid='"+t.attr("class")+"']");t.find("[columnname]").each(function(e,t){var n=$(t);!n.attr("id")&&n.attr("id",b++),a.find("[columnname='"+n.attr("columnname")+"']").attr({toId:n.attr("id")})})});var y=d[g.xy];if(g.items){var x=m.find("tr"),w=x.eq(h).data("fieldIds",g.fieldIds).data("type",{typeField:s,typeCode:g.xy,typeName:g.name}).data("rule",n),j=new Batch(w,v),k=w.attr("tId");d.stuff[g.xy]={fn:j,length:g.items.length},$.each(g.items,function(e,t){var a=x.eq(t.trIndex).addClass(k);a&&a[0]&&(j.initTrEvents(a),w[0]!==a[0]&&a.find("td").each(function(e,t){var a=$(this).children().last();a&&a[0]&&a.attr({columnName:j.fields[e]})}),j.rowspan(1),y&&y.length>=e&&j.set(y[e],a))})}}if(d.stuff){var O;for(var S in d.stuff)if(O=d.stuff[S]){var T=d[S];if(T&&T.length>O.length){var F=T.slice(O.length,T.length);F&&O.fn.add(F)}}}}}},getValue:function(e){function t(){e.splice(n,a.length)}for(var a,n,r=this,i=r.rules,o=(new Date).getTime(),s=0;s<i.length;s++){var l=i[s],u=l.cId;e.length>0&&function(r){a=[],n=-1,$.each(e,function(e,t){t.table&&t.table.tableName==r&&(a.push(t),-1==n&&(n=e))}),a.length&&t()}(l.tableName);var c=$("#"+u).closest("table"),d=c.attr("tbId");c.find("tr[tbid='"+d+"']").each(function(){var t=$(this),a=t.data("type")||{},n=t.attr("tId");c.find("."+n).each(function(t,n){var r=new Array,i=$(this).data("row");e.push({idValue:i?i.id:"",table:{tableName:l.tableName},columns:r}),a.typeField&&r.push({fieldName:a.typeField,value:a.typeCode}),r.push({fieldName:"listno",value:t}),r.push({fieldName:"topId",value:l.topId}),o++,r.push({fieldName:"batchId",value:o}),$(this).addClass("_"+o,o),$(this).find("[columnName]").each(function(){var e=$(this),t=e.attr("columnName");t&&r.push({fieldName:t,value:e.mtbootstrap("getValue")})})})})}var p=r.deleteCollection;if(p.length>0)for(s=0;s<p.length;s++)e.push(p[s])},initTools:function(){var e=$(".k-batch-tools");return e[0]||(e=$("<div>",{class:"k-batch-tools"}).css({position:"absolute","z-index":"99"}).appendTo(document.body).hide(),$("<button>",{class:"k-button k-batch-tools-add"}).text("↑").on("click",function(t){t.preventDefault();var a=e.data("o");a&&a.fn&&a.fn.insert(null,a.target,"top")}).appendTo(e),$("<button>",{class:"k-button k-batch-tools-add"}).text("↓").on("click",function(t){t.preventDefault();var a=e.data("o");a&&a.fn&&a.fn.insert(null,a.target,"bot")}).appendTo(e),$("<button>",{class:"k-button k-batch-tools-remove"}).text("-").on("click",function(t){t.preventDefault();var a=e.data("o");a&&a.fn&&a.fn.remove(a.target)}).appendTo(e),$("<button>",{class:""}).text("X").on("click",function(t){t.preventDefault();e.hide()}).appendTo(e)),e}};var $copyRole=function(){var e={touchspin:"touchSpinExt",datepickerbt:"datepickerExt"},t={touchspin:function(){return!$(this).find("input").attr("disabled")},textboxbt:function(){return!$(this).attr("disabled")}},a=function(){};return a.add=function(t,a){e[t]=a},a.get=function(t){return e[t]},a.getOptions=function(e){var t=$.extend(!0,{},e.options,{id:this.id}),n=a.enabled($("#"+e.options.id));return void 0!==n&&(t.enabled=n),t},a.enabled=function(e){var a=e.data("role"),n=t[a];if(n)return n.call(e.get(0))},a}();Batch.prototype={constructor:Batch,init:function(){var e=this;e.fieldIds&&($.each(e.fieldIds,function(t,a){var n=e.tr.find("#"+a.id);n&&n[0]&&n.attr({columnName:a.columnName})}),e.tr.find("[columnName]").each(function(){e.fields.push($(this).attr("columnName"))}));for(var t=e.tr.clone(!0),a=0;a<=e.tdIndex;a++)t.find("td").eq(a).remove();e.template=t.html();var n=e.tr.closest("table"),r=n.attr("tbId")||(new Date).getTime();return n.attr("tbId",r),e.tr.attr({"data-role":"k-batch",tId:"tr"+((new Date).getTime()+e.tr.index()),tbId:r}),e},set:function(e,t){if(e)for(var a in e){var n=t.data("table",{tableName:this.rule.tableName}).data("row",e).find("[columnName='"+a+"']");n&&n[0]&&n.mtbootstrap("setValue",e[a])}return this},add:function(e,t){function a(e){var a=t,r=t;0==n.rows||(a=$("<tr>",{class:n.tr.attr("tId")}),t.after(a)),a.append(n.template);var i=(new Date).getTime();return e=e||{},a.find("[id]").each(function(){var t,a=$("#"+this.id),n=a.attr("columnname"),o=a.data("optionsKey"),s=this.id+i++;if($(this).show().attr({tempId:this.id,id:s}).removeClass(this.id).find("."+this.id).removeClass(this.id).addClass(s),"true"==a.attr("tmpval")){var l=r?r.find("[columnname='"+n+"']").mtbootstrap("getValue"):null;e[n]||(e[n]=l||a.mtbootstrap("getValue"))}if(o||(t=a.data())&&t.role&&a.data(t.role)&&(o={key:t.role,options:$.extend(!0,{},a.data(t.role).options)},a.data("optionsKey",o)),o){var u=$copyRole.get(o.key)||o.key;if($.fn[u]){var c=$copyRole.getOptions.call(this,o);$(this)[u](c)}else $copyRole.enabled(a)||$(this).attr("disabled","disabled")}}),n.initTrEvents(a).rowspan(1).set(e,a),a}var n=this;if(t=t||$("."+n.tr.attr("tid")+":last"),e)for(var r=0;r<e.length;r++)t=a(e[r]);else a();return n},insert:function(e,t,a){function n(e){var n=t,i=t;0==r.rows||(n=$("<tr>",{class:r.tr.attr("tId")}),"top"==a?null!=t[0].previousElementSibling.getAttribute("class")&&t.before(n):"bot"==a&&t.after(n)),n.append(r.template);var o=(new Date).getTime();return e=e||{},n.find("[id]").each(function(){var t,a=$("#"+this.id),n=a.attr("columnname"),r=a.data("optionsKey"),s=this.id+o++;if($(this).show().attr({tempId:this.id,id:s}).removeClass(this.id).find("."+this.id).removeClass(this.id).addClass(s),"true"==a.attr("tmpval")){var l=i?i.find("[columnname='"+n+"']").mtbootstrap("getValue"):null;e[n]=l||a.mtbootstrap("getValue")}if(r||(t=a.data())&&t.role&&a.data(t.role)&&(r={key:t.role,options:$.extend(!0,{},a.data(t.role).options)},a.data("optionsKey",r)),r){var u=$copyRole.get(r.key)||r.key;if($.fn[u]){var c=$copyRole.getOptions.call(this,r);$(this)[u](c)}else $copyRole.enabled(a)||$(this).attr("disabled","disabled")}}),r.initTrEvents(n).rowspan(1).set(e,n),n}var r=this;if(t=t||$("."+r.tr.attr("tid")+":last"),e)for(var i=0;i<e.length;i++)t=n(e[i]);else n();return r},remove:function(e){if(confirm("确定删除?"))if(this.tr[0]===e[0])alert("首行不能删除!");else{var t=e.data("row"),a=e.data("table");if(t&&a&&window.batch){var n={delete:!0,tableName:a.tableName,id:t.id};window.batch.deleteCollection.push(n)}e.remove(),this.rowspan(-1),$(".k-batch-tools").hide()}return this},rowspan:function(e){return this.rows=this.rows+e,this.tdIndex>-1&&this.tr.find("td").eq(this.tdIndex).attr("rowspan",this.rows),this},initTrEvents:function(e){var t=this,a=e.find("td:last"),n=$(".k-batch-tools");e.closest("table");return e.off("mouseover").on("mouseover",function(e){var t=a.offset();return n.css({left:t.left+1*a.css("width").replace(/px/gi,"")-50,top:t.top}).show(),!0}).off("mouseout").on("mouseout",function(r){var i=$(r.target);return i.is("td")||(i=i.closest("td")),i.get(0)==a[0]?n.data("o",{fn:t,target:e}):n.hide(),!0}),t}},String.prototype.startsWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substr(0,e.length)==e},String.prototype.endsWith=function(e){return!(null==e||""==e||0==this.length||e.length>this.length)&&this.substring(this.length-e.length)==e},Array.prototype.remove=function(e,t){var a=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,a)},Array.prototype.removeObj=function(e){return this.remove(this.indexOf(e))};var mtutils=function(){var e={};return e.sleep=function(e){for(var t=new Date,a=t.getTime()+e;;)if((t=new Date).getTime()>a)return},e.eachDelays=function(e,t){if(this.sleep(t),"function"==typeof e)return e.call(this)},e}(),getSysDate=function(){return pageParameters.sys_date},getContextPath=function(){return window.location.host+contextPath},mtExpressions=mtException=function(){var mt={};mt.arrayContains=function(e,t){if(t&&e)for(var a=t.split(","),n=0;n<a.length;n++)if(-1!=e.indexOf(a[n]))return!0;return!1},mt.seqGenerator=function(e,t,a){var n=(e+"").length,r=[];!t&&(t=n),e=parseInt(e);var i=t-((e=(isNaN(e)?0:e)+1)+"").length;return r.length=i<=0?0:i+1,r.join(a||"0")+e},mt.conc=function(e,t){return e+""+t},mt.len=function(e){return(e+="")?e.length:0},mt.find=function(e,t){return e&&t?e.indexOf(t):-1},mt.search=function(e,t){return e+="",t+="",e&&t?e.toUpperCase().indexOf(t.toUpperCase()):-1},mt.lower=function(e){return(e+="")?e.toLowerCase():e},mt.upper=function(e){return(e+="")?e.toUpperCase():e},mt.subString=function(e,t,a){return e=(e||"")+"",void 0!=a?e.substring(t,t+a):e.substring(t)},mt.trim=function(e){return $.trim(e)},mt.replace=function(e,t,a){return e.replace(new RegExp(t),a)},mt.replaceAll=function(e,t,a){return e.replace(new RegExp(t,"gm"),a)},mt.getStrByIndex=function(e,t,a){var n=(e=(e||"")+"").split(a||",");return t<=n.length&&t>=1?n[t-1]:""},mt.getOccurSize=function(e,t){for(var a=0,n=-1;(n=e.indexOf(t,n))>-1;)++n,++a;return a},mt.digitUppercase=function(e){var t=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],n=[["元","万","亿"],["","拾","佰","仟"]],r=(e=parseFloat(e))<0?"欠":"";e=Math.abs(e);for(var i="",o=0;o<t.length;o++)i+=(a[Math.floor(10*e*Math.pow(10,o))%10]+t[o]).replace(/零./,"");i=i||"整",e=Math.floor(e);for(o=0;o<n[0].length&&e>0;o++){for(var s="",l=0;l<n[1].length&&e>0;l++)s=a[e%10]+n[1][l]+s,e=Math.floor(e/10);i=s.replace(/(零.)*零$/,"").replace(/^$/,"零")+n[0][o]+i}return r+i.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")};var funcs={convertGis:function(arys){var retAry=[],str;return $.each(arys,function(i,v){for(var p in v)(str=v[p])&&(str=eval("("+str+")"),retAry.push([str[0].Longitude,str[0].Latitude]))}),JSON.stringify(retAry)}};return mt.func=function(){var e=Array.prototype.slice.call(arguments,1),t=arguments[0];return funcs[t].apply(this,e)},mt}(),mtMath=function(){var e={};return e.sum=function(e){if(e){if("string"==typeof e){var t=e.split(","),a=0;return $.each(t,function(e,t){t&&(a+=parseFloat(t))}),a}if($.isNumeric(e))return e}return 0},e.round=function(e){return e&&$.isNumeric(e)?Math.round(e):0},e.ceil=function(e){return e&&$.isNumeric(e)?Math.ceil(e):0},e.floor=function(e){return e&&$.isNumeric(e)?Math.floor(e):0},e.formatNumber=function(e,t){return e&&$.isNumeric(e)?e.toFixed(t||2):0},e.add=function(e,t){var a,n,r;try{a=e.toString().split(".")[1].length}catch(e){a=0}try{n=t.toString().split(".")[1].length}catch(e){n=0}return r=Math.pow(10,Math.max(a,n)),(e*r+t*r)/r},e.sub=function(e,t){var a,n,r,i;try{a=e.toString().split(".")[1].length}catch(e){a=0}try{n=t.toString().split(".")[1].length}catch(e){n=0}return r=Math.pow(10,Math.max(a,n)),i=a>=n?a:n,((e*r-t*r)/r).toFixed(i)},e.mul=function(e,t){var a=0,n=e.toString(),r=t.toString();try{a+=n.split(".")[1].length}catch(e){}try{a+=r.split(".")[1].length}catch(e){}return Number(n.replace(".",""))*Number(r.replace(".",""))/Math.pow(10,a)},e.div=function(e,t){var a,n,r=0,i=0;try{r=e.toString().split(".")[1].length}catch(e){}try{i=t.toString().split(".")[1].length}catch(e){}return a=Number(e.toString().replace(".","")),n=Number(t.toString().replace(".","")),a/n*Math.pow(10,i-r)},e}(),mtIsMobile=function(){var e={},t={Android:function(){return!!navigator.userAgent.match(/Android/i)},BlackBerry:function(){return!!navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)},Windows:function(){return!!navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Windows()}};return e.isMobile=function(){return t.any()},e}(),mtBrowser=function(){var e=navigator.userAgent,t=e.indexOf("Opera")>-1,a="Opera";e.indexOf("Firefox")>-1&&(a="FF"),e.indexOf("Chrome")>-1&&(a="Chrome"),e.indexOf("Safari")>-1&&(a="Safari"),e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!t&&(a="IE");var n={};return n.isIE=function(){return"IE"==a},n.isChrome=function(){return"Chrome"==a},n.browser=function(){return a},n}(),mtDate=function(){var e={};return e.getMonthStr=function(e){return new Date(e).getMonth()+1},e.getDiffDatetime=function(e,t,a){e=hmtdUtils.parseDate(e),t=hmtdUtils.parseDate(t),d3=t.getTime()-e.getTime();var n=0;switch(a){case"Y":n=t.getFullYear()-e.getFullYear();break;case"M":n=12*(t.getFullYear()-e.getFullYear())+t.getMonth()-e.getMonth();break;case"D":n=Math.floor(d3/864e5);break;case"H":n=Math.floor(d3%864e5/36e5);break;case"MI":n=Math.floor(d3%864e5%36e5/6e4);break;case"S":etVal=Math.round(d3%864e5%36e5%6e4/1e3)}return n},e.cellToDate=function(e,t){return hmtdUtils.toString(hmtdUtils.parseDate(864e5*(e-25569)),t||"yyyy-MM-dd HH:mm:ss")},e.formatDatetime=function(e,t){return hmtdUtils.toString(hmtdUtils.parseDate(e),t||"yyyy-MM-dd HH:mm:ss")},e.addDays=function(e,t,a){e=hmtdUtils.parseDate(e);try{t=parseInt(t);var n=new Date(e.getTime()+24*t*60*60*1e3);return hmtdUtils.toString(n,a||"yyyy-MM-dd HH:mm:ss")}catch(e){}return""},e.addYears=function(e,t,a){e=hmtdUtils.parseDate(e);try{return t=parseInt(t),e.setFullYear(e.getFullYear()+t),hmtdUtils.toString(e,a||"yyyy-MM-dd HH:mm:ss")}catch(e){}return""},e.addMonths=function(e,t,a){e=hmtdUtils.parseDate(e);try{return t=parseInt(t),e.setMonth(e.getMonth()+t),hmtdUtils.toString(e,a||"yyyy-MM-dd HH:mm:ss")}catch(e){}return""},e.addSeconds=function(e,t,a){e=hmtdUtils.parseDate(e);try{t=parseInt(t);var n=new Date(e.getTime()+1e3*t);return hmtdUtils.toString(n,a||"yyyy-MM-dd HH:mm:ss")}catch(e){}return""},e.addValueByType=function(t,a,n,r){return"day"==a?e.addDays(t,n,r):"month"==a?e.addMonths(t,n,r):"year"==a?e.addYears(t,n,r):"hours"==a?(n=60*parseInt(n)*60,e.addSeconds(t,n,r)):"minutes"==a?(n=60*parseInt(n),e.addSeconds(t,n,r)):"second"==a?e.addSeconds(t,n,r):""},e}();!function(){function e(e,t,a){return e+="",t=t||2,(a=t-e.length)?J[t].substring(0,a)+e:e}function t(e){if(e){if(e.numberFormat)return e;if(typeof e===P){var t=f.cultures;return t[e]||t[e.split("-")[0]]||null}return null}return null}function a(e){return e&&(e=t(e)),e||f.cultures.current}function n(e){e.groupSizes=e.groupSize,e.percent.groupSizes=e.percent.groupSize,e.currency.groupSizes=e.currency.groupSize}function r(t,n,r){var i=(r=a(r)).calendars.standard,o=i.days,s=i.months;return(n=i.patterns[n]||n).replace(g,function(a){var n,r,l;return"d"===a?r=t.getDate():"dd"===a?r=e(t.getDate()):"ddd"===a?r=o.namesAbbr[t.getDay()]:"dddd"===a?r=o.names[t.getDay()]:"M"===a?r=t.getMonth()+1:"MM"===a?r=e(t.getMonth()+1):"MMM"===a?r=s.namesAbbr[t.getMonth()]:"MMMM"===a?r=s.names[t.getMonth()]:"yy"===a?r=e(t.getFullYear()%100):"yyyy"===a?r=e(t.getFullYear(),4):"h"===a?r=t.getHours()%12||12:"hh"===a?r=e(t.getHours()%12||12):"H"===a?r=t.getHours():"HH"===a?r=e(t.getHours()):"m"===a?r=t.getMinutes():"mm"===a?r=e(t.getMinutes()):"s"===a?r=t.getSeconds():"ss"===a?r=e(t.getSeconds()):"f"===a?r=math.floor(t.getMilliseconds()/100):"ff"===a?((r=t.getMilliseconds())>99&&(r=math.floor(r/10)),r=e(r)):"fff"===a?r=e(t.getMilliseconds(),3):"tt"===a?r=t.getHours()<12?i.AM[0]:i.PM[0]:"zzz"===a?(l=(n=t.getTimezoneOffset())<0,r=math.abs(n/60).toString().split(".")[0],n=math.abs(n)-60*r,r=(l?"+":"-")+e(r),r+=":"+e(n)):"zz"!==a&&"z"!==a||(l=(r=t.getTimezoneOffset()/60)<0,r=math.abs(r).toString().split(".")[0],r=(l?"+":"-")+("zz"===a?e(r):r)),void 0!==r?r:a.slice(1,a.length-1)})}function i(e,t,n){var r,i,o,s,l,u,c,d,p,b,f,g,m,$,T,F,C,P,J,I,_,M,N=(n=a(n)).numberFormat,Q=N.groupSize[0],V=N[j],A=N[w],D=N.decimals,B=N.pattern[0],R=[],L=e<0,z=x,U=x,W=-1;if(void 0===e)return x;if(!isFinite(e))return e;if(!t)return n.name.length?e.toLocaleString():e.toString();if(l=h.exec(t)){if(t=l[1].toLowerCase(),i="c"===t,o="p"===t,(i||o)&&(Q=(N=i?N.currency:N.percent).groupSize[0],V=N[j],A=N[w],D=N.decimals,r=N.symbol,B=N.pattern[L?0:1]),(s=l[2])&&(D=+s),"e"===t)return s?e.toExponential(D):e.toExponential();if(o&&(e*=100),e=E(e,D),L=e<0,e=e.split(w),u=e[0],c=e[1],L&&(u=u.substring(1)),U=u,(d=u.length)>=Q)for(U=x,p=0;p<d;p++)p>0&&(d-p)%Q==0&&(U+=V),U+=u.charAt(p);if(c&&(U+=A+c),"n"===t&&!L)return U;for(e=x,p=0,b=B.length;p<b;p++)e+="n"===(f=B.charAt(p))?U:"$"===f||"%"===f?r:f;return e}if(L&&(e=-e),(t.indexOf("'")>-1||t.indexOf('"')>-1||t.indexOf("\\")>-1)&&(t=t.replace(v,function(e){var t=e.charAt(0).replace("\\",""),a=e.slice(1).replace(t,"");return R.push(a),S})),t=t.split(";"),L&&t[1])t=t[1],m=!0;else if(0===e){if(-1==(t=t[2]||t[0]).indexOf(k)&&-1==t.indexOf(O))return t}else t=t[0];if(J=t.indexOf("%"),I=t.indexOf("$"),o=-1!=J,i=-1!=I,o&&(e*=100),i&&"\\"===t[I-1]&&(t=t.split("\\").join(""),i=!1),(i||o)&&(Q=(N=i?N.currency:N.percent).groupSize[0],V=N[j],A=N[w],D=N.decimals,r=N.symbol),(g=t.indexOf(j)>-1)&&(t=t.replace(y,x)),$=t.indexOf(w),b=t.length,-1!=$?(c=(c=(c=e.toString().split("e"))[1]?E(e,Math.abs(c[1])):c[0]).split(w)[1]||x,C=(F=t.lastIndexOf(O)-$)>-1,P=(T=t.lastIndexOf(k)-$)>-1,p=c.length,C||P||(b=(t=t.substring(0,$)+t.substring($+1)).length,$=-1,p=0),C&&F>T?p=F:T>F&&(P&&p>T?p=T:C&&p<F&&(p=F)),p>-1&&(e=E(e,p))):e=E(e),T=t.indexOf(k),_=F=t.indexOf(O),W=-1==T&&-1!=F?F:-1!=T&&-1==F?T:T>F?F:T,T=t.lastIndexOf(k),F=t.lastIndexOf(O),M=-1==T&&-1!=F?F:-1!=T&&-1==F?T:T>F?T:F,W==b&&(M=W),-1!=W){if(U=e.toString().split(w),u=U[0],c=U[1]||x,d=u.length,c.length,L&&-1*e>=0&&(L=!1),g)if(d===Q&&d<$-_)u=V+u;else if(d>Q){for(U=x,p=0;p<d;p++)p>0&&(d-p)%Q==0&&(U+=V),U+=u.charAt(p);u=U}for(e=t.substring(0,W),L&&!m&&(e+="-"),p=W;p<b;p++){if(f=t.charAt(p),-1==$){if(M-p<d){e+=u;break}}else if(-1!=F&&F<p&&(z=x),$-p<=d&&$-p>-1&&(e+=u,p=$),$===p){e+=(c?A:x)+c,p+=M-$+1;continue}f===O?(e+=f,z=f):f===k&&(e+=z)}if(M>=W&&(e+=t.substring(M+1)),i||o){for(U=x,p=0,b=e.length;p<b;p++)U+="$"===(f=e.charAt(p))||"%"===f?r:f;e=U}if(b=R.length)for(p=0;p<b;p++)e=e.replace(S,R[p])}var H=t.indexOf(k),G=t.indexOf("0"),q=e.toString(),Y=q.indexOf(w);if(-1!=H&&-1==G){var Z=(t=t.replace(/#/gi,"0")).indexOf(w);if(-1!=Z){var K=t.substring(Z+1).length;if(-1!=Y){var X=q.substring(Y+1).length;if(K>X)for(te=0;te<K-X;te++)q+="0";else{var ee=X-K;q=q.substring(0,q.length-ee)}}else{q+=".";for(var te=0;te<K;te++)q+="0"}}}else{var ae=q.substring(0,Y);q=t.replace("#",ae)}return q}function o(e,t,a){return!(e>=t&&e<=a)}function s(e){return e.charAt(0)}function l(e){return $.map(e,s)}function u(e,t){t||23!==e.getHours()||e.setHours(e.getHours()+2)}function c(e){for(var t=0,a=e.length,n=[];t<a;t++)n[t]=(e[t]+"").toLowerCase();return n}function d(e){var t,a={};for(t in e)a[t]=c(e[t]);return a}function p(e,t,a){if(!e)return null;var n,r,i,s,c,p,b,f,g,m,h,v,y,x=function(e){for(var a=0;t[E]===e;)a++,E++;return a>0&&(E-=1),a},w=function(t){var a=R[t]||new RegExp("^\\d{1,"+t+"}"),n=e.substr(_,t).match(a);return n?(n=n[0],_+=n.length,parseInt(n,10)):null},$=function(t,a){for(var n,r,i,o=0,s=t.length;o<s;o++)if(n=t[o],r=n.length,i=e.substr(_,r),a&&(i=i.toLowerCase()),i==n)return _+=r,o+1;return null},j=function(){var a=!1;return e.charAt(_)===t[E]&&(_++,a=!0),a},k=a.calendars.standard,O=null,S=null,T=null,F=null,C=null,J=null,I=null,E=0,_=0,M=!1,N=new Date,A=k.twoDigitYearMax||2029,D=N.getFullYear();for(t||(t="d"),(s=k.patterns[t])&&(t=s),i=(t=t.split("")).length;E<i;E++)if(n=t[E],M)"'"===n?M=!1:j();else if("d"===n){if(r=x("d"),k._lowerDays||(k._lowerDays=d(k.days)),null!==T&&r>2)continue;if(null===(T=r<3?w(2):$(k._lowerDays[3==r?"namesAbbr":"names"],!0))||o(T,1,31))return null}else if("M"===n){if(r=x("M"),k._lowerMonths||(k._lowerMonths=d(k.months)),null===(S=r<3?w(2):$(k._lowerMonths[3==r?"namesAbbr":"names"],!0))||o(S,1,12))return null;S-=1}else if("y"===n){if(r=x("y"),null===(O=w(r)))return null;2==r&&(typeof A===P&&(A=D+parseInt(A,10)),(O=D-D%100+O)>A&&(O-=100))}else if("h"===n){if(x("h"),12==(F=w(2))&&(F=0),null===F||o(F,0,11))return null}else if("H"===n){if(x("H"),null===(F=w(2))||o(F,0,23))return null}else if("m"===n){if(x("m"),null===(C=w(2))||o(C,0,59))return null}else if("s"===n){if(x("s"),null===(J=w(2))||o(J,0,59))return null}else if("f"===n){if(r=x("f"),y=e.substr(_,r).match(R[3]),null!==(I=w(r))&&((y=y[0].length)<3&&(I*=Math.pow(10,3-y)),r>3&&(I=parseInt(I.toString().substring(0,3),10))),null===I||o(I,0,999))return null}else if("t"===n){if(r=x("t"),f=k.AM,g=k.PM,1===r&&(f=l(f),g=l(g)),!(c=$(g))&&!$(f))return null}else if("z"===n){if(p=!0,r=x("z"),"Z"===e.substr(_,1)){j();continue}if(!(b=e.substr(_,6).match(r>2?V:Q)))return null;if(b=b[0].split(":"),m=b[0],!(h=b[1])&&m.length>3&&(_=m.length-2,h=m.substring(_),m=m.substring(0,_)),m=parseInt(m,10),o(m,-12,13))return null;if(r>2&&(h=parseInt(h,10),isNaN(h)||o(h,0,59)))return null}else if("'"===n)M=!0,j();else if(!j())return null;return v=null!==F||null!==C||J||null,null===O&&null===S&&null===T&&v?(O=D,S=N.getMonth(),T=N.getDate()):(null===O&&(O=D),null===T&&(T=1)),c&&F<12&&(F+=12),p?(m&&(F+=-m),h&&(C+=-h),e=new Date(Date.UTC(O,S,T,F,C,J,I))):u(e=new Date(O,S,T,F,C,J,I),F),O<100&&e.setFullYear(O),e.getDate()!==T&&void 0===p?null:e}function b(e){var t="-"===e.substr(0,1)?-1:1;return e=e.substring(1),e=60*parseInt(e.substr(0,2),10)+parseInt(e.substring(2),10),t*e}var f={cultures:{}},g=/dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|HH|H|hh|h|mm|m|fff|ff|f|tt|ss|s|zzz|zz|z|"[^"]*"|'[^']*'/g,m=/\{(\d+)(:[^\}]+)?\}/g,h=/^(n|c|p|e)(\d*)$/i,v=/(\\.)|(['][^']*[']?)|(["][^"]*["]?)/g,y=/\,/g,x="",w=".",j=",",k="#",O="0",S="??",T="en-US",F="zh-CN",C={}.toString,P="string",J=["","0","00","000","0000"],I=window.MTGlobalize;f.cultures[T]={name:T,numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSize:[3],percent:{pattern:["-n %","n %"],decimals:2,",":",",".":".",groupSize:[3],symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,",":",",".":".",groupSize:[3],symbol:"$"}},calendars:{standard:{days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},AM:["AM","am","AM"],PM:["PM","pm","PM"],patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",F:"dddd, MMMM dd, yyyy h:mm:ss tt",g:"M/d/yyyy h:mm tt",G:"M/d/yyyy h:mm:ss tt",m:"MMMM dd",M:"MMMM dd",s:"yyyy'-'MM'-'ddTHH':'mm':'ss",t:"h:mm tt",T:"h:mm:ss tt",u:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",y:"MMMM, yyyy",Y:"MMMM, yyyy"},"/":"/",":":":",firstDay:0,twoDigitYearMax:2029}}},f.cultures[F]={name:F,numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSize:[3],percent:{pattern:["-n %","n %"],decimals:2,",":",",".":".",groupSize:[3],symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,",":",",".":".",groupSize:[3],symbol:"￥"}},calendars:{standard:{days:{names:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],namesAbbr:["日","一","二","三","四","五","六"],namesShort:["日","一","二","三","四","五","六"]},months:{names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],namesAbbr:["一","二","三","四","五","六","七","八","九","十","十一","十二"]},AM:["AM","am","AM"],PM:["PM","pm","PM"],patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",F:"dddd, MMMM dd, yyyy h:mm:ss tt",g:"M/d/yyyy h:mm tt",G:"M/d/yyyy h:mm:ss tt",m:"MMMM dd",M:"MMMM dd",s:"yyyy'-'MM'-'ddTHH':'mm':'ss",t:"h:mm tt",T:"h:mm:ss tt",u:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",y:"MMMM, yyyy",Y:"MMMM, yyyy"},"/":"/",":":":",firstDay:0,twoDigitYearMax:2029}}},f.culture=function(e){var a,r=f.cultures;if(void 0===e)return r.current;(a=t(e)||r[T]).calendar=a.calendars.standard,r.current=a,I&&!I.load&&n(a.numberFormat)},f.findCulture=t,f.getCulture=a,f.culture(F);var E=function(e,t){return t=t||0,e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]+t:t))),e=e.toString().split("e"),(e=+(e[0]+"e"+(e[1]?+e[1]-t:-t))).toFixed(t)},_=function(e,t,a){if(t){if("[object Date]"===C.call(e))return r(e,t,a);if("number"==typeof e)return i(e,t,a)}return void 0!==e?e:""};I&&!I.load&&(_=function(e,t,a){return $.isPlainObject(a)&&(a=a.name),I.format(e,t,a)}),f.format=function(e){var t=arguments;return e.replace(m,function(e,a,n){var r=t[parseInt(a,10)+1];return _(r,n?n.substring(1):"")})},f._extractFormat=function(e){return"{0:"===e.slice(0,3)&&(e=e.slice(3,e.length-1)),e},f._activeElement=function(){try{return document.activeElement}catch(e){return document.documentElement.activeElement}},f._round=E,f.toString=_;var M=/\u00A0/g,N=/[eE][\-+]?[0-9]+/,Q=/[+|\-]\d{1,2}/,V=/[+|\-]\d{1,2}:?\d{2}/,A=/^\/Date\((.*?)\)\/$/,D=/[+-]\d*/,B=["G","g","d","F","D","y","m","T","t"],R={2:/^\d{1,2}/,3:/^\d{1,3}/,4:/^\d{4}/},C={}.toString;f.parseDate=function(e,t,a){if("[object Date]"===C.call(e))return e;if("Invalid Date"!=new Date(e)&&!t&&!a)return new Date(e);var n,r,i,o=0,s=null;if(e&&0===e.indexOf("/D")&&(s=A.exec(e)))return s=s[1],i=D.exec(s.substring(1)),s=new Date(parseInt(s,10)),i&&(i=b(i[0]),s=f.timezone.apply(s,0),s=f.timezone.convert(s,0,-1*i)),s;if(a=f.getCulture(a),!t){for(t=[],r=a.calendar.patterns,n=B.length;o<n;o++)t[o]=r[B[o]];o=0,t=["yyyy/MM/dd HH:mm:ss","yyyy/MM/dd HH:mm","yyyy/MM/dd","ddd MMM dd yyyy HH:mm:ss","yyyy-MM-ddTHH:mm:ss.fffffffzzz","yyyy-MM-ddTHH:mm:ss.fffzzz","yyyy-MM-ddTHH:mm:sszzz","yyyy-MM-ddTHH:mm:ss.fffffff","yyyy-MM-ddTHH:mm:ss.fff","yyyy-MM-ddTHH:mmzzz","yyyy-MM-ddTHH:mmzz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mm","yyyy-MM-dd HH:mm:ss","yyyy-MM-dd HH:mm","yyyy-MM-dd","HH:mm:ss","HH:mm"].concat(t)}for(n=(t=$.isArray(t)?t:[t]).length;o<n;o++)if(s=p(e,t[o],a))return s;return s},f.parseInt=function(e,t){var a=f.parseFloat(e,t);return a&&(a|=0),a},f.parseFloat=function(e,t,a){if(!e&&0!==e)return null;if("number"==typeof e)return e;e=e.toString();var n,r,i=(t=f.getCulture(t)).numberFormat,o=i.percent,s=i.currency,l=s.symbol,u=o.symbol,c=e.indexOf("-");return N.test(e)?(e=parseFloat(e.replace(i["."],".")),isNaN(e)&&(e=null),e):c>0?null:(c=c>-1,e.indexOf(l)>-1||a&&a.toLowerCase().indexOf("c")>-1?(n=(i=s).pattern[0].replace("$",l).split("n"),e.indexOf(n[0])>-1&&e.indexOf(n[1])>-1&&(e=e.replace(n[0],"").replace(n[1],""),c=!0)):e.indexOf(u)>-1&&(r=!0,i=o,l=u),e=e.replace("-","").replace(l,"").replace(M," ").split(i[","].replace(M," ")).join("").replace(i["."],"."),e=parseFloat(e),isNaN(e)?e=null:c&&(e*=-1),e&&r&&(e/=100),e)},I&&!I.load&&(f.parseDate=function(e,t,a){return"[object Date]"===C.call(e)?e:I.parseDate(e,t,a)},f.parseFloat=function(e,t){return"number"==typeof e?e:void 0===e||null===e?null:($.isPlainObject(t)&&(t=t.name),e=I.parseFloat(e,t),isNaN(e)?null:e)}),window.hmtdUtils=f}();var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,jqCb=$.Callbacks(),mapCb=$.Callbacks(),pubsub=function(){function escape2Html(e){return e.replace(/&(lt|gt|nbsp|amp|quot|mdash|#39);/gi,function(e,t){return arrEntities[t]})}function html2Escape(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})}var q={elongateStockIndex:null},roles={},subUid=-1;q.outParamsObj=function(e,t,a,n){var r=t&&$.isPlainObject(t),i=t&&$.isArray(t);if(a||(a={}),n||(n={}),r&&(t[e.param]=a[e.columnName]||n[e.columnName]||""),i){var o=this;t[o]||(t[o]={}),t[o][e.param]=a[e.columnName]||n[e.columnName]||""}},q.inParamsObj=function(e,t,a){var n;return t||(t={}),a||(a={}),e.idataId&&(n=t[e.idataId]||a[e.idataId]),n};var arrEntities={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"',mdash:"-","#39":"'"};return q.htmlEscape=function(e){return html2Escape(e)},q.htmlUnescape=function(e){return escape2Html($("<div></div>").append(e).html())},q.htmlUnescape4Html=function(e){return $("<div></div>").append(e).html().replace(/&(amp|nbsp|mdash|#39);/gi,function(e,t){return arrEntities[t]})},q.execChilds=function(e){var t=e.childs;t&&pubsub._execOps(t,e.trigger,null,null)},q.getThat=function(e,t){var a,n=window;if("object"!=typeof e)return n;var r=[];$.isArray(e)?(r=e,a=e.tlevel):r.push(e);var i=r[0],o=t?i.inlev:i.outlev,s=t?i.inpage:i.outpage;if(!o)return n;var l=o-(a||i.tlevel||pageLevel);return l>0?(n=q.getNextLevel(n,l,s,t))||null:l<0?n=q.getPrevLevel(n,-l):s==pageParameters.id?n:void 0},q.getPrevLevel=function(e,t){for(var a=0;a<t;a++)e=e.opener||e.parent;return e},q.getNextLevel=function(e,t,a,n){var r,i="boolean"==typeof n?"body":n;if(1==t)r=e.$('iframe[src*="'+a+'"]',i);else{var o;for(o=e.$("iframe",i).contents();t>2;)t--,o=o.contents();r=o.find('iframe[src*="'+a+'"]')}if(r&&r[0])return e=r[0].contentWindow},q.getJQObj=function(e,t){var a=null;if("object"==typeof e){var n=[];$.isArray(e)?n=e:n.push(e);var r=n[0],i=t?r.iid||r.inid:r.oid||r.outid,o=q.getThat(e,t);o&&(a=o.$("#"+i)),(t&&r.ie||!t&&r.oe)&&(a=a.find("[name="+r[t?"inid":"outid"]+"]"))}else a=$("#"+e);return a&&a.attr("columnname")&&q.elongateStockIndex&&(a=$("[columnname="+a.attr("columnname")+"]").eq(q.elongateStockIndex)),a},q.getRole=function(e){return e.replace(/\d|\_|\-/g,"")},q.paramsToStr=function(e,t){if(t){var a={};for(var n in e)-1==$.inArray(n,t)&&(a[n]=e[n]);e=a}return"&"+(window.BASE64?"__mt__="+BASE64.encoder(JSON.stringify(e)):$.param(e))},q.expConvert=function(e,t,a){if(t){var n,r,i;for(var o in t)n=new RegExp(o,"gm"),r=t[o],i=a&&($.isNumeric(r)||$.isArray(r)||$.isPlainObject(r))?"":'"',($.isArray(r)||$.isPlainObject(r))&&(r=JSON.stringify(r)),e=e.replace(n,i+r+i)}return e.replace(/\\"/gm,"'")},q.variableLength=function(out,cellExp,outFuncs,cindex,args,tflag){var exp=cellExp.exp.replace(/\{area\}/gi,cindex),obj=eval(exp);"NaN"==obj&&(obj="");var outissplits=out.outid.split("_");tflag?outissplits[2]=cindex:outissplits[1]=cindex,out.outid=outissplits.join("_"),outFuncs[out.eventType](out,obj,args)},q.getParameters=function(e){var t=Array.prototype.slice.call(arguments,1);if(e){var a,n,r=new Object,i=this;for(a in e)n=e[a],$.each(n,function(e,a){var n=a.inid.length<31&&-1==a.inid.indexOf("/")?i.getRole(a.inid):"page";if(!roles[n])return!1;var o=roles[n][0].funcs;if("function"==typeof o[a.type]){var s=o[a.type](a,t);s&&(r[a.param]=s)}});return r}return null},q._getInParams=function(e,t){var a={};if(e&&e.length)for(var n=0;n<e.length;n++){var r=e[n];r.tlevel=t;var i=r.ie?this.getRole(r.ie):r.inid.length<31&&-1==r.inid.indexOf("/")?this.getRole(r.iid||r.inid):"page";if(roles[i]){var o=roles[i][0].funcs;if("function"==typeof o[r.type])try{var s=o[r.type](r,[]);a[r.param]=s}catch(e){console.log(e)}}}return a},q._execOps=function(ops,trigger,rules,args){for(var tlevel=trigger.level,outp,pars,par,expdata,exp,expds,expd,cellExp,childs,dbObj,ii=0,ol=ops.length,op;ii<ol;ii++){if(dbObj={trigger:trigger},pubsub.dbAry.push(dbObj),op=ops[ii],outp=op.out,pars=op.param,expdata=op.expdata,exp=expdata.exp,expds=expdata.expdata,cellExp=op.cellExp,expds){for(var eobj={},kk=0;kk<expds.length;kk++){var ed=expds[kk];ed.tlevel=tlevel;var inRole=ed.ie?this.getRole(ed.ie):ed.inid.length<31&&-1==ed.inid.indexOf("/")?this.getRole(ed.iid||ed.inid):"page";if(roles[inRole]){var inFuncs=roles[inRole][0].funcs,edType=ed.type;if("page"==inRole&&(0==edType.indexOf("getRow")&&(edType="getRow"),0==edType.indexOf("getValue")&&(edType="getValue")),"function"==typeof inFuncs[edType])try{ed.trigger=trigger;var p=inFuncs[edType](ed,args);eobj[ed.param]=p}catch(e){console.log(e)}}}exp=q.expConvert(exp,eobj)}if(dbObj.exp=exp,""!=exp){var exps=eval(exp.replace(/\n/g,"\\n"));if(!exps)continue}for(var jj=0;jj<outp.length;jj++){var out=outp[jj];if(out.tlevel=tlevel,!pars||!pars[out.outid]){var outRole=out.outid.length<31&&-1==out.outid.indexOf("/")?this.getRole(out.oid||out.outid):"page",outFuncs=roles[outRole][0].funcs;if("function"==typeof outFuncs[out.eventType]){var obj={};if(cellExp){var cell=op.cell;if(cell){var tflag="h"==cell.d,target=mtxx.e.target,tid=target.id,idIndexs=tid.split("_"),index=tflag?idIndexs[2]:idIndexs[1],cindex=tflag?cell.c:cell.r;if(cindex<=index)this.variableLength(out,cellExp,outFuncs,index,args,tflag);else for(var areas=$("[name="+$("#"+out.outid).attr("name")+"]"),areaLength=areas.length,area,areaId,areasplits,m=0;m<areaLength;m++)area=areas[m],areaId=area.id,areasplits=areaId.split("_"),cindex=tflag?areasplits[2]:areasplits[1],this.variableLength(out,cellExp,outFuncs,cindex,args,tflag),cindex++}else obj=eval(cellExp.exp),outFuncs[out.eventType](out,obj,args)}else try{out.childs=op.childs,out.tlevel=tlevel,out.trigger=trigger,outFuncs[out.eventType](out,obj,args)}catch(e){console.log(e)}}}}var isCallback=!1;dbObj.in=[],dbObj.param=[],dbObj.out=[];for(var id in pars){par=pars[id];for(var obj={},aryFlag=[],expObj={},insExpEval,i=0;i<par.length;i++){var r=par[i],isExpFunc=!1;if(r.tlevel=tlevel,r.insExp){var ins=r.ins,isExpFunc=!0;if(ins)for(var insLength=ins.length,rc,m=0;m<insLength;m++){rc=ins[m],rc.tlevel=tlevel;var inRole=rc.ie?this.getRole(rc.ie):rc.inid.length<31&&-1==rc.inid.indexOf("/")?this.getRole(rc.iid||rc.inid):"page";if(roles[inRole]){var inFuncs=roles[inRole][0].funcs,rcType=rc.type;if("page"==inRole&&(0==rcType.indexOf("getRow")&&(rcType="getRow"),0==rcType.indexOf("getValue")&&(rcType="getValue")),"function"==typeof inFuncs[rcType])try{rc.trigger=trigger;var p=inFuncs[rcType](rc,args,obj[rc.dataId]);expObj[rc.param]=p,dbObj.in.push({id:rc.iid||rc.inid,method:rc.type,param:p,columnName:rc.columnName})}catch(e){console.error(e)}else dbObj.in.push({id:rc.iid||rc.inid,method:rc.type,type:"none",param:p,columnName:rc.columnName})}}}else{var inRole=r.ie?this.getRole(r.ie):r.inid.length<31&&-1==r.inid.indexOf("/")?this.getRole(r.iid||r.inid):"page";if(!roles[inRole])continue;var inFuncs=roles[inRole][0].funcs,rType=r.type;if("page"==inRole&&(0==rType.indexOf("getRow")&&(rType="getRow"),0==rType.indexOf("getValue")&&(rType="getValue")),"function"==typeof inFuncs[rType])try{r.dataId&&(-1!=r.dataId.indexOf("obj")&&(obj[r.dataId]||(obj[r.dataId]={})),-1!=r.dataId.indexOf("ary")&&(obj[r.dataId]||(obj[r.dataId]=[]))),r.trigger=trigger;var p=inFuncs[rType](r,args,obj[r.dataId]);dbObj.in.push({id:r.iid||r.inid,method:r.type,param:p,columnName:r.columnName}),(p||0==p)&&(obj[r.param]=p)}catch(e){console.error(e)}else dbObj.in.push({id:r.iid||r.inid,method:r.type,param:p,type:"none",columnName:r.columnName})}if(isExpFunc){dbObj.in.push({exp:r.insExp,type:"exp",param:"",columnName:r.insExp});try{insExpEval=q.expConvert(r.insExp,expObj,!0),insExpEval&&(obj[r.param]=eval(insExpEval))}catch(e){mtDebugger.pushQueue("error","输入表达式："+r.insExp+",执行异常")}}}dbObj.param.push(obj);var outd=par[0],outType=outd.eventType,outRole=outd.oe?this.getRole(outd.oe):id.length<31&&-1==id.indexOf("/")?this.getRole(outd.oid||id):"page";if(isCallback=outd.callback,roles[outRole]){dbObj.out.push({id:id||outd.oid,method:outType}),par.childs=op.childs,par.trigger=trigger;var outFuncs=roles[outRole][0].funcs;if("function"==typeof outFuncs[outType])try{par.tlevel=tlevel,outFuncs[outType](par,obj,args)}catch(e){console.log(e),mtDebugger.pushQueue("error","outLinkTmp",{id:id,outType:outType,message:e.message})}else mtDebugger.pushQueue("error","outLinkTmp",{id:id,outType:outType,message:"没有执行方法"})}}}},q.pub=function(e,t){var a=Array.prototype.slice.call(arguments,2);if("string"==typeof e)for(var n in t){for(var r=t[n],i={},o=0;o<r.length;o++){var s=r[o],l=s.inid.length<31&&-1==s.inid.indexOf("/")?this.getRole(s.inid):"page";if(roles[l]){var u=roles[l][0].funcs;if("function"==typeof u[s.type])try{var c=u[s.type](s,a);c&&(i[s.param]=c)}catch(e){console.log(e)}}}var d=n.length<31&&-1==n.indexOf("/")?this.getRole(n):"page";if(roles[d]){var p=roles[d][0].funcs;if("function"==typeof p[e])try{p[e](n,i,a)}catch(e){console.log(e)}}}else if("object"==typeof e){var b=e.ops,f=e.trigger[0],g=(f.level,e.childs);pubsub.dbAry=[],q._execOps(b,f,t,a),g&&g.length&&$.each(g,function(e,a){q.pub(a,t)}),mtDebugger.__etable(pubsub.dbAry)}return this},q.sub=function(e,t){var a=function(){for(var e in t)this[e]=t[e]};a.prototype=new baseFunc,roles[e]=roles[e]?roles[e]:[];var n=(++subUid).toString();return roles[e].push({token:n,funcs:new a}),n},q}(),bindSpreadEvents=function(e){var t,a=$(e._host),n=a.data("eventsRule");n&&(t=n[a.attr("id")]),t&&t.call(),e.getActiveSheet().bind(GcSpread.Sheets.Events.ValueChanged,function(e,t){var a=t.sheet.getCell(t.row,t.col).cellType();if(a instanceof GcSpread.Sheets.ComboBoxCellType||a instanceof GcSpread.Sheets.RadioButtonCellType||a instanceof GcSpread.Sheets.CheckboxButtonCellType){var n=$(t.sheet.parent._host).data("eventsRule");if(n){var r=n[dynamicAreaFunc.calculate(t.sheet,t.row+"-"+t.col,!0)];r&&r.call()}}}),e.bind(GcSpread.Sheets.Events.ButtonClicked,function(e,t){var a=t.sheet.getCell(t.row,t.col),n=a.cellType(),r=a.watermark();if(r){var i=JSON.parse(r);i&&("del"==i.type?dynamicAreaFunc.delFunc.call(a,i.area):"add"==i.type&&dynamicAreaFunc.addFunc.call(a,i.area))}if(n instanceof GcSpread.Sheets.ButtonCellType){var o=$(t.sheet.parent._host).data("eventsRule");if(o){var s=o[dynamicAreaFunc.calculate(t.sheet,t.row+"-"+t.col,!0)];s&&s.call()}}})},bindSpreadValidate=function(eleId){function CustomerCondition(e,t,a,n){var r=this;r.ignoreBlank=!1,r.conditionType="CustomerCondition",r.compareType=e,r.expected=t,r.formula=a,r.trigger=n}CustomerCondition||(CustomerCondition.prototype=new GcSpread.Sheets.CellValueCondition,CustomerCondition.prototype.evaluate=function(evaluator,baseRow,baseColumn,actualValue){var trigger=this.trigger,mtValidate=trigger.vali,iid=trigger.iid,k=$("#"+iid),execObj=pubsub._getInParams(mtValidate.execExpData,trigger.inlev),exec=pubsub.expConvert(mtValidate.execExp||"",execObj);if(""!=exec)try{var execBol=eval(exec);if(!execBol)return!0}catch(e){return!1}var eObj=pubsub._getInParams(mtValidate.expData,trigger.inlev),exp=pubsub.expConvert(mtValidate.exp||"",eObj);if(""!=exp){k.data("currentCell",trigger);try{var expBol=eval(exp);return!!expBol}catch(e){return!1}}return!0});var $this=$("#"+eleId),spread=$this.data("spread"),sheet=spread.getActiveSheet(),spreadValidate=$this.data("spreadValidate"),inids,trigger,vali,cCondition,validator1;if(spread.highlightInvalidData(!0),spreadValidate)for(var pro in spreadValidate)trigger=spreadValidate[pro],vali=trigger.vali,inids=pro.split("-"),cCondition=new CustomerCondition(1,4,null,trigger),validator1=new GcSpread.Sheets.DefaultDataValidator(cCondition),validator1.inputMessage=vali.tip,validator1.ignoreBlank=!1,validator1.type=GcSpread.Sheets.CriteriaType.Custom,sheet.setDataValidator(inids[0],inids[1],validator1)};Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t){var n=t[a];new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n:("00"+n).substr((""+n).length)))}return e};var validateMethods={email:function(e,t){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},url:function(e,t){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)},date:function(e,t){return!/Invalid|NaN/.test(new Date(e).toString())},dateISO:function(e,t){return/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(e)},number:function(e,t){return/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return/^\d+$/.test(e)},creditcard:function(e,t){if(/[^0-9 \-]+/.test(e))return!1;var a,n,r=0,i=0,o=!1;if((e=e.replace(/\D/g,"")).length<13||e.length>19)return!1;for(a=e.length-1;a>=0;a--)n=e.charAt(a),i=parseInt(n,10),o&&(i*=2)>9&&(i-=9),r+=i,o=!o;return r%10==0}},validateMessage={required:"{0} 必须填写",email:"{0} 格式错误,请输入正确邮件",dateEqualgt:'{0} 必须大于"{1}',dateEqual:'{0} 必须大于"{1}"小于"{2}"',checkNum:"{0} 至少选中 {1} 项",number:"{0} 必须输入数字"},validate=function(e){return e.data("mt-vail-er-msg",validateMessage.required.format(e.attr("mtTitle"))),setCustomRule(e,e.data("mt-vail-er-msg")),""!==$.trim(e.mtbootstrap("getValue"))},validateType=function(e,t){return e.data("mt-vail-er-msg",validateMessage[t].format(e.attr("mtTitle"))),setCustomRule(e,e.data("mt-vail-er-msg")),validateMethods[t](e.mtbootstrap("getValue"))},validateFilesUpload=function(e){var t=e.closest("[data-role='jqfileupload2']");return e.data("mt-vail-er-msg","必须上传文件！"),setCustomRule(e,e.data("mt-vail-er-msg")),t.spFileUpload("hasFiles")},validateDate=function(e,t,a){var n="yyyy-MM-dd";"datetimepickerbt"==e.closest("div").attr("data-role")&&(n="yyyy-MM-dd HH:mm:ss"),a?e.data("mt-vail-er-msg",validateMessage.dateEqual.format(e.attr("mtTitle"),hmtdUtils.format("{0:"+n+"}",hmtdUtils.parseDate(t)),hmtdUtils.format("{0:"+n+"}",hmtdUtils.parseDate(a)))):e.data("mt-vail-er-msg",validateMessage.dateEqualgt.format(e.attr("mtTitle"),hmtdUtils.format("{0:"+n+"}",hmtdUtils.parseDate(t)))),setCustomRule(e,e.data("mt-vail-er-msg"));var r=hmtdUtils.parseDate($.trim(e.mtbootstrap("getValue")),""),i=!0,o=!0;return t&&(i=r-hmtdUtils.parseDate(t)>0),a&&(o=hmtdUtils.parseDate(a)-r>0),i&&o},validateLength=function(e,t,a){e.data("mt-vail-er-msg",validateMessage.dateEqual.format(e.attr("mtTitle"),t,a)),setCustomRule(e,e.data("mt-vail-er-msg"));var n=$.trim(e.mtbootstrap("getValue")),r=n.length;try{return $.isNumeric(n)?n-t>0&&a-n>0:r-t>0&&a-r>0}catch(e){return!1}},validateCheckNum=function(e,t){return e.data("mt-vail-er-msg",validateMessage.checkNum.format(e.attr("mtTitle"),t)),setCustomRule(e,e.data("mt-vail-er-msg")),$("input[name="+e.attr("name")+"]").prop("checked").length-t>=0},treelistbtFunc={insertStaticRow:function(e,t,a){var n=pubsub.getJQObj(e),r=n.data("inparamobjrule");if(n||n[0]){var i=r.arySource;if($.isArray(i)){var o=i;i={},$.each(o,function(e,t){var a=t.child,n="";a&&a[0]&&(n=a[0].param),i[t.param]=n}),r.arySource=i}var s=r.objSource;if($.isArray(s)){var l=s;s={},$.each(l,function(e,t){var a=JSON.parse(t.child),n={};$.each(a,function(e,t){n[t.param]=t.columnFiled}),s[t.param]=n}),r.objSource=s}if(s){var u=[],c=null;$.each(t,function(e,t){if($.isPlainObject(t)&&!$.isEmptyObject(t)){c={};a=s[e];$.each(t,function(e,t){a[e]&&(c[a[e]]=t)}),u.push(c)}else if($.isArray(t)){if(!i[e])return!0;var a=s[i[e]];$.each(t,function(e,t){c={},$.each(t,function(e,t){a[e]&&(c[a[e]]=t)}),u.push(c)})}}),u&&u.length>0&&n.treelist("insertStaticRow",u)}}},getRow:function(e,t,a){var n=pubsub.getJQObj(e,!0).treelist("getSelectedRows"),r=[];return n&&n.length?($.each(n,function(t,n){n[e.columnName]&&(r.push(n[e.columnName]||""),pubsub.outParamsObj.call(t,e,a,n))}),r.join(",")):""},getCurRow:function(e,t){return t&&t[1]?t[1][e.columnName]||"":""},getValue:function(e,t){return pubsub.getJQObj(e,!0).closest("a").text()},linkage:function(e,t){treelistbtFunc.linkageControl(e,t)},linkageControl:function(e,t){pubsub.getJQObj(e).data("treelist").options.expandChilds=t.expandLevel||!0,pubsub.getJQObj(e).treelist("query",t)},getGrade:function(e,t){return""+(pubsub.getJQObj(e,!0).treelist("getSelectedRows")[0]._level_+1)},selectRow:function(e,t){for(var a=pubsub.getJQObj(e),n=(a.treelist("getData"),0);n<e.length;n++)r=e[n],r&&"key"!=r.param&&(v=t[r.param]);var i=t.key;i=i||"id";var o=(a=pubsub.getJQObj(e)).treelist("getData");$.each(o,function(e,t){t[i].indexOf(v)>-1&&a.treelist("select",t.id)})},cancelSelect:function(e,t){pubsub.getJQObj(e).treelist("cancelSelect")},getAll:function(e,t){var a=pubsub.getJQObj(e,t[0]||!0);if(a){var n,r=[],i=a.data("treelist").getData();if(i){for(var o=0;o<i.length;o++)n=i[o],r.push(n[e.columnName]||"");return r.join(",")}}return""},setRowBgColor:function(e,t){pubsub.getJQObj(e).treelist("setRowBgColor",t.rowIndex,t.color)},tSelectFirst:function(e,t){var a=pubsub.getJQObj(e);a&&setTimeout(function(){a.treelist("select","","tr:eq(0)");var e=new MutationObserver(function(t){a.treelist("select","","tr:eq(0)"),e.disconnect()});e.observe(a[0],{childList:!0,arrtibutes:!0,subtree:!0,characterData:!0})},100)},grefresh:function(e,t){pubsub.getJQObj(e).treelist("query",$.isArray(t)?{}:t)},gsaveChange:function(e,t){pubsub.getJQObj(e).treelist("saveHandle")},refreshAndExpandNode:function(e,t){t.expandNodeId;for(var a=t.key,n=null,i=0;i<e.length;i++)r=e[i],r&&"key"!=r.param&&(n=t[r.param]);a=a||"id";var o=pubsub.getJQObj(e),s=o.treelist("getData");$.each(s,function(e,t){t[a]==n&&o.treelist("refreshAndExpandNode",t)})},parentRefresh:function(e,t){t.expandNodeId;for(var a=t.key,n=0;n<e.length;n++)r=e[n],r&&"key"!=r.param&&t[r.param];a=a||"id";var i=pubsub.getJQObj(e),o=i.treelist("getRow",i.treelist("getNodeById",i.treelist("getParentNodeId",i.treelist("getSelections")),i));o&&i.treelist("refreshAndExpandNode",o)},nodeRefresh:function(e,t){t.expandNodeId;for(var a=t.rename,n=t.text,i=t.key,o=null,s=0;s<e.length;s++)r=e[s],r&&"expandNodeId"==r.param&&(o=t[r.param]);i=i||"id";var l=pubsub.getJQObj(e),u=l.treelist("getData");$.each(u,function(e,t){t[i]==o&&l.treelist("nodeRefresh",t,a,n)})},expandNode:function(e,t){t.expandNodeId;for(var a=t.key,n=null,i=0;i<e.length;i++)r=e[i],r&&"key"!=r.param&&(n=t[r.param]);a=a||"id";var o=pubsub.getJQObj(e),s=o.treelist("getData"),l=null;$.each(s,function(e,t){t[a]==n&&(l=t["row-index"],o.find("tr[row-index='"+l+"'] .treelist-expander").click())})},endEdit:function(e,t){pubsub.getJQObj(e).treelist("endEdit")},getKeyName:function(e,t){return e.columnName},getCheckedRow:function(e,t,a){var n=pubsub.getJQObj(e,!0).treelist("getCheckedRowsData"),r=[];return n&&n.length?($.each(n,function(t,n){n[e.columnName]&&(r.push(n[e.columnName]||""),pubsub.outParamsObj(e,a,n))}),r.join(",")):""},checkRow:function(e,t){for(var a=pubsub.getJQObj(e),n=(a.treelist("getData"),0);n<e.length;n++)r=e[n],r&&"key"!=r.param&&(v=t[r.param]);var i=t.key;i=i||"id";var o=(a=pubsub.getJQObj(e)).treelist("getData");$.each(o,function(e,t){t[i]==v&&a.treelist("checkRow",null,null,t)})},isCheckedInput:function(e,t){return!(!t||!t[1])&&pubsub.getJQObj(e,!0).data("grid").tbody().find("tr:eq("+t[1]["row-index"]+") .inner_checkbox").prop("checked")},editRow:function(e,t){var a=pubsub.getJQObj(e),n=a.treelist("getData"),r=t.key;r=r||"id";var i="";$.each(e,function(a,n){if("key"==e[a].param)return!0;i=t[e[a].param]||""}),n&&n.length&&$.each(n,function(e,t){var n=i;if(n)for(var o=n.split(","),s=0;s<o.length;s++)t[r]==o[s]&&(t.id?a.treelist("editRow",t.id):a.treelist("editRow",null,null,t))})}};pubsub.sub("treelistbt",treelistbtFunc);var pageBtFunc={getValue:function(e,t){return mtxx.params?mtxx.params[e.inparam]:null},getRow:function(e,t,a){var n=pageParameters,r=e.idatasetId||e.indatasetId,i=window;if(!r)return pubsub.outParamsObj(e,a,n,i.callbackParam),pubsub.inParamsObj(e,i.callbackParam)||n[e.columnName]||i.callbackParam&&i.callbackParam[e.columnName]||"";var o=n.detail.dataSources;return!$.isEmptyObject(o)&&o[r]?o[r][e.columnName]||"":""},setValue:function(e,t,a){var n=window;n.callbackParam||(n.callbackParam={});for(var r in t)n.callbackParam[r]=t[r]},linkageControl:function(e,t){pageBtFunc.linkagePage(e,t)},linkagePage:function(e,t){t.newWin="1";var a=pubsub.paramsToStr(t),n=e;"object"==typeof e&&(n=e[0].outid),$("iframe[src*='"+n+"'],iframe[prosrc*='"+n+"']").each(function(e){$this=$(this),$this.attr("prosrc")||$this.attr("prosrc",$this.attr("src")),$this.attr("src",$this.attr("prosrc")+a)})},getClientIp:function(e,t){var a,n=window;$.isPlainObject(e)&&(a=e),$.isArray(e)&&(a=e[0]),$.ajax({url:contextPath+"/mx/form/page/getClientIp",type:"post",dataType:"json",async:!0,data:t,success:function(t){t?(n.callbackParam=n.callbackParam||{},$.each(a.callback,function(e,a){n.callbackParam[a.param]=t[a.columnName]})):$.each(a.callback,function(e,t){n.callbackParam[t.param]=""}),t&&pubsub.execChilds(e)},error:function(e){console.log("服务器处理错误！,请修改后再试。")}})},newWindow:function(id,params,args,windowUrl){var obj=args?args[0]:null;if(obj&&obj.jumpType);else{var parameters_=params.parameters||"";parameters_&&delete params.parameters;var p=pubsub.paramsToStr(params,["headerFontColor","closeBtnSize","closeBtnColor","isMax","width","height","singlePage","model","title","mtOpenTab","TABNAME","headerPadding","backdrop","isParent","closeByBackdrop","render","opacity"]);windowUrl?(url=windowUrl,path=url):(url=id[0]?id[0].srcUrl:id.srcUrl,path=contextPath+url+(url.indexOf("?")>-1?"":"?")+p+(parameters_?"&"+parameters_:""),-1!=window.location.href.indexOf("isPublish=true")&&(path+="&isPublish=true"));var mtOpenTab=!0===params.mtOpenTab;if(mtOpenTab)params.path=path,pageBtFunc.mtOpenTab(id,params,args);else if(params.render)location.href=path;else if(params.singlePage){var iTop=(window.screen.availHeight-30-eval((params.height+"").replace("px","")))/2,iLeft=(window.screen.availWidth-10-eval((params.width+"").replace("px","")))/2,width=eval(params.width)||650,height=eval(params.height)||450;if(params.isMax&&(width=$("body").width()-24,height=$("body").height()-93),params.model)window.open(path,params.title,"width="+params.width+",height="+params.height+",top="+iTop+",left="+iLeft+", modal=true,status=no,scrollbars=yes");else if(params.isParent&&top&&top.$.fancybox)top.$.fancybox.open({href:path,width:width,height:height,type:"iframe",modal:!1,closeClick:!0,openEffect:"none",padding:5,autoSize:!1,autoHeight:!1,autoWidth:!1,helpers:{title:null==params.title?"窗口":params.title}});else{var dialog=BootstrapDialog.show({title:null==params.title?"窗口":params.title,draggable:!1!==params.draggable,message:function(e){var t,a=e.getData("pageToLoad");return t=windowUrl?"<iframe width='100%' height='"+height+"' src='"+a+"' frameborder='no' scrolling='yes'></iframe>":"<iframe onload=\"$(this).contents().find('body').css('overflow-y', 'auto');\" width='100%' height='"+height+"' src='"+a+"' frameborder='no' scrolling='yes'></iframe>",$(t)},closeByBackdrop:!1!==params.closeByBackdrop,data:{pageToLoad:path},css:{width:width+"px",height:height+6+"px"},onhide:function(e){var t=e.$modal.find("iframe:first")[0];if(t&&!windowUrl){var a=t.contentWindow;if(a&&$(a.document.body)[0]){var n=$(a.document.body).data("onbeforeunload");if($.isFunction(n))return void n()}if(void 0!=a.onbeforeunload&&null!=a.onbeforeunload)return void a.onbeforeunload()}}});if(null==params.backdrop||params.backdrop||dialog.$modal.data("bs.modal").$backdrop.hide(),null!=params.opacity&&dialog.getModalContent().css("opacity",params.opacity),dialog.getModalHeader().find(".bootstrap-dialog-header .bootstrap-dialog-close-button").remove(),dialog.getModalContent().prepend('<button type="button" class="btn closeBtn" style=""><i class="fa fa-remove"></i></button>'),params.closeBtnColor&&dialog.getModalContent().find(".closeBtn").css("color",params.closeBtnColor),params.closeBtnSize&&dialog.getModalContent().find(".closeBtn").css("font-size",params.closeBtnSize),dialog.getModalContent().find(".closeBtn").click(function(e){dialog.close()}),null!=params.headerPadding){var headerPaddingStr=params.headerPadding+"px "+params.headerPadding+"px "+params.headerPadding+"px "+params.headerPadding+"px",headerBackgroundColor=params.headerBackgroundColor||"",headerFontSize=params.headerFontSize||"";dialog.getModalHeader().css({padding:headerPaddingStr,"background-color":headerBackgroundColor});var headerFontColor=params.headerFontColor||"";dialog.getModalHeader().find(".bootstrap-dialog-title").css("color",headerFontColor),dialog.getModalHeader().find(".bootstrap-dialog-title").css("font-size",headerFontSize)}params.isMax&&(dialog.$modal.css({padding:"0px 10px"}),dialog.$modalDialog.css({margin:"0px 10px"}))}}else window.open(path)}},getActoidMessage:function(e,t){$.each(t,function(e,t){window.actoid=t})},openWindowFunc:function(e,t,a){t&&t.url&&(t.render=t.isturn,pageBtFunc.newWindow(null,t,null,t.url))},pageClose:function(e,t){var a=pubsub.getThat(e);if(a.top.location.href==a.location.href)try{a.close()}catch(e){}else{var n=a.parent.$("[role=dialog]"),r=$("body").data("onbeforeunload");$.isFunction(r)&&r(),n.each(function(e,t){$(this).attr("id")&&a.parent.BootstrapDialog.getDialog($(this).attr("id")).close()}),a.parent.$("input[type=text]:visible:enabled:not([readonly]):not([class*=date]):first").focus()}try{var i=a.opener||a.parent;i.closeWindow&&i.closeWindow()}catch(e){}},grefresh:function(e,t){pubsub.getThat(e).location.reload()},mt_service:function(e,t,a){var n,r=window;if($.isPlainObject(e)?n=e:$.isArray(e)&&(n=e[0]),!n.useId)return alert("服务地址不存在!"),pubsub.execChilds(e),!1;var i={page:"",pageSize:""},o={},s=!0;$.each(t,function(e,t){!(e in i)&&(o[e]=t)&&(s=!1)}),o={params:s?null:JSON.stringify(o)},$.each(i,function(e,a){t[e]&&(o[e]=t[e])}),MyAjax({operation:"执行微服务",url:n.useId,type:"post",data:o,dataType:"jsonp",success:function(a){SearchCallback(r,t,a,e,n)}})},mtSave:function(e,t){var a=pubsub.getThat(e);if(!a.getFormValiate())return!1;var n=$(a.document.body).data("saveMsg");if(n&&($.each(n,function(e,a){a&&a.save&&a.save(null,t)}),e.childs)){a.savecount=0;var r=setInterval(function(){a.savecount==n.length&&(a.clearInterval(r),pubsub.execChilds(e))},500)}},downSqlLite:function(e,t,a){var n;pubsub.getThat(e);$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]),MyAjax({operation:"sqlLite文件下载",url:contextPath+"/mx/form/wdatasetSqllite/getById",type:"post",data:{id:n.useId},async:!1,success:function(e){if(e){var a=JSON.parse(e),n="";if(a.ruleJson){var r=JSON.parse(a.ruleJson);$.each(r,function(e,t){n&&(n+=","),n+=t.dataSetId})}var i=contextPath+"/website/public/dataset/export/sqlite?1=1";return n&&(i=i+"&dataSetIds="+n),t&&(i=i+"&params="+JSON.stringify(t)),void window.open(i)}},error:function(){alert("异常错误,请稍后再试.")}})},mtAlert:function(e,t){for(var a,n=0;n<e.length;n++)a=t[e[n].param],alert(a)},mtLoading:function(e,t){$.blockUI({message:'<div class="loading-message "><div class="block-spinner-bar"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>',baseZ:1e3,css:{border:"0",padding:"0",backgroundColor:"none"},overlayCSS:{backgroundColor:"#555",opacity:.1,cursor:"wait"}})},cancelLoading:function(e,t){$.unblockUI()},mtLogin:function(e,t,a){handleLogin(e,t,a)},mtSubmit:function(e,t){if(window.mtxx&&window.mtxx.params&&confirm("你确定提交吗?")){var a=mtxx.params.id,n=$.extend(!0,{},t,{approve:!0}),r=$("."+a).attr("idValue"),i={pageId:a};i.flowParams=JSON.stringify(n),i[a]=r,MyAjax({operation:"流程提交",url:contextPath+"/mx/form/workflow/defined/submit",type:"POST",dataType:"JSON",data:i,success:function(e){alert("操作成功!")}})}},mtAssign0:function(e,t){FlowProcess.mtAssign0(e,t)},mtSubmit0:function(e,t){FlowProcess.mtSubmit0(e,t)},mtBack0:function(e,t){t.approve=!1,FlowProcess.mtSubmit0(e,t)},mtReject:function(e,t){FlowProcess.reject(t)},mtReject0:function(e,t){FlowProcess.reject0(e,t)},mtCancel:function(e,t){FlowProcess.cancel(t)},mtCancel0:function(e,t){FlowProcess.cancel0(e,t)},mtStop:function(e,t){FlowProcess.stop(t)},mtStop0:function(e,t){FlowProcess.stop0(e,t)},mtActive:function(e,t){FlowProcess.active(t)},mtActive0:function(e,t){FlowProcess.active0(e,t)},sendDown:function(e,t,a){var n={},r={};for(var i in t)-1!=i.indexOf("hmtdusd-")?r[i.replace("hmtdusd-","")]=t[i]:n[i]=t[i];n.sendData=JSON.stringify(r),MyAjax({operation:"下发",url:contextPath+"/mx/form/data/sendDown2",type:"post",data:n,async:!1,success:function(t){t&&(t=JSON.parse(t),alert(t.message),pubsub.execChilds(e))},error:function(){alert("异常错误,请稍后再试.")}})},sendAllDown:function(e,t,a){MyAjax({operation:"整表下发",url:contextPath+"/mx/form/data/sendDown",type:"post",data:t,async:!1,success:function(t){t&&(t=JSON.parse(t),alert(t.message),pubsub.execChilds(e))},error:function(){alert("异常错误,请稍后再试.")}})},exprCalc:function(e,t,a){if($.isArray(e)){var n=window,r=t||{},i=e[0],o=i.callback,s=pubsub.elongateStockIndex;r.mtUserId=i.useId,MyAjax({operation:"表达式运算",url:contextPath+"/mx/expr/calculateByPoi",type:"post",data:{params:JSON.stringify(r)},async:!0,success:function(t){t&&(pubsub.elongateStockIndex=s,t=JSON.parse(t),n.callbackParam=n.callbackParam||{},$.each(o,function(e,a){n.callbackParam[a.param]=t[a.columnName]}),pubsub.execChilds(e),pubsub.elongateStockIndex=null),console.log(t)},error:function(){alert("异常错误,请稍后再试.")}})}},collect:function(e,t,a){function n(){var a=t.databaseId||"",n=contextPath+"/mx/form/treeTableAggregate/executeSpec?treeTableAggregateId="+r.useId+"&databaseId="+a;jQuery.ajax({type:"POST",url:n,data:t,dataType:"json",error:function(e){alert("服务器处理错误！")},success:function(a){null!=a&&a.message,t.isAlt||alert("操作成功完成！"),pubsub.execChilds(e)}})}var r;$.isPlainObject(e)&&(r=e),$.isArray(e)&&(r=e[0]),t.isAlt?n():confirm("确定执行数据汇总吗？")&&n()},parseAryToObj:function(e){var t={};return $.each(e,function(e,a){var n="";$.isArray(a)?($.each(a,function(e,t){if(n&&(n+=","),"object"==typeof t){var a="";$.each(t,function(e,t){a=t}),n+=a}else n+=t}),t[e]=n):t[e]=a}),t},mtcrud:function(e,t,a){var n,t=pageBtFunc.parseAryToObj(t),r=window;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]),n.columnName;var i={useId:n.useId,params:JSON.stringify(t),type:n.oid};"del"!=i.type||t.isDelAlt?MyAjax({operation:"CRUD事件",url:contextPath+"/mx/form/data/mtcrud",type:"post",data:i,async:!1,success:function(a){a&&(a=JSON.parse(a))&&!a.statusCode?(r.callbackParam=r.callbackParam||{},$.each(n.callback,function(e,t){r.callbackParam[t.param]=a[t.columnName]}),t.isAlt||alert("操作成功完成！")):alert("异常错误,请稍后再试."),pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}}):confirm2("是否确认删除",function(a){a&&MyAjax({operation:"CRUD事件",url:contextPath+"/mx/form/data/mtcrud",type:"post",data:i,async:!1,success:function(a){!a||!(a=JSON.parse(a))||a.statusCode&&"500"==a.statusCode?alert("异常错误,请稍后再试."):(r.callbackParam=r.callbackParam||{},$.each(n.callback,function(e,t){r.callbackParam[t.param]=a[t.columnName]}),t.isAlt||alert("操作成功完成！")),pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}})})},mtsearch:function(e,t,a){var n;$.isPlainObject(e)?n=e:$.isArray(e)&&(n=e[0]);var r=window;MyAjax({operation:"查询服务",url:contextPath+"/mx/form/data/mtsearch",type:"post",data:{did:n.useId,params:JSON.stringify(t)},dataType:"json",async:!1,success:function(a){if(r.callbackParam=r.callbackParam||{},a.total){var i=a.data,o=i[0],s={};$.each(n.callback,function(e,t){r.callbackParam[t.param]=o[t.columnName],t.dataId&&0==t.dataId.indexOf("ary")?(!s[t.dataId]&&(r.callbackParam[t.dataId]=[])&&(s[t.dataId]=!0),$.each(i,function(e,a){r.callbackParam[t.dataId][e]||(r.callbackParam[t.dataId][e]={}),r.callbackParam[t.dataId][e][t.param]=a[t.columnName]})):t.dataId&&0==t.dataId.indexOf("obj")&&(!s[t.dataId]&&(r.callbackParam[t.dataId]={})&&(s[t.dataId]=!0),r.callbackParam[t.dataId][t.param]=o[t.columnName])}),t.isAlt||alert("操作成功完成！")}else $.each(n.callback,function(e,t){r.callbackParam[t.param]="",t.dataId&&0==t.dataId.indexOf("ary")?(!s[t.dataId]&&(r.callbackParam[t.dataId]=[])&&(s[t.dataId]=!0),$.each(i,function(e,a){r.callbackParam[t.dataId][e]||(r.callbackParam[t.dataId][e]={}),r.callbackParam[t.dataId][e][t.param]=""})):t.dataId&&0==t.dataId.indexOf("obj")&&(!s[t.dataId]&&(r.callbackParam[t.dataId]={})&&(s[t.dataId]=!0),r.callbackParam[t.dataId][t.param]="")}),t.isAlt||alert("没有查询结果.");pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}})},convertService:function(e,t,a){var n;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]);var r={useId:n.useId,params:JSON.stringify(t),type:n.oid},i=window;MyAjax({operation:"转换服务事件",url:contextPath+"/mx/form/data/convertService",type:"post",data:r,async:!1,success:function(a){a&&(a=JSON.parse(a))&&!a.statusCode?(i.callbackParam=i.callbackParam||{},$.each(n.callback,function(e,t){i.callbackParam[t.param]=a[t.columnName]}),t.isAlt||alert("操作成功完成！")):alert("异常错误,请稍后再试."),pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}})},mtPagePrint:function(e,t,a){var n=pubsub.getJQObj(e,!0);if(n&&n[0]){if(!n.printArea){var r=$('<script type="text/javascript" src="'+contextPath+'/scripts/jquery.PrintArea.js"><\/script>');$("body").append(r)}n.printArea()}else window.print()},mtCellPrint:function(e,t,a){pubsub.getJQObj(e,!0).data("spread").print()},mtCellExport:function(e,t,a){var n=pubsub.getThat(e)||window,r=(t=($.isArray(t)?t[0]:t)||{}).exprotValue,i=t.exprotName||"",o="",s=e;$.isArray(e)&&(s=e[0]);s.callback;var l=s.useId;l&&(o="?mtUserId="+l,r=JSON.stringify(t));var u=contextPath+"/mx/form/data/spread2xls"+o,c=(n.$("#__cell_export_iframe__").get(0)?n.$("#__cell_export_iframe__"):n.$("<iframe>",{id:"__cell_export_iframe__",name:"__cell_export_iframe__",style:"display:none"}).appendTo("body"),n.$("#__cell_export_form__").get(0)?n.$("#__cell_export_form__").attr("action",u):n.$("<form>",{id:"__cell_export_form__",action:u,method:"post",target:"__cell_export_iframe__",style:"display:none"}).appendTo("body"));n.$("#__cell_export_value__").get(0)?n.$("#__cell_export_value__").val(r):n.$("<input>",{id:"__cell_export_value__",name:"exprotValue",type:"text",value:r}).appendTo(c),n.$("#__cell_export_name__").get(0)?n.$("#__cell_export_name__").val(i):n.$("<input>",{id:"__cell_export_name__",name:"exprotName",type:"text",value:i}).appendTo(c);c.submit()},nodeMessage:function(e,t,a){MyAjax({operation:"短信服务",url:contextPath+"/mx/form/sendMessage",type:"post",data:{params:JSON.stringify(t)},dataType:"json",async:!1,success:function(t){t&&t.message&&alert(t.message),pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}})},mtOpenTab:function(e,t,a){var n=t.TABURL,r="",i=t.path;if(i)n=i;else{if(!n)return alert("地址不能为空!"),!1;var o={TABURL:"",TABID:"",TABNAME:""},s=[];$.each(t,function(e,t){!(e in o)&&s.push(e+"="+t)}),r=s.join("&"),n=n.indexOf("?")>=0?n+"&"+r:n+"?"+r}var l=parent.addTabEx||parent.parent.addTabEx;if(l?l(t.TABID||(new Date).getTime(),t.TABNAME,n):window.open(n),window.pageParameters&&window.pageParameters.id){!window.top.__windows&&(window.top.__windows={}),window.top.__windows[window.pageParameters.id]=window}},mtCloseTab:function(e,t,a){window.ClosePageTab(t.TABID)},callTelNo:function(e,t,a){if(window.WebViewJavascriptBridge){var n,r=window;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]),window.WebViewJavascriptBridge.callHandler("callTelNo",{},function(t){r.callbackParam||(r.callbackParam={}),window.callbackParam||(window.callbackParam={}),$.each(n.callback,function(e,a){window.callbackParam[a.param]=r.callbackParam[a.param]=t}),pubsub.execChilds(e)})}else console.error("请在手机端使用获取手机号码功能")},callGps:function(e,t,a){if(window.WebViewJavascriptBridge){var n,r=window;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]),window.WebViewJavascriptBridge.callHandler("callGps",{},function(t){r.callbackParam||(r.callbackParam={}),window.callbackParam||(window.callbackParam={}),$.each(n.callback,function(e,a){window.callbackParam[a.param]=r.callbackParam[a.param]=t}),pubsub.execChilds(e)})}else console.error("请在手机端使用获取GPS坐标功能")},callScan:function(e,t,a){window.WebViewJavascriptBridge?window.WebViewJavascriptBridge.callHandler("callScan",!(!t||!t.hasCallback),function(e){}):console.error("请在手机端使用扫描二维码功能")},callLogout:function(e,t,a){window.WebViewJavascriptBridge?window.WebViewJavascriptBridge.callHandler("logout",{},function(e){}):console.error("请在手机端使用注销退出功能")},callTif:function(e,t,a){if(window.WebViewJavascriptBridge){var n=t.tifId,r=t.tnfield,i=t.ctfield,o=t.idfield||"id",s=t.databaseId,l="/mx/form/imageUpload?method=downloadById&id="+n;r&&i&&(l="/mx/form/imageUpload?method=downloadByTab&tid="+n+"&tn="+r+"&ct="+i+"&id="+o+"&databaseId="+s),window.WebViewJavascriptBridge.callHandler("callTif",{url:l},function(e){})}else console.error("请在手机端使用查看TIF功能")},callWpfSoaTif:function(e,t,a){window.WebViewJavascriptBridge?(pageBtFunc.mtLoading(),MyAjax({operation:"手机查看wpfsoatif文件",url:contextPath+"/mx/wpf/getFiledotByIdForSoa",type:"post",data:t,dataType:"json",success:function(e){pageBtFunc.cancelLoading(),e&&200==e.code?window.WebViewJavascriptBridge.callHandler("callWpfSoaTif",{url:e.data},function(e){}):alert(e.message)},error:function(){pageBtFunc.cancelLoading(),alert("异常错误,请稍后再试.")}})):console.error("请在手机端使用查看TIF功能")},callTelPhone:function(e,t,a){if(window.WebViewJavascriptBridge){t.tifId;window.WebViewJavascriptBridge.callHandler("callTelPhone",t.telPhone,function(e){})}else console.error("请在手机端使用拨打电话功能")},callLogin:function(e,t,a){if(window.WebViewJavascriptBridge){if(t.rember&&1==t.rember){if(!$.cookie){var n=$('<script type="text/javascript" src="'+contextPath+'/webfile/js/jquery.cookie.js"><\/script>');$("body").append(n)}var r={};t.expires&&(r.expires=t.expires),$.cookie("userInfo",t.x,r)}window.WebViewJavascriptBridge.callHandler("goHome",{x:t.x,y:t.y,z:t.z||"",k:t.k||contextPath,a:t.a,r:t.r},function(e){})}else console.error("请在手机端使用手机登录功能")},callYsVideo:function(e,t,a){window.WebViewJavascriptBridge?MyAjax({operation:"手机查看萤石云视频",url:contextPath+"/mx/form/videoData/videoMobileData",type:"post",data:t,async:!1,success:function(e){e?window.WebViewJavascriptBridge.callHandler("callPlayVideo",{param:e},function(e){}):alert("参数传递错误")},error:function(){alert("异常错误,请稍后再试.")}}):console.error("请在手机端使用此功能")},taskTable:function(e,t,a){var n;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]);var r={useId:n.useId,params:JSON.stringify(t)};MyAjax({operation:"组合任务表调度",url:contextPath+"/mx/form/data/taskTable",type:"post",data:r,dataType:"json",async:!1,success:function(a){a&&a.message&&(t.isAlt||alert(a.message)),pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}})},tableCombination:function(e,t,a){var n;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]);var r={useId:n.useId,params:JSON.stringify(t)};MyAjax({operation:"组合任务表调度",url:contextPath+"/mx/form/data/tableCombination",type:"post",data:r,dataType:"json",async:!1,success:function(a){a&&a.message&&(t.isAlt||alert(a.message)),pubsub.execChilds(e)},error:function(){alert("异常错误,请稍后再试.")}})},wpfMobileNotification:function(e,t,a){MyAjax({operation:"wpf推送通知",url:contextPath+"/mx/jiguang/push",type:"post",data:t,dataType:"json",async:!1,success:function(e){e&&e.message},error:function(){alert("推送失败.")}})},setCyclicTask:function(e,t,a){var n=window;n.createCyclicTask=function(){pubsub.execChilds(e)};var r,i=n.setInterval("createCyclicTask()",t.delayTime||300);$.isPlainObject(e)?r=e:$.isArray(e)&&(r=e[0]),n.callbackParam=n.callbackParam||{},$.each(r.callback,function(e,t){n.callbackParam[t.param]=i})},clearCyclicTask:function(e,t,a){var n=window,r=t.cyclicTask;r&&n.clearInterval(r)},mtVali:function(e,t,a){var n,r=pubsub.getThat(e),i=r.$("[valiSave=true]"),o=!0;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]),i.length&&!i.valid()&&(o=!1);for(var s=n.insExp-0;s>0;s--)r=r.opener||r.parent;r.callbackParam||(r.callbackParam={}),window.callbackParam||(window.callbackParam={}),$.each(n.callback,function(e,t){window.callbackParam[t.param]=r.callbackParam[t.param]=o}),pubsub.execChilds(e)},tableTransform:function(e,t,a){var n;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]);var r=t.databaseId||"";MyAjax({type:"POST",url:contextPath+"/mx/form/tableTransform/execute?tableName="+n.useId+"&databaseId="+r,data:t,dataType:"json",error:function(e){alert("服务器处理错误！")},success:function(a){null!=a&&a.message,t.isAlt||alert("操作成功完成！"),pubsub.execChilds(e)}})},mtConfirm:function(e,t,a){var n,r=window;$.isPlainObject(e)&&(n=e),$.isArray(e)&&(n=e[0]);var i,o,s,l=[BootstrapDialog.TYPE_DEFAULT,BootstrapDialog.TYPE_INFO,BootstrapDialog.TYPE_PRIMARY,BootstrapDialog.TYPE_SUCCESS,BootstrapDialog.TYPE_WARNING,BootstrapDialog.TYPE_DANGER],u=["btn-default","btn-info","btn-primary","btn-success","btn-warning","btn-danger"];t.titleType&&l.length-(t.titleType-1)>1&&(i=l[t.titleType-1]),t.btnOKClass&&u.length-(t.btnOKClass-1)>1&&(o=u[t.btnOKClass-1]),t.btnCancelClass&&u.length-(t.btnCancelClass-1)>1&&(s=u[t.btnCancelClass-1]),window.confirm2&&window.confirm2({type:i,title:t.title,message:t.message,btnOKClass:o,btnOKLabel:t.btnOKLabel,btnCancelClass:s,btnCancelLabel:t.btnCancelLabel,callback:function(t){r.callbackParam=r.callbackParam||{},$.each(n.callback,function(e,a){r.callbackParam[a.param]=t}),n.callback?pubsub.execChilds(e):t&&pubsub.execChilds(e)}})},logout:function(e,t,a){location.href=contextPath+"/mx/login/logout"},systemServer:function(rule,params,args){var thatWin=window,operation=void 0!=rule[0]?rule[0].useId:rule.useId;if(params){var isAlt=!1;params.isAlt&&(isAlt=!0);var ruleOne,thatWin=window;$.isPlainObject(rule)&&(ruleOne=rule),$.isArray(rule)&&(ruleOne=rule[0]);var callbackFunct=function(){pubsub.execChilds(rule)};if("addRole"==operation)$.ajax({url:contextPath+"/mx/custom/role/saveAdd",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?(isAlt||(e.message?alert(e.message):alert("添加角色成功")),thatWin.callbackParam=thatWin.callbackParam||{},$.each(ruleOne.callback,function(t,a){thatWin.callbackParam[a.param]=e.data[a.columnName]})):e.message?alert(e.message):alert("添加角色失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("服务器处理错误！,请修改后再试。")}});else if("modifyRole"==operation)$.ajax({url:contextPath+"/mx/custom/role/saveModify",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("修改角色成功")):e.message?alert(e.message):alert("修改角色失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("服务器处理错误！,请修改后再试。")}});else if("deleteRole"==operation)confirm2("是否确认删除",function(e){e&&$.ajax({url:contextPath+"/mx/custom/role/batchDelete",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("删除角色成功")):e.message?alert(e.message):alert("删除角色失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("服务器处理错误！,请修改后再试。")}})});else if("addDepartment"==operation)$.ajax({url:contextPath+"/mx/custom/department/saveAdd",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?(isAlt||(e.message?alert(e.message):alert("新增部门成功")),thatWin.callbackParam=thatWin.callbackParam||{},$.each(ruleOne.callback,function(t,a){thatWin.callbackParam[a.param]=e.data[a.columnName]})):e.message?alert(e.message):alert("新增部门失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("服务器处理错误！,请修改后再试。")}});else if("copyServer"==operation.split("-",1)){var arr=operation.split("-");$.ajax({url:contextPath+"/mx/form/data/saveDataServer",async:!0,data:{databaseId:arr[2],tableName:arr[1],indexId:params.indexId,tindexId:params.t_indexId,indexKey:arr[3],parentKey:arr[4],treeKey:arr[5]},type:"post",success:function(ret){(ret=eval("("+ret+")")).msg&&(isAlt||alert(ret.msg),callbackFunct())}})}else if("modifyDepartment"==operation){var link=contextPath+"/mx/custom/department/saveModify";if(!params.id)return void alert("修改时需要部门id");$.ajax({url:link,type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("修改部门成功")):e.message?alert(e.message):alert("修改部门失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("服务器处理错误！,请修改后再试。")}})}else if("delDepartment"==operation){var link=contextPath+"/mx/custom/department/batchDelete";confirm2("是否确认删除",function(e){params.id&&!params.ids&&(params.ids=params.id),e&&jQuery.ajax({type:"POST",url:link,dataType:"json",data:params,error:function(e){alert("服务器处理错误！")},success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("删除部门成功")):e.message?alert(e.message):alert("删除部门失败")),e&&"200"==e.statusCode&&callbackFunct()}})})}else"blukAddUser"==operation?$.ajax({url:contextPath+"/mx/custom/user/blukSaveAdd",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("新增用户成功")):e.message?alert(e.message):alert("新增用户失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"addUser"==operation?$.ajax({url:contextPath+"/mx/custom/user/saveAdd",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("新增用户成功")):e.message?alert(e.message):alert("新增用户失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"registerUser"==operation?$.ajax({url:contextPath+"/mx/custom/user/register",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("新增用户成功")):e.message?alert(e.message):alert("新增用户失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"modifyUser"==operation?(params.id||alert("修改用户需要用户账号信息!"),$.ajax({url:contextPath+"/mx/custom/user/saveModify",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("修改用户成功")):e.message?alert(e.message):alert("修改用户失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}})):"resetUserPwd"==operation?(params.id||alert("修改用户密码需要用户账号信息!"),$.ajax({url:contextPath+"/mx/custom/user/resetPwd",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("修改用户成功")):e.message?alert(e.message):alert("修改用户失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}})):"resetPwdByMySelf"==operation?(params.id||alert("修改用户密码需要用户账号信息!"),$.ajax({url:contextPath+"/mx/custom/user/resetPwdByMySelf",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("修改密码成功")):e.message?alert(e.message):alert("修改密码失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}})):"deleteUser"==operation?confirm2("是否确认删除",function(e){e&&$.ajax({url:contextPath+"/mx/custom/user/batchDelete",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("删除成功")):e.message?alert(e.message):alert("删除失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误")}})}):"saveUserRoles"==operation?(params.actorId||alert("分配用户角色需要用户信息!"),$.ajax({url:contextPath+"/mx/custom/user/saveUserRoles",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("分配成功")):e.message?alert(e.message):alert("分配失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误")}})):"blukSaveUserRoles"==operation?$.ajax({url:contextPath+"/mx/custom/user/blukSaveUserRoles",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("分配成功")):e.message?alert(e.message):alert("分配失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误")}}):"blukInsertUserRoles"==operation?$.ajax({url:contextPath+"/mx/custom/user/blukInsertUserRoles",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("分配成功")):e.message?alert(e.message):alert("分配失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误")}}):"blukRemoveUserRoles"==operation?confirm2("是否确认删除",function(e){e&&$.ajax({url:contextPath+"/mx/custom/user/blukRemoveUserRoles",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("分配成功")):e.message?alert(e.message):alert("分配失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误")}})}):"addRole"==operation?$.ajax({url:contextPath+"/mx/custom/role/saveAdd",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("新增角色成功")):e.message?alert(e.message):alert("新增角色失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"branchDepartmentSaveRole"==operation?$.ajax({url:contextPath+"/mx/custom/branch/department/saveRoles",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("新增成功")):e.message?alert(e.message):alert("新增失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"addDatabaseAccessor"==operation?$.ajax({url:contextPath+"/mx/custom/database/saveAccessor",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("权限添加成功")):e.message?alert(e.message):alert("权限添加失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"deleteDatabaseAccessor"==operation?confirm2("是否确认删除",function(e){e&&(params.operation="revoke",$.ajax({url:contextPath+"/mx/custom/database/saveAccessor",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("权限添加成功")):e.message?alert(e.message):alert("权限添加失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}))}):"setSmsPersion"==operation?$.ajax({url:contextPath+"/mx/custom/user/setSmsPersion",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("操作成功")):e.message?alert(e.message):alert("操作失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"saveRoleMenus"==operation?$.ajax({url:contextPath+"/mx/custom/role/saveRoleMenus",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("操作成功")):e.message?alert(e.message):alert("操作失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"saveRoleMenusNoDelete"==operation?$.ajax({url:contextPath+"/mx/custom/role/saveRoleMenusNoDelete",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("操作成功")):e.message?alert(e.message):alert("操作失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}}):"deleteRoleMenu"==operation&&confirm2("是否确认删除",function(e){e&&$.ajax({url:contextPath+"/mx/custom/role/deleteRoleMenu",type:"post",dataType:"json",async:!0,data:params,success:function(e){e&&("200"==e.statusCode?isAlt||(e.message?alert(e.message):alert("操作成功")):e.message?alert(e.message):alert("操作失败")),e&&"200"==e.statusCode&&callbackFunct()},error:function(e){alert("异常错误，请联系管理员！")}})})}},downloadFile:function(e,t,a){var n=t.attachmentId;if(n){var r=contextPath+"/mx/form/attachment?method=download&id="+n;window.open(r)}}};pubsub.sub("page",pageBtFunc);var GetTabWin=function(e){var t=new Function,a=0;return t.find=function(e){return(e=e||window).document.getElementById("usual1")&&e.closePage?(a=0,e):(e.parent&&(e.parent.__child=e),!e.parent||a>5?(a=0,null):(++a,t.find(e.parent)))},t}();$.validator.methods.customRule=function(e,t,a){return initPageValidate.prototype.customRule($(t))};var setCustomRule=function(e,t,a){e.rules("add",{customRule:a||"",messages:{customRule:t}})};initPageValidate.prototype.customRule=function(k){var mtValidate=k.data("mtValidate"),trigger=k.data("mtValiObj"),execObj=pubsub._getInParams(mtValidate.execExpData,1),exec=pubsub.expConvert(mtValidate.execExp||"",execObj);if(""!=exec){var execBol=eval(exec);if(!execBol)return!0}var eObj=pubsub._getInParams(mtValidate.expData,1),exp=pubsub.expConvert(mtValidate.exp||"",eObj);if(""!=exp){var expBol=eval(exp);return!!expBol}return!0};var pubsubobjects={default:function(e){if("changeByName"==e.eventType)$("input[name="+$(this).attr("name")+"]").on("change",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")});else if("listenVal"==e.eventType)new MutationObserver(function(t){pubsub.pub(e.pageEvent,"")}).observe($(this)[0],{attributes:!0,characterData:!0,subtree:!0,attributeFilter:["setvalue"]}),$(this).on("change",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")});else if("listenKey"==e.eventType)(t=this).on("keyup",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")});else if("listenEnter"==e.eventType){var t=this;t.on("keyup",function(t){mtxx.e=t;e.which;"13"==t.keyCode&&pubsub.pub(e.pageEvent,"")})}else if(-1!=e.eventType.indexOf("By")){var a=e.eventType.substr(e.eventType.indexOf("By")+2);$(this).find(a).length,$(this).on(e.eventType.substr(0,e.eventType.indexOf("By")),function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})}else $(this).on(e.eventType,function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})},ztree:function(e){var t=$.fn.zTree.getZTreeObj(this.attr("id"));if(t)"clickEvent"==e.eventType?t.setting.callback.onClick=function(t,a,n){pubsub.pub(e.pageEvent,"",a,n)}:"checkEvent"==e.eventType?t.setting.callback.onCheck=function(t,a,n){pubsub.pub(e.pageEvent,"",a,n)}:"onLoadSuccess"==e.eventType&&(t.setting.callback.onLoadSuccess=function(t,a,n){pubsub.pub(e.pageEvent,"",a,n)});else{var a=this.data("_bindEvent_");a?a.push(e):this.data("_bindEvent_",[e])}},prompt:function(e){var t=$("#"+this.attr("id")).data("promptExt");"inithind"==e.eventType&&t&&t.options&&jqCb.add(function(){pubsub.pub(e.pageEvent,"",t.options)})},popover:function(e){var t=$("#"+this.attr("id")).data("popoverExt");"initpopover"==e.eventType&&t&&t.options&&jqCb.add(function(){pubsub.pub(e.pageEvent,"",t.options)})},button:function(e){if("true"==$(this).attr("t-events")){var t="[data-role] a[btn-id="+$(this).attr("id")+"][t-events=true]";$(this).data("event",e),$(document).on(e.eventType+"."+$(this).attr("id"),t,function(e){e.preventDefault();var t=$(this).attr("btn-id"),a=$("#"+t);if(a[0]){var n,r=$(this).closest("tr").attr("row-index"),i=$(this).closest("[data-role]"),o=i.attr("data-role"),s=a.data("event");"gridbt"==o&&(n=i.data("grid").getData()[r]),s&&(mtxx.e=e,pubsub.pub(s.pageEvent,"",void 0,n))}})}else pubsubobjects.default.call(this,e)},page:function(e){if("pageInit"==e.eventType)jqCb.add(function(){pubsub.pub(e.pageEvent)});else if("mtSubmit"==e.eventType)$(document.body).data("mtSubmit",function(){pubsub.pub(e.pageEvent)});else if("oncloseEvent"==e.eventType){var t=function(t){pubsub.pub(e.pageEvent,"",t)};$("body").data("onbeforeunload",t),window.onbeforeunload=t}else"singleClick"==e.eventType?$("body").on("click",function(t){pubsub.pub(e.pageEvent,"",t)}):"scanCallback"==e.eventType?$("body").data("scanCallback",function(t){pubsub.pub(e.pageEvent,"",t)}):"wpfscanSavedEvents"==e.eventType&&$("body").data("wpfscanSavedEvents",function(t){pubsub.pub(e.pageEvent,"",t)})},jsgis:function(e){var t=function(e,t){var a=$("#"+e.trigger.eleId),n=a.data(t)||[];n.push(function(t){var a=!1,n=!1;$.each(e.pageEvent.ops,function(e,r){for(var i in r.param){var o=r.param[i];$.each(o,function(e,r){"point"==r.param&&r.columnName==t.graphic.symbol.column&&(a=!0),"point"!=r.param&&r.columnName==t.graphic.symbol.column&&(n=!0)})}}),a&&pubsub.pub(e.pageEvent,"",t,n)})&&a.data(t,n)};"jsgisInit"==e.eventType?mapCb.add(function(){pubsub.pub(e.pageEvent)}):"clickEvent"==e.eventType?t(e,"clickEventList"):"dbclick"==e.eventType?t(e,"dbclickList"):"mouseover"==e.eventType?t(e,"mouseoverList"):"mouseup"==e.eventType&&t(e,"mouseupList")},definedTable:function(e){var t=$("#"+this.attr("id"));"loadEndExecOne"==e.eventType&&t.definedTable("loadEndExecOne",function(t){pubsub.pub(e.pageEvent,"",t)}),"loadEnd"==e.eventType&&t.definedTable("loadEnd",function(t){pubsub.pub(e.pageEvent,"",t)}),"onClickTable"==e.eventType&&t.definedTable("onClickTable",function(t){pubsub.pub(e.pageEvent,"",t)})},calendarbt:function(e){var t=$("#"+this.attr("id"));"unselect"==e.eventType?t.find("div.has-toolbar").data("fullCalendar").options.unselect=function(t,a,n){pubsub.pub(e.pageEvent,"",a,n)}:"eventClick"==e.eventType?t.find("div.has-toolbar").data("fullCalendar").options.eventClick=function(t,a,n){pubsub.pub(e.pageEvent,"",t,a,n)}:"dayClick"==e.eventType&&(t.find("div.has-toolbar").data("fullCalendar").options.dayClick=function(t,a,n){pubsub.pub(e.pageEvent,"",t,a,n)})},megamenu:function(e){var t=$("#"+this.attr("id")),a=t.attr("selectcolor"),n=t.megaMenuExt("getSelectColor",a);t.on("click",'ul.page-sidebar-menu-mt a:not(".nav-toggle"),ul.nav.navbar-nav a:not(".nav-toggle")',function(){t.data("select")&&(t.data("select").removeClass(n),t.data("select").parents("li").find(">a").removeClass(n)),$(this).addClass(n),$(this).parents("li").find(">a").addClass(n),t.data("select",$(this)),pubsub.pub(e.pageEvent,"",$(this).closest("li").data("mObj"))})},login_actions:function(e){var t=$("#"+this.attr("id"));"click"==e.eventType&&t.on("click",'button[frame-variable="loginBtn"]',function(a){pubsub.pub(e.pageEvent,"",t)})},login_username:function(e){var t=$("#"+this.attr("id"));"keypress"==e.eventType&&t.on("keypress",'input[frame-variable="username"]',function(t){13==t.which&&pubsub.pub(e.pageEvent,"")}),"listenVal"==e.eventType&&t.on("change",'input[frame-variable="username"]',function(t){pubsub.pub(e.pageEvent,"")}),"listenEnter"==e.eventType&&t.on("keyup",'input[frame-variable="username"]',function(t){"13"==t.keyCode&&pubsub.pub(e.pageEvent,"")})},login_password:function(e){var t=$("#"+this.attr("id"));"keypress"==e.eventType&&t.on("keypress",'input[frame-variable="password"]',function(t){13==t.which&&pubsub.pub(e.pageEvent,"")}),"listenVal"==e.eventType&&t.on("change",'input[frame-variable="password"]',function(t){pubsub.pub(e.pageEvent,"")}),"listenEnter"==e.eventType&&t.on("keyup",'input[frame-variable="password"]',function(t){"13"==t.keyCode&&pubsub.pub(e.pageEvent,"")})},login_verify:function(e){var t=$("#"+this.attr("id"));"keypress"==e.eventType&&t.on("keypress",'input[frame-variable="verification"]',function(t){13==t.which&&pubsub.pub(e.pageEvent,"")}),"listenKey"==e.eventType&&t.on("keyup",'input[frame-variable="verification"]',function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")}),"listenEnter"==e.eventType&&t.on("keyup",'input[frame-variable="verification"]',function(t){"13"==t.keyCode&&pubsub.pub(e.pageEvent,"")})},__gridbt__:function(e){var t=this.attr("id"),a=$("#"+t);"listenVal"==e.eventType||"change"==e.eventType?a.on("change","[name="+e.trigger.eleId+"]",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")}):"click"==e.eventType?a.on("click","[name="+e.trigger.eleId+"]",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")}):"loadSucess"==e.eventType?a.metroselect("getOptions").events.onLoadSucess=function(t){pubsub.pub(e.pageEvent,"",t)}:"clickNode"==e.eventType?a.on("ifClicked","[name="+e.trigger.eleId+"]",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeChange"==e.eventType?a.on("ifChanged","[name="+e.trigger.eleId+"]",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeChecked"==e.eventType?a.on("ifChecked","[name="+e.trigger.eleId+"]",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeUnchecked"==e.eventType?a.on("ifUnchecked","[name="+e.trigger.eleId+"]",function(t){pubsub.pub(e.pageEvent,"",t)}):"dblclick"==e.eventType&&a.on("dblclick","[name="+e.trigger.eleId+"]",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})},gridbt:function(e){var t=this.attr("id"),a=$("#"+t);if(e.trigger.otype)pubsubobjects.__gridbt__.call(this,e);else if("gchange"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.onClickRow=function(t,a){pubsub.pub(e.pageEvent,"",t,a)});else if("loadEnd"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.onLoadSuccess=function(t){pubsub.pub(e.pageEvent,"",t)});else if("dbclick"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.onDblClickRow=function(t,a){pubsub.pub(e.pageEvent,"",t,a)});else if("beginEditEvent"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.beginEditEvent=function(t){pubsub.pub(e.pageEvent,"",t)});else if("onCheckRow"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.onCheckRow=function(t,a){pubsub.pub(e.pageEvent,"",t,a)});else if("onclick"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.onClickCell=function(t,a,n){pubsub.pub(e.pageEvent,"",t,a,n,this)});else if("justClick"==e.eventType)a.on("click",function(t){$(t.target).is("div")&&pubsub.pub(e.pageEvent,"",t)});else if("beforeEndEdit"==e.eventType)(n=a.data("grid"))&&n.options&&(n.options.events.onBeforeEndEdit=function(){pubsub.pub(e.pageEvent,"")});else if("updateButtonClick"==e.eventType){var n=a.data("grid");n&&n.options&&(n.options.events.onUpdateButtonClick=function(){a.find("a[atype='update']").on("click",function(t){pubsub.pub(e.pageEvent,"",t)})})}},gridlist:function(e){var t=this.attr("id"),a=$("#"+t);if("clickEvent"==e.eventType&&(n=a.data("gridList"))&&n.options&&(n.options.callback.OnContentClick=function(t){pubsub.pub(e.pageEvent,"",t)}),"dblClickEvent"==e.eventType&&(n=a.data("gridList"))&&n.options&&(n.options.callback.OnContentDblClick=function(t){pubsub.pub(e.pageEvent,"",t)}),"droppend"==e.eventType&&(n=a.data("gridList"))&&n.options&&(n.options.callback.onDroppEnd=function(t){pubsub.pub(e.pageEvent,"",t)}),"drapStart"==e.eventType&&(n=a.data("gridList"))&&n.options&&(n.options.callback.onDrapStart=function(t){pubsub.pub(e.pageEvent,"",t)}),"draopOver"==e.eventType&&(n=a.data("gridList"))&&n.options&&(n.options.callback.onDroppOver=function(t){pubsub.pub(e.pageEvent,"",t)}),"onloadSuccess"==e.eventType){var n=a.data("gridList");n&&n.options&&(n.options.callback.OnLoadSuccess=function(t){pubsub.pub(e.pageEvent,"",t)})}},gridList:function(e){pubsubobjects.gridlist.call(this,e)},treelistbt:function(e){var t=this.attr("id"),a=$("#"+t);if(e.trigger.otype)pubsubobjects.__gridbt__(e);else if("gchange"==e.eventType)(n=a.data("treelist"))&&n.options?n.options.events.onClickRow=function(t,a){pubsub.pub(e.pageEvent,"",t,a)}:a[0]&&a.data("__onClickRow__",function(t,a){pubsub.pub(e.pageEvent,"",t,a)});else if("loadEnd"==e.eventType)(n=a.data("treelist"))&&n.options?n.options.events.onLoadSuccess=function(t){pubsub.pub(e.pageEvent,"",t)}:a[0]&&a.data("__onLoadSuccess__",function(t){pubsub.pub(e.pageEvent,"",t)});else if("dbclick"==e.eventType)(n=a.data("treelist"))&&n.options?n.options.events.onDblClickRow=function(t,a){pubsub.pub(e.pageEvent,"",t,a)}:a[0]&&a.data("__onDblClickRow__",function(t,a){pubsub.pub(e.pageEvent,"",t,a)});else if("onCheckRow"==e.eventType){var n=a.data("treelist");n&&n.options?n.options.events.onCheckRow=function(t,a){pubsub.pub(e.pageEvent,"",t,a)}:a[0]&&a.data("__onCheckRow__",function(t,a){pubsub.pub(e.pageEvent,"",t,a)})}},cell:function(e){$this=this;var t=$this.data("eventsRule")||{};t[e.trigger.eleId]=function(t){pubsub.pub(e.pageEvent,"",t)},$this.data("eventsRule",t)},charts:function(e){var t=this;"clickEvent"==e.eventType&&t.data("clickEvent",function(t){pubsub.pub(e.pageEvent,"",t,this)})},mapext:function(e){var t=this.attr("id"),a=$("#"+t);if("clickNode"==e.eventType){var n=a.data("echartsmapExt");n&&n.options&&(n.options.events.clickNode=function(t){pubsub.pub(e.pageEvent,"",t)})}},diagrambt:function(e){var t=this;t.isdblclick=!1,"clickNode"==e.eventType&&t.on("click",".orgchart .node",function(a){t.data("isdblclick",!1),setTimeout(function(){t.data("isdblclick")||pubsub.pub(e.pageEvent,"",a,this)},250)}),"dblclickNode"==e.eventType&&t.on("dblclick",".orgchart .node",function(a){t.data("isdblclick",!0),pubsub.pub(e.pageEvent,"",a,this)})},gantt:function(e){var t=this.attr("id"),a=$("#"+t);"gchange"==e.eventType&&(a.bind("gantt-click",function(t,a,n){pubsub.pub(e.pageEvent,"",a,n)}),a.iframegantt("initEvents",{events:{onClickRow:function(e,t){a.trigger("gantt-click",[e,t])},onDbClickRow:function(e,t){a.trigger("gantt-click",[e,t])}}}))},step:function(e){var t=this;"clickStep"==e.eventType&&t.on("click","div.mt-step-col",function(t){var a=$(this).data("step");pubsub.pub(e.pageEvent,"",a)})},icheckradio:function(e){var t=this;"clickNode"==e.eventType?t.on("ifClicked","input",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeChange"==e.eventType?t.on("ifChanged","input",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeChecked"==e.eventType?t.on("ifChecked","input",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeUnchecked"==e.eventType&&t.on("ifUnchecked","input",function(t){pubsub.pub(e.pageEvent,"",t)})},icheckbox:function(e){var t=this;"clickNode"==e.eventType?t.on("ifClicked","input",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeChange"==e.eventType?t.on("ifChanged","input",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeChecked"==e.eventType?t.on("ifChecked","input",function(t){pubsub.pub(e.pageEvent,"",t)}):"nodeUnchecked"==e.eventType&&t.on("ifUnchecked","input",function(t){pubsub.pub(e.pageEvent,"",t)})},excelupload:function(e){var t=this;"onUploadSucess"==e.eventType&&(t.data("excelFileUpload").opts.onUploadSucess=function(t){pubsub.pub(e.pageEvent,"",t)})},metroselect:function(e){var t=this;"loadSucess"==e.eventType?t.metroselect("getOptions").events.onLoadSucess=function(t){pubsub.pub(e.pageEvent,"",t)}:$(this).on(e.eventType,function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})},customSelect:function(e){var t=this;"loadSucess"==e.eventType?t.data("customSelect").option.events.onLoadSuccess=function(t){pubsub.pub(e.pageEvent,"",t)}:$(this).on(e.eventType,function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})},searchbar:function(e){var t=this;"listenVal"==e.eventType?(new MutationObserver(function(t){pubsub.pub(e.pageEvent,"")}).observe($(this)[0],{attributes:!0,characterData:!0,subtree:!0,attributeFilter:["setvalue"]}),$(this).on("change",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})):"listenKey"==e.eventType?t.on("keyup",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")}):"listenEnter"==e.eventType?t.on("keyup",function(t){mtxx.e=t;e.which;"13"==t.keyCode&&pubsub.pub(e.pageEvent,"")}):"dblclick"==e.eventType?t.on("dbclick",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")}):"click"==e.eventType&&t.on("click",function(t){mtxx.e=t,pubsub.pub(e.pageEvent,"")})},jqfileupload2:function(e){var t=this;if("uploadSucess"==e.eventType){var a=t.data("spFileUpload");if(a&&a.opts){var n=a.opts;n.events=n.events||{},n.events.onUploadSuccess=function(t){pubsub.pub(e.pageEvent,"",t)}}}},bootstrap_tabs:function(e){var t=this;"activeEvent"==e.eventType&&t.find('>.nav-tabs a[data-toggle="tab"],>.row>.tabnav>.nav-tabs a[data-toggle="tab"]').on("shown.bs.tab",function(t){pubsub.pub(e.pageEvent,"",t)})},bim:function(e){var t=this,a={BimClick:function(a){var n=t.data("bim");n.onSelect=function(a){try{if(!t.data("client_method")){var r=a.dbIdArray[0];if(null!=r){var i=t.bim("GetNodeById",r);pubsub.pub(e.pageEvent,"",$.extend(!0,i,{_documentId:n._documentId}))}}}catch(e){throw e}finally{t.data("client_method",!1)}}}};a[e.eventType]&&a[e.eventType]()},reviewArea:function(e){var t=this;if("reply"==e.eventType){var a=t.data("reviewArea");a&&a.option&&(a.option.event.reply=function(t){pubsub.pub(e.pageEvent,"")})}},definedcard:function(e){var t=this;if("gchange"==e.eventType){var a=t.data("definedCardExt");a&&a.options&&(a.options.events.onClickRow=function(t,a){pubsub.pub(e.pageEvent,"",t)})}},switch:function(e){var t=this;"gchange"==e.eventType&&t.find("input[type='checkbox']").bootstrapSwitch("onSwitchChange",function(t,a){pubsub.pub(e.pageEvent,"",a)})},metrolist:function(e){var t=this;if("droppend"==e.eventType){var a=t.data("metrolist");a&&a.options&&(a.options.onDroppEnd=function(){pubsub.pub(e.pageEvent,"",null)})}},rangeSlider:function(e){var t=this.attr("id"),a=$("#"+t);if("dragBar"==e.eventType){var n=a.data("rangeSlider");n&&(n.options.onChan=function(){pubsub.pub(e.pageEvent,"",null)})}},fullpage:function(e){var t=this.attr("id"),a=$("#"+t);if("afterLoad"==e.eventType)(n=a.data("fullpage"))&&(n.options.afl=function(){pubsub.pub(e.pageEvent,"",null)});else if("afterSlideload"==e.eventType){var n=a.data("fullpage");n&&(n.options.asl=function(){pubsub.pub(e.pageEvent,"",null)})}},nestable:function(e){var t=this;if("dropNestEvent"==e.eventType&&(a=t.data("nestable"))&&(a.dragStopEvent=function(t){pubsub.pub(e.pageEvent,"")}),"dropStartEvent"==e.eventType){var a=t.data("nestable");a&&(a.dragStartEvent=function(t){pubsub.pub(e.pageEvent,"")})}},definedpanel:function(e){var t=this;if("onClickEvent"==e.eventType){var a=t.data("definedPanelExt");a&&a.options&&(a.options.events.onClickEvent=function(t,a){pubsub.pub(e.pageEvent,"",t)})}},custom:function(e){var t=this;"onLoadSucess"==e.eventType&&t.data("onLoadSucess",function(t){pubsub.pub(e.pageEvent,"",t)})},officebt:function(e){if("onAppendRowsByBookMarks"==e.eventType){var t=$(this);if(!t.get(0))return;t.data("office.options").options.events.onAppendRowsByBookMarks=function(t){pubsub.pub(e.pageEvent,"",t)}}},office:function(e){return pubsubobjects.officebt.apply(this,Array.prototype.slice.call(arguments,0))},bmapext:function(e){var t=this;if("initEnd"==e.eventType){var a=t.data("bmapext");a&&a.options&&(a.options.events.initEnd=function(t,a){pubsub.pub(e.pageEvent,"",t)})}}},btalertFunc={open:function(e,t){pubsub.getJQObj(e).btalert("open",t)},close:function(e,t){pubsub.getJQObj(e).btalert("close",t)}};pubsub.sub("btalert",btalertFunc);var btmessengerFunc={open:function(e,t){pubsub.getJQObj(e).btmessenger("open",t.content)},close:function(e,t){pubsub.getJQObj(e).btmessenger("close")}};pubsub.sub("btmessenger",btmessengerFunc);var calendarbtFunc={grefresh:function(e,t){pubsub.getJQObj(e).calendarExt("refresh")},getSource:function(e,t){return t[0][e.columnName]},getDate:function(e,t){return pubsub.getJQObj(e).calendarExt("dateFormat",t[0],"yyyy-MM-dd HH:mm:dd")},linkage:function(e,t){return pubsub.getJQObj(e).calendarExt("query",t)}};pubsub.sub("calendarbt",calendarbtFunc);var datepickerFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).datepickerExt("getValue")},setValue:function(e,t){for(var a=pubsub.getJQObj(e),n="",r=0;r<e.length;r++)n=t[e[r].param]||"";a.datepickerExt("setValue",n)},tclear:function(e,t){pubsub.getJQObj(e).datepickerExt("getOject").attr("tclear","tclear").val("")},thidden:function(e,t){pubsub.getJQObj(e).datepickerExt("display",!1)},tshow:function(e,t){pubsub.getJQObj(e).datepickerExt("display",!0)},tdisabled:function(e,t){pubsub.getJQObj(e).datepickerExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).datepickerExt("disabled",!0)}};pubsub.sub("datepickerbt",datepickerFunc);var datetimepickerFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).datetimepickerExt("getValue")},setValue:function(e,t){for(var a=pubsub.getJQObj(e),n="",r=0;r<e.length;r++)n=t[e[r].param]||"";a.datetimepickerExt("setValue",n)},tclear:function(e,t){pubsub.getJQObj(e).datetimepickerExt("getOject").attr("tclear","tclear").val("")},thidden:function(e,t){pubsub.getJQObj(e).datetimepickerExt("display",!1)},tshow:function(e,t){pubsub.getJQObj(e).datetimepickerExt("display",!0)},tdisabled:function(e,t){pubsub.getJQObj(e).datetimepickerExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).datetimepickerExt("disabled",!0)}};pubsub.sub("datetimepickerbt",datetimepickerFunc);var daterangepickerFunc={startSetValue:function(e,t){var a=pubsub.getJQObj(e),n=a.find(".form-control"),r=a.data("daterangepicker"),i=r.methods.formatDate(r,t),n=a.find(".form-control");$(n[0]).datepicker("setDate",i)},dateFormat:function(e,t){var a=new Date(e),n=function(e){return(e<10?"0":"")+e};return t.replace(/yyyy|MM|dd|HH|mm|ss/g,function(e){switch(e){case"yyyy":return n(a.getFullYear());case"MM":return n(a.getMonth()+1);case"mm":return n(a.getMinutes());case"dd":return n(a.getDate());case"HH":return n(a.getHours());case"ss":return n(a.getSeconds())}})},thidden:function(e,t){pubsub.getJQObj(e).daterangepickerExt("display",!1)},tshow:function(e,t){pubsub.getJQObj(e).daterangepickerExt("display",!0)},tdisabled:function(e,t){pubsub.getJQObj(e).daterangepickerExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).daterangepickerExt("disabled",!0)}};pubsub.sub("daterangepicker",daterangepickerFunc);var icheckboxFunc={getSelection:function(e,t){return pubsub.getJQObj(e).icheckbox("getSelection")},getText:function(e,t){var a=[],n=pubsub.getJQObj(e,!0).icheckbox("getSelection");return $.each(n,function(e,t){a.push(t.text)}),a.join(",")},getValue:function(e,t){var a=[],n=pubsub.getJQObj(e,!0).icheckbox("getSelection");return $.each(n,function(e,t){a.push(t.value)}),a.join(",")},getData:function(e,t){var a=pubsub.getJQObj(e,!0),n=[];if($.isArray(t)&&t.length>0){var r=a.data("icheckbox").options.__dataArray,i=$(t[0].currentTarget).attr("row-index")||"";r.length>0&&n.push(r[i][e.columnName])}else{var o=a.icheckbox("getSelection");$.each(o,function(t,a){n.push(a.data[e.columnName])})}return n.join(",")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.icheckbox("setValue",n)}else a.icheckbox("setValue",t)},linkage:function(e,t){pubsub.getJQObj(e).icheckbox("linkage",t)},getKeyName:function(e,t){return e.columnName},tdisabled:function(e,t){pubsub.getJQObj(e).icheckbox("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).icheckbox("disabled",!0)},disable:function(e,t){if(t.index)pubsub.getJQObj(e).icheckbox("disable",t.index);else{var a=t.key,n="";$.each(e,function(a,r){if("key"==e[a].param)return!0;n=t[e[a].param]||""});var r={key:a,value:n,type:"disable"};pubsub.getJQObj(e).icheckbox("checkByCompare",r)}},enable:function(e,t){if(t.index)pubsub.getJQObj(e).icheckbox("enable",t.index);else{var a=t.key,n="";$.each(e,function(a,r){if("key"==e[a].param)return!0;n=t[e[a].param]||""});var r={key:a,value:n,type:"enable"};pubsub.getJQObj(e).icheckbox("checkByCompare",r)}},check:function(e,t){if(t.index)pubsub.getJQObj(e).icheckbox("check",t.index);else{var a=t.key,n="";$.each(e,function(a,r){if("key"==e[a].param)return!0;n=t[e[a].param]||""});var r={key:a,value:n,type:"check"};pubsub.getJQObj(e).icheckbox("checkByCompare",r)}},uncheck:function(e,t){if(t.index)pubsub.getJQObj(e).icheckbox("uncheck",t.index);else{var a=t.key,n="";$.each(e,function(a,r){if("key"==e[a].param)return!0;n=t[e[a].param]||""});var r={key:a,value:n,type:"uncheck"};pubsub.getJQObj(e).icheckbox("checkByCompare",r)}},checkAll:function(e,t){pubsub.getJQObj(e).icheckbox("checkAll")},invert:function(e,t){pubsub.getJQObj(e).icheckbox("invert")}};pubsub.sub("icheckbox",icheckboxFunc);var icheckradioFunc={getSelection:function(e,t){return pubsub.getJQObj(e).icheckradio("getSelection")},getText:function(e,t){var a=pubsub.getJQObj(e,!0),n=[];if($.isArray(t)&&t.length>0&&t[0]&&t[0].currentTarget)n.push($(t[0].currentTarget).attr("text")||"");else{var r=a.icheckradio("getSelection");$.each(r,function(e,t){n.push(t.text)})}return n.join(",")},getValue:function(e,t){var a=pubsub.getJQObj(e,!0),n=[];if($.isArray(t)&&t.length>0&&t[0]&&t[0].currentTarget)n.push($(t[0].currentTarget).attr("value")||"");else{var r=a.icheckradio("getSelection");$.each(r,function(e,t){n.push(t.value)})}return n.join(",")},getData:function(e,t){var a=pubsub.getJQObj(e,!0),n=[];if($.isArray(t)&&t.length>0){var r=a.data("icheckradio").options.__dataArray,i=$(t[0].currentTarget).attr("row-index")||"";r.length>0&&n.push(r[i][e.columnName])}else{var o=a.icheckradio("getSelection");$.each(o,function(t,a){n.push(a.data[e.columnName])})}return n.join(",")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.icheckradio("setValue",n)}else a.icheckradio("setValue",t)},linkage:function(e,t){pubsub.getJQObj(e).icheckradio("linkage",t)},tdisabled:function(e,t){pubsub.getJQObj(e).icheckradio("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).icheckradio("disabled",!0)},disable:function(e,t){null!=t.index&&pubsub.getJQObj(e).icheckradio("disable",t.index)},enable:function(e,t){null!=t.index&&pubsub.getJQObj(e).icheckradio("enable",t.index)},check:function(e,t){null!=t.index&&pubsub.getJQObj(e).icheckradio("check",t.index)},uncheck:function(e,t){null!=t.index&&pubsub.getJQObj(e).icheckradio("uncheck",t.index)}};pubsub.sub("icheckradio",icheckradioFunc);var metrolistFunc={reload:function(e,t){return pubsub.getJQObj(e).metrolist("reload",t)},removeItem:function(e,t){return pubsub.getJQObj(e).metrolist("removeItem",t)},getDrapRow:function(e,t){return pubsub.getJQObj(e,!0).metrolist("getDrapRow")[e.columnName]}};pubsub.sub("metrolist",metrolistFunc);var officebtFunc={linkage:function(e,t){var a=pubsub.getJQObj(e);t&&t.DocId&&a.get(0)&&a.office("openByDocId",t.DocId)},setValue:function(e,t){var a=pubsub.getJQObj(e);t&&a.get(0)&&$.each(t,function(e,t){a.office("setValue",e,t)})},OfficeSave:function(e,t){var a=pubsub.getJQObj(e);a.get(0)&&a.office("save")},print:function(e,t){var a=pubsub.getJQObj(e);a.get(0)&&a.office("print")},linkModel:function(e,t){var a=pubsub.getJQObj(e);t&&t.DocId&&a.get(0)&&a.office("openModelByDocId",t.DocId)},ShowRevisions:function(e,t){var a=pubsub.getJQObj(e);t&&a.get(0)&&a.office("ShowRevisions",!!t.ShowRevisions)},MtProtect:function(e,t){var a=pubsub.getJQObj(e);if(t&&a.get(0)){if(void 0===t.Protect)return alert("加密参数不能为空!"),!1;if(void 0===t.PWD)return alert("密码不能为空!"),!1;1==t.Protect||"true"==t.Protect?a.office("Protect",t.PWD):a.office("Unprotect",t.PWD)}},MtShowDialog:function(e,t){var a=pubsub.getJQObj(e);t&&a.get(0)&&a.office("ShowDialog",t.TYPE||3)},saveAs:function(e,t){var a=pubsub.getJQObj(e);t&&a.get(0)&&a.office("saveAs",t.fileName)},AppendRowsByBookMarks:function(e,t){var a=pubsub.getJQObj(e);if(t&&a.get(0)){!(e instanceof Array)&&(e=[e]);var n={};$.each(e,function(e,t){n[t.param]=t.columnName});var r=null;for(var i in t)!r&&(r=t[i]);a.office("AppendRowsByBookMarks",n,r)}}};pubsub.sub("officebt",officebtFunc);var loginUserNameFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).find("input").val()}};pubsub.sub("loginusername",loginUserNameFunc);var loginPasswordFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).find("input").val()}};pubsub.sub("loginpassword",loginPasswordFunc);var loginVerificationFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).find("input").val()}};pubsub.sub("login_verify",loginVerificationFunc);var loginAlertFunc={setValue:function(e,t){for(var a=pubsub.getJQObj(e).find("span"),n="",r=0;r<e.length;r++)n=t[e[r].param]||"";a.html(n)}};pubsub.sub("loginalert",loginAlertFunc);var loginFormFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).attr("alert")}};pubsub.sub("loginform",loginFormFunc);var megaMenuFunc={thidden:function(e,t){pubsub.getJQObj(e).megaMenuExt("display",!1)},tshow:function(e,t){pubsub.getJQObj(e).megaMenuExt("display",!0)},getMenu:function(e,t){return t[0][e.columnName]},removeAllSelected:function(e,t){var a=pubsub.getJQObj(e),n=a.attr("selectcolor"),r=a.megaMenuExt("getSelectColor",n);a.data("select").removeClass(r),a.removeData("select")}};pubsub.sub("megamenu",megaMenuFunc);var metroselectFunc={reload:function(e,t){return pubsub.getJQObj(e).metroselect("reload",t)},getValue:function(e,t){return pubsub.getJQObj(e,!0).metroselect("getValue")},getData:function(e,t){var a=pubsub.getJQObj(e,!0).find("select").select2("data")[0].data;return a?a[e.columnName]||"":""},setValue:function(e,t){for(var a=pubsub.getJQObj(e),n="",r=0;r<e.length;r++)n=t[e[r].param]||"";a.metroselect("select",n)},getText:function(e,t){return pubsub.getJQObj(e,!0).metroselect("getText")},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()},tdisabled:function(e,t){var a=pubsub.getJQObj(e),n=pubsub.getJQObj(e).find("select");a.attr("enabled","false"),n.attr("disabled","disabled"),n.prop("disabled","disabled")},tenabled:function(e,t){var a=pubsub.getJQObj(e),n=a.find("select");a.attr("enabled","true"),n.removeAttr("disabled"),n.prop("disabled",!1)},clear:function(e,t){pubsub.getJQObj(e).metroselect("clear")},disable:function(e,t){t.index&&pubsub.getJQObj(e).metroselect("disable",t.index)},enable:function(e,t){t.index&&pubsub.getJQObj(e).metroselect("enable",t.index)},change:function(e,t){return pubsub.getJQObj(e).metroselect("change",t)},select:function(e,t){t.value&&pubsub.getJQObj(e).metroselect("select",t.value)},unselect:function(e,t){t.index&&pubsub.getJQObj(e).metroselect("uncheck",t.index)}};pubsub.sub("metroselect",metroselectFunc);var metroselectMFunc={reload:function(e,t){return pubsub.getJQObj(e).metroselect_m("reload",t)},getValue:function(e,t){return pubsub.getJQObj(e,!0).metroselect_m("getValue")},getData:function(e,t){for(var a,n=pubsub.getJQObj(e,!0).find("select").select2("data"),r=[],i=0;i<n.length;i++)a=n[i].data[e.columnName]||"",r.push(a);return r.join(",")},setValue:function(e,t){for(var a=pubsub.getJQObj(e),n="",r=0;r<e.length;r++)n=t[e[r].param]||"";n&&(n=n.split(",")),a.metroselect_m("select",n)},getText:function(e,t){return pubsub.getJQObj(e,!0).metroselect_m("getText")},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()},tdisabled:function(e,t){pubsub.getJQObj(e).find("select").attr("disabled","disabled")},tenabled:function(e,t){pubsub.getJQObj(e).find("select").removeAttr("disabled")},clear:function(e,t){pubsub.getJQObj(e).metroselect_m("clear")},disable:function(e,t){t.index&&pubsub.getJQObj(e).metroselect_m("disable",t.index)},enable:function(e,t){t.index&&pubsub.getJQObj(e).metroselect_m("enable",t.index)},change:function(e,t){return pubsub.getJQObj(e).metroselect_m("change",t)},select:function(e,t){t.value&&pubsub.getJQObj(e).metroselect_m("select",t.value)},unselect:function(e,t){t.index&&pubsub.getJQObj(e).metroselect_m("uncheck",t.index)},selectIndex:function(e,t){null!=t.index&&pubsub.getJQObj(e).metroselect_m("selectIndex",t.index)}};pubsub.sub("metroselectm",metroselectMFunc);var selectFunc={selectIndex:function(e,t){pubsub.getJQObj(e)},reload:function(e,t){var a=pubsub.getJQObj(e),n=a.data("select2").options.options,r=$.extend({},n.editor.params,{params:JSON.stringify(t)});return $.ajax({url:contextPath+n.editor.url.replace("contextPath",""),type:"POST",dataType:"JSON",contentType:"application/x-www-form-urlencoded",data:r,success:function(e){var t=[];e&&e.length&&$.each(e,function(e,a){a.id=a[n.editor.params.value],a.text=a[n.editor.params.text],t.push(a)});var r=a.select2("data")||[];a.empty(),a.select2($.extend({},n,{data:t})),r[0]||!n.editor.defaultIndex?a.val(r[0]?r[0].value:"").trigger("change"):t[n.editor.defaultIndex-1]&&a.val(t[n.editor.defaultIndex-1].id).trigger("change")},async:!0}),a},getValue:function(e,t){var a=pubsub.getJQObj(e,!0).val();if("object"==typeof a){var n="";return $.each(a,function(e,t){t&&(n&&(n+=","),n+=t)}),n}return a},getData:function(e,t){var a=pubsub.getJQObj(e,!0).find("select").select2("data")[0].data;return a?a[e.columnName]||"":""},setValue:function(e,t){for(var a=pubsub.getJQObj(e),n="",r=0;r<e.length;r++)n=t[e[r].param]||"";a.val(n).trigger("change")},getText:function(e,t){return pubsub.getJQObj(e,!0).metroselect("getText")},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()},tdisabled:function(e,t){pubsub.getJQObj(e).find("select").attr("disabled","disabled")},tenabled:function(e,t){pubsub.getJQObj(e).find("select").removeAttr("disabled")},clear:function(e,t){pubsub.getJQObj(e).val("").trigger("change")},disable:function(e,t){t.index&&pubsub.getJQObj(e).metroselect("disable",t.index)},enable:function(e,t){t.index&&pubsub.getJQObj(e).metroselect("enable",t.index)},change:function(e,t){return pubsub.getJQObj(e).metroselect("change",t)},select:function(e,t){t.value&&pubsub.getJQObj(e).metroselect("select",t.value)},unselect:function(e,t){t.index&&pubsub.getJQObj(e).metroselect("uncheck",t.index)}};pubsub.sub("select",selectFunc),pubsub.sub("select2",selectFunc),MtButton.prototype.dialogInst=function(e){this.dialogRel=e},MtButton.prototype.init=function(){this.viewModel.data=new Object,this.viewModel.handlecolumns&&(this.viewModel.data.tableMsg=eval("("+this.viewModel.handlecolumns+")")),this.viewModel.ruleData&&(this.viewModel.data.rule=eval("("+this.viewModel.ruleData+")")),this.viewModel.data.pageParameters=pageParameters,this.viewModel.functions=this},MtButton.prototype.save=function(e,t){function a(e,n,r){var i={id:e.idValue};$.each(e.columns,function(t,o){o.delete&&o.id?r.push(o):e.batch?a(o,n):i[o.fieldName]=o.value}),$.extend(i,t),e.batch||n.push(i)}function n(e,t,a){var n=a[t.table.tableName];if(!n&&d&&d.length){var r=d[0];t.table.id==r.id&&a[r.id]&&(n={idValue:a[r.id]})}if(n){t.idValue=n.idValue||n,!$("input."+t.table.tableName)[0]&&$("<input>",{class:t.table.tableName,type:"hidden",fieldname:"id",value:t.idValue}).appendTo("body");var i=$("."+mtxx.params.id);i.get(0)||(i=$("<input>",{class:mtxx.params.id,type:"hidden"}).appendTo("body")),i.attr({idValue:t.idValue})}if(t.cell&&window.batch&&window.batch.refresh(),t.batch&&a.batchIds){var o,s;$.each(a.batchIds,function(e,t){(o=$("._"+e)).get(0)&&!(s=o.data("row"))&&o.data("row",{id:t})})}}function r(a){window.savecount++,a&&a.message&&!a.rst?(alert(a.message),mtDebugger.pushQueue("error","页面保存失败！错误信息为:"),mtDebugger.pushQueue("error",a.message)):(mtDebugger.pushQueue("info","页面保存成功！其保存结果为:"),mtDebugger.pushQueue("info",a),e||t.isAlt||alert("操作成功!"),$.each(s.tableMsg,function(e,t){n(e,t,a)}),e&&$.isFunction(e)&&e.call(window,a))}t=t||{};var i=this,o=new Array;new Object;if(!window.getFormValiate())return!1;var s=i.viewModel.data;if(!s.tableMsg)return alert("未保存设置!"),!1;var l=null;if(jQuery.each(i.viewModel.data.tableMsg,function(e,t){var a={dataSetId:t.dataSetId,idValue:t.idValue,table:t.table,columns:new Array,batch:t.batch,wdataSet:t.wdataSet},n={};t.columns&&$.each(t.columns,function(e,t){var r=jQuery("#"+t.id),i=r.data("params")||{};i.idValue&&!a.idValue&&(a.idValue=i.idValue);try{t.value=r.mtbootstrap("getValue",t.fieldName)}catch(e){t.value=r.val()||""}a.columns.push(t),n[t.fieldName]=t});var r=$("."+a.table.tableName);if(r.length&&r.each(function(e,t){var r=$(t),i=r.attr("fieldName");i&&i in n?n[i].value=n[i].value:i&&a.columns.push({fieldName:i,value:r.val()})}),a.columns.length>0)if(t.batch||t.cell){if(window.batch)if(a.wdataSet&&a.wdataSet.id){if(!l){var i=[];l={},window.batch.getValue(i),i.length>0&&$.each(i,function(e,t){var a=t.table;a&&(!l[a.tableName]&&(l[a.tableName]=[]),l[a.tableName].push(t))})}a.columns=l[a.table.tableName]||[],o.push(a)}else window.batch.getValue(o)}else o.push(a)}),o.length>0){var u=!0;if(window.saveFileToUrl&&(u=saveFileToUrl(!0)),u){var c=o[0],d=[];if(c&&c.wdataSet&&c.wdataSet.id){var p,b=[],f={},g={};return $.each(o,function(e,t){(p=t.table.children)&&p.length&&$.each(p,function(e,a){g[a]=t.table.id})}),$.each(o,function(e,t){var n={id:t.wdataSet.id,table:t.table,datas:[],dels:[]};t.table.children=[],g[t.table.tableName]&&!t.table.topId&&(t.table.topId=g[t.table.tableName]),!f[t.table.id]&&(f[t.table.id]=t.table)&&d.push($.extend(!0,{},t.table)),a(t,n.datas,n.dels),b.push(n)}),d=d.length>1?$.transformToTreeFormat(d,"tableName","topTableName","children"):null,$.ajax({url:contextPath+"/mx/form/data/saveFormData",type:"POST",data:{relation:d?JSON.stringify(d):d,tableMsg:JSON.stringify(b)},error:function(){window.savecount++},dataType:"JSON",success:r}),!1}jQuery.ajax({url:contextPath+"/mx/form/data/saveOrUpdateDetail",type:"post",data:{tableMsg:JSON.stringify(o)},async:!0,dataType:"json",error:function(){window.savecount++},success:function(e){if(window.savecount++,e&&e.message)alert(e.message);else{r(e);var t=getOpenDialogToggle(window);if(t){var a=i.bootstrapData(parent.$(t.viewModel.change));a&&a.bootstrap&&a.bootstrap.load()}"true"==i.viewModel.data.rule.closeWindow&&i.closeWindow()}}})}}},MtButton.prototype.closeWindow=function(){var e=this;e.viewModel.data.pageParameters?MtButtonClose(window,e)||window.close():window.close()},MtButton.prototype.search=function(){jQuery(this.viewModel.change);var e=this.viewModel.data.rule.paraType;if(e&&e[0]){var t=e[0].datas;t&&pubsub.pub("linkageControl",t)}},MtButton.prototype.delete=function(){var e=this,t=e.deleteFuncs;jQuery.each(e.viewModel.data.tableMsg,function(a,n){var r=jQuery("#"+n.id),i=e.bootstrapData(r).dataRole;t[i]&&t[i].call(e,r)})},MtButton.prototype.deleteFuncs={gridbt:function(e){var t=this,a=t.bootstrapData(e).bootstrap,n=a.getSelectedRows();if(n&&n.length>0){if("false"==t.viewModel.multiPlay&&n.length>1)return alert("请选择一条记录!"),!1;var r=n;a.ajaxDestroy(r,function(){a.load()})}else 0==n.length&&alert("请选择!")}},MtButton.prototype.submit=function(){var e=this,t=e.viewModel.data,a={isDefined:function(){return!0},isUndefined:function(){alert("流程未定义!")}};if(t&&t.rule){var n=$("[fieldname=id]:hidden").val(),r=mtxx.params.flow,i=$(".pageruleid").val(),o={multiple:t.rule["multiple-flow"],rid:e.viewModel.prid,id:n,pageRuleId:i,pageId:t.rule.pageId};if(objectISNotEmpty(r))if(n){var s=contextPath+"/mx/form/defined/ex/flowFeedback?"+$.param({fn:"processGetData",pageId:t.rule.pageId});jQuery.mt.window({id:i,title:"流程审批",width:"750px",height:"350px",refresh:!0,modal:!0,content:{url:s,iframe:!0},appendTo:"body"}).kendo.center()}else alert("该流程未启动");else if(objectISNotEmpty(r)||o.multiple){var l=t.rule.paraType;if(l){var u=getParaType(l);if(u){if(!u.isReady)return alert("流程参数不能为空!"),!1;o.flowParams=JSON.stringify(u)}}var c=null;if(r||$.ajax({url:contextPath+"/mx/form/workflow/defined/getMultipleVariables",async:!1,data:o,type:"POST",dataType:"JSON",success:function(e){e&&e[0]&&($.each(e,function(e,t){var a=JSON.parse(t);(a=a[0])&&a.targets&&$.each(a.targets,function(e,t){addVariables(t.eleId,t.taskId)})}),c=processGetData()||{},$.extend(o,c)),mtxx.params.flow=null}}),confirm("你确定提交流程吗?")){if(c&&!c.id)return alert("请先保存!"),!1;$.post(contextPath+"/mx/form/workflow/defined/processSubmit",o,function(e){alert("流程提交成功! 流程实例ID为："+e.processInstanceId)},"JSON")}}else a.isUndefined()}else a.isUndefined()},MtButton.prototype.newWindow=function(e){var t=this,a=(t.viewModel.id,t.viewModel.data.rule),n=t.viewModel.maximize,r=a.jumpType,i={childPage:{open:function(){t.newWinFuncs.init(t,function(e,r){var i=a.width||650,o=a.height||450;n&&(i=$(document).width()-24,o=$(document).height()-81);var s=BootstrapDialog.show({draggable:!0,message:function(e){var t=e.getData("pageToLoad");return"<iframe onload=\"$(this).contents().find('body').css('overflow-y', 'auto');\" width='100%' height='"+o+"' src='"+t+"' frameborder='no' scrolling='yes'></iframe>"},data:{pageToLoad:e+"?"+jQuery.param(r)},css:{width:i+"px",height:o+"px"}});n&&(s.$modal.css({display:"table",padding:"0px 10px"}),s.$modalDialog.css({margin:"0px 10px"})),t.dialogInst(s)})},close:function(e){}},singlePage:{open:function(){t.newWinFuncs.init(t,function(e,t){window.open(e+"?"+jQuery.param(t))})},close:function(e){e.close()}}};return e||i[r]&&i[r].open(),i[r]},MtButton.prototype.newWinFuncs={init:function(e,t){var a=e.viewModel.data.rule.paraType,n=contextPath+"/mx/form/page/viewPage",r=!1,i=null,o={newWin:e.viewModel.buttonType,id:e.viewModel.pageId,prid:e.viewModel.prid,btnId:e.viewModel.id};if(a&&a[0]){var s=a[0].datas;if(s){for(var l in s)if(l.indexOf("/mx/")>-1){n=contextPath+l;break}i=pubsub.getParameters(s)}}null!=i&&(r=!0,t&&t(n,$.extend(i,o))),r||t&&t.call({},n,o)},grid:function(e,t){var a=e.bootstrapData(t).bootstrap,n=a.select();if(!(n&&n.length>0))return alert("请选择!"),!1;if("false"==e.viewModel.multiPlay&&n.length>1)return alert("请选择一条记录!"),!1;if(e.viewModel.pageId){var r=new Array,i=t.data("idRelation"),o={};return jQuery.each(n,function(e,t){i?$.each(i,function(e,n){n.items.push(a.dataItem(t)[n.columnName])}):r.push(a.dataItem(t).id)}),i&&$.each(i,function(e,t){o[e]=t.items.join("_0_")}),o.newWin=e.viewModel.buttonType,o.id=e.viewModel.pageId,o.prid=e.viewModel.prid,o.btnId=e.viewModel.id,o}}};var roleList={gridbt:"grid"};MtButton.prototype.bootstrapData=function(e){return getBootstrapData(e)};var mtbuttonFunc={binding:function(e,t,a){pubsub.getJQObj(e);var n=e.outid;n||(n=e[0].outid);var r=e.trigger.eleId,i=$("#"+r).clone(),o=a[0].promptmessage,s=a[0].titile;s||(s=t.title),i.attr("id",""),s?$("#"+n).tooltip({title:s,placement:o,html:!0,template:i}):(i.find(".tooltip-inner").remove(),$("#"+n).tooltip({title:"z",placement:o,html:!0,template:i}))},setValue:function(e,t){var a=pubsub.getJQObj(e);$.each(t,function(e,t){a.find("span.frame-variable")[0].innerHTML=t})},copyMtButon:function(e,t){var a=pubsub.getJQObj(e),n=a.parent().parent(),r=a.parent().parent().parent();$.each(t,function(e,t){if(-1!=t.toString().indexOf(","))for(var a=t.toString().split(","),i=0;i<a.length;i++)n.before(n[0].outerHTML),$(r.find("div.row")[i]).find("button").css("display","block"),$(r.find("div.row")[i]).find("span")[0].innerHTML=a[i];else n.before(n[0].outerHTML),$(r.find("div")[0]).find("button").css("display","block"),r.find("div").find("span")[0].innerHTML=t})},bindpopover:function(e,t,a){pubsub.getJQObj(e);var n=e.outid;n||(n=e[0].outid);var r=e.trigger.eleId,i=$("#"+r),o=a[0].promptmessage,s=a[0].titile;s||(s=t.title);var l=a[0].content;l||(content=t.content),i.attr("id",""),!s&&i.find(".popover-title").remove(),!l&&i.find(".popover-content").remove(),$("#"+n).popover({title:s||"x",content:l||"x",placement:o,html:!0,template:i})}};pubsub.sub("mtbutton",mtbuttonFunc);var progressbarFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).progressBarExt("getValue")},setValue:function(e,t){var a,n=pubsub.getJQObj(e),r={};if(t.value&&(r.value=t.value,r.length=1),t.value_uint&&(r.value_uint=t.value_uint,r.length=1),t.remain&&(r.remain=t.remain,r.length=1),t.remain_uint&&(r.remain_uint=t.remain_uint,r.length=1),r.length>0)n.progressBarExt("setValue",r);else{for(var i=0;i<e.length;i++)a=t[e[i].param]||"";a&&n.progressBarExt("setValue",a)}},tdisabled:function(e,t){pubsub.getJQObj(e).progressBarExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).progressBarExt("disabled",!0)}};pubsub.sub("progressbarbt",progressbarFunc);var textAreaBtFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).textAreaBtExt("getValue")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if(a.attr("setValue","setValue"),"object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.textAreaBtExt("setValue",pubsub.htmlUnescape(n))}else a.textAreaBtExt("setValue",pubsub.htmlUnescape(t))},thidden:function(e,t){pubsub.getJQObj(e).textAreaBtExt("display",!1)},tshow:function(e,t){pubsub.getJQObj(e).textAreaBtExt("display",!0)},tclear:function(e,t){pubsub.getJQObj(e).textAreaBtExt("getOject").attr("tclear","tclear").val("")},tdisabled:function(e,t){pubsub.getJQObj(e).textAreaBtExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).textAreaBtExt("disabled",!0)},appendSetValue:function(e,t){var a=pubsub.getJQObj(e),n="",r=a.textAreaBtExt("getOject"),i=r.val()?r.val()+",":"";if(a.attr("setValue","setValue"),"object"==typeof t){for(var o=0;o<e.length;o++)n=t[e[o].param]||"";a.textAreaBtExt("setValue",pubsub.htmlUnescape(i+n))}else a.textAreaBtExt("setValue",pubsub.htmlUnescape(i+t))}};pubsub.sub("textareabt",textAreaBtFunc);var textboxbtFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).textboxBtExt("getValue")},setValue:function(e,t){var a,n=pubsub.getJQObj(e),r="";if("object"==typeof t){if($.isArray(t))$.eahc(t,function(e,t){r&&(r+=","),r+=t||""});else for(var i=0;i<e.length;i++){var o=t[(a=e[i]).param];$.isArray(o)?$.each(o,function(e,t){r&&(r+=","),r+=t[a.columnName]||""}):r=o||""}n.textboxBtExt("setValue",pubsub.htmlUnescape(r))}else n.textboxBtExt("setValue",pubsub.htmlUnescape(t))},thidden:function(e,t){pubsub.getJQObj(e).textboxBtExt("display",!1)},tshow:function(e,t){pubsub.getJQObj(e).textboxBtExt("display",!0)},tclear:function(e,t){pubsub.getJQObj(e).textboxBtExt("getOject").attr("tclear","tclear").val("")},tdisabled:function(e,t){pubsub.getJQObj(e).textboxBtExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).textboxBtExt("disabled",!0)},appendSetValue:function(e,t){var a=pubsub.getJQObj(e),n="",r=a.textboxBtExt("getOject"),i=r.val()?r.val():"";if("object"==typeof t){for(var o=0;o<e.length;o++)(n=t[e[o].param]||"")&&(i&&(i+=","),i+=n);a.textboxBtExt("setValue",i)}else a.textboxBtExt("setValue",i+t)}};pubsub.sub("textboxbt",textboxbtFunc);var touchSpinFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).touchSpinExt("getValue")},getSumValue:function(e,t){var a=pubsub.getJQObj(e,!0),n=a.closest("table").find("[columnname="+a.attr("columnname")+"]"),r=0;return $.each(n,function(e,t){r=mtMath.add(r,parseFloat($(this).touchSpinExt("getValue")||0))}),r},setValue:function(e,t){var a,n=pubsub.getJQObj(e),r="";if("object"==typeof t){for(var i=0;i<e.length;i++)r=null!=t[(a=e[i]).param]?t[a.param]:"";n.touchSpinExt("setValue",r)}else n.touchSpinExt("setValue",t)},tclear:function(e,t){pubsub.getJQObj(e).textboxBtExt("getOject").attr("tclear","tclear").val("")},tdisabled:function(e,t){pubsub.getJQObj(e).touchSpinExt("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).touchSpinExt("disabled",!0)}};pubsub.sub("touchspin",touchSpinFunc);var ztreeFunc={getRow:function(e,t){var a=pubsub.getJQObj(e,!0);a||(a=pubsub.getJQObj(e.inid,!0));var n=a.zTree.getZTreeObj(a.attr("id")).getSelectedNodes(),r="";if(n.length)for(var i=0,o=n.length;i<o;i++)r+=n[i][e.columnName]||"",r+=i==o-1?"":",";return r},setExpandLevel:function(e,t){var a=pubsub.getJQObj(e),n="";$.each(e,function(a,r){n=t[e[a].param]||""}),a.data("expandChilds",n||0)},getChkRow:function(e,t){var a=pubsub.getJQObj(e,!0);a||(a=pubsub.getJQObj(e.inid,!0));var n=a.zTree.getZTreeObj(a.attr("id")).getCheckedNodes(),r="";if(n.length)for(var i=0,o=n.length;i<o;i++)r+=n[i][e.columnName]||"",r+=i==o-1?"":",";return r},getCurRow:function(e,t){if(t&&t.length>1)return t[1][e.columnName];var a=pubsub.getJQObj(e,!0);a||(a=pubsub.getJQObj(e.inid,!0));var n=a.zTree.getZTreeObj(a.attr("id")).getCheckedNodes(),r="";if(n.length){for(var i=0,o=n.length;i<o;i++)r+=n[i][e.columnName]||"",r+=i==o-1?"":",";return r}return""},linkage:function(e,t){ztreeFunc.linkageControl(e,t)},linkageControl:function(e,t){var a=pubsub.getJQObj(e),n=a.data("requireNum")||0;if(a&&!n){var r=a.zTree.getZTreeObj(a.attr("id")),i=r.setting.async.otherParam;if(i.params=JSON.stringify(t),r.setting.async.otherParam=i,null!=t.expandLevel)a.data("expandChilds",t.expandLevel||0);else{var o=a.data("expandChilds");a.data("expandChilds",o||r.setting.expandChilds||0)}r.reAsyncChildNodes(null,"refresh")}},_buildRetAry:function(e,t,a){for(var n,r=e.length,i=0;i<r;i++)(n=e[i])[a.columnName]&&t.push(n[a.columnName]),n.children&&ztreeFunc._buildRetAry(n.children,t,a)},getAll:function(e,t){var a=pubsub.getJQObj(e,!0);if(a){var n=a.zTree.getZTreeObj(a.attr("id")).getNodes(),r=[];return n&&ztreeFunc._buildRetAry(n,r,e),r.join(",")}},thidden:function(e,t){pubsub.getJQObj(e).closest("div").hide()},tshow:function(e,t){pubsub.getJQObj(e).closest("div").show()},showChilds:function(e,t){var a=pubsub.getJQObj(e,!0);if(a){var n=$.fn.zTree.getZTreeObj(a.attr("id")),r=n.getCheckedNodes(!0);$.each(r,function(e,t){n.expandNode(t,!0,!0,!0)})}},nodeRefresh:function(e,t){var a=pubsub.getJQObj(e);if(a){var n=$.fn.zTree.getZTreeObj(a.attr("id")),r=n.getSelectedNodes();r.length>0&&n.reAsyncChildNodes(r[0],"refresh")}},parentRefresh:function(e,t){var a=pubsub.getJQObj(e);if(a){var n=$.fn.zTree.getZTreeObj(a.attr("id")),r=n.getSelectedNodes();if(r.length>0){var i=r[0].getParentNode();n.reAsyncChildNodes(i,"refresh")}}},tSelectFirst:function(e,t){var a=pubsub.getJQObj(e);if(a){var n=a.zTree.getZTreeObj(a.attr("id")),r=n.getNodes();if(r&&r.length>0){var i=r[0];n.selectNode(i),n.setting.callback.onClick(null,a.attr("id"),i)}var o=new MutationObserver(function(e){if((r=n.getNodes())&&r.length>0){var t=r[0];n.selectNode(t),n.setting.callback.onClick(null,a.attr("id"),t)}o.disconnect()});o.observe(a[0],{childList:!0,arrtibutes:!0,subtree:!0,characterData:!0})}},cancelSelectNodes:function(e,t){var a=pubsub.getJQObj(e);if(a){var n=a.zTree.getZTreeObj(a.attr("id"));n.cancelSelectedNode(),n.checkAllNodes(!1)}},_init_:function(rule,param,args){var $id=pubsub.getJQObj(rule);eval("("+__gobalInit__[$id.attr("id")]+")")($.isArray(param)?{}:param),pubsub.execChilds(rule)},isChecked:function(e,t){if(t[1])return t[1].checked;var a=pubsub.getJQObj(e,!0),n=a.zTree.getZTreeObj(a.attr("id"));return selectNodes=n.getSelectedNodes(),!!selectNodes.length&&selectNodes[0].checked},checkedNode:function(e,t){var a=pubsub.getJQObj(e);if(a){var n=t.key,r=a.zTree.getZTreeObj(a.attr("id"));$.each(t,function(e,t){if("key"==e)return!0;var a=t.split(",");$.each(a,function(t,a){var i=r.getNodesByParam(n||e,a,null);$.each(i,function(e,t){r.checkNode(t,!0,!1)})})})}},selectNode:function(e,t){var a=pubsub.getJQObj(e);if(a){var n=a.zTree.getZTreeObj(a.attr("id")),r=t.key;$.each(t,function(e,t){if("key"==e)return!0;var i=t.split(",");e=r||e,$.each(i,function(t,r){var i=n.getNodesByParam(e,r,null);$.each(i,function(e,t){n.selectNode(t),n.setting.callback.onClick(null,a.attr("id"),t)})})})}},getKeyName:function(e,t){return e.columnName},insertStaticRow:function(e,t){var a=pubsub.getJQObj(e);if(a||a[0]){var n=a.data("inparamobjrule"),r=n.arySource;if($.isArray(r)){var i=r;r={},$.each(i,function(e,t){var a=t.child,n="";a&&a[0]&&(n=a[0].param),r[t.param]=n}),n.arySource=r}var o=n.objSource;if($.isArray(o)){var s=o;o={},$.each(s,function(e,t){var a=JSON.parse(t.child),n={};$.each(a,function(e,t){n[t.param]=t.columnFiled}),o[t.param]=n}),n.objSource=o}if(o){var l=[],u=null;if($.each(t,function(e,t){if($.isPlainObject(t)&&!$.isEmptyObject(t)){u={};a=o[e];$.each(t,function(e,t){a[e]&&(u[a[e]]=t)}),l.push(u)}else if($.isArray(t)){if(!r[e])return!0;var a=o[r[e]];$.each(t,function(e,t){u={},$.each(t,function(e,t){a[e]&&(u[a[e]]=t)}),l.push(u)})}}),l&&l.length>0)a.zTree.getZTreeObj(a.attr("id"))}}}};void 0!==pubsub&&pubsub.sub("ztree",ztreeFunc);var glafZtree={beforeDrop:function(e,t,a,n,r,i){if("null"==n)return!1;for(var o=[],s=0;s<t.length;s++){var l=t[s];o.push(l.id)}var u="treeNodeIds="+o.join(",")+"&targetNodeId="+(a?a.id:"")+"&moveType="+n+"&rid="+i+"&isCopy="+r,c=!0;return $.ajax({type:"POST",url:contextPath+"/mx/form/treeData/drop",data:u,async:!1,success:function(e){},error:function(){alert("操作失败"),c=!1}}),c},beforeRemove:function(e,t,a){if(t.children&&t.children.length>0)return alert("有子节点不能删除"),!1;if(confirm("确认删除 节点<"+t.name+">吗？")){var n="treeNodeIds="+t.id+"&rid="+a,r=!0;return $.ajax({type:"POST",url:contextPath+"/mx/form/treeData/remove",data:n,async:!1,success:function(e){},error:function(){alert("操作失败"),r=!1}}),r}return!1},beforeRename:function(e,t,a,n,r){if(n)return!0;var i="treeNodeId="+t.id+"&newName="+a+"&rid="+r,o=!0;return $.ajax({type:"POST",url:contextPath+"/mx/form/treeData/rename",data:i,async:!1,success:function(e){},error:function(){alert("操作失败"),o=!1}}),o},ztreeToolbar:function(e,t,a,n){var r,i=$.fn.zTree.getZTreeObj(t);r=i.setting.check.enable?i.getCheckedNodes(!0):i.getSelectedNodes();var o;switch(e){case"add":if(r.length>1)return void alert("请选择一个节点");var s="",l="";1==r.length&&(s=r[0].pidkey,l=r[0].idkey),o=contextPath+"/mx/form/treeData/ztreeEdit?rid="+a+"&pid="+s+"&treeId="+t+"&epac="+n+"&treeIdValue="+l;break;case"next":if(!r||r.length<=0)return void alert("请选择节点");if(1!=r.length)return void alert("请选择一个节点");o=contextPath+"/mx/form/treeData/ztreeEdit?rid="+a+"&pid="+r[0].indexkey+"&treeId="+t+"&epac="+n;break;case"edit":if(!r||r.length<=0)return void alert("请选择节点");if(1!=r.length)return void alert("请选择一个节点");o=contextPath+"/mx/form/treeData/ztreeEdit?rid="+a+"&id="+r[0].id+"&treeId="+t+"&epac="+n;break;case"del":if(!r||r.length<=0)return void alert("请选择节点");if(!confirm("确认删除 节点 吗？"))return;for(var u=[],c=0;c<r.length;c++){var d=r[c];u.push(d.id)}var p="treeNodeIds="+u.join(",")+"&rid="+a;return void $.ajax({type:"POST",url:contextPath+"/mx/form/treeData/remove",data:p,async:!1,success:function(e){i.reAsyncChildNodes(null,"refresh")},error:function(){alert("操作失败")}});default:alert("操作失败")}if(o){var b="<iframe width='100%' height='280' src='"+o+"' frameborder='no' scrolling='no'></iframe>";window.ztreeOpenShow=window.show({title:"增加/编辑节点",size:BootstrapDialog.SIZE_WIDE,message:b,modal:!0,draggable:!0,css:{width:400,height:300}})}},init:function(e,t,a){var n=null,r=$("#"+e),i=r.data("_bindEvent_");r.data("expandChilds",t.expandChilds||1);var o=t.check.chkboxType;"2"==t.check.chkboxType&&(o={Y:"s",N:"s"}),"1"==t.check.chkboxType&&(o={Y:"p",N:"p"}),"0"==t.check.chkboxType&&(o={Y:"",N:""}),"3"==t.check.chkboxType&&(o={Y:"ps",N:"ps"}),t.check.chkboxType=o,"radio"==t.check.chkStyle&&(t.check.radioType="all"),(isMobile()||"awesome"==r.attr("zTreeStyle"))&&(t.callback.beforeClick=function(e,t,a){return t.chkDisabled||n.checkNode(t,!t.checked,!0),!0},glafZtree.trunToMobileStyle(t)),n=a?$.fn.zTree.init(r,t,a):$.fn.zTree.init(r,t),r.data("kkk",n),i&&$.each(i,function(e,t){pubsubobjects.ztree.call(r,t)}),t&&($("#ztree_"+e+"_add").addClass("btn btn-primary hmtd-xs").on("click",function(){a?n.addNodes(null,[{name:"newNode1"}]):glafZtree.ztreeToolbar("add",e,t.opts.ruleId,t.opts.editPanleAutoClose)}),$("#ztree_"+e+"_add_next").addClass("btn btn-primary hmtd-xs").on("click",function(){if(a){var r=n.getSelectedNodes();r&&n.addNodes(r[0],[{name:"newNode1"}])}else glafZtree.ztreeToolbar("next",e,t.opts.ruleId,t.opts.editPanleAutoClose)}),$("#ztree_"+e+"_edit").addClass("btn btn-primary hmtd-xs").on("click",function(){a||glafZtree.ztreeToolbar("edit",e,t.opts.ruleId,t.opts.editPanleAutoClose)}),$("#ztree_"+e+"_del").addClass("btn btn-primary hmtd-xs").on("click",function(){a||glafZtree.ztreeToolbar("del",e,t.opts.ruleId,t.opts.editPanleAutoClose)}))},trunToMobileStyle:function(e){$("[href='"+contextPath+"/scripts/ztree/css/awesomeStyle/awesome.css']")[0]||($("body").append('<link rel="stylesheet" href="'+contextPath+'/scripts/ztree/css/awesomeStyle/awesome.css">'),$("body").append('<link rel="stylesheet" href="'+contextPath+'/scripts/ztree/css/zTreeStyle/font-awesome.min.css">'),$("body").append('<link rel="stylesheet" href="'+contextPath+'/scripts/ztree/css/awesomeStyle/ztree.extend.css">'),$("[href='"+contextPath+"/scripts/ztree/css/zTreeStyle/zTreeStyle.css']").remove())},convert:function(dataItem,rule){if(rule.icon&&rule.icon.length)for(var icons=rule.icon,i=0;i<icons.length;i++){var icon=icons[i];icon.expression&&eval("("+icon.expression.replace(/\\\"/g,'"')+")")&&(dataItem[icon.type]=contextPath+icon.icon)}if(rule.check&&rule.check.length)for(var checks=rule.check,i=0;i<checks.length;i++){var check=checks[i];check.expression&&eval("("+check.expression.replace(/\\\"/g,'"')+")")&&(check.type&&"disabled"==check.type?dataItem.chkDisabled=!0:dataItem.checked=!0)}if(rule.text&&rule.text.length)for(var texts=rule.text,i=0;i<texts.length;i++){var text=texts[i];text.expression&&eval("("+text.expression.replace(/\\\"/g,'"')+")")&&(dataItem.name=new Function('var dataItem = arguments[0];return "'+text.htmlVal.replace(/##/g,'"')+'";')(dataItem))}}},nestableFunc={getNowNest:function(e,t){var a=pubsub.getJQObj(e,!0);a||(a=pubsub.getJQObj(e.inid,!0));var n="",r=a.data("nestable").getNestData();if(r.length)for(var i=0,o=r.length;i<o;i++)n+=r[i][e.columnName]||"",n+=i==o-1?"":",";return n},refresh:function(e,t){pubsub.getJQObj(e).data("nestable").refresh()},insertStaticNestData:function(e,t,a){var n=pubsub.getJQObj(e),r=n.data("inparamobjrule");if(n||n[0]){var i=r.arySource;if($.isArray(i)){var o=i;i={},$.each(o,function(e,t){var a=t.child,n="";a&&a[0]&&(n=a[0].param),i[t.param]=n}),r.arySource=i}var s=r.objSource;if($.isArray(s)){var l=s;s={},$.each(l,function(e,t){var a=JSON.parse(t.child),n={};$.each(a,function(e,t){n[t.param]=t.columnFiled}),s[t.param]=n}),r.objSource=s}if(s){var u=[],c=null;$.each(t,function(e,t){if($.isPlainObject(t)&&!$.isEmptyObject(t)){c={};a=s[e];$.each(t,function(e,t){a[e]&&(c[a[e]]=t)}),u.push(c)}else if($.isArray(t)){if(!i[e])return!0;var a=s[i[e]];$.each(t,function(e,t){c={},$.each(t,function(e,t){a[e]&&(c[a[e]]=t)}),u.push(c)})}}),u&&u.length>0&&n.nestable("saveStaticData",u)}}}};pubsub.sub("nestable",nestableFunc);var ratylimasterFunc={getValue:function(e,t){var a=pubsub.getJQObj(e,!0).data("ratylimaster").el;return $(a).find(".ratymode").attr("data-rate")},setValue:function(id,args){var $id=pubsub.getJQObj(id[0].outid,!0),build=$id.data("ratylimaster"),emp="☆",full="★",el=build.el;switch(build.option.state){case"xingxing":emp="☆",full="★";break;case"radius":emp="O",full="X";break;case"agree":emp='<i class="fa fa-thumbs-o-up"></i>',full='<i class="fa fa-thumbs-up"></i>';break;case"people":full="<i class='fa fa-male' aria-hidden='true'></i>",emp="<i class='fa fa-male' aria-hidden='true'></i>";break;default:emp="☆",full="★"}var rule=el.find(".ratymode").attr("rule");void 0!=rule&&(void 0!=(rule=eval("("+rule+")")).icon&&(full="<i class='"+rule.icon+"'></i>",emp="<i class='"+rule.icon+"'></i>"),void 0!=rule.iconsize&&el.find(".ratymode").css("font-size",rule.iconsize)),$.each(args,function(e,t){t=void 0!=t&&null!=t?t:0,$(el).find(".ratymode").attr("data-rate",t),$(el).find(".ratymode").empty();for(var a=0;a<$(el).find(".ratymode").attr("data-ratemax");a++){var n='<span class="rate rate-full" style="cursor:default;" style="color:#fe5845">'+full+"</span>";a>Math.round(parseFloat(t))-1&&(n='<span class="rate rate-empty" style="cursor:default;" >'+emp+"</span>"),$(el).find(".ratymode").append(n);var r=$(el).find(".ratymode").attr("empty-color"),i=$(el).find(".ratymode").attr("full-color");void 0!=r&&$(el).find("span.rate-empty").css("color",r),void 0!=i&&$(el).find("span.rate-full").css("color",i)}})},stopClick:function(e,t){var a=pubsub.getJQObj(e.outid,!0).data("ratylimaster").el;$(a).find(".ratymode").unbind()}};pubsub.sub("ratylimaster",ratylimasterFunc);var echartsFunc={getMapJsonData:function(e,t){var a=pubsub.getJQObj(e).data("echarts"),n=echarts.init(a.target);$.getJSON(contextPath+"/scripts/plugins/bootstrap/echarts/json/beijing.json",function(e){echarts.registerMap("beijing",e),n.setOption({series:[{type:"map",map:"beijing"}]})})},refresh:function(e,t){pubsub.getJQObj(e).data("echarts")._init()},linkageControl:function(e,t,a){var n=pubsub.getJQObj(e).data("echarts");n.options._querydata=JSON.stringify(t),n._init()}};pubsub.sub("echarts",echartsFunc);var diagrambtFunc={init:function(e,t){var a=t[0];diagrambtFunc.initOptions=$.extend(!0,{},a),$.ajax({type:"POST",url:contextPath+"/mx/form/diagrambt/data",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{rid:a.rid,params:a.parameters},success:function(t){a.DDepth&&(a.depth=a.DDepth),a.CContent&&(a.nodeContent="title"),a.data=t;var n=[];n.push(a.data),diagrambtFunc.buildTitle(n);var r=$("#"+e.inid);r.empty(),r.removeData(),r.orgchart(a),a.viewState&&r.find(".orgchart").addClass("view-state")}})},buildTitle:function(e){$.each(e,function(e,t){var a=diagrambtFunc._buildTemplateContent(t);a&&(t.title=a),diagrambtFunc.buildTitle(t.children)})},_buildTemplateContent:function(data){var options=diagrambtFunc.initOptions,that=diagrambtFunc;that.options=options;var templateStr=that.options.template,customdefinedArray=that.options.customdefined;return customdefinedArray&&customdefinedArray.length>0?(customdefined=customdefinedArray[0],customdefined.value?$.each(customdefined.value,function(i,item){var expdata=JSON.parse(item.expdata),expression=expdata.expActVal,reg1=/#:[^#]+#/g,varVal=expdata.varVal;$.each(varVal,function(e,t){expression=expression.replace(t.value.code,"#:"+t.value.columnName+"#")});var columns=expression.match(reg1);if($.each(columns,function(e,t){var a=t.substring(2,t.length-1);data[a]||(a=a.toLowerCase()),expression=expression.replace(t,data[a]||"")}),eval(expression))return templateStr=item.htmlExpression,templateStr=that._renderContentbyTemplate(templateStr,data),!1}):null!=templateStr&&(templateStr=that._renderContentbyTemplate(templateStr,data))):null!=templateStr&&(templateStr=that._renderContentbyTemplate(templateStr,data)),templateStr},_renderContentbyTemplate:function(e,t){var a=/#:[^#]+#/g,n=e.match(a);return n&&$.each(n,function(a,n){var r=n.substring(2,n.length-1);t[r]||(r=r.toLowerCase()),e=e.replace(n,t[r])}),e},getValue:function(e,t){return t[1].id},setValue:function(e,t){},getFocusNodeData:function(e,t){var a=pubsub.getJQObj(e,!0),n=a.find("div.node.focused").attr("id"),r=[];return r.push(a.find(".orgchart").data("options").data),diagrambtFunc.getNodeDataById(r,n)[e.columnName]},getNodeDataById:function(e,t){var a=null;return $.each(e,function(e,n){return n.id==t?(a=n,!1):null==(a=diagrambtFunc.getNodeDataById(n.children,t))&&void 0}),a},getNode:function(e,t){var a=pubsub.getJQObj(e);return a.find("div.node.focused").length>0?a.find("div.node.focused"):$("")},removeNodes:function(e,t){var a=pubsub.getJQObj(e),n=diagrambtFunc.getNode(e,t);a.orgchart("removeNodes",n)},addParent:function(e,t){var a=pubsub.getJQObj(e),n="";if(diagrambtFunc.getNode(e,t).length>0)for(var r=0;r<e.length;r++)n=t[e[r].param],a.orgchart("addParent",a.find(".node:first"),{name:n})},addSiblings:function(e,t){var a=pubsub.getJQObj(e),n="",r=diagrambtFunc.getNode(e,t);if(r.length>0)for(var i=0;i<e.length;i++)n=t[e[i].param],a.orgchart("addSiblings",r,{siblings:[{name:n,relationship:"110"}]})},addChildren:function(e,t){var a=pubsub.getJQObj(e),n="",r=diagrambtFunc.getNode(e,t),i=$.extend({},a.find(".orgchart").data("options"),{depth:0});if(r.length>0)for(var o=r.parent().attr("colspan")>0,s=0;s<e.length;s++)n=t[e[s].param],o?a.orgchart("addSiblings",r.closest("tr").siblings(".nodes").find(".node:first"),{siblings:[{name:n,relationship:"110"}]}):a.orgchart("addChildren",r,{children:[{name:n,relationship:"100"}]},i)},grefresh:function(e,t){var a=[];a.push(diagrambtFunc.initOptions),diagrambtFunc.init({inid:e.outid},a)},changeTitleColor:function(e,t){for(var a=pubsub.getJQObj(e),n=0;n<e.length;n++)r=e[n],r&&"key"!=r.param&&"color"!=r.param&&(v=t[r.param]);var i=t.key;i=i||"id";(a=pubsub.getJQObj(e)).find(".orgchart").data("options");var o=a.find(".orgchart").data("options").data,s=[];s.push(o),diagrambtFunc.getNodes(s,i,v,function(e){a.find("div.node[id='"+e.id+"']").find("div.title").css("background-color",t.color)})},getNodes:function(e,t,a,n){$.each(e,function(e,r){r[t]==v&&n&&$.isFunction(n)&&n(r),diagrambtFunc.getNodes(r.children,t,a,n)})},getKeyName:function(e,t){return e.columnName}};pubsub.sub("diagrambt",diagrambtFunc);var editorbtFunc={init:function(e,t){var a=t[0];$("#"+e.inid).summernote(a),$("#"+e.inid).next()[0].style.display=t[0].display},getValue:function(e,t){return pubsub.getJQObj(e,!0).code()},destroy:function(e,t){pubsub.getJQObj(e).destroy()},tclear:function(e,t){var a=pubsub.getJQObj(e).next().find("div.note-editable.panel-body");a&&a.html("")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.parents().find(".note-editable p").append(n)}else a.parents().find(".note-editable p").append(n)}};pubsub.sub("editorbt",editorbtFunc);var chartsFunc={init:function(e,t){var a=t[0];a._querydata=getParams(e.inid)?JSON.stringify(getParams(e.inid)):null,$.ajax({type:"POST",url:contextPath+"/mx/form/charts/datas",contentType:"application/json",dataType:"json",data:JSON.stringify({rid:a.rid,params:a._querydata}),success:function(t){var n=chartsFunc.transform(t,a),r=$("#"+e.inid),i=[];a.series=n,void 0!=a.pieInnerSize&&""!=a.pieInnerSize&&(a.series[0].innerSize=a.pieInnerSize),"pie"==a.chart.type&&(a.tooltip.pointFormat="{series.name}: <b>{point.y}个({point.percentage:.1f}%)</b>"),$.each(n,function(e,t){t.data.length>1e3&&i.push(t.data.length)}),i.length&&(a.plotOptions.series.turboThreshold=Math.max.apply(Math,i)),r.data("clickEvent")&&(a.plotOptions.series.point.events.click=r.data("clickEvent")),r.highcharts(a),a.rotate3D&&chartsFunc.rotate3D(e.inid),r.resize&&r.resize(function(e,t,a){r.highcharts().setSize(r.width(),r.height(),!0)})}})},tshow:function(e,t){pubsub.getJQObj(e).show()},getRow:function(e,t){var a=t[1];return"categories"==e.columnName?"pie"==pubsub.getJQObj(e,!0).highcharts().options.chart.type?a.name:a.series&&a.series.name||"":a[e.columnName]},fresh:function(e,t,a){var n=pubsub.getJQObj(e);if(n.highcharts()){var r=n.highcharts().options;$.ajax({type:"POST",url:contextPath+"/mx/form/charts/datas",contentType:"application/json",dataType:"json",data:JSON.stringify({rid:r.rid,params:r._querydata}),success:function(e){var t=chartsFunc.transform(e,r);r.series=t,n.highcharts(r)}})}},refresh:function(e,t,a){chartsFunc.linkageControl(e,t,a)},linkageControl:function(e,t,a){var n=pubsub.getJQObj(e);if(n.highcharts()){var r=n.highcharts().options,i={rid:r.rid};i.params=JSON.stringify(t),$.ajax({type:"POST",url:contextPath+"/mx/form/charts/datas",contentType:"application/json",dataType:"json",data:JSON.stringify(i),success:function(e){var t=chartsFunc.transform(e,r);r.series=t,void 0!=r.pieInnerSize&&""!=r.pieInnerSize&&(r.series[0].innerSize=r.pieInnerSize),n.highcharts(r)}})}else var o=setInterval(function(){if(n.highcharts()){var e=n.highcharts().options,a={rid:e.rid};a.params=JSON.stringify(t),$.ajax({type:"POST",url:contextPath+"/mx/form/charts/datas",contentType:"application/json",dataType:"json",data:JSON.stringify(a),success:function(t){var a=chartsFunc.transform(t,e);e.series=a,n.highcharts(e)}}),clearInterval(o)}},200)},_getRule:function(e,t){var a=e.length;if(a)for(var n,r=0;r<a;r++)if((n=e[r]).id==t)return n;return null},_hasYAxisName:function(e,t){var a,n=e.length;if(n)for(var r=0;r<n;r++)if((a=e[r]).name==t)return a;return null},_staticBuildSubserie:function(e,t){var a={},n=t.chartType||t._chartType,r="scatter"==n,i="bubble"==n;for(var o in e){if(t.xAxisName&&o==t.xAxisName.en){if(a.name=e[o],"datetime"==t.xAxisName.type&&(a.name=chartsFunc._formatTime(e[o],t.tf)),r||i){var s=parseFloat(+e[o]);a.x=parseFloat(s.toFixed(2))}}else if(o==t.axisName.en)if(e[o]){var l=parseFloat(+e[o]);a.y=parseFloat(l.toFixed(2))}else a.y=null;else if(i&&t.zAxisName&&o==t.zAxisName.en)if(a.zoneAxis="z",e[o]){var u=parseFloat(+e[o]);a.z=parseFloat(u.toFixed(2))}else a.z=null;a[o]=e[o]}return a},_buildSubserie:function(e,t,a){var n={},r=t.chartType||t._chartType,i="scatter"==r,o="bubble"==r;for(var s in e){if(t.xAxisName&&s==t.xAxisName.en){if(n.name=e[s],"datetime"==t.xAxisName.type&&(n.name=chartsFunc._formatTime(e[s],t.tf)),i||o){var l=parseFloat(+e[s]);n.x=parseFloat(l.toFixed(2))}}else if(s==a.en)if(e[s]){var u=parseFloat(+e[s]);n.y=parseFloat(u.toFixed(2))}else n.y=null;else if(o&&t.zAxisName&&s==t.zAxisName.en)if(n.zoneAxis="z",e[s]){var c=parseFloat(+e[s]);n.z=parseFloat(c.toFixed(2))}else n.z=null;n[s]=e[s]}return n.name||(n.name=a.cn),n},_formatTime:function(e,t){return hmtdUtils.parseDate(e).format(t||"yyyy-MM-dd")||e},_setShowValueAndPoint:function(e,t){t.markerEnable&&(e.marker=e.marker||{},e.marker.enabled=!(!t.markerEnable||"true"!=t.markerEnable)),t.dataLabelsEnable&&(e.dataLabels=e.dataLabels||{},e.dataLabels.enabled=!(!t.dataLabelsEnable||"true"!=t.dataLabelsEnable))},_convertExpToStr:function(e,t,a,n){var r=/{[\w|\.]+}/g,i=e.match(r);return $.each(i,function(r,i){"{point.name}"==i?e=e.replace(i,a.cn):"{y}"==i?e=e.replace(i,t[a.en]):"{total}"==i&&(e=e.replace(i,n))}),e},_groupBySeries:function(datas,rule,ind,opts){var series=[],serie,subseries,subserie,data,datasSize=datas.length,yans=rule.yAxisName,yansSize=void 0!=yans?yans.length:0,an=rule.axisName,tsize=rule.tSize,tname=rule.tName,tid=rule.tid,tparent=rule.tParent,tcolor=rule.tColor,yan,xan=rule.xAxisName,yAxisLength=opts.yAxis.length>1;if(rule._chartType=opts.chart.type,rule.pieInnerSize=opts.pieInnerSize,void 0!=yans)if(1==yans.length&&void 0!=an&&""!=an.en)for(var i=0;i<datasSize;i++){data=datas[i];var yAxisName=data[yans[0].en];"datetime"==yans[0].type&&(yAxisName=chartsFunc._formatTime(yAxisName,rule.tf));var hasSerie=chartsFunc._hasYAxisName(series,yAxisName);if(hasSerie){var subserie=chartsFunc._staticBuildSubserie(data,rule),formatColor=serie.dataLabels.formatColor;if(formatColor){var boo="";try{boo=JSON.parse(formatColor)}catch(e){}if(boo){var strExp="";$.each(boo,function(i,item){var expression=item.expression,color=item.color,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(subserie.color=color)})}}hasSerie.data.push(subserie)}else{serie={},serie.name=yAxisName,yAxisLength&&(serie.yAxis=ind),serie.type=rule.chartType,rule.stack&&(serie.stack=data[rule.stack]),serie.dataLabels=serie.dataLabels||$.extend(!0,{},opts.plotOptions.series.dataLabels)||{};var formatExp=serie.dataLabels.formatExp;if(formatExp&&formatExp.length>0){var strExp="";$.each(formatExp,function(i,item){var expression=item.expression,htmlExpression=item.htmlExpression,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(serie.dataLabels.format=htmlExpression)})}var formatColor=serie.dataLabels.formatColor;if(formatColor){var boo="";try{boo=JSON.parse(formatColor)}catch(e){}if(boo){var strExp="";$.each(boo,function(i,item){var expression=item.expression,color=item.color,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(subserie.color=color)})}}chartsFunc._setShowValueAndPoint(serie,rule),subseries=[],subserie=chartsFunc._staticBuildSubserie(data,rule);var formatColor=serie.dataLabels.formatColor;if(formatColor){var formatc="";try{formatc=JSON.parse(formatColor)}catch(e){}if(formatc){var strExp="";$.each(formatc,function(i,item){var expression=item.expression,color=item.color,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(subserie.color=color)})}}subseries.push(subserie),serie.data=subseries,opts.pieInnerSize&&(serie.innerSize=opts.pieInnerSize),("pie"==serie.type||!serie.type&&"pie"==opts.chart.type)&&opts.pieInnerSize&&(serie.colorByPoint=!0),series.push(serie)}}else for(var i=0;i<datasSize;i++){data=datas[i];for(var j=0;j<yansSize;j++){yan=yans[j];var hasSerie=chartsFunc._hasYAxisName(series,yan.cn);if(hasSerie){var subserie=chartsFunc._buildSubserie(data,rule,yan),formatColor=serie.dataLabels.formatColor;if(formatColor){var boo="";try{boo=JSON.parse(formatColor)}catch(e){}if(boo){var strExp="";$.each(boo,function(i,item){var expression=item.expression,color=item.color,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(subserie.color=color)})}}hasSerie.data.push(subserie)}else{serie={},yAxisLength&&(serie.yAxis=ind),serie.name=yan.cn,serie.type=rule.chartType,serie.dataLabels=serie.dataLabels||$.extend(!0,{},opts.plotOptions.series.dataLabels)||{};var formatExp=serie.dataLabels.formatExp;if(formatExp&&formatExp.length>0){var strExp="";$.each(formatExp,function(i,item){var expression=item.expression,htmlExpression=item.htmlExpression,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(serie.dataLabels.format=htmlExpression)})}chartsFunc._setShowValueAndPoint(serie,rule),rule.stack&&(serie.stack=data[rule.stack]),subseries=[],subserie=chartsFunc._buildSubserie(data,rule,yan);var formatColor=serie.dataLabels.formatColor;if(formatColor){var boo="";try{boo=JSON.parse(formatColor)}catch(e){}if(boo){var strExp="";$.each(boo,function(i,item){var expression=item.expression,color=item.color,exp=chartsFunc._convertExpToStr(expression,data,yan,datasSize);eval(exp)&&(subserie.color=color)})}}subseries.push(subserie),serie.data=subseries,opts.colorByPoint&&(serie.colorByPoint=!0),("pie"==serie.type||!serie.type&&"pie"==opts.chart.type)&&opts.pieInnerSize&&(serie.innerSize=opts.pieInnerSize),series.push(serie)}}}return series},_buildPie:function(e){for(var t,a,n=[],r={data:[]},i=0,o=e.length;i<o;i++){a=(t=e[i]).data,r.name=a[0].name;for(var s=0,l=a.length;s<l;s++)a[s].name=t.name,r.data.push(a[s])}return n.push(r),n},_hastreeName:function(e,t){var a,n=e.length;if(n)for(var r=0;r<n;r++)if((a=e[r]).name==t)return a;return null},_buildtreemap:function(e,t,a){e.tSize,e.tName;for(var n=e.tid,r=e.tParent,i=(e.tColor,t.length),o=[],s=0,l=["#d94e5d","#eac736","#50a3ba","#404a59","#323c48","#a6c84c","#ffa022","#46bee9"],u=0;u<i;u++){data=t[u];var c=chartsFunc._hastreeName(o,"treemap");if(void 0!=e.yAxisName&&(data.value=parseInt(data[e.yAxisName[0].en])),void 0!=e.xAxisName&&(data.name=data[e.xAxisName.en]),void 0!=n&&(data.id=data[n.en]),void 0!=r&&a.istree&&(data.parent=data[r.en]),s=s<l.length-1?s+1:0,data.color=l[s],c)c.data.push(data);else{serie={},serie.type=e.chartType,serie.name="treemap",serie.layoutAlgorithm="stripes",serie.alternateStartingDirection=!0;var d=[{level:1,layoutAlgorithm:"sliceAndDice",dataLabels:{enabled:!0,align:"left",verticalAlign:"top",style:{fontSize:"15px",fontWeight:"bold"}}}];a.istree||(d[0].dataLabels.verticalAlign="middle",d[0].dataLabels.align="center"),serie.levels=d,chartsFunc._setShowValueAndPoint(serie,e),e.stack&&(serie.stack=data[e.stack]),subseries=[],subseries.push(data),serie.data=subseries,a.pieInnerSize&&(serie.innerSize=a.pieInnerSize),o.push(serie)}}return o},transform:function(e,t){var a,n,r=t.chartsSource,i=e.length,o=[];if(i){for(var s=0;s<i;s++)if(a=e[s],n=chartsFunc._getRule(r,a.id)){var l=chartsFunc._groupBySeries(a.data,n,s,t);l&&l.length>1&&"pie"==t.chart.type&&(l=chartsFunc._buildPie(l)),"treemap"==t.chart.type&&(l=chartsFunc._buildtreemap(n,a.data,t)),$.merge(o,l)}if(t.sortLegend)for(var u,c=$.extend([],o),d=t.sortLegend,p=0,b=0;b<d.length;b++)(u=c[d[b]-1])?o[b-p]=u:p++;return o}return[]},rotate3D:function(e){var t=$("#"+e).highcharts();$(t.container).bind("mousedown.hc touchstart.hc",function(e){var a,n,r=(e=t.pointer.normalize(e)).pageX,i=e.pageY,o=t.options.chart.options3d.alpha,s=t.options.chart.options3d.beta;$(document).bind({"mousemove.hc touchdrag.hc":function(e){n=s+(r-e.pageX)/5,n=Math.min(100,Math.max(-100,n)),t.options.chart.options3d.beta=n,a=o+(e.pageY-i)/5,a=Math.min(100,Math.max(-100,a)),t.options.chart.options3d.alpha=a,t.redraw(!1)},"mouseup touchend":function(){$(document).unbind(".hc")}})})},changeSeriesValue:function(e,t){var a=pubsub.getJQObj(e).highcharts(),n=a.series;$.each(t,function(e,t){$.each(n,function(a,n){if(n.name==e){var r=[];$.each(n.data,function(e,a){r.push(parseInt(t))}),n.setData(r)}})}),a.redraw()}};pubsub.sub("charts",chartsFunc);try{Highcharts.setOptions({lang:{drillUpText:"<< 返回 {series.name}",noData:"暂无数据"}})}catch(e){}var videoFunc={getRow:function(e,t){return null},linkage:function(e,t){videoFunc.linkageControl(e,t)},linkageControl:function(e,t){var a=pubsub.getJQObj(e),n=a.attr("drole"),r=a.attr("model");if(n&&"ys"==n)a.ysVideo("link",{params:t});else if(r&&"traffic"==r)(i={params:JSON.stringify(t)||null}).rid=a.attr("rid"),$.ajax({url:contextPath+"/mx/form/data/getVideoSetByTraffic",data:i,type:"POST",dataType:"JSON",async:!1,success:function(e){e&&e[0]&&loginNetVideo(e[0])}});else{var i={params:JSON.stringify(t)||null};i.rid=a.attr("rid"),$.ajax({url:contextPath+"/mx/form/data/getVideoSet",data:i,type:"POST",dataType:"JSON",async:!1,success:function(e){e&&e[0]&&loginNetVideo(e[0])}})}}};pubsub.sub("video",videoFunc);var gridbtFunc={insertStaticRow:function(e,t,a){var n=pubsub.getJQObj(e),r=n.data("inparamobjrule");if(n||n[0]){var i=r.arySource;if($.isArray(i)){var o=i;i={},$.each(o,function(e,t){var a=t.child,n="";a&&a[0]&&(n=a[0].param),i[t.param]=n}),r.arySource=i}var s=r.objSource;if($.isArray(s)){var l=s;s={},$.each(l,function(e,t){var a=JSON.parse(t.child),n={};$.each(a,function(e,t){n[t.param]=t.columnFiled}),s[t.param]=n}),r.objSource=s}if(s){var u=[],c=null;$.each(t,function(e,t){if($.isPlainObject(t)&&!$.isEmptyObject(t)){c={};a=s[e];$.each(t,function(e,t){a[e]&&(c[a[e]]=t)}),u.push(c)}else if($.isArray(t)){if(!i[e])return!0;var a=s[i[e]];$.each(t,function(e,t){c={},$.each(t,function(e,t){a[e]&&(c[a[e]]=t)}),u.push(c)})}}),u&&u.length>0&&n.grid("insertStaticRow",u)}}},getRow:function(e,t,a){var n=pubsub.getJQObj(e,!0).grid("getSelectedRows"),r=pubsub.getJQObj(e,!0).data("grid"),i=[];return n&&n.length?($.each(n,function(t,n){if(n[e.columnName]){var o=$(r.target).find("td[field="+e.columnName+"]")[n.row_number-1];void 0!=$(o).find("input[type=radio]")[0]?$.each($(o).find("input[type=radio]"),function(e,t){t.checked&&i.push(t.value||"")}):(i.push(n[e.columnName]||""),pubsub.outParamsObj.call(t,e,a,n))}}),i.join(",")):""},getUnselectRow:function(e,t){var a=pubsub.getJQObj(e,!0).grid("getUnselectedRows"),n=[];return a&&a.length?($.each(a,function(t,a){a[e.columnName]&&n.push(a[e.columnName]||"")}),n.join(",")):""},getCurRow:function(e,t){return t&&t[1]?t[1][e.columnName]||"":""},getText:function(e,t){var a="",n=pubsub.getJQObj(e,!0).data("grid"),r=$(n.target).find("td[field="+t[1]+"]")[t[0]];return void 0!=$(r).find("input[type=radio]")[0]?$.each($(r).find("input[type=radio]"),function(e,t){t.checked&&(a=t.value)}):a=t[2],a},getCurColumn:function(e,t){var a=pubsub.getJQObj(e,!0).data("grid"),n=(t[3],a.options.columns),r="";return $.each(n,function(e,a){a.field==t[1]&&(r=a.title)}),r},isChecked:function(e,t){if(t&&t[1]){var a=pubsub.getJQObj(e,!0).data("grid");return a.tbody().find("tr:eq("+t[1]["row-index"]+")").hasClass(a.options.selectedCls)}return!1},getValue:function(e,t){return pubsub.getJQObj(e,!0).closest("a").text()},linkage:function(e,t){gridbtFunc.linkageControl(e,t)},linkageControl:function(e,t){t.databaseId&&pubsub.getJQObj(e).attr("dbid",t.databaseId);var a=pubsub.getJQObj(e).data("grid.options").options;a&&a.pagination.page&&(a.pagination.page=1),pubsub.getJQObj(e).grid("query",t)},selectRow:function(e,t){var a=pubsub.getJQObj(e),n=a.grid("getData"),r=t.key;r=r||"id";var i="";$.each(e,function(a,n){if("key"==e[a].param)return!0;i=t[e[a].param]||""}),n&&n.length&&$.each(n,function(e,t){var n=i;if(n)for(var o=n.split(","),s=0;s<o.length;s++)t[r]==o[s]&&(t.id?a.grid("select",t.id):a.grid("select",null,null,t))})},checkRecord:function(e,t){var a=pubsub.getJQObj(e),n=(t[e[0].param],t.key);n=n||"id";var r=a.grid("getData");r&&r.length&&$.each(r,function(r,i){var o=t[e[0].param];if(o)for(var s=o.split(","),l=0;l<s.length;l++)i[n]==s[l]&&(i.id?a.grid("checkRow",i.id):a.grid("checkRow",null,null,i))})},cancelSelect:function(e,t){pubsub.getJQObj(e).grid("cancelSelect")},getAll:function(e,t){var a=pubsub.getJQObj(e,!0);if(a){var n,r=[],i=a.data("grid").getData();if(i){for(var o=0;o<i.length;o++)n=i[o],r.push(n[e.columnName]||"");return r.join(",")}}return""},setRowBgColor:function(e,t){pubsub.getJQObj(e).grid("setRowBgColor",t.rowIndex,t.color)},tSelectFirst:function(e,t){var a=pubsub.getJQObj(e);a&&setTimeout(function(){if(!a.grid("select","","tr:eq(0)")){var e=null;(e=a.data("mutationObserver"))&&(e.disconnect(),a.data("mutationObserver","")),e=new MutationObserver(function(t){a.grid("select","","tr:eq(0)"),e.disconnect(),a.data("mutationObserver","")}),a.data("mutationObserver",e),e.observe(a[0],{childList:!0,arrtibutes:!0,subtree:!0,characterData:!0})}},100)},grefresh:function(e,t){pubsub.getJQObj(e).grid("query",$.isArray(t)?{}:t)},gsaveChange:function(e,t){pubsub.getJQObj(e).grid("saveHandle")},getTotal:function(e,t){return pubsub.getJQObj(e,!0).grid("getTotal")||0},endEdit:function(e,t){pubsub.getJQObj(e).grid("endEdit")},hideToolbar:function(e,t){pubsub.getJQObj(e).find(".grid-toolbar").hide()},showToolbar:function(e,t){pubsub.getJQObj(e).find(".grid-toolbar").show()},editRow:function(e,t){var a=pubsub.getJQObj(e),n=a.grid("getData"),r=t.key;r=r||"id";var i="";$.each(e,function(a,n){if("key"==e[a].param)return!0;i=t[e[a].param]||""}),n&&n.length&&$.each(n,function(e,t){var n=i;if(n)for(var o=n.split(","),s=0;s<o.length;s++)t[r]==o[s]&&(t.id?a.grid("editRow",t.id):a.grid("editRow",null,null,t))})},addRow:function(e,t){pubsub.getJQObj(e).grid("_newRow")},getCheckedRow:function(e,t,a){var n=pubsub.getJQObj(e,!0).grid("getCheckedRowsData"),r=[];return n&&n.length?($.each(n,function(t,n){n[e.columnName]&&(r.push(n[e.columnName]||""),pubsub.outParamsObj.call(t,e,a,n))}),r.join(",")):""},isCheckedInput:function(e,t){return!(!t||!t[1])&&pubsub.getJQObj(e,!0).data("grid").tbody().find("tr:eq("+t[1]["row-index"]+") .inner_checkbox").prop("checked")},getKeyName:function(e,t){return e.columnName},setEditDisabled:function(e,t){var a=pubsub.getJQObj(e),n=a.grid("getData"),r=t.key;r=r||"id";var i="";$.each(e,function(a,n){if("key"==e[a].param)return!0;i=t[e[a].param]||""}),n&&n.length&&$.each(n,function(e,t){var n=i;if(n)for(var o=n.split(","),s=0;s<o.length;s++)t[r]==o[s]&&(t.id?a.grid("setEditDisabled",t[r]):a.grid("setEditDisabled",null,null,t))})},setEditEnabled:function(e,t){var a=pubsub.getJQObj(e),n=a.grid("getData"),r=t.key;r=r||"id";var i="";$.each(e,function(a,n){if("key"==e[a].param)return!0;i=t[e[a].param]||""}),n&&n.length&&$.each(n,function(e,t){var n=i;if(n)for(var o=n.split(","),s=0;s<o.length;s++)t[r]==o[s]&&(t.id?a.grid("setEditEnabled",t[r]):a.grid("setEditEnabled",null,null,t))})}};pubsub.sub("gridbt",gridbtFunc);var imageuploadFunc={tdisabled:function(e,t){pubsub.getJQObj(e).find(".imageupload_tools").hide()},tenabled:function(e,t){pubsub.getJQObj(e).find(".imageupload_tools").show()},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()},delImg:function(e){var t=$(e).closest(".image_upload_div"),a=t.attr("randomparent");if(a){if(confirm("是否删除图片")){var n=t.attr("removeurl");$.ajax({type:"post",url:n,data:{id:a},success:function(e){alert("删除成功"),t.children("img").attr("src","").hide(),t.attr("attachmentid","");var a=t.attr("outputName");a&&imageuploadFunc.setOutPutName(a,"")},error:function(e){alert("删除失败")}})}}else alert("请先上传图片")},setOutPutName:function(e,t){for(var a=e.split(","),n=0;n<a.length;n++)outputName=a[n],outputName&&$("#"+outputName).val(t)},getRandomparent:function(e){return pubsub.getJQObj(e,!0).attr("randomparent")},getValue:function(e){return pubsub.getJQObj(e,!0).attr("attachmentId")},setImgPic:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t)for(var r=0;r<e.length;r++)n=t[e[r].param]||"";else n=t;var i=a.find(".imageupload_class");i[0].onload=function(){EXIF.getData(i[0],function(){$(this).data("tags",EXIF.getAllTags(this))})};var o="/glaf/mx/form/imageUpload?method=downloadById&_"+(new Date).getTime()+"&id="+n;a.attr("attachmentid",n),i.attr("src",o).show()},setRandomParent:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t)for(var r=0;r<e.length;r++)n=t[e[r].param]||"";else n=t;var i=a.find(".imageupload_class");if(null==n||""==n){i.hide();var o=(new UUID).createUUID();return a.attr("randomparent",o),void a.removeAttr("attachmentId")}a.attr("randomparent",n);var s=a.attr("downloadUrl");i[0].onload=function(){EXIF.getData(i[0],function(){$(this).data("tags",EXIF.getAllTags(this))})},i.attr("src",s+"&_"+(new Date).getTime()+"&randomparent="+n).show()},getBasePicData:function(e,t){return pubsub.getJQObj(e,!0).find(".imageupload_class").data("tags")[e.columnName]},clear:function(e,t){var a=pubsub.getJQObj(e);a.find(".imageupload_class").hide();var n=(new UUID).createUUID();a.attr("randomparent",n),a.attr("attachmentId","")}};pubsub.sub("imageupload",imageuploadFunc);var customFunc={init:function(e,t){$("#"+e.inid).data("retSource",t[0]),customFunc.setValue($("#"+e.inid),"")},setValue:function(jq,args){var rets=jq.data("retSource"),length=rets.length,ret,key,val;if(length)for(var i=0;i<length;i++)if(ret=rets[i],key=customFunc._convert(ret.key,args,"key"),eval(key)||"true"==key){jq.html(customFunc._convert(ret.val,args,"val"));var onLoadSucessFunc=jq.data("onLoadSucess");return void($.isFunction(onLoadSucessFunc)&&onLoadSucessFunc())}},_convert:function(e,t,a){var n,r,i,o,s=t.length,l="key"==a?"'":"";if(s)for(var u=0;u<s;u++)r=(n=t[u]).param,i=n.value,o=new RegExp("##"+r+"##","gm"),e=e.replace(o,l+i+l);return e.replace(/\\"/gm,"'").replace(/##col\w*##/gm,"key"==a?"''":"")},_paramsToArgs:function(e){var t,a=[];for(var n in e)(t={}).param=n,t.value=e[n],a.push(t);return a},linkage:function(e,t){customFunc.linkageControl(e,t)},linkageControl:function(id,params){var jq=pubsub.getJQObj(id),rets=jq.data("retSource"),length=rets.length,ret,key,val,args=customFunc._paramsToArgs(params);if(length)for(var i=0;i<length;i++)if(ret=rets[i],key=customFunc._convert(ret.key,args,"key"),eval(key)||"true"==key){params.esc?jq.html($(customFunc._convert(ret.val,args,"val")).text()):jq.html(customFunc._convert(ret.val,args,"val"));var onLoadSucessFunc=jq.data("onLoadSucess");return void($.isFunction(onLoadSucessFunc)&&onLoadSucessFunc())}}};pubsub.sub("custom",customFunc);var aFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).html()},getActVal:function(e,t){return pubsub.getJQObj(e,!0).attr("actVal")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.find("p").html(n)}else a.find("p").html(t)}};pubsub.sub("a",aFunc);var definedTableFunc={getPage:function(e,t){return pubsub.getJQObj(e,!0).definedTable("getPage")},getRow:function(e,t){var a=pubsub.getJQObj(e,!0).definedTable("getSelectedRowsData");return a&&a[0]?a[0][e.columnName]:null},getValue:function(e,t){return pubsub.getJQObj(e,!0).closest("a").text()},linkage:function(e,t){definedTableFunc.linkageControl(e,t)},linkageControl:function(e,t){pubsub.getJQObj(e).definedTable("query",$.isArray(t)?{}:t)},getAll:function(e,t){var a=pubsub.getJQObj(e,t[0]||!0);if(a){var n,r=[],i=a.data("definedTable").rows;if(i){for(var o=0;o<i.length;o++)n=i[o],r.push(n[e.columnName]);return r.join(",")}}return null},getAllRows:function(e,t){var a=pubsub.getJQObj(e,t[0]||!0);if(a){var n,r=[],i=a.data("definedTable").allRows;if(i){for(var o=0;o<i.length;o++)n=i[o],r.push(n[e.columnName]);return r.join(",")}}return null},getFirstRow:function(e,t){var a=pubsub.getJQObj(e,t[0]||!0);if(a){var n=a.data("definedTable").rows;if(n&&n[0])return n[0][e.columnName]}return null}};pubsub.sub("definedTable",definedTableFunc);var stepFunc={init:function(e,t){var a=t[0];stepFunc.display.call($("#"+e.inid),a.visible),0!=a.fixDataSource.length?stepFunc.createEle.call($("#"+e.inid),a,a.fixDataSource):$.ajax({type:"POST",url:contextPath+"/mx/form/data/gridData",contentType:"application/json",dataType:"json",data:JSON.stringify({rid:a.rid}),success:function(t){stepFunc.createEle.call($("#"+e.inid),a,t.data)}})},createEle:function(opts,data){if(0!=data.length){var that=this,container=that.find("div.step-line").html("");$.each(data,function(i,o){var $col=$('<div class="step mt-step-col"></div>');if(0==i?$col.addClass("first"):i==data.length-1&&$col.addClass("last"),$col.css("width",100/data.length+"%"),$col.data("step",data[i]),container.append($col),opts.defined&&opts.defined.length)for(var defineds=opts.defined,j=0;j<defineds.length;j++){var defined=defineds[j];if(key=stepFunc._convert(defined.key,data[i],"key"),eval(key)||"true"==key)return defined.numberVal?$col.append('<div class="mt-step-number bg-white">'+stepFunc._convert(defined.numberVal,data[i])+"</div>"):$col.append('<div class="mt-step-number bg-white">'+(i+1)+"</div>"),void $col.append('<div class="mt-step-title uppercase font-grey-cascade">'+stepFunc._convert(defined.contentVal,data[i])+"</div>")}0==$col.find("div.mt-step-number").length&&data[i].number?$col.append('<div class="mt-step-number bg-white">'+data[i].number+"</div>"):$col.append('<div class="mt-step-number bg-white">'+(i+1)+"</div>"),0==$col.find("div.mt-step-title").length&&data[i].content?$col.append('<div class="mt-step-title uppercase font-grey-cascade">'+data[i].content+"</div>"):$col.append('<div class="mt-step-title uppercase font-grey-cascade"></div>')})}},_convert:function(e,t,a){var n,r="key"==a?"'":"";if(t)for(var i in t)if(t[i]){var o=i.split("_0_")[1]||i;n=new RegExp("##"+o+"##","gm"),e=e.replace(n,r+t[i]+r)}return e.replace(/##/gm,"'").replace(/\\"/gm,"'").replace(/##col\w*##/gm,"key"==a?"''":"")},display:function(e){var t=this;e?t.css("display",""):t.css("display","none")},thidden:function(e,t){var a=pubsub.getJQObj(e);stepFunc.display.call(a,!1)},tshow:function(e,t){var a=pubsub.getJQObj(e);stepFunc.display.call(a,!0)},getValue:function(e,t){},setValue:function(e,t){},getData:function(e,t){return t[0][e.columnName]},active:function(e,t){var a=pubsub.getJQObj(e),n=stepFunc.getParam(e,t),r=a.find("div.mt-step-col");r.removeClass("done active error");for(var i=0;i<r.length;i++){var o=$(r[i]).data("step");if($(r[i]).addClass("done"),o[e[0].columnName]==n||o.index==n)return $(r[i]).removeClass("done"),void $(r[i]).addClass("active")}},error:function(e,t){var a=pubsub.getJQObj(e),n=stepFunc.getParam(e,t),r=a.find("div.mt-step-col");r.removeClass("done active error");for(var i=0;i<r.length;i++){var o=$(r[i]).data("step");if($(r[i]).addClass("done"),o[e[0].columnName]==n||o.index==n)return $(r[i]).removeClass("done"),void $(r[i]).addClass("error")}},getParam:function(e,t){var a,n="";if("object"==typeof t)for(var r=0;r<e.length&&(a=e[r],!(n=t[a.param]||""));r++);return n}};pubsub.sub("step",stepFunc);var labelFunc={getValue:function(e,t){var a=pubsub.getJQObj(e,!0);return(a.find("span").length>0?a.find("span"):a).html()},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";a.attr("setValue","setValue");var r=a.find("span").length>0?a.find("span"):a;if("object"==typeof t){for(var i=0;i<e.length;i++)n=t[e[i].param]||"";r.html(pubsub.htmlUnescape4Html(n))}else r.html(pubsub.htmlUnescape4Html(t))},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()}};pubsub.sub("label",labelFunc);var fileUploadFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).data("saveId")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if(a.attr("setValue","setValue"),"object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.spFileUpload("setValue",n)}else a.spFileUpload("setValue",t)},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()},tdisabled:function(e,t){pubsub.getJQObj(e).spFileUpload("disabled",!1)},tenabled:function(e,t){pubsub.getJQObj(e).spFileUpload("disabled",!0)},setRamdomparent:function(e,t){var a=pubsub.getJQObj(e);if("object"==typeof t)for(var n=0;n<e.length;n++)r=e[n],v=t[r.param]||"";else v=t;a.spFileUpload("setValue",v)},clear:function(e,t){pubsub.getJQObj(e).spFileUpload("setValue","")},setReadOnly:function(e){pubsub.getJQObj(e).spFileUpload("setReadOnly")},removeReadOnly:function(e){pubsub.getJQObj(e).spFileUpload("removeReadOnly")},disabledDelete:function(e){pubsub.getJQObj(e).spFileUpload("disabledDelete")},removeDisabledDelete:function(e){pubsub.getJQObj(e).spFileUpload("removeDisabledDelete")}};pubsub.sub("jqfileupload",fileUploadFunc);var ganttFunc={getRow:function(e,t){t[0];return(t[1]||{}).row[e.columnName]||""},save:function(e,t){return pubsub.getJQObj(e).iframegantt("save",t)},load:function(e,t){return pubsub.getJQObj(e).iframegantt("load",$.isArray(t)?{}:t)}};pubsub.sub("gantt",ganttFunc);var cellFunc={setValue:function(e,t,a){var n=e[0].outid;if(n!=e[0].oid){var i=cellFunc._getActiveSheet(e),o=dynamicAreaFunc.calculate(i,n).split("-");if("object"==typeof a){for(var s=0;s<e.length;s++)r=e[s],v=t[r.param];i.setValue(o[0],o[1],v)}else i.setValue(o[0],o[1],t)}else{var l=cellFunc._getSpread(e);for(var u in t)l.fromJSON(JSON.parse(t[u]))}},insertImg:function(e,t,a){var n=e[0].outid,i=cellFunc._getActiveSheet(e),o=dynamicAreaFunc.calculate(i,n).split("-"),s=contextPath+"/mx/form/imageUpload?method=download&from=to_db&randomparent=",l=i.getSpan(o[0],o[1]);if(l){if("object"==typeof a){for(var u=0;u<e.length;u++)r=e[u],v=t[r.param];i.addPicture(v+(new Date).getTime(),s+v,l.row,l.col,l.row+l.rowCount,l.col+l.colCount)}}else i.addPicture(v+(new Date).getTime(),s+v,l.row,l.col,l.row+l.rowCount,l.col+l.colCount)},getValue:function(e,t,a){var n=e.inid;if(n!=e.iid){var r=cellFunc._getActiveSheet(e,!0),i=dynamicAreaFunc.calculate(r,n).split("-");return r.getValue(i[0],i[1])}var o=cellFunc._getSpread(e,!0);return JSON.stringify(o.toJSON())},prevPage:function(e,t,a){var n=pubsub.getJQObj(e),r=n.data("__page__")||1;n.data("__page__",r>1?r-1:1),pageCell.call(n.data("spread"))},nextPage:function(e,t,a){var n=pubsub.getJQObj(e),r=n.data("__page__")||1;n.data("__page__",r+1),pageCell.call(n.data("spread"))},linkAge:function(e,t,a){var n=pubsub.getJQObj(e);n.data("__params__",t),pageCell.call(n.data("spread"))},_getSpread:function(e,t){return pubsub.getJQObj(e,t).data("spread")},_getActiveSheet:function(e,t){return cellFunc._getSpread(e,t).getActiveSheet()},tshow:function(e,t){pubsub.getJQObj(e).show()},thidden:function(e,t){pubsub.getJQObj(e).hide()}};pubsub.sub("cell",cellFunc);var bootstraptabsFunc={activeTab:function(e,t){var a,n="",r=pubsub.getJQObj(e).find('a[data-toggle="tab"]');if("object"==typeof t)for(var i=0;i<e.length;i++)a=e[i],n=t[a.param]||"",$.each(r,function(e,t){$(t).find("span").html()!=n&&e!=n||setTimeout(function(){$(t).tab("show")},100)})},showTab:function(e,t){var a=pubsub.getJQObj(e),n="";$.each(e,function(e,a){n=t[a.param]+""});var r=n.split(",");$.each(r,function(e,t){a.tabs("show",$.isNumeric(t)?parseInt(t):t)})},hideTab:function(e,t){var a=pubsub.getJQObj(e),n="";$.each(e,function(e,a){n=t[a.param]+""});var r=n.split(",");$.each(r,function(e,t){a.tabs("hide",$.isNumeric(t)?parseInt(t):t)})},setTabName:function(e,t){var a=pubsub.getJQObj(e).find(".nav.nav-tabs li");$.each(a,function(e,a){t&&null!=t[e]&&$.each($(a).find("span"),function(a,n){void 0!=$(n).attr("class")||$(n).text(t[e])})})},setTabStatus:function(e,t){var a=pubsub.getJQObj(e).find(".nav.nav-tabs li"),n=null;$.each(t,function(e,t){n=t}),null!=n&&(n=parseInt(n),$(a[n]).find("a:first-child").trigger("click"))},getActivedValue:function(e,t){return pubsub.getJQObj(e,!0).find("li.active:first>a").text()},getActivedIndex:function(e,t){var a=pubsub.getJQObj(e,!0).find(".nav.nav-tabs li"),n=-1;return $.each(a,function(e,t){if($(t).hasClass("active"))return n=e+1,!1}),n}};pubsub.sub("bootstraptabs",bootstraptabsFunc);var bootstrapdialogFunc={curwindow:function(e,t){var a=pubsub.getJQObj(e).data("bootstrapdialog"),n={title:null,width:null,height:null};$.each(t,function(e,t){switch(e){case"标题":n.title=t;break;case"宽度":n.width=t;break;case"高度":n.height=t}}),a._open(n)},closeCurwindow:function(e,t){pubsub.getJQObj(e).data("bootstrapdialog")._close()},hidden:function(e,t){pubsub.getJQObj(e).data("bootstrapdialog")._hidden()},visible:function(e,t){pubsub.getJQObj(e).data("bootstrapdialog")._visible()}};pubsub.sub("bootstrapdialog",bootstrapdialogFunc);var colmdFunc={};pubsub.sub("colmd",colmdFunc);var carouselFunc={linkage:function(e,t,a){pubsub.getJQObj(e).carouselbt("loadData",$.isArray(t)?{}:t)},refresh:function(e,t,a){pubsub.getJQObj(e).carouselbt("refresh")}};pubsub.sub("carousel",carouselFunc);var tagsinputObj={defaults:{visible:!0,enabled:!0,defaultVal:""},init:function(e,t){var a=t[0],n=$("#"+e.inid),r=$.extend(!0,{},tagsinputObj.defaults,a);tagsinputObj.setValue(n,r.defaultVal),tagsinputObj.display(n,r.visible),n.data("tagsinput",{element:n[0],defaults:tagsinputObj.defaults,options:r})},getValue:function(e,t){var a=e instanceof $?e:pubsub.getJQObj(e,!0);return tagsinputObj.getOject.call(a).val()},thidden:function(e,t){pubsub.getJQObj(e);tagsinputObj.display(e,!1)},tshow:function(e,t){pubsub.getJQObj(e);tagsinputObj.display(e,!0)},tclear:function(e,t){var a=e instanceof $?e:pubsub.getJQObj(e),n=tagsinputObj.getOject.call(a);n.attr("tclear","tclear"),n.tagsinput("removeAll")},setValue:function(e,t){var a,n="";if((a=tagsinputObj.getOject.call(e instanceof $?e:pubsub.getJQObj(e))).attr("setValue","setValue"),a.tagsinput("removeAll"),"object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.tagsinput("add",n)}else e instanceof $&&a.tagsinput("add",t)},appendValue:function(e,t){var a,n,r=e instanceof $?e:pubsub.getJQObj(e);if((a=tagsinputObj.getOject.call(r)).attr("setValue","setValue"),"object"==typeof t){for(var i=0;i<e.length;i++)n=t[e[i].param]||"";a.tagsinput("add",n)}else e instanceof $&&a.tagsinput("add",t)},display:function(e,t){var a=e instanceof $?e:pubsub.getJQObj(e);t?a.css("display",""):a.css("display","none")},getOject:function(){$this=$(this);return $this.find('input[role="tagsinput"]').length>0?$this.find('input[role="tagsinput"]'):$this}};pubsub.sub("tagsinput",tagsinputObj);var sidebarFunc={display:function(e,t){pubsub.getJQObj(e).sidebarExt("display")},show:function(e,t){pubsub.getJQObj(e).sidebarExt("showSidebar")},hide:function(e,t){pubsub.getJQObj(e).sidebarExt("hideSidebar")}};pubsub.sub("sidebar",sidebarFunc);var sionalcodeFunc={copyContent:function(e,t){var a=pubsub.getJQObj(e);t.id=a.selector,$(t.id).empty(),a.sionalcodeExt("copyContent",t)},downloadSional:function(e,t){var a=pubsub.getJQObj(e);t.id=a.selector,a.sionalcodeExt("downloadSional",t)}};pubsub.sub("sionalcode",sionalcodeFunc);var bimFunc={setValue:function(e,t){var a=pubsub.getJQObj(e);for(var n in t)a.bim("setValue",t[n])},select2View:function(e,t){var a=pubsub.getJQObj(e);for(var n in t)a.bim("select2View",t[n])},getData:function(e,t){var a=pubsub.getJQObj(e,!0);return a&&a.get(0)&&(t=a.bim("GetSelection")),t[0]?t[0][e.columnName]:null}};pubsub.sub("bim",bimFunc);var gridlistFunc={setIndex:function(e,t){for(var a=pubsub.getJQObj(e),n="",i=0;i<e.length;i++)r=e[i],n=t[r.param]||"";a.css("z-Index",n)},getNowClickCell:function(e,t){return pubsub.getJQObj(e,!0).gridList("getClickValue")[e.columnName]},getNowDblClickCell:function(e,t){return pubsub.getJQObj(e,!0).gridList("getDblClickValue")[e.columnName]},isChecked:function(e,t){return!(!t||!t[0])&&pubsub.getJQObj(e,!0).gridList("getGridlistBox").find(">.gridList_ul>li>.demo_content[cell-index="+t[0]["cell-index"]+"]").hasClass("selected")},getClickCell:function(e,t){var a=pubsub.getJQObj(e,!0).gridList("getSelectedDatas"),n=[];if(a&&a.length)return $.each(a,function(t,a){a[e.columnName]&&n.push(a[e.columnName]||"")}),n.join(",")},getAll:function(e,t){var a=pubsub.getJQObj(e,!0);if(a){var n,r=[],i=a.data("gridList").getData();if(i){for(var o=0;o<i.length;o++)n=i[o],r.push(n[e.columnName]||"");return r.join(",")}}return""},linkage:function(e,t){gridlistFunc.linkageControl(e,t)},linkageControl:function(e,t){pubsub.getJQObj(e).gridList("query",t)},thidden:function(e,t){pubsub.getJQObj(e).hide()},tshow:function(e,t){pubsub.getJQObj(e).show()},getDrapRow:function(e,t){return pubsub.getJQObj(e,!0).gridList("getDrapRow")[e.columnName]},getDropRow:function(e,t){return pubsub.getJQObj(e,!0).gridList("getDropRow")[e.columnName]},getOverRow:function(e,t){return pubsub.getJQObj(e,!0).gridList("getOverRow")[e.columnName]},refresh:function(e,t){pubsub.getJQObj(e).gridList("refresh")},disableCell:function(e,t){var a,n=pubsub.getJQObj(e),r="";if("object"==typeof t)for(var i=0;i<e.length;i++)r=t[(a=e[i]).param],null==t[a.param]&&(r="");else r=t;n.gridList("disableCell",r)},blukCancelDisableCell:function(e,t){var a=pubsub.getJQObj(e),n="",r=t.key,n=t.value;a.gridList("blukCancelDisableCell",r,n)},selectCheckCell:function(e,t){var a=pubsub.getJQObj(e.outid,!0).data("gridList"),n=($(a.target).attr("data-rule"),$(a.target).find("li"));$.each(n,function(e,t){void 0!=$(t).find(".disabledCell")[0]&&null!=$(t).find(".disabledCell")[0]?$(t).find("input[type=checkbox]").iCheck("uncheck"):($(t).find(".demo_content").addClass("selected"),$(t).find("input[type=checkbox]").iCheck("check"))})},cancelCheckCell:function(e,t){var a=pubsub.getJQObj(e.outid,!0).data("gridList"),n=($(a.target).attr("data-rule"),$(a.target).find("li"));$.each(n,function(e,t){$(t).find(".demo_content").removeClass("selected"),$(t).find("input[type=checkbox]").iCheck("uncheck")})},cancelDisableCell:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.gridList("cancelDisableCell",n)}else a.gridList("cancelDisableCell",t)},cancelAllDisableCell:function(e,t){pubsub.getJQObj(e).gridList("cancelAllDisableCell")},blukDisableCell:function(e,t){var a=pubsub.getJQObj(e),n="",r=t.key,n=t.value;a.gridList("blukDisableCell",r,n)},getKeyName:function(e,t){return e.columnName}};pubsub.sub("gridlist",gridlistFunc),pubsub.sub("gridList",gridlistFunc);var exceluploadFunc={setValue:function(e,t){pubsub.getJQObj(e).excelFileUpload("setParam",t)},getExcelVal:function(e,t){var a=0;return $.each(t[0].result,function(e,t){void 0!=t.count&&null!=t.count&&(a=t.count)}),a}};pubsub.sub("excelupload",exceluploadFunc);var svgEditorFunc={setValue:function(e,t){var a=pubsub.getJQObj(e);for(var n in t)a.svgEditor("setValue",t[n])},getValue:function(e,t){return pubsub.getJQObj(e,!0).svgEditor("getValue")}};pubsub.sub("svgeditor",svgEditorFunc);var bridgeseamFunc={init:function(e,t){var a=t[0];a.url=contextPath+"/mx/form/charts/datas",a.data=JSON.stringify({rid:a.rid,params:getParams(e.inid)?JSON.stringify(getParams(e.inid)):null}),$("#"+e.inid).bridgeSeam(a)},linkage:function(e,t,a){bridgeseamFunc.linkageControl(e,t,a)},linkageControl:function(e,t,a){pubsub.getJQObj(e).bridgeSeam("query",t)}};pubsub.sub("bridgeseam",bridgeseamFunc);var jplayerFunc={acceptMessage:function(e,t){var a=pubsub.getJQObj(e[0].outid,!0),n=(a.data("jp"),a.data("jplayer").target,{}),n=new jPlayerPlaylist({jPlayer:"#jquery_jplayer_2",cssSelectorAncestor:"#jp_container_2"},[],{swfPath:"js/jplayer",supplied:"oga, mp3,wav",wmode:"window",useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!0,keyEnabled:!0}),r={title:t.title,mp3:contextPath+t.value,ogg:contextPath+t.value,wav:contextPath+t.value};n.add(r)},linkageControl:function(e,t){var a=pubsub.getJQObj(e.outid,!0).data("jplayer");a.target.find("#jquery_jplayer_2").jPlayer("clearMedia"),a.target.find("ul").empty(),$.ajax({url:a.option.read.url,async:a.option.read.async,data:JSON.stringify(a.option.read.data),type:"post",dataType:"JSON",contentType:"application/json",success:function(e){var t=a._convertData(e[0].data,a.option);$.each(t,function(e,t){a.option.config.add(t)})}})},refresh:function(e,t){var a=pubsub.getJQObj(e.outid,!0).data("jplayer");a.target.find("#jquery_jplayer_2").jPlayer("clearMedia"),a.target.find("ul").empty(),$.ajax({url:a.option.read.url,async:a.option.read.async,data:JSON.stringify(a.option.read.data),type:"post",dataType:"JSON",contentType:"application/json",success:function(e){var t=a._convertData(e[0].data,a.option);$.each(t,function(e,t){a.option.config.add(t)})}})}};pubsub.sub("jplayer",jplayerFunc);var dojoConfig={parseOnLoad:!0,cacheBust:!0,packages:[{name:"myModules",location:contextPath+"/scripts/arcgis"}]},jsGisFunc={getNode:function(e,t){return"point"==e.param?"":t[0].graphic.symbol.data[e.columnName]||""},_gallery:function(e,t,a,n,r,i,o){if(jsgistb=new esri.toolbars.Draw(r),i){var s=$('<div style="position:absolute; z-Index:99;"><div data-dojo-type="dijit.TitlePane" id="dijit_TitlePane_0" data-dojo-props="title:\'切换地图\',open:false"><div data-dojo-type="dijit.layout.ContentPane" style="overflow:auto;"><div id="basemapGallery"></div></div></div></div>');o&&s.css(JSON.parse(o)),$("#"+r.id).append(s);var l=new e({showArcGISBasemaps:!1,map:r},"basemapGallery"),u=JSON.parse(i);$.each(u,function(e,n){var r=new t({url:n.mapUrl}),i=new a({layers:[r],title:n.name,thumbnailUrl:contextPath+n.thumbnailUrl});l.add(i)}),$("body").on("mouseover","#dijit_TitlePane_0",function(e){$(this).find(".dijitTitlePaneContentOuter").show(),$(this).find(".dijitReset").show()}).on("mouseleave","#dijit_TitlePane_0",function(e){$(this).find(".dijitTitlePaneContentOuter").hide(),$(this).find(".dijitReset").hide()}),l.startup(),n.connect(l,"onError",function(e){console.log(e)})}},_convert:function(e,t,a){var n,r,i=t.length,o="key"==a?"'":"";if(i)for(var s=0;s<i;s++){n=t[s];for(var l in n){var u=l.split("_0_")[1];r=new RegExp("##"+u+"##","gm"),e=e.replace(r,o+n[l]+o)}}return e.replace(/\\"/gm,"'").replace(/##col\w*##/gm,"key"==a?"''":"").replace(/##\w*##/gm,"key"==a?"''":"")},_getParamName:function(e,t,a){if(a){if(e.rules){var n,r,i,o=JSON.parse(e.rules),s="";for(var l in o)if(n=o[l])for(u=0;u<n.length;u++)(i=t[(r=n[u]).columnName])&&(s+=r.param+"="+i+"&");return s}return""}for(var u=0;u<e.length;u++){o=e[u];if(t.urlId==o.outid)return o.param}return""},_jsGisDraw:function(e,t,a){var n=getUrlToSplitter()+contextPath+"/mx/form/page/viewPage?id=";dojo.connect(jsgistb,"onDrawEnd",function(r){var i="",o=r,s=r.type;"point"===s||"multipoint"===s?i=jsgistb.markerSymbol:"line"===s||"polyline"===s?(o.x=r.paths[0][0][0],o.y=r.paths[0][0][1],i=jsgistb.lineSymbol):i=jsgistb.fillSymbol,e.graphics.add(new esri.Graphic(r,i));for(var l={type:s,source:JSON.stringify(r.toJson())},u=[],c=0;c<t.length;c++){var d=t[c];if(d.type==s&&"all"!=d.type){b="&"+jsGisFunc._getParamName(a,d)+"="+JSON.stringify(l).replace(/\\"/gm,'\\\\"').replace(/"/gm,'\\"');return void(d.urlId&&jsGisFunc.jsGisShowInfoWindow(e,o,d.title,n+d.urlId+b,d.width,d.height))}"all"==d.type&&u.push(d)}if(u)for(c=0;c<u.length;c++){var p=u[c],b="&"+jsGisFunc._getParamName(a,p)+"="+JSON.stringify(l).replace(/\\"/gm,'\\\\"').replace(/"/gm,'\\"');p.urlId&&jsGisFunc.jsGisShowInfoWindow(e,o,p.title,n+p.urlId+b,p.width,p.height)}})},_initType:function(data,rules){for(var ees=[],k=0;k<rules.length;k++){var ee=rules[k],key=jsGisFunc._convert(ee.exp,[data],"key");eval(key)&&ees.push(ee)}return ees},_init:function(e,t,a,n,r){e.rules=a;var i={},o={},s=[];e.strokeGraphics||(e.strokeGraphics=[]),e.defaultGraphics||(e.defaultGraphics=[]),e.prevStorage||(e.prevStorage=[]);for(var l=0;l<t.length;l++)for(var u=t[l].data,c=0;c<u.length;c++)for(var d=u[c],p=d[n.x],b=jsGisFunc._initType(d,a),f=0;f<b.length;f++){var g=b[f];if(g.column&&(p=d[g.column]),p)try{var m,h=JSON.parse(p.replace(/\\&quot;/gi,'"').replace(/\\\\/gi,"\\")),v=!!h.flag;m=JSON.parse(h.source);var y=null,x=null,w=!1;if("point"==h.type)w=!0,y=new esri.symbol.PictureMarkerSymbol(contextPath+g.icon,g.iconWidth||20,g.iconHeight||20),x=new esri.geometry.Point(m);else if("polyline"==h.type)y=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(g.lineColor||[255,0,0]),g.lineWidth||2),x=new esri.geometry.Polyline(m);else if("polygon"==h.type){var j=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(g.lineColor||[255,0,0]),g.lineWidth||2);y=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,j,new esri.Color(g.lineColor||[255,0,0])),x=new esri.geometry.Polygon(m)}v&&(x=esri.geometry.geographicToWebMercator(x)),y.data=d,y.rule=g,y.rules=a,y.column=g.column;var k=new esri.Graphic(x,y);"true"==g.isShow?w?s.push(k):e.defaultGraphics.push(k):k.visible=!1,e.strokeGraphics.push(k)}catch(e){if(p){var O=p.split(",");$.each(O,function(e,t){var a={},n=t.split("-");a.id=n[1],o[n[0]]||(o[n[0]]=[]),-1==$.inArray(a.id,o[n[0]])&&o[n[0]].push(a.id),a.layerId=n[0],a.data=d,a.rule=g,a.column=g.column,(i[n[0]]||(i[n[0]]={}))&&(i[n[0]][a.id]||(i[n[0]][a.id]=[])),i[n[0]][a.id].push(a)})}}}if($.isEmptyObject(i))$.merge(e.defaultGraphics,s),$.each(e.defaultGraphics,function(t,a){e.graphics.add(a),e.workingStorage.push(a);var n=$.extend({},a),r=n.symbol,i=r.rule;if(i&&"true"==i.isShow&&("true"==i.isSort||i.showColumn)&&"point"==a.geometry.type){var o=new jsgisMap.esri.symbol.TextSymbol("true"==i.isSort?count++:r.data[i.showColumn]||"");if(o.rule=r.rule,o.data=r.data,o.column=r.column,o.url=o.url,i.sortSize){var s=new e.esri.symbol.Font;s.setSize(i.sortSize),o.setFont(s)}if(i.sortColor){var l=new e.esri.Color(i.sortColor);o.setColor(l)}var u=i.sortOffset;if(u)try{var c=u.split(",");o.setOffset(parseFloat(c[0]),parseFloat(c[1]))}catch(e){console.log(e)}(n=new e.esri.Graphic(n.geometry,o)).visible=!0,n.isText=!0,e.graphics.add(n),e.workingStorage.push(n),e.prevStorage.push(n)}}),mapCb&&mapCb.fire();else{var S,T=new esri.tasks.Query;T.outFields=["*"],T.returnGeometry=!0;var F=Object.getOwnPropertyNames(o).length,c=0;for(var C in o)(S=new esri.tasks.QueryTask(r+"/"+C)).layerId=C,T.where=" fid in ("+o[C].join(",")+") ",S.on("complete",function(t){c++;var a=i[t.target.layerId];$.each(t.featureSet.features,function(t,n){$.each(a[n.attributes.FID],function(t,a){var r=$.extend({},n);if(a.id==r.attributes.FID){var i=r.geometry.type,o=a.rule;if(w=!1,isPolygon=!1,"point"==i)w=!0,y=new esri.symbol.PictureMarkerSymbol(contextPath+o.icon,o.iconWidth||20,o.iconHeight||20);else if("polyline"==i)y=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(o.lineColor||[255,0,0]),o.lineWidth||2);else if("polygon"==i){isPolygon=!0;var l=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(o.lineColor||[255,0,0]),o.lineWidth||2);y=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,l,new esri.Color(o.lineColor||[255,0,0]))}if((u=o.toffset)&&w)try{var u=u.split(",");y.setOffset(parseFloat(u[0]),parseFloat(u[1]))}catch(e){console.log(e)}y.id=a.id,y.data=a.data,y.rule=o,y.column=a.column,y.layerId=a.layerId,r.setSymbol(y),"true"==o.isShow?w?s.push(r):isPolygon?e.graphics.add(r):e.defaultGraphics.push(r):r.visible=!1,e.strokeGraphics.push(r),e.prevStorage.push(r)}})}),c==F&&($.merge(e.defaultGraphics,s),$.each(e.defaultGraphics,function(t,a){e.graphics.add(a),e.workingStorage.push(a);var n=$.extend({},a),r=n.symbol,i=r.rule;if(i&&"true"==i.isShow&&("true"==i.isSort||i.showColumn)&&"point"==a.geometry.type){var o=new jsgisMap.esri.symbol.TextSymbol("true"==i.isSort?count++:r.data[i.showColumn]||"");if(o.rule=r.rule,o.data=r.data,o.column=r.column,o.url=o.url,i.sortSize){var s=new e.esri.symbol.Font;s.setSize(i.sortSize),o.setFont(s)}if(i.sortColor){var l=new e.esri.Color(i.sortColor);o.setColor(l)}var u=i.sortOffset;if(u)try{var c=u.split(",");o.setOffset(parseFloat(c[0]),parseFloat(c[1]))}catch(e){console.log(e)}(n=new e.esri.Graphic(n.geometry,o)).visible=!0,n.isText=!0,e.graphics.add(n),e.workingStorage.push(n),e.prevStorage.push(n)}}),mapCb&&mapCb.fire())}),S.execute(T)}},jsGisShowInfoWindow:function(e,t,a,n,r,i){e.infoWindow.resize(r.replace(/px||%/gm,""),parseInt(i.replace(/px||%/gm,""))+10),e.infoWindow.setTitle(a),e.infoWindow.setContent("<iframe frameborder='no' border='0' marginwidth='0' marginheight='0' src='"+n+"' style='width:100%;height:"+i+";'></iframe>"),e.infoWindow.show(t,e.getInfoWindowAnchor(t));var o={};return o.width=r.replace(/px||%/gm,""),o.height=i.replace(/px||%/gm,""),o},getCoord:function(e,t){jsGisFunc._jsGisDraw(t[0],t[1],t[2])},clickEvent:function(map,e,clickEvent){var symbol=e.symbol||e.graphic.symbol,symdata=symbol.data,objs=[],ee=symbol.rule,key=jsGisFunc._convert(ee.exp,[symdata],"key");if(eval(key)&&symbol.column==ee.column&&ee.urlId){var trul=getUrlToSplitter()+contextPath+"/mx/form/page/viewPage?id="+ee.urlId+"&"+jsGisFunc._getParamName(ee,symdata,"c"),point=clickEvent;clickEvent||"line"!==(point=e.screenPoint||e.geometry).type&&"polyline"!==point.type||(point.x=point.paths[0][0][0],point.y=point.paths[0][0][1]);var obj=jsGisFunc.jsGisShowInfoWindow(map,point,ee.windowName,trul,ee.windowWidth,ee.windowHeight);objs.push(obj)}return objs},_bindEventType:function(e,t,a){var n=e.data(t);n&&n.length&&$.each(n,function(e,t){t(a)})},_bindEvent:function(e){e.graphics.on("click",function(t){jsGisFunc._bindEventType($("#"+e.id),"clickEventList",t)}),e.graphics.on("dbl-click",function(t){jsGisFunc._bindEventType($("#"+e.id),"dbclickList",t)}),e.graphics.on("mouse-over",function(t){jsGisFunc._bindEventType($("#"+e.id),"mouseoverList",t)}),e.graphics.on("mouse-up",function(t){jsGisFunc._bindEventType($("#"+e.id),"mouseupList",t)})},initDataAndClick:function(e,t,a,n,r){$.ajax({type:"POST",url:contextPath+"/mx/form/charts/datas",contentType:"application/json",dataType:"json",data:JSON.stringify({rid:a}),success:function(a){jsGisFunc._bindEvent(e),jsGisFunc._init(e,a,t,n,r)},error:function(e){alert("数据获取错误")}})},_clearGis:function(e,t,a){if(!a&&(t.infoWindow&&t.infoWindow.isShowing&&t.infoWindow.hide(),e.length>0)){clearInterval(t.timer);for(var n=0;n<e.length;n++){var r=e[n],i=r.symbol,o=i.rule;o&&o.isShow,o||(o={}),t.graphics.remove(r);var s=r.geometry.type;"textsymbol"==i.type||"line"!=s&&"polyline"!=s?i.type:(r.symbol.color=new t.BColor(o.lineColor||[255,0,0]),r.symbol.width=o.lineWidth,r.draw(),r.isFlicker&&(r.isFlicker=!1))}e.length=0}},isExtis:function(e,t,a,n){return e&&t.columnName&&e.column==t.columnName&&(e.data[t.columnName].split(",").length>1?-1!=a.indexOf(e.data[t.columnName]):-1!=$.inArray(e.data[t.columnName],n))},_eventFunc:function(e,t,a,n,r){var i=jsGisFunc.getMap(e),o=(pubsub.getJQObj(e),i.workingStorage),s=i.prevStorage=[];r||jsGisFunc._clearGis(o,i,t.remit);for(var l=i.strokeGraphics,u=[],c=t._col,d=t._col_p,p=0,b=l.length;p<b;p++){var f=l[p],g=f.symbol;for(var m in t)if("zoom"!=m&&"point"!=m&&"remit"!=m&&"_col"!=m&&"_col_p"!=m){var h=jsGisFunc.getRule(e,m),v=t[m],y=(v+"").split(",");jsGisFunc.isExtis(g,h,v,y)&&(!c||!d||c&&d&&g.data[c]==d)&&(o.push(f),s.push(f),"point"==f.geometry.type?u.push(f):i.graphics.add(f),n.call(this,f,i,g,a,u))}}u&&u.length&&$.each(u,function(e,t){i.graphics.add(t)})},_flicker:function(e){var t=e.workingStorage;t.length>0&&(e.timer=setInterval(function(){for(var e=0;e<t.length;e++)!t[e].isText&&t[e].isFlicker&&(t[e].visible?t[e].hide():t[e].show())},e.flicker||500))},highlightingGis:function(e,t,a){jsGisFunc._eventFunc(e,t,a,function(e,t,a){var n=e.geometry.type;"line"!=n&&"polyline"!=n||(syrule=e.symbol.rule,e.symbol.color=new t.BColor(syrule.highlightColor||[255,0,0]),e.symbol.width=syrule.highlightWidth,e.draw()),e.show()})},flickerGis:function(e,t,a){var n=jsGisFunc.getMap(e);jsGisFunc._eventFunc(e,t,a,function(e,t,a){e.show(),e.isFlicker=!0}),jsGisFunc._flicker(n)},flickerAndHighlightingGis:function(e,t,a){var n=jsGisFunc.getMap(e);jsGisFunc._eventFunc(e,t,a,function(e,t,a){var n=e.geometry.type;"line"!=n&&"polyline"!=n||(syrule=e.symbol.rule,e.symbol.color=new t.BColor(syrule.highlightColor||[255,0,0]),e.symbol.width=syrule.highlightWidth,e.draw()),e.isFlicker=!0,e.show()}),jsGisFunc._flicker(n)},showAndHideLastGis:function(e,t,a){$.each(jsgisMap.prevStorage,function(e,t){var a=t.symbol,n=a.rule;jsgisMap.graphics.remove(t),jsgisMap.strokeGraphics.removeObj(t);var r=t.geometry.type;"textsymbol"==a.type||"line"!=r&&"polyline"!=r||(t.symbol.color=new jsgisMap.BColor(n.lineColor||[255,0,0]),t.symbol.width=n.lineWidth,t.draw(),t.isFlicker&&(t.isFlicker=!1))}),jsgisMap.prevStorage.length=0,jsGisFunc._eventFunc(e,t,a,function(e,t,a){e.visible?e.hide():e.show()},!0)},showAndHideGis:function(e,t,a){jsGisFunc._eventFunc(e,t,a,function(e,t,a){e.visible?(e.isFlicker=!1,e.hide()):e.show()},!0)},hideGis:function(e,t,a){jsGisFunc._eventFunc(e,t,a,function(e,t,a){e.visible&&(e.isFlicker=!1,e.hide())},!0)},locateAndShowWindow:function(e,t,a){var n=pubsub.getJQObj(e),r=n.data("isZoom")?1e3:0;setTimeout(function(){jsGisFunc._eventFunc(e,t,a,function(e,t,r,i){var o=a&&a.length>1&&a[1]?a[0].mapPoint:"";0==e.visible&&e.show();var s=jsGisFunc.clickEvent(t,e,n.data("isZoom")?e.geometry:o),l=o;o||"line"!==(l=e.geometry).type&&"polyline"!==l.type||(l.x=l.paths[0][0][0],l.y=l.paths[0][0][1]);var u=t.toScreen(l),c=s[0]?s[0].width:0,d=s[0]?s[0].height:0,p=r.rule.offset||0;u.x=u.x-(n.width()/2-c-80)+p,u.y=u.y+(n.height()/2-d-80),t.centerAt(t.toMap(u))},!0),n.data("isZoom",!1)},r)},showAndHideOtherGis:function(e,t,a){$id=pubsub.getJQObj(e);var n=jsGisFunc.getMap(e),r=n.graphics.graphics,i=n.workingStorage;jsGisFunc._clearGis(i,n,t.remit);for(var o=0,s=r.length;o<s;o++)r[o].hide();n.count=1,jsGisFunc._eventFunc(e,t,a,function(e,t,a,n,r){var i=a.rule,o=e.geometry.type;if(e.show(),i&&("true"==i.isSort||i.showColumn)&&"line"!=o&&"polyline"!=o){var s=new t.esri.symbol.TextSymbol("true"==i.isSort?t.count++:a.data[i.showColumn]||"");if(s.rule=a.rule,s.rules=a.rules,s.data=a.data,s.column=a.column,s.url=s.url,i.sortSize){var l=new t.esri.symbol.Font;l.setSize(i.sortSize),s.setFont(l)}if(i.sortColor){var u=new t.esri.Color(i.sortColor);s.setColor(u)}var c=i.sortOffset;if(c)try{var d=c.split(",");s.setOffset(parseFloat(d[0]),parseFloat(d[1]))}catch(e){console.log(e)}var p=new t.esri.Graphic(e.geometry,s);p.visible=!0,p.isText=!0,r.push(p),t.workingStorage.push(p),t.prevStorage.push(p)}})},zoomGis:function(e,t,a){$id=pubsub.getJQObj(e),$id.data("isZoom",!0);var n=jsGisFunc.getMap(e),r=t.zoom?t.zoom:8;for(var i in t)if("zoom"!=i&&"point"!=i)for(var o=jsGisFunc.getRule(e,i),s=t[i],l=(s+"").split(","),u=0,c=n.graphics.graphics.length;u<c;u++){var d=n.graphics.graphics[u],p=d.symbol;if(p&&p.column==o.columnName&&(p.data[o.columnName].split(",").length>1?-1!=s.indexOf(p.data[o.columnName]):-1!=$.inArray(p.data[o.columnName],l))){var b=d.geometry;if("line"===b.type||"polyline"===b.type){var f=b.getExtent().getCenter();b.x=f.x,b.y=f.y}n.centerAt(b),setTimeout(function(){n.setZoom(r)},300)}}},previewGis:function(e,t,a){var n=jsGisFunc.getMap(e),r=new esri.tasks.FindTask(n.jsgisUrl),i=new esri.tasks.FindParameters;i.contains=!1,i.returnGeometry=!0,n.graphics.clear();for(var o in t){var s=t[o].split("-");2==s.length&&(i.layerIds=[parseInt(s[0])],i.searchFields=["FID"],i.searchText=parseInt(s[1]),r.execute(i,function(e){for(var t,a,r,i=0,o=e.length;i<o;i++)"point"==(a=(r=e[i].feature).geometry.type)?(t=new esri.symbol.SimpleMarkerSymbol).setColor(new esri.Color([255,0,0,.5])):"polyline"==a&&(t=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([255,0,0]),2)),r.setSymbol(t),r.visible=!0,n.graphics.add(r)}))}},initExtent:function(e,t){var a=jsGisFunc.getMap(e);a.setExtent(a.Extent(a.initExtent))},hideWindow:function(e,t){jsGisFunc.getMap(e).infoWindow.hide()},getRule:function(e,t){for(var a=0;a<e.length;a++){var n=e[a];if(n.param==t)return n}},getMap:function(rs,isIn){if("object"==typeof rs){var rules=[];$.isArray(rs)?rules=rs:rules.push(rs);var that=pubsub.getThat(rules,isIn),rule=rules[0],id=isIn?rule.inid:rule.outid;if(that)return that.eval(id+"Map")}return eval(rs+"Map")},showTrack:function(e,t){var a=jsGisFunc.getMap(e),n=a.workingStorage,r=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([255,0,0]),4),i=t[e[0].param];if(jsGisFunc._clearGis(n,a,t.remit),i&&(i=JSON.parse(i))){var o=new esri.geometry.Polyline(i),s=new esri.Graphic(o,r),l=s.geometry.getExtent().getCenter();a.graphics.add(s),s.isFlicker=!0,n.push(s),a.centerAt(new esri.geometry.Point([l.x,l.y]))}jsGisFunc._flicker(a)}};pubsub.sub("jsgis",jsGisFunc),function(){!function(e){window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){e(WebViewJavascriptBridge)},!1)}(function(e){if(e.init){e.init(function(e,t){t({"Javascript Responds":"Wee!"})});window.open,window.close;window.open=function(){var e=[].slice.call(arguments);window.WebViewJavascriptBridge.callHandler("openWindow",{url:e[0]},function(e){})},window.close=function(){[].slice.call(arguments);window.WebViewJavascriptBridge.callHandler("closeWindow",{},function(e){})},e.registerHandler("scanCallback",function(e,t){var a=$("body").data("scanCallback");a&&a.call(null,e)})}})}();var videoplayFunc={setVideoSource:function(e,t){for(var a,n=pubsub.getJQObj(e),r=0;r<e.length;r++)a=t[e[r].param];var i={src:a,type:"video/"+a.substring(a.lastIndexOf(".")+1)};n.videoExt("setVideoSource",i)},setVideoPreImg:function(e,t){for(var a,n=pubsub.getJQObj(e),r=0;r<e.length;r++)a=t[e[r].param];var i={src:a,type:"video/"+a.substring(a.lastIndexOf(".")+1)};n.videoExt("setVideoPreImg",i)}};pubsub.sub("videoplay",videoplayFunc);var definedcardFunc={getSelectRow:function(e,t){return pubsub.getJQObj(e,!0).definedCardExt("getSelectRow")[e.columnName]},getAll:function(e,t){var a=pubsub.getJQObj(e,!0);if(a){var n,r=[],i=a.data("gridList").getData();if(i){for(var o=0;o<i.length;o++)n=i[o],r.push(n[e.columnName]||"");return r.join(",")}}return""},refresh:function(e,t){pubsub.getJQObj(e).definedCardExt("refresh")},linkage:function(e,t){t.databaseId&&pubsub.getJQObj(id).attr("dbid",t.databaseId);pubsub.getJQObj(e).definedCardExt("linkage",t)}};pubsub.sub("definedcard",definedcardFunc);var mapextFunc={getClickNode:function(e,t){if(t)return"seriesName"==e.columnName?t[0].seriesName:t[0].data[e.columnName]}};pubsub.sub("mapext",mapextFunc);var rangeSliderFunc={setValue:function(e,t){pubsub.getJQObj(e,!1);var a=new Array;for(key in t)a.push(t[key]);if(1==a.length){var n=$("#range").data("ionRangeSlider"),r=Number(a[0]);n.reset(),n.update({from:r})}else{var n=$("#range").data("ionRangeSlider"),r=Number(a[0]),i=Number(a[1]);n.reset(),n.update({from:r,to:i})}},getRightValue:function(e,t){return pubsub.getJQObj(e,!0).find(".irs-to").text()},getLeftValue:function(e,t){return pubsub.getJQObj(e,!0).find(".irs-single").text()}};pubsub.sub("rangeSlider",rangeSliderFunc);var fullpageFunc={movesectionUp:function(){$.fn.fullpage.moveSectionUp()},movesectionDown:function(){$.fn.fullpage.moveSectionDown()},moveSlideLeft:function(){$.fn.fullpage.moveSlideLeft()},moveSlideRight:function(){$.fn.fullpage.moveSlideRight()}};pubsub.sub("fullpage",fullpageFunc);var promptFunc={};pubsub.sub("prompt",promptFunc);var popoverFunc={};pubsub.sub("popover",popoverFunc);var imageFunc={setAttachmentId:function(e,t){var a=pubsub.getJQObj(e),n="";if($.each(t,function(e,t){n=t}),n){var r=contextPath+"/mx/form/imageUpload?method=downloadById&_"+(new Date).getTime()+"&id="+n;a.attr("src",r).show()}},setAttachmentParent:function(e,t){var a=pubsub.getJQObj(e),n="";if($.each(t,function(e,t){n=t}),n){var r=contextPath+"/mx/form/imageUpload?method=download&from=to_db&"+(new Date).getTime()+"&randomparent="+n;a.attr("src",r).show()}}};pubsub.sub("image",imageFunc);var definedButtonFunc={binding:function(e,t,a){pubsub.getJQObj(e);var n=e.outid;n||(n=e[0].outid);var r=e.trigger.eleId,i=$("#"+r).clone(),o=a[0].promptmessage,s=a[0].titile;s||(s=t.title),i.attr("id",""),s?$("#"+n).tooltip({title:s,placement:o,html:!0,template:i}):(i.find(".tooltip-inner").remove(),$("#"+n).tooltip({title:"z",placement:o,html:!0,template:i}))},setValue:function(e,t){var a=pubsub.getJQObj(e);$.each(t,function(e,t){a.find("span.frame-variable")[0].innerHTML=t})},copyMtButon:function(e,t){var a=pubsub.getJQObj(e),n=a.parent().parent(),r=a.parent().parent().parent();$.each(t,function(e,t){if(-1!=t.toString().indexOf(","))for(var a=t.toString().split(","),i=0;i<a.length;i++){n.before(n[0].outerHTML),$(r.find("div.row")[i]).css("display","block"),$(r.find("div.row")[i]).find("span")[0].innerHTML=a[i],(s=$("<span>").addClass("ui-icon ui-icon-close"))[0].innerHTML="x";o=$(r.find("div.row")[i]);s.attr({style:"cursor:pointer;float:right;position:absolute;top:2px;right:8px;color:#66C8F2;font-weight: bolder;font-size: 12px;display:none"}).bind("click",function(e){o.remove()}),s.appendTo(o),o.mouseover(function(){o.on("mouseover",function(e){o.find("span.ui-icon-close").css("display","block")})}),o.mouseout(function(){o.on("mouseout",function(e){o.find("span.ui-icon-close").css("display","none")})})}else{n.before(n[0].outerHTML),$(r.find("div")[0]).css("display","block"),r.find("div").find("span")[0].innerHTML=t;var o=$(r.find("div")[0]),s=$("<span>").addClass("ui-icon ui-icon-close");s[0].innerHTML="x",s.attr({style:"cursor:pointer;float:right;position:absolute;top:2px;right:10px;color:#66C8F2;font-weight: bolder;font-size: 12px;display:none"}).bind("click",function(e){o.remove()}),s.appendTo(o.find("div")),o.find("div").mouseover(function(){o.find("div").on("mouseover",function(e){o.find("div").find("span.ui-icon-close").css("display","block")})}),o.find("div").mouseout(function(){o.find("div").on("mouseout",function(e){o.find("div").find("span.ui-icon-close").css("display","none")})})}})},copyMtButon:function(e,t){var a=pubsub.getJQObj(e),n=a.parent().parent(),r=a.parent().parent().parent();$.each(t,function(e,t){if(-1!=t.toString().indexOf(","))for(var a=t.toString().split(","),i=0;i<a.length;i++){n.before(n[0].outerHTML),$(r.find("div.row")[i]).css("display","block"),$(r.find("div.row")[i]).find("span")[0].innerHTML=a[i],(s=$("<span>").addClass("ui-icon ui-icon-close"))[0].innerHTML="x";o=$(r.find("div.row")[i]);s.attr({style:"cursor:pointer;float:right;position:absolute;top:2px;right:8px;color:#66C8F2;font-weight: bolder;font-size: 12px;display:none"}).bind("click",function(e){o.remove()}),s.appendTo(o),o.mouseover(function(){o.on("mouseover",function(e){o.find("span.ui-icon-close").css("display","block")})}),o.mouseout(function(){o.on("mouseout",function(e){o.find("span.ui-icon-close").css("display","none")})})}else{n.before(n[0].outerHTML),$(r.find("div")[0]).css("display","block"),r.find("div").find("span")[0].innerHTML=t;var o=$(r.find("div")[0]),s=$("<span>").addClass("ui-icon ui-icon-close");s[0].innerHTML="x",s.attr({style:"cursor:pointer;float:right;position:absolute;top:2px;right:10px;color:#66C8F2;font-weight: bolder;font-size: 12px;display:none"}).bind("click",function(e){o.remove()}),s.appendTo(o.find("div")),o.find("div").mouseover(function(){o.find("div").on("mouseover",function(e){o.find("div").find("span.ui-icon-close").css("display","block")})}),o.find("div").mouseout(function(){o.find("div").on("mouseout",function(e){o.find("div").find("span.ui-icon-close").css("display","none")})})}})},bindpopover:function(e,t,a){pubsub.getJQObj(e);var n=e.outid;n||(n=e[0].outid);var r=e.trigger.eleId,i=$("#"+r),o=a[0].promptmessage,s=a[0].titile;s||(s=t.title);var l=a[0].content;l||(content=t.content),i.attr("id",""),!s&&i.find(".popover-title").remove(),!l&&i.find(".popover-content").remove(),$("#"+n).popover({title:s||"x",content:l||"x",placement:o,html:!0,template:i})}};pubsub.sub("definedButton",definedButtonFunc);var editorFunc={init:function(e,t){var a=t[0];$("#"+e.inid).summernote(a),$("#"+e.inid).next()[0].style.display=t[0].display},getValue:function(e,t){var a=pubsub.getJQObj(e,!0),n=UE.getEditor(a[0].id).getContent();return n=void 0!=n&&""!=n?n.replace(/"/g,"'"):n},destroy:function(e,t){pubsub.getJQObj(e).destroy()},tclear:function(e,t){var a=pubsub.getJQObj(e);UE.getEditor(a[0].id).setContent("")},setValue:function(e,t){var a=pubsub.getJQObj(e),n="";if("object"==typeof t){for(var r=0;r<e.length;r++)n=t[e[r].param]||"";a.parents().find(".note-editable p").append(n)}else a.parents().find(".note-editable p").append(n)}};pubsub.sub("editor",editorFunc);var wyvideoFunc={linkage:function(e,t,a){var n=pubsub.getJQObj(e);for(var r in t){var i=t[r];i&&n.wyvideo("play",i)}}};pubsub.sub("wyvideo",wyvideoFunc);var formFunc={};pubsub.sub("form",formFunc);var webchatFunc={linkage:function(e,t,a){var n=pubsub.getJQObj(e);"roomId"in t&&n.webchat("reload",t.roomId)},sendMsg:function(e,t,a){var n=pubsub.getJQObj(e);for(var r in t)t[r]&&n.webchat("sendMsg",t[r])}};pubsub.sub("webchat",webchatFunc);var phoneListViewFunc={getAll:function(){var e=pubsub.getJQObj(rule,!0);if(e){var t,a=[],n=e.data("phoneListView").getData();if(n){for(var r=0;r<n.length;r++)t=n[r],a.push(t[rule.columnName]||"");return a.join(",")}}return""}};pubsub.sub("phoneListView",phoneListViewFunc);var alivideoFunc={linkage:function(e,t,a){var n=pubsub.getJQObj(e);for(var r in t){var i=t[r];i&&n.alivideo("roomId"==r?"playByRoomId":"play",i)}}};pubsub.sub("alivideo",alivideoFunc);var phoneTimePickerFunc={setValue:function(e,t){var a=pubsub.getJQObj(e);$.each(t,function(e,t){a.data("phoneTimePicker").setValue(t)})},tdisabled:function(e,t){pubsub.getJQObj(e).data("phoneTimePicker").tdisabled()},thidden:function(e,t){pubsub.getJQObj(e).data("phoneTimePicker").thidden()},getValue:function(e,t){return console.log($("#"+e.inid).find(".weui-input").val()),$("#"+e.inid).find(".weui-input").val()}};pubsub.sub("phoneTimePicker",phoneTimePickerFunc);var searchbarFunc={setValue:function(e,t){var a=pubsub.getJQObj(e);$.each(t,function(e,t){a.data("searchbar").setValue(t)})},appendSetValue:function(e,t){var a=pubsub.getJQObj(e);$.each(t,function(e,t){a.data("searchbar").appendSetValue(t)})},tdisabled:function(e,t){pubsub.getJQObj(e).data("searchbar").tdisabled()},tenabled:function(e,t){pubsub.getJQObj(e).data("searchbar").tenabled()},thidden:function(e,t){pubsub.getJQObj(e).data("searchbar").thidden()},tshow:function(e,t){pubsub.getJQObj(e).data("searchbar").tshow()}};pubsub.sub("searchbar",searchbarFunc);var loadMoreFunc={thidden:function(e,t){pubsub.getJQObj(e).data("loadMore").thidden()},tshow:function(e,t){pubsub.getJQObj(e).data("loadMore").tshow()}};pubsub.sub("loadMore",loadMoreFunc);var bmapextFunc={setLocationByGps:function(e,t){pubsub.getJQObj(e).bmapext("setLocationByGps")},setLocationMarker:function(e,t){pubsub.getJQObj(e).bmapext("setLocationMarker")},getLocationMarkerPosition:function(e,t){return pubsub.getJQObj(e,!0).bmapext("getLocationMarkerPosition")},clearOverlays:function(e,t){return pubsub.getJQObj(e).bmapext("clearOverlays")},setZoom:function(e,t){var a=pubsub.getJQObj(e),n=null;$.each(t,function(e,t){n=t}),n&&a.bmapext("setZoom",n)},setMarkerByGps:function(rule,params){var $this=pubsub.getJQObj(rule),point=null;if($.each(params,function(e,t){point=t}),point){if("string"==typeof point)try{point=JSON.parse(point)}catch(e){point=eval(point)}$this.bmapext("setMarkerByGps",point)}},setMarkerAndPanto:function(rule,params){var $this=pubsub.getJQObj(rule),point=null;if($.each(params,function(e,t){point=t}),point){if("string"==typeof point)try{point=JSON.parse(point)}catch(e){point=eval(point)}$this.bmapext("setMarkerAndPanto",point)}},setDragAble:function(e,t){var a=pubsub.getJQObj(e),n=null;$.each(t,function(e,t){n=t}),n&&(n=eavl(n))&&a.bmapext("setDragAble",n)},setDragRange:function(e,t){var a=pubsub.getJQObj(e),n=null;$.each(t,function(e,t){n=t}),n&&(n=eavl(n))&&a.bmapext("setDragRange",n)},setKeyWrods:function(e,t){var a=[];$.each(t,function(e,t){t&&$.merge(a,t.split(","))}),pubsub.getJQObj(e).bmapext("setKeyWrods",a)},setSearchRange:function(e,t){var a;$.each(t,function(e,t){a=t}),pubsub.getJQObj(e).bmapext("setSearchRange",a)},showSearchPanel2:function(e,t){pubsub.getJQObj(e).bmapext("setSearchPanelStatus",!0)},hideSearchPanel:function(e,t){pubsub.getJQObj(e).bmapext("setSearchPanelStatus",!1)},getMarkerAddress:function(e,t){return pubsub.getJQObj(e,!0).bmapext("getMarkerAddress")},getAddressTitle:function(e,t){return pubsub.getJQObj(e,!0).bmapext("getAddressTitle")}};pubsub.sub("bmapext",bmapextFunc);var cellWebCabFunc={linkageControl:function(e,t){var a=pubsub.getJQObj(e),n={};$.each(t,function(e,t){n[e]=t}),a.data("cellWebCab").__linkageControl(n)}};pubsub.sub("cellWebCab",cellWebCabFunc);var reviewAreaFunc={getClickRowData:function(e,t){return pubsub.getJQObj(e,!0).reviewArea("getClickRowData")[e.columnName]},getAllData:function(e,t){var a=pubsub.getJQObj(e,!0).reviewArea("getAllData"),n=[];if(a&&a.length)return $.each(a,function(t,a){a[e.columnName]&&n.push(a[e.columnName]||"")}),n.join(",")},linkage:function(e,t){pubsub.getJQObj(e).reviewArea("query",t)},expandNode:function(e,t){var a=pubsub.getJQObj(e),n=(t[e[0].param],t.key);n=n||"id";var r="";$.each(e,function(a,n){if("key"==e[a].param)return!0;r=t[e[a].param]||""}),r&&a.reviewArea("expandNodeByParam",n,r)},getKeyName:function(e,t){return e.columnName}};pubsub.sub("reviewArea",reviewAreaFunc);var scanFunc={getValue:function(e,t){return pubsub.getJQObj(e,!0).scan("getValue")},getParent:function(e,t){return pubsub.getJQObj(e,!0).scan("getParent")},loadFile:function(e,t,a){var n=pubsub.getJQObj(e);for(var r in t)if(t[r])return void n.scan("loadFile",t[r])}};pubsub.sub("scan",scanFunc),function(e,t){function a(a){var n=e.data(a,"bootstrapData"),r=n.options,i=t.observable(r);n.viewModel=i}e.mt=e.mt||{},e.mt.init=function(t,a){if("string"==typeof t.options){var n=e.fn[t.plugin].methods[t.options];return n?n(this,t.param,t.args):this}return t.options=t.options||{},this.each(function(){var n=e.data(this,"bootstrapData");n?e.extend(n.options,t.options):(t.options.target=this,e.data(this,"bootstrapData",{options:t.options,target:this})),a&&a(this)})};var n="mtbootstrap";e.fn[n]=function(t,r){return e.mt.init.call(this,{plugin:n,options:t,param:r,args:arguments},a)},e.fn[n].methods={init:function(t,a,r,i,o){var s=t[n]("getBootstrapData"),l=s.dataRole,u=s.bootstrap,c=e.fn[n].roleFunctions[l];if(c){if(c[a])return c[a].call(u,t,r,o)}else if(i)return i(u)},reload:function(t,a){t.each(function(r,i){var o=e.fn[n].methods.init(t,"reload",a,null);e.extend(o.dataSource.transport.options.read.data,a)})},rebind:function(e){var t=e[n]("getBootstrapData");if(t.bootstrap.destroy){var a=e.clone();e.parent().after(a).remove(),a.mtbootstrap(t.viewModel)}},getValue:function(t,a){return e.fn[n].methods.init(t,"getValue",a,function(e){return t.val()})},getRow:function(t,a){return e.fn[n].methods.init(t,"getRow",a,function(e){return t.val()})},setValue:function(t,a,r){-1!=t.attr("data-role").indexOf("editor")?e.fn[n].methods.init(t,"setValue",a,function(e){},r):(a&&"string"==typeof a&&(a=e("<div>").html(a).text()),e.fn[n].methods.init(t,"setValue",a,function(e){return t.val(a)},r))},disable:function(t,a){e.fn[n].methods.init(t,"disable",function(e){return t.attr("disable",!0)},a)},options:function(e){return e.data("bootstrapData").options},getBootstrapData:function(t){var a=t.data("bootstrapData")||{},n=t.attr("data-role");return e.extend(a,{dataRole:n||"text"})},getViewModel:function(e){return e.data("bootstrapData").viewModel},validate:function(t,a){return e.fn[n].methods.init(t,"validate",a,function(e){})}};var r={textboxbt:{getValue:function(e,t){return e.textboxBtExt("getValue")},setValue:function(e,t,a){t=getMtValue(t,a),e.textboxBtExt("setValue",t)},disable:function(e,t){e.textboxBtExt("disabled",!t)},readOnly:function(e,t){e.textboxBtExt("readable",t)},validate:function(e){return e.valid()}},textareabt:{getValue:function(e,t){return e.textAreaBtExt("getValue")},setValue:function(e,t,a){t=getMtValue(t,a),e.textAreaBtExt("setValue",t)},disable:function(e,t){e.textAreaBtExt("disabled",!t)},readOnly:function(e,t){e.textAreaBtExt("readable",t)}},touchspin:{getValue:function(e,t){return e.touchSpinExt("getValue")},setValue:function(e,t,a){t=getMtValue(t,a),e.touchSpinExt("setValue",t)},disable:function(e,t){e.touchSpinExt("disabled",!t)},readOnly:function(e,t){e.touchSpinExt("readable",t)}},tagsinput:{getValue:function(e,t){return tagsinputObj.getValue(e)},setValue:function(e,t,a){t=getMtValue(t,a),tagsinputObj.getValue(e,t)}},datepickerbt:{getValue:function(e,t){return e.datepickerExt("getValue")},setValue:function(e,t,a){t=getMtValue(t,a),e.datepickerExt("setValue",t)},disable:function(e,t){e.datepickerExt("disabled",!t)},readOnly:function(e,t){e.datepickerExt("readable",t)}},datetimepickerbt:{getValue:function(e,t){return e.datetimepickerExt("getValue")},setValue:function(e,t,a){t=getMtValue(t,a),e.datetimepickerExt("setValue",t)},disable:function(e,t){e.datetimepickerExt("disabled",!t)},readOnly:function(e,t){e.datetimepickerExt("readable",t)}},progressbarbt:{getValue:function(e,t){return e.progressBarExt("getValue")},setValue:function(e,t,a){t=getMtValue(t,a),e.progressBarExt("setValue",t)},disable:function(e,t){e.progressBarExt("disabled",!t)}},metroselect:{getValue:function(e,t){return e.metroselect("getValue")},setValue:function(e,t,a){(t=getMtValue(t,a))&&e.metroselect("prepareSelect",t)},disable:function(e,t){e.metroselect("disabled",!t)},validate:function(e){return e.find("select").valid()}},metroselect_m:{getValue:function(e,t){return e.metroselect_m("getValue")},setValue:function(e,t,a){(t=getMtValue(t,a))&&e.metroselect_m("prepareSelect",t)},disable:function(e,t){e.metroselect_m("disabled",!t)},validate:function(t){return e(t.find("select")[0]).valid()}},icheckbox:{getValue:function(e,t){return e.icheckbox("getValue")},setValue:function(e,t,a){(t=getMtValue(t,a))&&e.icheckbox("setValue",t)},disable:function(e,t){e.icheckbox("disabled",!t)},validate:function(t){return e(t.find("input")[0]).valid()}},icheckradio:{getValue:function(e,t){return e.icheckradio("getValue")},setValue:function(e,t,a){(t=getMtValue(t,a))&&e.icheckradio("setValue",t)},disable:function(e,t){e.icheckradio("disabled",!t)},validate:function(t){return e(t.find("input")[0]).valid()}},jqfileupload2:{getValue:function(e,t){return e.data("saveId")},setValue:function(e,t,a){(t=getMtValue(t,a))&&e.spFileUpload("setValue",t)},disable:function(e,t){e.spFileUpload("disabled",!t)}},imageupload:{getValue:function(e,t){return e.attr("randomparent")},setValue:function(e,t,a){(t=getMtValue(t,a))&&e.attr("randomparent",t)},disable:function(e,t){}},office:{getValue:function(e,t){return e.attr("randomparent")},setValue:function(e,t){t&&(e.attr({randomparent:t,isSet:!0}),e.office("openDocs"))}},editorbt:{getValue:function(e,t){return e.code()},setValue:function(e,t){e.next().find("div.note-editable.panel-body").html(t.replace(/\\\"/gm,'"'))},disable:function(e,t){e.next().find("div.note-editable.panel-body").attr("contenteditable",!t)}},editor:{get:function(e){var t=e.attr("id");return(window.UE||{}).getEditor(t)},getText:function(t){e.fn[n].roleFunctions.editor.get(t).getContentTxt()},getValue:function(t){return e.fn[n].roleFunctions.editor.get(t).getContent()},setValue:function(t,a,n){if(a){a=a.replace(/\\\"/gm,'"');var r=t.attr("id"),i=window.UE||{};try{if(/&lt/.test(a)){var o=e("<div>").html(a);a=o.get(0).innerText}}catch(e){console.log(e)}i.getEditor(r).ready(function(){this.setContent(a)})}}},custom:{setValue:function(e,t,a){customFunc.setValue(e,a[2])}},excelupload:{setValue:function(e,t,a){e.excelFileUpload("setIniParam",a[2])}},mtbutton:{disable:function(e,t){e.prop("disabled",!0)}}};e.fn[n].roleFunctions=r}(jQuery);var handleLogin=function(e,t,a){var n=$([]),i=$([]),o=$([]),s=$([]),l={};if("object"==typeof t)for(var u=0;u<e.length;u++)r=e[u],r.inid?(l[r.inid]=t[r.param],-1!=r.inid.indexOf("login_username")?(n=$("#"+r.inid).find("input"),l.uname=r.param,l.unameEle=n):-1!=r.inid.indexOf("login_password")?(i=$("#"+r.inid).find("input"),l.pname=r.param,l.pnameEle=i):-1!=r.inid.indexOf("login_verify")&&(s=$("#"+r.inid).find("input"),l.vname=r.param,l.vnameEle=s)):l[r.param]=t[r.param];if(o=a[0]?a[0].find("button"):$([]),1==n.length&&1==i.length){var c=n.closest('div[data-role="login_username"]').data("config"),d=i.closest('div[data-role="login_password"]').data("config"),p=o.closest('div[data-role="login_actions"]').data("config");if(1==s.length)var b=s.closest('div[data-role="login_verify"]').data("config");var f="username",g="password",m="verification",h="用户名为必填项.",v="密码为必填项.",y="请输入图片验证码.";l.toIndex=getUrlToSplitter()+contextPath+"/index.jsp",l.securityKey=contextPath+"/mx/login/getLoginSecurityKey",l.loginUrl=contextPath+"/mx/login/doLogin",c&&(n.attr("name",l.uname),f=l.uname,h=c.validateInfo),d&&(i.attr("name",l.pname),g=l.pname,v=d.validateInfo),p&&(l.securityKey=p.securityKey,l.loginUrl=p.loginUrl,""!=p.toIndex&&(l.toIndex=getUrlToSplitter()+contextPath+JSON.parse(p.toIndex)[0].url)),b&&(s.attr("name",l.vname),m=l.vname,y=b.validateInfo);var x={};x[f]={required:!0},x[g]={required:!0},x[m]={required:!0};var w={};if(w[f]={required:h},w[g]={required:v},w[m]={required:y},$(".login-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:x,messages:w,invalidHandler:function(e,t){$(".alert-danger",$(".login-form")).show()},highlight:function(e){$(e).closest('div[data-role="login_username"]').length>0?$(e).closest('div[data-role="login_username"]').addClass("has-error"):$(e).closest('div[data-role="login_password"]').length>0?$(e).closest('div[data-role="login_password"]').addClass("has-error"):$(e).closest('div[data-role="login_verify"]').length>0&&$(e).closest('div[data-role="login_verify"]').addClass("has-error")},success:function(e){e.closest('div[data-role="login_username"]').length>0?e.closest('div[data-role="login_username"]').removeClass("has-error"):e.closest('div[data-role="login_password"]').length>0?e.closest('div[data-role="login_password"]').removeClass("has-error"):e.closest('div[data-role="login_verify"]').length>0&&e.closest('div[data-role="login_verify"]').removeClass("has-error"),e.remove()},errorPlacement:function(e,t){if($(".alert-danger",$(".login-form"))[0]&&e.text())$(".alert-danger",$(".login-form")).find("span").html(e.text());else{var a;t.closest('div[data-role="login_username"]').length>0?a=t.closest('div[data-role="login_username"]').children().last():t.closest('div[data-role="login_password"]').length>0?a=t.closest('div[data-role="login_password"]').children().last():t.closest('div[data-role="login_verify"]').length>0&&(a=t),e.insertAfter(a)}},submitHandler:function(e){}}),$(".login-form").validate().form()){var j={};l.vnameEle?(j[l.vname]=l.vnameEle.val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:contextPath+"/website/form/verification/checkcode",dataType:"json",data:j,error:function(e){alert("服务器处理错误！")},success:function(e){e&&e.status?checkUser(l):($(".alert-danger",$(".login-form")).show(),$(".alert-danger",$(".login-form")).find("span").html("验证码错误！"))}})):checkUser(l)}}},checkUser=function(e){jQuery.ajax({type:"POST",url:e.securityKey,dataType:"json",error:function(e){alert("服务器处理错误！")},success:function(t){if(null!=t&&null!=t.x_y&&null!=t.x_z){var a=t.x_y+e.pnameEle.val()+t.x_z;e.pnameEle.val(a);var n=e.unameEle.val();if(n=encodeURIComponent(n),e.rember&&1==e.rember){if(!$.cookie){var r=$('<script type="text/javascript" src="'+contextPath+'/webfile/js/jquery.cookie.js"><\/script>');$("body").append(r)}var i={};e.expires&&(i.expires=e.expires),$.cookie("userInfo",n,i)}var o=e.loginUrl+"?"+e.uname+"="+n+"&responseDataType=json",s=$("form.login-form").serialize();jQuery.ajax({type:"POST",url:o,dataType:"json",data:s,error:function(e){alert("服务器处理错误！")},success:function(t){null!=t?200==t.statusCode?window.location=e.toIndex:null!=t.message&&($(".alert-danger",$(".login-form")).show(),$(".alert-danger",$(".login-form")).find("span").html(t.message),e.pnameEle.val("")):alert("服务器处理错误！")}})}}})};jQuery;var pageFunc={getValue:function(e,t){return mtxx.params?mtxx.params[e.inparam]:null},getRow:function(e,t){var a=pubsub.getJQObj(e).data("params");return a?a.value:null},linkageControl:function(e,t){pageFunc.linkagePage(e,t)},linkagePage:function(e,t){t.newWin="1";var a=pubsub.paramsToStr(t),n=e;"object"==typeof e&&(n=e[0].outid),$("iframe[src*='"+n+"'],iframe[prosrc*='"+n+"']").each(function(e){$this=$(this),$this.attr("prosrc")||$this.attr("prosrc",$this.attr("src")),$this.attr("src",$this.attr("prosrc")+a)})},newWindow:function(id,params,args){var obj=args[0];if(obj&&obj.jumpType){var p=pubsub.paramsToStr(params),path,f="";obj.slink&&obj.fillform&&(f="&fillform="+obj.fillform);var link=JSON.parse(obj.link),url=link.url;if(path=contextPath+url+(url.indexOf("?")>-1?"":"?")+p+f,"singlePage"==obj.jumpType)window.open(path);else{var iTop=(window.screen.availHeight-30-eval(obj.height.replace("px","")))/2,iLeft=(window.screen.availWidth-10-eval(obj.width.replace("px","")))/2;if(obj.model)window.open(path,obj.title,"width="+obj.width+",height="+obj.height+",top="+iTop+",left="+iLeft+", modal=true,status=no");else{var kendoWindow=$("#mt-popwindow").data("kendoWindow")||$("<div id='mt-popwindow'></div>").kendoWindow({modal:obj.model,title:obj.title,width:obj.width,height:obj.height,iframe:!0}).data("kendoWindow");kendoWindow.refresh({url:path}),kendoWindow.open(),kendoWindow.center(),"true"==obj.maximize&&kendoWindow.maximize()}}}else{var p=pubsub.paramsToStr(params,["isMax","width","height","singlePage","model","title"]),url=id[0].srcUrl,path=contextPath+url+(url.indexOf("?")>-1?"":"?")+p;if(params.singlePage){var iTop=(window.screen.availHeight-30-eval((params.height+"").replace("px","")))/2,iLeft=(window.screen.availWidth-10-eval((params.width+"").replace("px","")))/2;if(params.model)window.open(path,params.title,"width="+params.width+",height="+params.height+",top="+iTop+",left="+iLeft+", modal=true,status=no");else{var kendoWindow=$("#mt-popwindow").data("kendoWindow")||$("<div id='mt-popwindow'></div>").kendoWindow({modal:params.model,title:params.title,width:params.width,height:params.height,iframe:!0}).data("kendoWindow");kendoWindow.refresh({url:path}),kendoWindow.open(),kendoWindow.center(),params.isMax&&kendoWindow.maximize()}}else window.open(path)}},pageClose:function(e,t){var a=pubsub.getThat(e);a.top.location.href==a.location.href?a.close():a.parent.$("[data-role=window]").each(function(t,n){var r=a.parent.$(n).data("kendoWindow");-1!=r.content().indexOf(e.outid)&&r.close()})},grefresh:function(e,t){pubsub.getThat(e).location.reload()},mtSave:function(e,t){var a=$(document.body).data("saveMsg");a&&$.each(a,function(e,t){t&&t.save&&t.save()})},mtLogin:function(e,t,a){handleLogin(e,t,a)},mtSubmit:function(e,t){if(window.mtxx&&window.mtxx.params&&confirm("你确定提交吗?")){var a=mtxx.params.id,n=$.extend(!0,{},t,{approve:!0}),r=$("."+a).attr("idValue"),i={pageId:a};i.flowParams=JSON.stringify(n),i[a]=r,$.ajax({url:contextPath+"/mx/form/workflow/defined/submit",type:"POST",dataType:"JSON",data:i,success:function(e){alert("操作成功!")}})}}};pubsub.sub("page",pageFunc);var SortArray=function(e,t,a){function n(t,a){e.sort(function(e,n){var r=(e[t]||0)-(n[t]||0);return a?-r:r})}if(t&&e&&e.length)try{var r=t.split(",");$.each(r,function(e,t){var r=t.split(" "),i=r[0].trim(),o=r[1];n(i,o=o&&(o=o.trim())?"desc"==o:a)})}catch(e){console.log(e)}};
//# sourceMappingURL=bootstrap.extend.all.min.js.map