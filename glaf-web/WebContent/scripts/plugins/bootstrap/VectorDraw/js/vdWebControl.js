vdversion='7012.2017.1030.1646';var X=0;var Y=1;var Z=2;var B=3;var W=3;var INDEX=3;var A00=0;var A01=1;var A02=2;var A03=3;var A10=4;var A11=5;var A12=6;var A13=7;var A20=8;var A21=9;var A22=10;var A23=11;var A30=12;var A31=13;var A32=14;var A33=15;var vdgeo={};vdgeo.newpoint=function(x,y,z){return[x,y,z];};vdgeo.vd_tY=function(x,y,z,i){return[x,y,z,i];};vdgeo.newvertex=function(x,y,z,vd_ft){return[x,y,z,vd_ft];};vdgeo.pointPolar=function(pt,ang,dst){ang=vdgeo.FixAngle(ang);return vdgeo.newpoint(Math.cos(ang)*dst+pt[X],Math.sin(ang)*dst+pt[Y],pt[Z]);};vdgeo.vd_Dm=function(pt,x,y,z){pt[X]+=x;pt[Y]+=y;pt[Z]+=z;};vdgeo.vd_iE=function(pt,x,y,z,w){pt[X]=x;pt[Y]=y;pt[Z]=z;pt[W]=w;};vdgeo.MidPoint=function(p1,p2){return vdgeo.newpoint((p1[X]+p2[X])/2.0,(p1[Y]+p2[Y])/2.0,(p1[Z]+p2[Z])/2.0);};vdgeo.Distance2D=function(p1,p2){return Math.sqrt((p1[X]-p2[X])*(p1[X]-p2[X])+(p1[Y]-p2[Y])*(p1[Y]-p2[Y]));};vdgeo.Distance3D=function(p1,p2){return Math.sqrt((p1[X]-p2[X])*(p1[X]-p2[X])+(p1[Y]-p2[Y])*(p1[Y]-p2[Y])+(p1[Z]-p2[Z])*(p1[Z]-p2[Z]));};vdgeo.vd_ce=function(dest,source){dest[X]=source[X];dest[Y]=source[Y];dest[Z]=source[Z];dest[W]=source[W];};vdgeo.vd_jZ=function(pt,vd_vf,dir,dist){pt[X]=vd_vf[X]+dir[X]*dist;pt[Y]=vd_vf[Y]+dir[Y]*dist;pt[Z]=vd_vf[Z]+dir[Z]*dist;};vdgeo.vd_uh=function(pt,val){return vdgeo.newpoint(pt[X]*val,pt[Y]*val,pt[Z]*val);};vdgeo.GetAngle=function(p1,p2){if(vdgeo.AreEqual(vdgeo.Distance2D(p1,p2),0.0,vdgeo.DefaultLinearEquality))return 0.0;return vdgeo.FixAngle(Math.atan2(p2[Y]-p1[Y],p2[X]-p1[X]));};vdgeo.VectorDirection=function(p1,p2){var v=vdgeo.newpoint(p2[X]-p1[X],p2[Y]-p1[Y],p2[Z]-p1[Z]);vdgeo.vd_cD(v);return v;};vdgeo.vd_dX=function(v,other){return(v[X]*other[X]+v[Y]*other[Y]+v[Z]*other[Z]);};vdgeo.vd_hC=function(v){return Math.sqrt(vdgeo.vd_dX(v,v));};vdgeo.vd_vL=function(vec){var v=vdgeo.newpoint(vec[X],vec[Y],vec[Z]);vdgeo.vd_cD(v);var sa=0.0;if(vdgeo.AreEqual(v[X],0,vdgeo.DefaultLinearEquality)){if(v[Y]>0.0){sa=vdgeo.HALF_PI;}else{sa=3.0*vdgeo.HALF_PI;}}else if(vdgeo.AreEqual(v[Y],0,vdgeo.DefaultLinearEquality)){if(v[X]>0.0){sa=0.0;}else{sa=vdgeo.PI;}}else{sa=Math.atan(Math.abs(v[Y])/Math.abs(v[X]));if(v[Y]>0.0&&v[X]<0.0){sa=vdgeo.PI-sa;}else if(v[Y]<0.0&&v[X]<0.0){sa=vdgeo.PI+sa;}else if(v[Y]<0.0&&v[X]>0.0){sa=vdgeo.VD_TWOPI-sa;}}return sa;};vdgeo.vd_cD=function(v){var l=vdgeo.vd_hC(v);if(vdgeo.AreEqual(l,0.0,vdgeo.DefaultVectorEquality)){v[X]=0.0;v[Y]=0.0;v[Z]=1.0;return false;}v[X]/=l;v[Y]/=l;v[Z]/=l;return true;};vdgeo.vd_wt=function(v1,v2,v){v[X]=v1[Y]*v2[Z]-v2[Y]*v1[Z];v[Y]=v1[Z]*v2[X]-v2[Z]*v1[X];v[Z]=v1[X]*v2[Y]-v2[X]*v1[Y];};vdgeo.vd_ig=function(v1,v2){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_wt(v1,v2,v);return v;};vdgeo.vd_jJ=function(p1,p2,p3,v){var A=vdgeo.newpoint(p2[X]-p1[X],p2[Y]-p1[Y],p2[Z]-p1[Z]);var B=vdgeo.newpoint(p3[X]-p1[X],p3[Y]-p1[Y],p3[Z]-p1[Z]);vdgeo.vd_wt(A,B,v);if(!vdgeo.vd_cD(v))return false;return true;};vdgeo.vd_AW=function(p1,p2,p3){var v=vdgeo.newpoint(0,0,0);if(!vdgeo.vd_jJ(p1,p2,p3,v))return null;return v;};vdgeo.vd_ER=function(p1,p2,p3,p4){if(vdgeo.vd_fI(p1,p2,vdgeo.vd_gS))return 1;if(vdgeo.vd_fI(p2,p3,vdgeo.vd_gS))return 2;if(vdgeo.vd_fI(p3,p4,vdgeo.vd_gS))return 3;if(vdgeo.vd_fI(p4,p1,vdgeo.vd_gS))return 4;return 0;};vdgeo.vd_Be=function(p1,p2,p3,p4,v){var olap=vdgeo.vd_ER(p1,p2,p3,p4);switch(olap){case 0:return vdgeo.vd_jJ(p1,p2,p3,v);case 1:return vdgeo.vd_jJ(p2,p3,p4,v);case 2:return vdgeo.vd_jJ(p1,p3,p4,v);case 3:return vdgeo.vd_jJ(p1,p2,p4,v);case 4:return vdgeo.vd_jJ(p1,p2,p3,v);}return false;};vdgeo.vd_EI=function(mat){return[mat[A00],mat[A10],mat[A20],mat[A30],mat[A01],mat[A11],mat[A21],mat[A31],mat[A02],mat[A12],mat[A22],mat[A32],mat[A03],mat[A13],mat[A23],mat[A33]];};vdgeo.vd_It=function(vd_ti,pvTo){var vA=vdgeo.newpoint(vd_ti[X],vd_ti[Y],vd_ti[Z]);var vB=vdgeo.newpoint(pvTo[X],pvTo[Y],pvTo[Z]);vdgeo.vd_cD(vA);vdgeo.vd_cD(vB);var vd_rP=vdgeo.newpoint(vA[X]+vB[X],vA[Y]+vB[Y],vA[Z]+vB[Z]);vdgeo.vd_cD(vd_rP);var vOut=vdgeo.vd_ig(vA,vd_rP);var x=vOut[X];var y=vOut[Y];var z=vOut[Z];var w=vdgeo.vd_dX(vA,vd_rP);return[x,y,z,w];};vdgeo.vd_Ii=function(q){var x=q[X];var y=q[Y];var z=q[Z];var w=q[W];var vd_jt=0.0;var vd_iU=0.0;var bank=0.0;var test=x*y+z*w;if(test>0.499){vd_jt=2*Math.atan2(x,w);vd_iU=vdgeo.PI/2;bank=0;return[vdgeo.FixAngle(bank),vdgeo.FixAngle(vd_jt),vdgeo.FixAngle(vd_iU)];}if(test< -0.499){vd_jt= -2*Math.atan2(x,w);vd_iU= -vdgeo.PI/2;bank=0;return[vdgeo.FixAngle(bank),vdgeo.FixAngle(vd_jt),vdgeo.FixAngle(vd_iU)];}var sqx=x*x;var sqy=y*y;var sqz=z*z;vd_jt=Math.atan2(2*y*w-2*x*z,1-2*sqy-2*sqz);vd_iU=Math.asin(2*test);bank=Math.atan2(2*x*w-2*y*z,1-2*sqx-2*sqz);return[vdgeo.FixAngle(bank),vdgeo.FixAngle(vd_jt),vdgeo.FixAngle(vd_iU)];};vdgeo.vd_l=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];};vdgeo.vd_cw=function(m){var ret=vdgeo.vd_l();vdgeo.vd_oT(ret,m);return ret;};vdgeo.vd_GW=function(m,precision){if(precision==undefined)precision=10;m[A00]=Number(m[A00].toFixed(precision));m[A01]=Number(m[A01].toFixed(precision));m[A02]=Number(m[A02].toFixed(precision));m[A03]=Number(m[A03].toFixed(precision));m[A10]=Number(m[A10].toFixed(precision));m[A11]=Number(m[A11].toFixed(precision));m[A12]=Number(m[A12].toFixed(precision));m[A13]=Number(m[A13].toFixed(precision));m[A20]=Number(m[A20].toFixed(precision));m[A21]=Number(m[A21].toFixed(precision));m[A22]=Number(m[A22].toFixed(precision));m[A23]=Number(m[A23].toFixed(precision));m[A30]=Number(m[A30].toFixed(precision));m[A31]=Number(m[A31].toFixed(precision));m[A32]=Number(m[A32].toFixed(precision));m[A33]=Number(m[A33].toFixed(precision));};vdgeo.vd_fD=function(m){m[A00]=1.0;m[A01]=0.0;m[A02]=0.0;m[A03]=0.0;m[A10]=0.0;m[A11]=1.0;m[A12]=0.0;m[A13]=0.0;m[A20]=0.0;m[A21]=0.0;m[A22]=1.0;m[A23]=0.0;m[A30]=0.0;m[A31]=0.0;m[A32]=0.0;m[A33]=1.0;};vdgeo.vd_oT=function(m,from){m[A00]=from[A00];m[A01]=from[A01];m[A02]=from[A02];m[A03]=from[A03];m[A10]=from[A10];m[A11]=from[A11];m[A12]=from[A12];m[A13]=from[A13];m[A20]=from[A20];m[A21]=from[A21];m[A22]=from[A22];m[A23]=from[A23];m[A30]=from[A30];m[A31]=from[A31];m[A32]=from[A32];m[A33]=from[A33];};vdgeo.vd_fx=function(m,mat){if(vdgeo.vd_yv(m)&&vdgeo.vd_yv(mat)){vdgeo.vd_Ec(m,mat);return;}if(vdgeo.vd_qN(m)){vdgeo.vd_oT(m,mat);return;}if(vdgeo.vd_qN(mat)){return;}var a_00=m[A00]*mat[A00]+m[A10]*mat[A01]+m[A20]*mat[A02]+m[A30]*mat[A03];var a_01=m[A01]*mat[A00]+m[A11]*mat[A01]+m[A21]*mat[A02]+m[A31]*mat[A03];var a_02=m[A02]*mat[A00]+m[A12]*mat[A01]+m[A22]*mat[A02]+m[A32]*mat[A03];var a_03=m[A03]*mat[A00]+m[A13]*mat[A01]+m[A23]*mat[A02]+m[A33]*mat[A03];var a_10=m[A00]*mat[A10]+m[A10]*mat[A11]+m[A20]*mat[A12]+m[A30]*mat[A13];var a_11=m[A01]*mat[A10]+m[A11]*mat[A11]+m[A21]*mat[A12]+m[A31]*mat[A13];var a_12=m[A02]*mat[A10]+m[A12]*mat[A11]+m[A22]*mat[A12]+m[A32]*mat[A13];var a_13=m[A03]*mat[A10]+m[A13]*mat[A11]+m[A23]*mat[A12]+m[A33]*mat[A13];var a_20=m[A00]*mat[A20]+m[A10]*mat[A21]+m[A20]*mat[A22]+m[A30]*mat[A23];var a_21=m[A01]*mat[A20]+m[A11]*mat[A21]+m[A21]*mat[A22]+m[A31]*mat[A23];var a_22=m[A02]*mat[A20]+m[A12]*mat[A21]+m[A22]*mat[A22]+m[A32]*mat[A23];var a_23=m[A03]*mat[A20]+m[A13]*mat[A21]+m[A23]*mat[A22]+m[A33]*mat[A23];var a_30=m[A00]*mat[A30]+m[A10]*mat[A31]+m[A20]*mat[A32]+m[A30]*mat[A33];var a_31=m[A01]*mat[A30]+m[A11]*mat[A31]+m[A21]*mat[A32]+m[A31]*mat[A33];var a_32=m[A02]*mat[A30]+m[A12]*mat[A31]+m[A22]*mat[A32]+m[A32]*mat[A33];var a_33=m[A03]*mat[A30]+m[A13]*mat[A31]+m[A23]*mat[A32]+m[A33]*mat[A33];m[A00]=a_00;m[A01]=a_01;m[A02]=a_02;m[A03]=a_03;m[A10]=a_10;m[A11]=a_11;m[A12]=a_12;m[A13]=a_13;m[A20]=a_20;m[A21]=a_21;m[A22]=a_22;m[A23]=a_23;m[A30]=a_30;m[A31]=a_31;m[A32]=a_32;m[A33]=a_33;};vdgeo.vd_qN=function(m){return(m[A00]===1.0&&m[A01]===0.0&&m[A02]===0.0&&m[A03]===0.0&&m[A10]===0.0&&m[A11]===1.0&&m[A12]===0.0&&m[A13]===0.0&&m[A20]===0.0&&m[A21]===0.0&&m[A22]===1.0&&m[A23]===0.0&&m[A30]===0.0&&m[A31]===0.0&&m[A32]===0.0&&m[A33]===1.0);};vdgeo.vd_kM=function(m){var m_N=vdgeo.vd_ig(vdgeo.vd_ji(m),vdgeo.vd_yV(m));var m_A=vdgeo.vd_dX(m_N,m_N);if((-vdgeo.EPSILON)<m_A&&m_A<vdgeo.EPSILON)return false;return(vdgeo.vd_dX(m_N,vdgeo.vd_mN(m))<0.0?true:false);};vdgeo.vd_ji=function(m){return vdgeo.newpoint(m[A00],m[A10],m[A20]);};vdgeo.vd_yV=function(m){return vdgeo.newpoint(m[A01],m[A11],m[A21]);};vdgeo.vd_mN=function(m){return vdgeo.newpoint(m[A02],m[A12],m[A22]);};vdgeo.vd_Dr=function(m){return vdgeo.newpoint(m[A03],m[A13],m[A23]);};vdgeo.vd_hX=function(m){return vdgeo.newpoint(vdgeo.vd_hC(vdgeo.vd_ji(m)),vdgeo.vd_hC(vdgeo.vd_yV(m)),vdgeo.vd_hC(vdgeo.vd_mN(m)));};vdgeo.vd_mv=function(m){var zdir=vdgeo.vd_mN(m);if(vdgeo.AreEqual(zdir[X],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(zdir[Y],0,vdgeo.DefaultVectorEquality))return vdgeo.vd_vL(vdgeo.vd_ji(m));var offset=vdgeo.vd_Dr(m);var _mat=vdgeo.vd_cw(m);vdgeo.vd_Y(_mat,-offset[X],-offset[Y],-offset[Z]);vdgeo.vd_jc(_mat,zdir);return vdgeo.vd_vL(vdgeo.vd_ji(_mat));};vdgeo.vd_yv=function(m){return(m[A02]===0.0&&m[A12]===0.0&&m[A20]===0.0&&m[A21]===0.0&&m[A23]===0.0&&m[A32]===0.0);};vdgeo.vd_Ec=function(m,mat){var a_00=m[A00]*mat[A00]+m[A10]*mat[A01]+m[A30]*mat[A03];var a_01=m[A01]*mat[A00]+m[A11]*mat[A01]+m[A31]*mat[A03];var a_03=m[A03]*mat[A00]+m[A13]*mat[A01]+m[A33]*mat[A03];var a_10=m[A00]*mat[A10]+m[A10]*mat[A11]+m[A30]*mat[A13];var a_11=m[A01]*mat[A10]+m[A11]*mat[A11]+m[A31]*mat[A13];var a_13=m[A03]*mat[A10]+m[A13]*mat[A11]+m[A33]*mat[A13];var a_22=m[A22]*mat[A22];var a_30=m[A00]*mat[A30]+m[A10]*mat[A31]+m[A30]*mat[A33];var a_31=m[A01]*mat[A30]+m[A11]*mat[A31]+m[A31]*mat[A33];var a_33=m[A03]*mat[A30]+m[A13]*mat[A31]+m[A33]*mat[A33];m[A00]=a_00;m[A01]=a_01;m[A02]=0;m[A03]=a_03;m[A10]=a_10;m[A11]=a_11;m[A12]=0;m[A13]=a_13;m[A20]=0;m[A21]=0;m[A22]=a_22;m[A23]=0;m[A30]=a_30;m[A31]=a_31;m[A32]=0;m[A33]=a_33;};vdgeo.vd_DK=function(m){return(m[A03]*m[A12]*m[A21]*m[A30]-m[A02]*m[A13]*m[A21]*m[A30]-m[A03]*m[A11]*m[A22]*m[A30]+m[A01]*m[A13]*m[A22]*m[A30]+m[A02]*m[A11]*m[A23]*m[A30]-m[A01]*m[A12]*m[A23]*m[A30]-m[A03]*m[A12]*m[A20]*m[A31]+m[A02]*m[A13]*m[A20]*m[A31]+m[A03]*m[A10]*m[A22]*m[A31]-m[A00]*m[A13]*m[A22]*m[A31]-m[A02]*m[A10]*m[A23]*m[A31]+m[A00]*m[A12]*m[A23]*m[A31]+m[A03]*m[A11]*m[A20]*m[A32]-m[A01]*m[A13]*m[A20]*m[A32]-m[A03]*m[A10]*m[A21]*m[A32]+m[A00]*m[A13]*m[A21]*m[A32]+m[A01]*m[A10]*m[A23]*m[A32]-m[A00]*m[A11]*m[A23]*m[A32]-m[A02]*m[A11]*m[A20]*m[A33]+m[A01]*m[A12]*m[A20]*m[A33]+m[A02]*m[A10]*m[A21]*m[A33]-m[A00]*m[A12]*m[A21]*m[A33]-m[A01]*m[A10]*m[A22]*m[A33]+m[A00]*m[A11]*m[A22]*m[A33]);};vdgeo.vd_hR=function(m){var det=vdgeo.vd_DK(m);var t00=m[A12]*m[A23]*m[A31]-m[A13]*m[A22]*m[A31]+m[A13]*m[A21]*m[A32]-m[A11]*m[A23]*m[A32]-m[A12]*m[A21]*m[A33]+m[A11]*m[A22]*m[A33];var t01=m[A03]*m[A22]*m[A31]-m[A02]*m[A23]*m[A31]-m[A03]*m[A21]*m[A32]+m[A01]*m[A23]*m[A32]+m[A02]*m[A21]*m[A33]-m[A01]*m[A22]*m[A33];var t02=m[A02]*m[A13]*m[A31]-m[A03]*m[A12]*m[A31]+m[A03]*m[A11]*m[A32]-m[A01]*m[A13]*m[A32]-m[A02]*m[A11]*m[A33]+m[A01]*m[A12]*m[A33];var t03=m[A03]*m[A12]*m[A21]-m[A02]*m[A13]*m[A21]-m[A03]*m[A11]*m[A22]+m[A01]*m[A13]*m[A22]+m[A02]*m[A11]*m[A23]-m[A01]*m[A12]*m[A23];var t10=m[A13]*m[A22]*m[A30]-m[A12]*m[A23]*m[A30]-m[A13]*m[A20]*m[A32]+m[A10]*m[A23]*m[A32]+m[A12]*m[A20]*m[A33]-m[A10]*m[A22]*m[A33];var t11=m[A02]*m[A23]*m[A30]-m[A03]*m[A22]*m[A30]+m[A03]*m[A20]*m[A32]-m[A00]*m[A23]*m[A32]-m[A02]*m[A20]*m[A33]+m[A00]*m[A22]*m[A33];var t12=m[A03]*m[A12]*m[A30]-m[A02]*m[A13]*m[A30]-m[A03]*m[A10]*m[A32]+m[A00]*m[A13]*m[A32]+m[A02]*m[A10]*m[A33]-m[A00]*m[A12]*m[A33];var t13=m[A02]*m[A13]*m[A20]-m[A03]*m[A12]*m[A20]+m[A03]*m[A10]*m[A22]-m[A00]*m[A13]*m[A22]-m[A02]*m[A10]*m[A23]+m[A00]*m[A12]*m[A23];var t20=m[A11]*m[A23]*m[A30]-m[A13]*m[A21]*m[A30]+m[A13]*m[A20]*m[A31]-m[A10]*m[A23]*m[A31]-m[A11]*m[A20]*m[A33]+m[A10]*m[A21]*m[A33];var t21=m[A03]*m[A21]*m[A30]-m[A01]*m[A23]*m[A30]-m[A03]*m[A20]*m[A31]+m[A00]*m[A23]*m[A31]+m[A01]*m[A20]*m[A33]-m[A00]*m[A21]*m[A33];var t22=m[A01]*m[A13]*m[A30]-m[A03]*m[A11]*m[A30]+m[A03]*m[A10]*m[A31]-m[A00]*m[A13]*m[A31]-m[A01]*m[A10]*m[A33]+m[A00]*m[A11]*m[A33];var t23=m[A03]*m[A11]*m[A20]-m[A01]*m[A13]*m[A20]-m[A03]*m[A10]*m[A21]+m[A00]*m[A13]*m[A21]+m[A01]*m[A10]*m[A23]-m[A00]*m[A11]*m[A23];var t30=m[A12]*m[A21]*m[A30]-m[A11]*m[A22]*m[A30]-m[A12]*m[A20]*m[A31]+m[A10]*m[A22]*m[A31]+m[A11]*m[A20]*m[A32]-m[A10]*m[A21]*m[A32];var t31=m[A01]*m[A22]*m[A30]-m[A02]*m[A21]*m[A30]+m[A02]*m[A20]*m[A31]-m[A00]*m[A22]*m[A31]-m[A01]*m[A20]*m[A32]+m[A00]*m[A21]*m[A32];var t32=m[A02]*m[A11]*m[A30]-m[A01]*m[A12]*m[A30]-m[A02]*m[A10]*m[A31]+m[A00]*m[A12]*m[A31]+m[A01]*m[A10]*m[A32]-m[A00]*m[A11]*m[A32];var t33=m[A01]*m[A12]*m[A20]-m[A02]*m[A11]*m[A20]+m[A02]*m[A10]*m[A21]-m[A00]*m[A12]*m[A21]-m[A01]*m[A10]*m[A22]+m[A00]*m[A11]*m[A22];var vd_cX=1.0/det;m[A00]=t00*vd_cX;m[A01]=t01*vd_cX;m[A02]=t02*vd_cX;m[A03]=t03*vd_cX;m[A10]=t10*vd_cX;m[A11]=t11*vd_cX;m[A12]=t12*vd_cX;m[A13]=t13*vd_cX;m[A20]=t20*vd_cX;m[A21]=t21*vd_cX;m[A22]=t22*vd_cX;m[A23]=t23*vd_cX;m[A30]=t30*vd_cX;m[A31]=t31*vd_cX;m[A32]=t32*vd_cX;m[A33]=t33*vd_cX;};vdgeo.vd_bc=function(m){var ret=vdgeo.vd_cw(m);vdgeo.vd_hR(ret);return ret;};vdgeo.vd_Y=function(m,dx,dy,dz){if(dx===0.0&&dy===0.0&&dz===0.0)return;var mat=vdgeo.vd_l();mat[A03]=dx;mat[A13]=dy;mat[A23]=dz;vdgeo.vd_fx(m,mat);};vdgeo.vd_aM=function(m,a,b,c){if(a===1.0&&b===1.0&&c===1.0)return;var mat=vdgeo.vd_l();mat[A00]=a;mat[A11]=b;mat[A22]=c;vdgeo.vd_fx(m,mat);};vdgeo.vd_af=function(m,rads){if(rads===0.0)return;var mat=vdgeo.vd_l();var vd_cZ,sine;vd_cZ=Math.cos(rads);sine=Math.sin(rads);mat[A00]=vd_cZ;mat[A11]=vd_cZ;mat[A01]= -sine;mat[A10]=sine;vdgeo.vd_fx(m,mat);};vdgeo.vd_Dw=function(m,rads){if(rads===0.0)return;var mat=vdgeo.vd_l();var vd_cZ,sine;vd_cZ=Math.cos(rads);sine=Math.sin(rads);mat[A11]=vd_cZ;mat[A22]=vd_cZ;mat[A12]= -sine;mat[A21]=sine;vdgeo.vd_fx(m,mat);};vdgeo.vd_Ez=function(m,rads){if(rads===0.0)return;var mat=vdgeo.vd_l();var vd_cZ,sine;vd_cZ=Math.cos(rads);sine=Math.sin(rads);mat[A00]=vd_cZ;mat[A22]=vd_cZ;mat[A02]=sine;mat[A20]= -sine;vdgeo.vd_fx(m,mat);};vdgeo.vd_xG=function(m,Sx,Sy){if(Sx===0.0&&Sy===0.0)return;var mat=vdgeo.vd_l();mat[A01]=Math.tan(Sx);mat[A10]=Math.tan(Sy);vdgeo.vd_fx(m,mat);};var vd_xg=0.015625;vdgeo.vd_DT=function(m,vd_gp,vd_qD){var vd_bO=vdgeo.newpoint(vd_gp[X],vd_gp[Y],vd_gp[Z]);vdgeo.vd_cD(vd_bO);var vd_cN=vdgeo.newpoint(vd_qD[X],vd_qD[Y],vd_qD[Z]);vdgeo.vd_cD(vd_cN);var vd_eS=vdgeo.vd_ig(vd_bO,vd_cN);vdgeo.vd_cD(vd_eS);var mat=vdgeo.vd_l();mat[A00]=vd_cN[X];mat[A01]=vd_eS[X];mat[A02]=vd_bO[X];mat[A10]=vd_cN[Y];mat[A11]=vd_eS[Y];mat[A12]=vd_bO[Y];mat[A20]=vd_cN[Z];mat[A21]=vd_eS[Z];mat[A22]=vd_bO[Z];vdgeo.vd_fx(m,mat);};vdgeo.vd_aG=function(m,vd_gp){if(vd_gp==undefined)return;var vd_bO=vdgeo.newpoint(vd_gp[X],vd_gp[Y],vd_gp[Z]);vdgeo.vd_cD(vd_bO);if(vd_bO[X]===0.0&&vd_bO[Y]===0.0&&vd_bO[Z]===1.0)return;var vd_cN;var vd_eS;var Wy=vdgeo.newpoint(0.0,1.0,0.0);var Wz=vdgeo.newpoint(0.0,0.0,1.0);if((Math.abs(vd_bO[X])<vd_xg)&&(Math.abs(vd_bO[Y])<vd_xg))vd_cN=vdgeo.vd_ig(Wy,vd_bO);else vd_cN=vdgeo.vd_ig(Wz,vd_bO);vdgeo.vd_cD(vd_cN);vd_eS=vdgeo.vd_ig(vd_bO,vd_cN);vdgeo.vd_cD(vd_eS);var mat=vdgeo.vd_l();mat[A00]=vd_cN[X];mat[A01]=vd_eS[X];mat[A02]=vd_bO[X];mat[A10]=vd_cN[Y];mat[A11]=vd_eS[Y];mat[A12]=vd_bO[Y];mat[A20]=vd_cN[Z];mat[A21]=vd_eS[Z];mat[A22]=vd_bO[Z];vdgeo.vd_fx(m,mat);};vdgeo.vd_jc=function(m,vd_bO){var mat=vdgeo.vd_l();vdgeo.vd_aG(mat,vd_bO);vdgeo.vd_hR(mat);vdgeo.vd_fx(m,mat);};vdgeo.vd_Dv=function(m,axis,rotation){vdgeo.vd_jc(m,axis);vdgeo.vd_af(m,rotation);vdgeo.vd_aG(m,axis);};vdgeo.vd_Iu=function(m,vd_Fu,vd_GB,vd_mj,vd_oi){vdgeo.vd_fD(m);vdgeo.vd_aM(m,vd_mj*0.5,vd_oi*0.5,1);vdgeo.vd_Y(m,-vd_mj*0.5+vd_Fu,-vd_oi*0.5+vd_GB,0);};vdgeo.vd_Dc=function(m,vd_r,vd_v,vd_qL,near,far){var width=vd_v*vd_qL;var left=vd_r[X]-width*0.5;var right=vd_r[X]+width*0.5;var top=vd_r[Y]+vd_v*0.5;var bottom=vd_r[Y]-vd_v*0.5;vdgeo.vd_fD(m);m[A00]=2.0/(right-left);m[A03]= -(right+left)/(right-left);m[A11]=2.0/(top-bottom);m[A13]= -(top+bottom)/(top-bottom);m[A22]= -2.0/(far-near);m[A23]= -(far+near)/(far-near);m[A32]=0.0;m[A33]=1.0;};vdgeo.vd_Dh=function(m,vd_qL,far,FocalLength,LensAngle){var near=FocalLength;near=Math.max(near,0.001);far=Math.max(near+0.001,far);var vd_if=2.0*FocalLength*Math.tan(vdgeo.DegreesToRadians(LensAngle/2.0));var top=vd_if*0.5;var bottom= -top;var right=vd_qL*top;var left= -right;vdgeo.vd_fD(m);m[A00]=2.0*near/(right-left);m[A02]=(right+left)/(right-left);m[A11]=2.0*near/(top-bottom);m[A12]=(top+bottom)/(top-bottom);m[A22]= -(far+near)/(far-near);m[A23]= -2.0*far*near/(far-near);m[A32]= -1.0;m[A33]=0.0;};vdgeo.vd_Dk=function(p1,p2){var z1=p1[Z];var z2=p2[Z];if(z1<0&&z2<0)return false;if(z1<0||z2<0){var gradient=(-p1[Z])/(p2[Z]-p1[Z]);var x=vdgeo.vd_bK(p1[X],p2[X],gradient);var y=vdgeo.vd_bK(p1[Y],p2[Y],gradient);var z=vdgeo.vd_bK(p1[Z],p2[Z],gradient);var w=vdgeo.vd_bK(p1[W],p2[W],gradient);if(z1<0){p1[X]=x;p1[Y]=y;p1[Z]=0;p1[W]=w;}else if(z2<0){p2[X]=x;p2[Y]=y;p2[Z]=0;p2[W]=w;}}if(p1[W]){p1[X]/=p1[W];p1[Y]/=p1[W];p1[Z]/=p1[W];}if(p2[W]){p2[X]/=p2[W];p2[Y]/=p2[W];p2[Z]/=p2[W];}return true;};vdgeo.vd_CZ=function(pts,uvs){var i=0,n=0;var uv1,uv2,u,v,d,vd_eT;var p1,p2,z1,z2,x,y,z,w,gradient;var vd_bz=[];if(uvs)vd_eT=[];for(i=0;i<pts.length;i++){p1=[pts[i][X],pts[i][Y],pts[i][Z],pts[i][W]];if(uvs){uv1=[uvs[i][X],uvs[i][Y],uvs[i][Z]];}n=i+1;if(n===pts.length)n=0;p2=[pts[n][X],pts[n][Y],pts[n][Z],pts[n][W]];if(uvs){uv2=[uvs[n][X],uvs[n][Y],uvs[n][Z]];}z1=p1[Z];z2=p2[Z];if(z1<0&&z2<0)continue;if(z1<0||z2<0){gradient=(-p1[Z])/(p2[Z]-p1[Z]);x=vdgeo.vd_bK(p1[X],p2[X],gradient);y=vdgeo.vd_bK(p1[Y],p2[Y],gradient);z=vdgeo.vd_bK(p1[Z],p2[Z],gradient);w=vdgeo.vd_bK(p1[W],p2[W],gradient);if(uvs){u=vdgeo.vd_jb(uv1[X],uv2[X],gradient);v=vdgeo.vd_jb(uv1[Y],uv2[Y],gradient);d=vdgeo.vd_jb(uv1[Z],uv2[Z],gradient);}if(z1<0){p1[X]=x;p1[Y]=y;p1[Z]=z;p1[W]=w;if(uvs){uv1[X]=u;uv1[Y]=v;uv1[Z]=d;vd_eT.push(uv1);}vd_bz.push(p1);}else if(z2<0){p2[X]=x;p2[Y]=y;p2[Z]=z;p2[W]=w;if(uvs){uv2[X]=u;uv2[Y]=v;uv2[Z]=d;vd_eT.push(uv1);vd_eT.push(uv2);}vd_bz.push(p1);vd_bz.push(p2);}}else{vd_bz.push(p1);if(uvs)vd_eT.push(uv1);}}for(i=0;i<vd_bz.length;i++){if(vd_bz[i][W]){vd_bz[i][X]/=vd_bz[i][W];vd_bz[i][Y]/=vd_bz[i][W];vd_bz[i][Z]/=vd_bz[i][W];if(uvs&&vd_eT[i][Z]!=0){vd_eT[i][X]/=vd_bz[i][W];vd_eT[i][Y]/=vd_bz[i][W];vd_eT[i][Z]/=vd_bz[i][W];}}}return[vd_bz,vd_eT];};vdgeo.vd_dZ=function(x,y,z,projection,vd_bg){vd_bg[X]=(x*projection[A00])+(y*projection[A01])+(z*projection[A02])+projection[A03];vd_bg[Y]=(x*projection[A10])+(y*projection[A11])+(z*projection[A12])+projection[A13];vd_bg[Z]=(x*projection[A20])+(y*projection[A21])+(z*projection[A22])+projection[A23];vd_bg[W]=(x*projection[A30])+(y*projection[A31])+(z*projection[A32])+projection[A33];};vdgeo.vd_ax=function(x,y,z,projection){var vd_bg=vdgeo.newpoint(0,0,0);vdgeo.vd_dZ(x,y,z,projection,vd_bg);if(vd_bg[W]){vd_bg[X]/=vd_bg[W];vd_bg[Y]/=vd_bg[W];vd_bg[Z]/=vd_bg[W];}return vd_bg;};vdgeo.vd_fZ=function(pt,projection){return vdgeo.vd_ax(pt[X],pt[Y],pt[Z],projection);};vdgeo.vd_yK=function(m){if(vdgeo.AreEqual(m[A22],0.0,vdgeo.DefaultVectorEquality))return false;m[A20]=m[A21]=m[A23]=m[A02]=m[A12]=0.0;return true;};vdgeo.vd_Hn=function(m){var ret=vdgeo.vd_cw(m);if(!vdgeo.vd_yK(ret))return null;return ret;};vdgeo.vd_ED=function(m,x,y,z){return vdgeo.newpoint(m[A00]*x+m[A01]*y+m[A02]*z+m[A03],m[A10]*x+m[A11]*y+m[A12]*z+m[A13],m[A20]*x+m[A21]*y+m[A22]*z+m[A23]);};vdgeo.vd_pK=function(m,x,y,z,pt){pt[X]=m[A00]*x+m[A01]*y+m[A02]*z+m[A03];pt[Y]=m[A10]*x+m[A11]*y+m[A12]*z+m[A13];pt[Z]=m[A20]*x+m[A21]*y+m[A22]*z+m[A23];};vdgeo.vd_M=function(m,pt){return vdgeo.vd_ED(m,pt[X],pt[Y],pt[Z]);};vdgeo.vd_dL=function(m,pt,vd_aF){vd_aF[X]=m[A00]*pt[X]+m[A01]*pt[Y]+m[A02]*pt[Z]+m[A03];vd_aF[Y]=m[A10]*pt[X]+m[A11]*pt[Y]+m[A12]*pt[Z]+m[A13];vd_aF[Z]=m[A20]*pt[X]+m[A21]*pt[Y]+m[A22]*pt[Z]+m[A23];};vdgeo.vd_lN=function(m,x,y,z,vd_aF){vd_aF[X]=m[A00]*x+m[A01]*y+m[A02]*z+m[A03];vd_aF[Y]=m[A10]*x+m[A11]*y+m[A12]*z+m[A13];};vdgeo.vd_jh=function(m,x,y,z,normalize){var v=vdgeo.newpoint();vdgeo.vd_iW(m,x,y,z,v,normalize);return v;};vdgeo.vd_iW=function(m,x,y,z,v,normalize){v[X]=m[A00]*x+m[A01]*y+m[A02]*z;v[Y]=m[A10]*x+m[A11]*y+m[A12]*z;v[Z]=m[A20]*x+m[A21]*y+m[A22]*z;if(normalize===true)vdgeo.vd_cD(v);};vdgeo.vd_ot=function(m,pt,vd_kb){var ret=[0,0,0,0];ret[X]=m[A00]*pt[X]+m[A01]*pt[Y]+m[A02]*pt[Z]+m[A03];ret[Y]=m[A10]*pt[X]+m[A11]*pt[Y]+m[A12]*pt[Z]+m[A13];ret[Z]=m[A20]*pt[X]+m[A21]*pt[Y]+m[A22]*pt[Z]+m[A23];if(vd_kb==undefined)vd_kb=vdgeo.vd_kM(m);ret[B]=pt[B]*(vd_kb? -1.0:1.0);return ret;};vdgeo.vd_nJ=function(m,pts){var vd_kb=vdgeo.vd_kM(m);var ret=[];for(var i=0;i<pts.length;i++){ret.push(vdgeo.vd_ot(m,pts[i],vd_kb));}return ret;};vdgeo.vd_xu=function(m,x,y,vd_aF){vd_aF[X]=m[A00]*x+m[A01]*y+m[A03];vd_aF[Y]=m[A10]*x+m[A11]*y+m[A13];};vdgeo.vd_ff=function(m,pts){var ret=[];for(var i=0;i<pts.length;i++){ret.push(vdgeo.vd_M(m,pts[i]));}return ret;};vdgeo.vd_HG=function(m,pts){var ret=[];ret.length=pts.length;for(var i=0;i<pts.length;i++){ret[i]=vdgeo.newpoint(m[A00]*pts[i][X]+m[A01]*pts[i][Y]+m[A02]*pts[i][Z]+m[A03],m[A10]*pts[i][X]+m[A11]*pts[i][Y]+m[A12]*pts[i][Z]+m[A13]);}return ret;};vdgeo.vd_qP=function(m,box){var b1=vdgeo.vd_M(m,vdgeo.newpoint(box[0],box[1],box[2]));var b2=vdgeo.vd_M(m,vdgeo.newpoint(box[0],box[4],box[2]));var b3=vdgeo.vd_M(m,vdgeo.newpoint(box[3],box[4],box[2]));var b4=vdgeo.vd_M(m,vdgeo.newpoint(box[3],box[1],box[2]));var b5=vdgeo.vd_M(m,vdgeo.newpoint(box[0],box[1],box[5]));var b6=vdgeo.vd_M(m,vdgeo.newpoint(box[0],box[4],box[5]));var b7=vdgeo.vd_M(m,vdgeo.newpoint(box[3],box[4],box[5]));var b8=vdgeo.vd_M(m,vdgeo.newpoint(box[3],box[1],box[5]));return[Math.min(b1[X],b2[X],b3[X],b4[X],b5[X],b6[X],b7[X],b8[X]),Math.min(b1[Y],b2[Y],b3[Y],b4[Y],b5[Y],b6[Y],b7[Y],b8[Y]),Math.min(b1[Z],b2[Z],b3[Z],b4[Z],b5[Z],b6[Z],b7[Z],b8[Z]),Math.max(b1[X],b2[X],b3[X],b4[X],b5[X],b6[X],b7[X],b8[X]),Math.max(b1[Y],b2[Y],b3[Y],b4[Y],b5[Y],b6[Y],b7[Y],b8[Y]),Math.max(b1[Z],b2[Z],b3[Z],b4[Z],b5[Z],b6[Z],b7[Z],b8[Z])];};vdgeo.vd_iM=function(m1,m2){var ret=vdgeo.vd_cw(m1);vdgeo.vd_fx(ret,m2);return ret;};vdgeo.vd_FJ=function(pts){if(pts.length===0)return null;var vd_bd=new vd_nn();for(var i=1;i<pts.length;i++){vd_bd.vd_ct(pts[i]);}return vd_bd.vd_gl();};vdgeo.vd_vS=function(vd_dn,vd_ck,vd_cP,vd_dP,p1,p2,vd_D,vd_X){var vd_bu=0,vd_bQ=0;var done=false;vd_D[X]=p1[X];vd_D[Y]=p1[Y];vd_D[Z]=p1[Z];vd_X[X]=p2[X];vd_X[Y]=p2[Y];vd_X[Z]=p2[Z];var vd_ei;vd_ei=0;done=false;do{vd_bu=vd_bQ=0;if(vd_D[X]<vd_dn){vd_bu|=1;}else if(vd_D[X]>vd_cP){vd_bu|=2;}if(vd_D[Y]<vd_ck){vd_bu|=4;}else if(vd_D[Y]>vd_dP){vd_bu|=8;}if(vd_X[X]<vd_dn){vd_bQ|=1;}else if(vd_X[X]>vd_cP){vd_bQ|=2;}if(vd_X[Y]<vd_ck){vd_bQ|=4;}else if(vd_X[Y]>vd_dP){vd_bQ|=8;}if((vd_bu&vd_bQ)>0){done=true;vd_ei=1;}else{if((vd_bu|vd_bQ)===0){done=true;}else{vd_ei=2;if(vd_bu===0){if((vd_bQ&8)>0){vd_X[X]+=(vd_dP-vd_X[Y])*((vd_D[X]-vd_X[X])/(vd_D[Y]-vd_X[Y]));vd_X[Y]=vd_dP;}else if((vd_bQ&4)>0){vd_X[X]+=(vd_ck-vd_X[Y])*((vd_D[X]-vd_X[X])/(vd_D[Y]-vd_X[Y]));vd_X[Y]=vd_ck;}else if((vd_bQ&2)>0){vd_X[Y]+=(vd_cP-vd_X[X])*((vd_D[Y]-vd_X[Y])/(vd_D[X]-vd_X[X]));vd_X[X]=vd_cP;}else if((vd_bQ&1)>0){vd_X[Y]+=(vd_dn-vd_X[X])*((vd_D[Y]-vd_X[Y])/(vd_D[X]-vd_X[X]));vd_X[X]=vd_dn;}}else{if((vd_bu&8)>0){vd_D[X]+=(vd_dP-vd_D[Y])*((vd_X[X]-vd_D[X])/(vd_X[Y]-vd_D[Y]));vd_D[Y]=vd_dP;}else if((vd_bu&4)>0){vd_D[X]+=(vd_ck-vd_D[Y])*((vd_X[X]-vd_D[X])/(vd_X[Y]-vd_D[Y]));vd_D[Y]=vd_ck;}else if((vd_bu&2)>0){vd_D[Y]+=(vd_cP-vd_D[X])*((vd_X[Y]-vd_D[Y])/(vd_X[X]-vd_D[X]));vd_D[X]=vd_cP;}else if((vd_bu&1)>0){vd_D[Y]+=(vd_dn-vd_D[X])*((vd_X[Y]-vd_D[Y])/(vd_X[X]-vd_D[X]));vd_D[X]=vd_dn;}}}}}while(!done);if(vd_ei!==1){var vd_sE=0,vd_sz=0;if((p2[X]-p1[X])!=0.0){vd_sE=(vd_D[X]-p1[X])/(p2[X]-p1[X]);vd_sz=(vd_X[X]-p1[X])/(p2[X]-p1[X]);}else if((p2[Y]-p1[Y])!=0.0){vd_sE=(vd_D[Y]-p1[Y])/(p2[Y]-p1[Y]);vd_sz=(vd_X[Y]-p1[Y])/(p2[Y]-p1[Y]);}vd_D[Z]=vdgeo.vd_jb(p1[Z],p2[Z],vd_sE);vd_X[Z]=vdgeo.vd_jb(p1[Z],p2[Z],vd_sz);}return vd_ei;};vdgeo.vd_wK=function(vd_dn,vd_ck,vd_cP,vd_dP,p1,p2,vd_D,vd_X){var vd_bu=0,vd_bQ=0;var done=false;vd_D[X]=p1[X];vd_D[Y]=p1[Y];vd_X[X]=p2[X];vd_X[Y]=p2[Y];var vd_ei;vd_ei=0;done=false;do{vd_bu=vd_bQ=0;if(vd_D[X]<vd_dn){vd_bu|=1;}else if(vd_D[X]>vd_cP){vd_bu|=2;}if(vd_D[Y]<vd_ck){vd_bu|=4;}else if(vd_D[Y]>vd_dP){vd_bu|=8;}if(vd_X[X]<vd_dn){vd_bQ|=1;}else if(vd_X[X]>vd_cP){vd_bQ|=2;}if(vd_X[Y]<vd_ck){vd_bQ|=4;}else if(vd_X[Y]>vd_dP){vd_bQ|=8;}if((vd_bu&vd_bQ)>0){done=true;vd_ei=1;}else{if((vd_bu|vd_bQ)===0){done=true;}else{vd_ei=2;if(vd_bu===0){if((vd_bQ&8)>0){vd_X[X]+=(vd_dP-vd_X[Y])*((vd_D[X]-vd_X[X])/(vd_D[Y]-vd_X[Y]));vd_X[Y]=vd_dP;}else if((vd_bQ&4)>0){vd_X[X]+=(vd_ck-vd_X[Y])*((vd_D[X]-vd_X[X])/(vd_D[Y]-vd_X[Y]));vd_X[Y]=vd_ck;}else if((vd_bQ&2)>0){vd_X[Y]+=(vd_cP-vd_X[X])*((vd_D[Y]-vd_X[Y])/(vd_D[X]-vd_X[X]));vd_X[X]=vd_cP;}else if((vd_bQ&1)>0){vd_X[Y]+=(vd_dn-vd_X[X])*((vd_D[Y]-vd_X[Y])/(vd_D[X]-vd_X[X]));vd_X[X]=vd_dn;}}else{if((vd_bu&8)>0){vd_D[X]+=(vd_dP-vd_D[Y])*((vd_X[X]-vd_D[X])/(vd_X[Y]-vd_D[Y]));vd_D[Y]=vd_dP;}else if((vd_bu&4)>0){vd_D[X]+=(vd_ck-vd_D[Y])*((vd_X[X]-vd_D[X])/(vd_X[Y]-vd_D[Y]));vd_D[Y]=vd_ck;}else if((vd_bu&2)>0){vd_D[Y]+=(vd_cP-vd_D[X])*((vd_X[Y]-vd_D[Y])/(vd_X[X]-vd_D[X]));vd_D[X]=vd_cP;}else if((vd_bu&1)>0){vd_D[Y]+=(vd_dn-vd_D[X])*((vd_X[Y]-vd_D[Y])/(vd_X[X]-vd_D[X]));vd_D[X]=vd_dn;}}}}}while(!done);return vd_ei;};vdgeo.vd_Gx=function(x1,y1,z1,x2,y2,z2,x,y){var gradient=0;if((x2-x1)!=0.0){gradient=(x-x1)/(x2-x1);}else if((y2-y1)!=0.0){gradient=(y-y1)/(y2-y1);}else{gradient=0;}return vdgeo.vd_jb(z1,z2,gradient);};vdgeo.vd_Bj=function(value){return Math.max(0,Math.min(value,1));};vdgeo.vd_jb=function(min,max,gradient){return min+(max-min)*vdgeo.vd_Bj(gradient);};vdgeo.vd_bK=function(min,max,gradient){return min+(max-min)*gradient;};vdgeo.EPSILON=4.94066e-324;vdgeo.INCH_MM=25.4;vdgeo.VD_TWOPI=6.2831853071796;vdgeo.HALF_PI=1.5707963267948;vdgeo.PI=3.1415926535898;vdgeo.VD_270PI=4.7123889803844;vdgeo.vd_gS=0.00001;vdgeo.DefaultLinearEquality=0.00000001;vdgeo.DefaultPointEquality=0.00000001;vdgeo.DefaultVectorEquality=0.000001;vdgeo.DefaultAngularEquality=0.000001;vdgeo.vd_vJ=0.000001;vdgeo.vd_Hb=0.000001;vdgeo.DefaultScaleEquality=0.0000000001;vdgeo.vd_zZ=0.0000000001;vdgeo.vd_Dl=1.0e+09;vdgeo.CURVERESOLUTION=200;vdgeo.vd_EA=false;vdgeo.AreEqual=function(val1,val2,eq){return(Math.abs(val1-val2)<=eq);};vdgeo.DegreesToRadians=function(vd_AR){return(vdgeo.PI/180.0)*vd_AR;};vdgeo.RadiansToDegrees=function(vd_Gt){return(vd_Gt*(180.0/vdgeo.PI));};vdgeo.vd_GJ=function(vd_dH,vd_dg){if(!vdgeo.vd_EA)return false;return vdgeo.AreEqual(vd_dH,vd_dg,vdgeo.DefaultLinearEquality)||vdgeo.AreEqual(Math.abs(vd_dg-vd_dH),vdgeo.VD_TWOPI,vdgeo.DefaultLinearEquality);};vdgeo.FixAngle=function(vd_nk,vd_aa){if(vd_aa==undefined)vd_aa=vdgeo.DefaultAngularEquality;if(vdgeo.AreEqual(vd_nk,vdgeo.VD_TWOPI,vd_aa))return vdgeo.VD_TWOPI;var angle=vd_nk;angle=angle%vdgeo.VD_TWOPI;if(angle>(vdgeo.VD_TWOPI+vd_aa))angle-=vdgeo.VD_TWOPI;if((angle+vd_aa)<0.0)angle+=vdgeo.VD_TWOPI;if(vdgeo.AreEqual(angle,0.0,vd_aa))return 0.0;if(vdgeo.AreEqual(angle,vdgeo.HALF_PI,vd_aa))return vdgeo.HALF_PI;if(vdgeo.AreEqual(angle,vdgeo.PI,vd_aa))return vdgeo.PI;if(vdgeo.AreEqual(angle,vdgeo.VD_270PI,vd_aa))return vdgeo.VD_270PI;if(vdgeo.AreEqual(angle,vdgeo.VD_TWOPI,vd_aa))return vdgeo.VD_TWOPI;return angle;};vdgeo.vd_pj=function(vd_br,rad,sa,ea,elevation){var da=(ea-sa);da=vdgeo.FixAngle(da);if(vdgeo.vd_GJ(sa,ea))da=vdgeo.VD_TWOPI;var vd_gT=da/vd_br;var aa=vdgeo.FixAngle(sa);var vd_kZ=[];for(var i=0;i<vd_br;i++){vd_kZ.push(vdgeo.newpoint(rad*Math.cos(aa),rad*Math.sin(aa),elevation));aa=aa+vd_gT;}return vd_kZ;};vdgeo.vd_hz=function(vd_cO,vd_cy,Radius,vd_hm){vd_hm=vdgeo.FixAngle(vd_hm);var nseg;var vd_po,ar1;var vd_pc,vd_nz,fi1;vd_nz=400;if(vd_cO>1000)vd_nz*=(vd_cO/1000);vd_po=vd_hm/vdgeo.VD_TWOPI;if((vd_pc=vdgeo.vd_R(8.99*vd_po))<1)vd_pc=1;ar1=0.3222*Math.sqrt(vd_cO*Radius/vd_cy);ar1*=vd_po;if(ar1<vd_pc)ar1=vd_pc;else if(ar1>vd_nz)ar1=vd_nz;nseg=vdgeo.vd_R(ar1);if(Math.abs(vd_po-1.0)<vdgeo.DefaultLinearEquality&&(fi1=nseg%4)!=0)nseg+=4-fi1;return Math.max(nseg,8);};vdgeo.vd_mt=function(vd_cO,vd_cy,vd_jf,vd_ab){var vd_kr=0.0;for(var k=1;k<vd_jf.length-1;k++){vd_kr=Math.max(vdgeo.Distance3D(vd_jf[k],vd_jf[k+1]),vd_kr);}if(vd_ab){vd_kr=Math.max(vdgeo.Distance3D(vd_jf[vd_jf.length-1],vd_jf[0]),vd_kr);}var vd_br=vdgeo.vd_hz(vd_cO,vd_cy,vd_kr/2.0,vdgeo.PI);return Math.min(vd_br,100);};vdgeo.Bulge2Arc=function(p1,p2){if(!p1[B]||vdgeo.AreEqual(p1[B],0.0,vdgeo.vd_vJ))return null;vd_en=vdgeo.Distance2D(p1,p2);if(vdgeo.AreEqual(vd_en,0.0,vdgeo.vd_vJ))return null;var Center=null,Radius=0.0,vd_dM=0.0,vd_eq=0.0;var vd_en,vd_kp;vd_kp=(p1[B]*vd_en)/2.0;Radius=((vd_en/2.0)*(vd_en/2.0)+(vd_kp*vd_kp))/(vd_kp*2.0);Center=vdgeo.MidPoint(p1,p2);Center=vdgeo.pointPolar(Center,vdgeo.GetAngle(p1,p2)+vdgeo.PI/2.0,(Radius-vd_kp));vd_dM=vdgeo.GetAngle(Center,((p1[B]>0)?p1:p2));vd_eq=vdgeo.GetAngle(Center,((p1[B]>0)?p2:p1));Radius=Math.abs(Radius);return[Center,Radius,vd_dM,vd_eq];};vdgeo.Arc2Bulge=function(Radius,vd_yi){var alt=Math.abs(Radius-(Math.cos(vd_yi/2.0)*Radius));var vd_en=2.0*alt/Math.tan(vd_yi/4.0);if(vdgeo.AreEqual(vd_en,0.0,vdgeo.DefaultLinearEquality))return 0.0;var vd_ft=2.0*alt/vd_en;return vd_ft;};function vd_oI(vd_br,pts,pA,pB,pC){var t,x,y,z=pA[Z];for(var i=1;i<vd_br-1;i++){t=i/vd_br;x=(pA[X]-2.0*pB[X]+pC[X])*t*t+(2.0*pB[X]-2.0*pA[X])*t+pA[X];y=(pA[Y]-2.0*pB[Y]+pC[Y])*t*t+(2.0*pB[Y]-2.0*pA[Y])*t+pA[Y];pts.push(vdgeo.newpoint(x,y,z));}pts.push(vdgeo.newpoint(pC[X],pC[Y],pC[Z]));};vdgeo.vd_EQ=function(vd_br,vd_aB){var Points=[];var pts=[];pts.length=3;pts[0]=vd_aB[0];for(var k=1;k<vd_aB.length;k++){pts[1]=vd_aB[k];Points.push(vdgeo.newpoint(pts[0][X],pts[0][Y],pts[0][Z]));if(k<vd_aB.length-1){pts[2]=vd_aB[k+1];if((k+1)!=vd_aB.length-1)pts[2]=vdgeo.MidPoint(pts[1],pts[2]);}vd_oI(vd_br,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];}return Points;};vdgeo.vd_uo=function(vd_cO,vd_cy,vd_aB,vd_ab){var vd_br=vdgeo.vd_mt(vd_cO,vd_cy,vd_aB,vd_ab);var Points=[];var pts=[];pts.length=3;pts[0]=vd_aB[0];for(var k=1;k<vd_aB.length;k++){pts[1]=vd_aB[k];if(k===1&&vd_ab){pts[0]=vdgeo.MidPoint(pts[0],pts[1]);}Points.push(vdgeo.newpoint(pts[0][X],pts[0][Y],pts[0][Z]));if(k<vd_aB.length-1){pts[2]=vd_aB[k+1];if((k+1)!=vd_aB.length-1||vd_ab)pts[2]=vdgeo.MidPoint(pts[1],pts[2]);}else{if(!vd_ab)break;pts[1]=vd_aB[vd_aB.length-1];pts[2]=vd_aB[0];pts[2]=vdgeo.MidPoint(pts[1],pts[2]);vd_oI(vd_br,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];pts[1]=vd_aB[0];pts[2]=Points[0];vd_oI(vd_br,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];break;}vd_oI(vd_br,Points,pts[0],pts[1],pts[2]);pts[0]=pts[2];}return Points;};vdgeo.vd_oF=function(vd_cO,vd_cy,vd_aB,vd_ab,StartTangent,EndTangent){var vd_eU=vdgeo.vd_mt(vd_cO,vd_cy,vd_aB,vd_ab);var vd_iZ=vd_DL(vd_aB,StartTangent,EndTangent,vd_ab);if(vd_iZ==null)return[];return vd_iZ.vd_tG(vd_eU);};vdgeo.vd_mh=function(vd_cO,vd_cy,vd_aB,vd_dG,vd_e,vd_ab){var vd_eU=vdgeo.vd_mt(vd_cO,vd_cy,vd_aB,vd_ab);var vd_iZ=new vdgeo.vd_so(vd_aB,vd_ab,3,vd_dG,vd_e);return vd_iZ.vd_tG(vd_eU);};vdgeo.vd_Ge=function(vd_cO,vd_cy,vd_aB,vd_dG,vd_e,vd_ab){var vd_eU=vdgeo.vd_mt(vd_cO,vd_cy,vd_aB,vd_ab);var vd_iZ=new vdgeo.vd_so(vd_aB,vd_ab,2,vd_dG,vd_e);return vd_iZ.vd_tG(vd_eU);};vdgeo.vd_Hl=function(pl,p1){if(!pl|| !p1|| !pl.VertexList||pl._t!==vdConst.vdPolyline_code)return null;var vd_jd=pl.ExtrusionVector;if(!vd_jd)vd_jd=vdgeo.newpoint(0,0,1);var vd_hw=vdgeo.vd_l();vdgeo.vd_aG(vd_hw,vd_jd);var vd_gi=vdgeo.vd_bc(vd_hw);var vd_bT=vdgeo.vd_nJ(vd_gi,pl.VertexList.Items);var vd_ab=pl.Flag===1;var pt1=vdgeo.vd_M(vd_gi,p1);var vd_nd={};var vd_hk=vdgeo.GetPlineSegmentIndexFromPoint(pt1,vd_bT,vd_ab,null,vd_nd);if(vd_hk<0|| !vd_nd.pt)return null;var sp1,ep1,arc1,a,b,a0,b0;pt1=vdgeo.vd_M(vd_gi,vd_nd.pt);sp1=vd_bT[vd_hk];if(vd_hk===vd_bT.length-1)ep1=vd_bT[0];else ep1=vd_bT[vd_hk+1];sp1=vdgeo.vd_ot(vd_gi,sp1);ep1=vdgeo.vd_ot(vd_gi,ep1);arc1=vdgeo.Bulge2Arc(sp1,ep1);if(!arc1){b=0.0;b0=0.0;}else{if(sp1[B]>0.0){a=vdgeo.FixAngle(arc1[3]-vdgeo.GetAngle(arc1[0],pt1));a0=vdgeo.FixAngle(vdgeo.GetAngle(arc1[0],pt1)-arc1[2]);}else{a=vdgeo.FixAngle(vdgeo.GetAngle(arc1[0],pt1)-arc1[2]);a0=vdgeo.FixAngle(arc1[3]-vdgeo.GetAngle(arc1[0],pt1));}b=vdgeo.Arc2Bulge(arc1[1],a)*Math.abs(sp1[B])/sp1[B];b0=vdgeo.Arc2Bulge(arc1[1],a0)*Math.abs(sp1[B])/sp1[B];}pl.VertexList.Items[vd_hk][B]=b0;var nv=vdgeo.vd_ot(vd_hw,[pt1[X],pt1[Y],pt1[Z],b]);pl.VertexList.Items.splice(vd_hk+1,0,nv);return[vd_hk+1,vd_nd.offset,vd_nd.vd_FT];};vdgeo.GetPlineSegmentIndexFromPoint=function(pt,vd_bT,vd_ab,vd_jd,vd_jB){if(!vd_jd)vd_jd=vdgeo.newpoint(0,0,1);var vd_hw=vdgeo.vd_l();vdgeo.vd_aG(vd_hw,vd_jd);var vd_gi=vdgeo.vd_bc(vd_hw);var vd_bH=vdgeo.vd_nJ(vd_gi,vd_bT);var p=vdgeo.vd_M(vd_gi,pt);var Center,sp,ep;var radius=0.0,vd_dH=0.0,vd_dg=0.0;var success=false;var sa,ea,pa,vd_mw;var vd_ku=null;var vd_nb=false;var dist=0.0;var vd_sZ=null;var vd_wV= -1;var vd_sa=0.0;var vd_cT=0.0;var offset=0.0;for(var i=0;i<=vd_bH.length-1;i++){sp=vd_bH[i];if(i==vd_bH.length-1){if(!vd_ab)break;ep=vd_bH[0];}else{ep=vd_bH[i+1];}success=vdgeo.Bulge2Arc(sp,ep);if(success==null){vd_ku=vdgeo.vd_DR(p,sp,ep);vd_cT=vdgeo.Distance3D(sp,ep);offset=vdgeo.Distance3D(vd_ku,sp);vd_nb=vdgeo.AreEqual(offset+vdgeo.Distance3D(vd_ku,ep),vd_cT,vdgeo.DefaultLinearEquality);}else{Center=success[0];radius=success[1];vd_dH=success[2];vd_dg=success[3];ea=vdgeo.FixAngle(vd_dg-vd_dH);sa=0.0;vd_mw=vdgeo.GetAngle(Center,p);pa=vdgeo.FixAngle(vd_mw-vd_dH);vd_cT=radius*ea;if(sp[B]>0.0)offset=radius*pa;else offset=radius*vdgeo.FixAngle(vd_dg-vd_mw);vd_ku=vdgeo.pointPolar(Center,vd_mw,radius);vd_nb=(pa<=ea);}if(vd_nb){dist=vdgeo.Distance3D(vd_ku,p);}else{dist=Math.min(vdgeo.Distance3D(sp,p),vdgeo.Distance3D(ep,p));}if(vd_sZ===null||dist<vd_sZ){vd_sZ=dist;vd_wV=i;if(vd_jB){if(vd_nb){vd_jB.pt=vdgeo.vd_M(vd_hw,vd_ku);vd_jB.offset=vd_sa+offset;}else{vd_jB.pt=null;}}}vd_sa+=vd_cT;}if(vd_jB)vd_jB.vd_FT=vd_sa;return vd_wV;};vdgeo.vd_Gy=function(vd_bH,vd_cO,vd_cy,vd_ab){var SamplePoints=[];var vd_br=8;var apts;var Center=vdgeo.newpoint(0,0,0);var radius=0.0,vd_dH=0.0,vd_dg=0.0;var success=false;var sp=null;var ep=null;for(var i=0;i<=vd_bH.length-1;i++){sp=vd_bH[i];if(i==vd_bH.length-1){if(!vd_ab)break;ep=vd_bH[0];}else{ep=vd_bH[i+1];}success=vdgeo.Bulge2Arc(sp,ep);if(success==null){SamplePoints.push(vdgeo.vd_tY(sp[X],sp[Y],sp[Z],i));}else{Center=success[0];radius=success[1];vd_dH=success[2];vd_dg=success[3];vd_br=vdgeo.vd_hz(vd_cO,vd_cy,radius,vdgeo.FixAngle(vd_dg-vd_dH));apts=vdgeo.vd_pj(vd_br,radius,vd_dH,vd_dg,0);apts.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),vd_dg,radius));if(vd_bH[i][B]<0.0)apts.reverse();var k;for(k=0;k<apts.length;k++)vdgeo.vd_Dm(apts[k],Center[X],Center[Y],Center[Z]);for(k=0;k<apts.length-1;k++){apts[k][INDEX]=i;SamplePoints.push(apts[k]);}}}if(ep!=null)SamplePoints.push(vdgeo.vd_tY(ep[X],ep[Y],ep[Z],vd_bH.length-1));return SamplePoints;};vdgeo.vd_EW=function(p1,p2,p3,len){var vd_nk=vdgeo.vd_hm(p1,p2,p3);var sinA=Math.sin(vd_nk*0.5);if(!vdgeo.AreEqual(sinA,0.0,vdgeo.DefaultAngularEquality))len/=sinA;if(vd_nk<vdgeo.PI)len*= -1;var m_e0=[p1[X]-p2[X],p1[Y]-p2[Y],p1[Z]-p2[Z]];var m_e1=[p3[X]-p2[X],p3[Y]-p2[Y],p3[Z]-p2[Z]];vdgeo.vd_cD(m_e0);vdgeo.vd_cD(m_e1);var v=[(m_e0[X]+m_e1[X])/2.0,(m_e0[Y]+m_e1[Y])/2.0,(m_e0[Z]+m_e1[Z])/2.0];vdgeo.vd_cD(v);v[X]*=len;v[Y]*=len;v[Z]*=len;return v;};vdgeo.vd_GH=function(vd_bH,vd_ab,width){if(width==0.0)return null;var vd_es=[];var vd_rL=width/2.0;var vd_mJ=[0,0,0];var sp=null;var ep=null;var pp=null;var v=null;for(var i=0;i<vd_bH.length;i++){sp=vd_bH[i];if(i===0){ep=vd_bH[i+1];if(vd_ab)pp=vd_bH[vd_bH.length-2];else pp=null;}else if(i===vd_bH.length-1){pp=vd_bH[i-1];if(vd_ab)ep=vd_bH[1];else ep=null;}else{ep=vd_bH[i+1];pp=vd_bH[i-1];}if(!pp){v=vdgeo.pointPolar(vd_mJ,vdgeo.GetAngle(sp,ep)+vdgeo.HALF_PI,vd_rL);}else if(!ep){v=vdgeo.pointPolar(vd_mJ,vdgeo.GetAngle(pp,sp)+vdgeo.HALF_PI,vd_rL);}else{v=vdgeo.vd_EW(pp,sp,ep,vd_rL)}vd_es.push(v);}return vd_es;};vdgeo.vd_oc=function(angle,vd_je,vd_mr){var vd_bg=vdgeo.newpoint(0,0,0);if(vdgeo.AreEqual(vd_je,0.0,vdgeo.DefaultLinearEquality)||vdgeo.AreEqual(vd_mr,0.0,vdgeo.DefaultLinearEquality))return vd_bg;angle=vdgeo.FixAngle(angle);var f=Math.tan(angle);vd_bg[X]=Math.sqrt(Math.pow(vd_je,2)*Math.pow(vd_mr,2)/(Math.pow(vd_mr,2)+Math.pow(vd_je,2)*Math.pow(f,2)));vd_bg[Y]=Math.abs(vd_bg[X]*f);if(angle>=0.0&&angle<vdgeo.HALF_PI){}else if(angle>=vdgeo.HALF_PI&&angle<vdgeo.PI){vd_bg[X]*= -1.0;}else if(angle>=vdgeo.PI&&angle<(3.0*vdgeo.HALF_PI)){vd_bg[X]*= -1.0;vd_bg[Y]*= -1.0;}else if(angle>=(3.0*vdgeo.HALF_PI)&&angle<vdgeo.VD_TWOPI){vd_bg[Y]*= -1.0;}return vd_bg;};vdgeo.vd_nQ=function(vd_cO,vd_cy,vd_je,vd_hm){return Math.max(vdgeo.vd_hz(vd_cO,vd_cy,vd_je,vd_hm),64);};vdgeo.vd_pf=function(vd_br,vd_je,vd_mr,sa,ea){if(vdgeo.AreEqual(sa,ea,vdgeo.DefaultAngularEquality))ea+=vdgeo.VD_TWOPI;var da=vdgeo.FixAngle(ea-sa);var vd_gT=da/vd_br;var aa=vdgeo.FixAngle(sa);var vd_kZ=[];for(var i=0;i<vd_br+1;i++){vd_kZ.push(vdgeo.vd_oc(aa,vd_je,vd_mr));aa=aa+vd_gT;}return vd_kZ;};vdgeo.vd_fI=function(p1,p2,vd_aa){return vdgeo.AreEqual(p1[X],p2[X],vd_aa)&&vdgeo.AreEqual(p1[Y],p2[Y],vd_aa)&&vdgeo.AreEqual(p1[Z],p2[Z],vd_aa);};vdgeo.vd_xx=function(pts){return vdgeo.vd_fI(pts[0],pts[pts.length-1],vdgeo.DefaultPointEquality);};vdgeo.vd_lU=function(p1,p2,p3,p4,vd_aa,vd_bg){var x1=p1[X],x2=p2[X],x3=p3[X],x4=p4[X],y1=p1[Y],y2=p2[Y],y3=p3[Y],y4=p4[Y];var dx=(x1+x2+x3+x4)/4.0;var dy=(y1+y2+y3+y4)/4.0;x1-=dx;x2-=dx;x3-=dx;x4-=dx;y1-=dy;y2-=dy;y3-=dy;y4-=dy;var A1=y4-y3;var B1=x3-x4;var A2=y2-y1;var B2=x1-x2;var DD=A1*B2-A2*B1;if(vdgeo.AreEqual(DD,0.0,vd_aa))return 0;var G1=x4*y3-x3*y4;var G2=x2*y1-x1*y2;var DX=B1*G2-B2*G1;var DY=A2*G1-A1*G2;vd_bg[X]=(DX/DD)+dx;vd_bg[Y]=(DY/DD)+dy;vd_bg[Z]=p1[Z];return 1;};vdgeo.vd_GE=function(p1,p2,p3){var mp1=vdgeo.MidPoint(p1,p2);var mp2=vdgeo.MidPoint(p2,p3);var mp1a=vdgeo.pointPolar(mp1,vdgeo.GetAngle(p1,p2)+vdgeo.HALF_PI,1.0);var mp2a=vdgeo.pointPolar(mp2,vdgeo.GetAngle(p2,p3)+vdgeo.HALF_PI,1.0);var vd_bg=vdgeo.newpoint(0,0,0);vdgeo.vd_lU(mp1,mp1a,mp2,mp2a,vdgeo.DefaultVectorEquality,vd_bg);return vd_bg;};vdgeo.vd_Gi=function(p1,p2,p3){var sa=0.0,sb=0.0;sa+=(p1[X]*p2[Y]);sb+=(p1[Y]*p2[X]);sa+=(p2[X]*p3[Y]);sb+=(p2[Y]*p3[X]);sa+=(p3[X]*p1[Y]);sb+=(p3[Y]*p1[X]);return(sb-sa)/2.0;};vdgeo.GetPointsArea=function(pts){if(!pts||pts.length==0)return 0.0;var sa=0.0;var sb=0.0;for(var i=0;i<pts.length-1;i++){sa+=(pts[i][X]*pts[i+1][Y]);sb+=(pts[i][Y]*pts[i+1][X]);}sa+=(pts[pts.length-1][X]*pts[0][Y]);sb+=(pts[pts.length-1][Y]*pts[0][X]);return(sb-sa)/2.0;};vdgeo.vd_FR=function(vd_aO){if(!vd_aO||vd_aO.length==0)return 0.0;var area=vdgeo.GetPointsArea(vd_aO);var Center;var Radius;var vd_dM;var vd_eq;var vd_en;var vd_rs;var alt;var vd_sp;var p1;var p2;for(var i=0;i<vd_aO.length;i++){p1=vd_aO[i];if(i==vd_aO.length-1)p2=vd_aO[0];else p2=vd_aO[i+1];var ret=vdgeo.Bulge2Arc(p1,p2);if(!ret)continue;Center=ret[0];Radius=ret[1];vd_dM=ret[2];vd_eq=ret[3];vd_en=vdgeo.Distance2D(p1,p2);vd_rs=Math.atan(Math.abs(p1[B]))*4.0;alt=Radius-(Radius*Math.cos(vd_rs/2.0));vd_sp=vd_rs/2.0*Radius*Radius;vd_sp+=(vd_en*(alt-Radius)/2.0);area+=(-1.0*(p1[B]/Math.abs(p1[B]))*vd_sp);}return area;};vdgeo.vd_wJ=function(vd_aO,closed){if(!vd_aO||vd_aO.length==0)return 0.0;var vd_uc=0;var Center;var Radius;var vd_dM;var vd_eq;var p1;var p2;for(var i=0;i<vd_aO.length;i++){p1=vd_aO[i];if(i==vd_aO.length-1){if(!closed)continue;p2=vd_aO[0];}else p2=vd_aO[i+1];var ret=vdgeo.Bulge2Arc(p1,p2);if(!ret){vd_uc+=vdgeo.Distance3D(p1,p2);}else{Center=ret[0];Radius=ret[1];vd_dM=ret[2];vd_eq=ret[3];vd_uc+=Radius*vdgeo.FixAngle(vd_eq-vd_dM);}}return vd_uc;};vdgeo.vd_jX=function(vd_aO,length,closed){var vd_bz=[];if(!vd_aO||vd_aO.length==0)return vd_bz;vd_bz.push(vdgeo.pointPolar(vd_aO[0],0.0,0.0));var cl=0.0;var cl1=0.0;var Center;var Radius;var vd_dM;var vd_eq;var p1;var p2;for(var i=0;i<vd_aO.length;i++){p1=vd_aO[i];if(i==vd_aO.length-1){if(!closed)continue;p2=vd_aO[0];}else p2=vd_aO[i+1];var ret=vdgeo.Bulge2Arc(p1,p2);if(!ret){vd_dM=vdgeo.GetAngle(p1,p2);cl1=vdgeo.Distance3D(p1,p2);while((cl+cl1+vdgeo.DefaultLinearEquality)>=length){p1=vdgeo.pointPolar(p1,vd_dM,length-cl);vd_bz.push(p1);cl1-=(length-cl);cl=0;}}else{Center=ret[0];Radius=ret[1];vd_dM=ret[2];vd_eq=ret[3];cl1=Radius*vdgeo.FixAngle(vd_eq-vd_dM);while((cl+cl1+vdgeo.DefaultLinearEquality)>=length){vd_dM+=(length-cl)/Radius;p1=vdgeo.pointPolar(Center,vd_dM,Radius);vd_bz.push(p1);cl1-=(length-cl);cl=0;}}cl+=cl1;}if(vd_bz.length==1)vd_bz=[];return vd_bz;};function vd_Ea(vd_nP,n,vd_cj){var i=0;var vd_e=[];vd_e.length=n;var prev=vd_nP[0];vd_e[0]=0;for(i=1;i<n;i++){var curr=vd_nP[i];var distance=vdgeo.Distance2D(prev,curr);vd_e[i]=vd_e[i-1]+distance;prev=curr;}var vd_qk=n+(2*vd_cj);var vd_du=[];vd_du.length=vd_qk;for(i=0;i<vd_cj;i++)vd_du[i]=vd_e[0];for(i=0;i<n;i++)vd_du[i+vd_cj]=vd_e[i];for(i=1;i<=vd_cj;i++)vd_du[vd_qk-i]=vd_e[n-1];return vd_du;};function T(k,t){var d=3;return t[d-1+(k)];};function vd_CG(nS,rAt,vd_e){var d=3;var m=0;var j=0;var t=[];t.length=d*2;for(j=0,m=nS-d+1;j<2*d;m++,j++)t[j]=vd_e[m];var v=[];v[0]=[];v[0].length=1;v[0][0]=1.0;for(m=1;m<=d;m++){v[m]=[];v[m].length=m+1;v[m][0]=v[m-1][0]*((T(1,t)-rAt)/(T(1,t)-T(-m+1,t)));for(j=1;j<m;j++){v[m][j]=v[m-1][j-1]*((rAt-T(-m+j,t))/(T(j,t)-T(-m+j,t)))+v[m-1][j]*((T(j+1,t)-rAt)/(T(j+1,t)-T(-m+j+1,t)));}v[m][m]=v[m-1][m-1]*((rAt-T(0,t))/(T(m,t)-T(0,t)));}return v[d];};function vd_DU(alpha,beta,vd_db,low,up){up.length=beta.length;low.length=beta.length;up[0]=beta[0];for(var i=1;i<beta.length;i++){low[i]=alpha[i]/up[i-1];up[i]=beta[i]-low[i]*vd_db[i-1];}};function vd_sh(low,up,vd_db,D,X){var n=low.length;var i=0;X.length=n;var y=[];y.length=n;y[0]=D[0];for(i=1;i<n;i++)y[i]=D[i]-low[i]*y[i-1];X[n-1]=y[n-1]/up[n-1];for(i=n-2;i>=0;i--)X[i]=(y[i]-vd_db[i]*X[i+1])/up[i];};var vd_tB=vdgeo.newpoint(0,0,0);function vd_DL(vd_bo,StartTangent,EndTangent,closed){var s1,t1,r1;var i=0;var vd_qr=vdgeo.vd_xx(vd_bo);closed=closed||vd_qr;var n=vd_bo.length;if(closed&&vd_qr)n--;if(n<3)return null;if(StartTangent==undefined)StartTangent=null;if(EndTangent==undefined)EndTangent=null;if(closed){if(StartTangent==null||EndTangent==null){if(!vd_qr)vd_bo[n]=vd_bo[0];n=vd_bo.length;var cen=vdgeo.vd_GE(vd_bo[n-2],vd_bo[0],vd_bo[1]);var area=vdgeo.vd_Gi(vd_bo[n-2],vd_bo[0],vd_bo[1]);if(!vdgeo.AreEqual(area,0.0,vdgeo.DefaultLinearEquality)){var ang=vdgeo.GetAngle(cen,vd_bo[0])+vdgeo.PI/2.0-vdgeo.PI*(area>0?1.0: -1.0);if(StartTangent==null)StartTangent=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),ang,1.0);if(EndTangent==null)EndTangent=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),ang,1.0)}}}var vd_Fh=(StartTangent!=null&& !vdgeo.vd_fI(StartTangent,vd_tB,vdgeo.DefaultPointEquality));var vd_Fb=(EndTangent!=null&& !vdgeo.vd_fI(EndTangent,vd_tB,vdgeo.DefaultPointEquality));var vd_jY=null,vd_jT=null;n=vd_bo.length;var nCP=n+2;var vd_qk=n+6;var vd_e=vd_Ea(vd_bo,n,3);var alpha=[];alpha.length=nCP;for(i=0;i<alpha.length;i++)alpha[i]=0;var beta=[];beta.length=nCP;for(i=0;i<beta.length;i++)beta[i]=0;var vd_db=[];vd_db.length=nCP;for(i=0;i<vd_db.length;i++)vd_db[i]=0;if(vd_Fh){vd_jY=vdgeo.vd_uh(StartTangent,(0.333333333333333*(vd_e[4]-vd_e[3])));alpha[1]= -1.0;}else{s1=vd_e[4]-vd_e[3];t1=vd_e[5]-vd_e[3];r1=s1+t1;alpha[1]= -t1/r1;vd_db[1]= -s1/r1;vd_jY=vdgeo.newpoint(0,0,0);}beta[0]=beta[1]=1.0;for(i=2;i<nCP-2;i++){var temp=vd_CG(i+1,vd_e[i+2],vd_e);alpha[i]=temp[1];beta[i]=temp[2];vd_db[i]=temp[3];}if(vd_Fb){vd_db[nCP-2]= -1.0;vd_jT=vdgeo.vd_uh(EndTangent,(-0.333333333333333*(vd_e[nCP]-vd_e[nCP-1])));}else{s1=vd_e[nCP]-vd_e[nCP-1];t1=vd_e[nCP]-vd_e[nCP-2];r1=s1+t1;alpha[nCP-2]= -s1/r1;vd_db[nCP-2]= -t1/r1;vd_jT=vdgeo.newpoint(0,0,0);}beta[nCP-2]=beta[nCP-1]=1;var low=[];var up=[];vd_DU(alpha,beta,vd_db,low,up);var right=[];right.length=nCP;var vd_tW=[];right[0]=vd_bo[0][X];right[1]=vd_jY[X];for(i=1;i<n-1;i++)right[i+1]=vd_bo[i][X];right[nCP-2]=vd_jT[X];right[nCP-1]=vd_bo[n-1][X];vd_sh(low,up,vd_db,right,vd_tW);var vd_tI=[];right[0]=vd_bo[0][Y];right[1]=vd_jY[Y];for(i=1;i<n-1;i++)right[i+1]=vd_bo[i][Y];right[nCP-2]=vd_jT[Y];right[nCP-1]=vd_bo[n-1][Y];vd_sh(low,up,vd_db,right,vd_tI);var vd_tA=[];right[0]=vd_bo[0][Z];right[1]=vd_jY[Z];for(i=1;i<n-1;i++)right[i+1]=vd_bo[i][Z];right[nCP-2]=vd_jT[Z];right[nCP-1]=vd_bo[n-1][Z];vd_sh(low,up,vd_db,right,vd_tA);var vd_xa=[];for(i=0;i<nCP;i++)vd_xa.push(vdgeo.newpoint(vd_tW[i],vd_tI[i],vd_tA[i]));return new vdgeo.vd_so(vd_xa,closed,3,null,vd_e);};vdgeo.vd_so=function(vd_li,closed,vd_cj,vd_dG,vd_e){var vd_hF=null;var vd_bJ=null;var vd_pa=false;var vd_fO=3;var vd_pd=null;var vd_vF=false;if(vd_dG==undefined)vd_dG=null;if(vd_e==undefined)vd_e=null;vd_pa=closed;vd_hF=vd_li;vd_fO=Math.min(vd_li.length-1,vd_cj);if(vd_e!=null&&vd_Bd(vd_li.length,vd_pa,vd_cj)==vd_e.length)vd_bJ=vd_e;else vd_bJ=vd_Ed(vd_li,vd_pa,vd_cj);if(vd_dG!=null&&vd_dG.length==vd_li.length){vd_pd=vd_dG;}else{vd_pd=[];for(var i=0;i<vd_li.length;i++)vd_pd.push(1.0);}vd_vF=vd_Ex();var vd_CW=9;var vd_vE=1e-9;function vd_Bd(vd_uL,closed,vd_cj){if(closed)return vd_uL+1;else return vd_uL+vd_cj+1;};function vd_Ex(){var rc=false;var i,j;if(vd_fO<1||vd_fO>vd_CW||vd_ly()<vd_vE||vd_eL()<Math.min(vd_fO,3))return false;for(i=0;;i=j){for(j=i+1;j<Size()&&vdgeo.AreEqual(vd_bJ[j],vd_bJ[i],vd_vE);j++)vd_bJ[j]=vd_bJ[i];if(j>=vd_eL())break;if(vd_bJ[j]<vd_bJ[i])return false;}rc=true;vd_Bu();return rc;};function vd_Ed(vd_nP,closed,vd_cj){var n=vd_nP.length;var i=0;var vd_du=[];if(closed){for(i=0;i<=n;i++)vd_du.push(i);}else{for(i=0;i<=vd_cj;i++)vd_du.push(0.0);for(i=vd_cj+1;i<=n;i++)vd_du.push(i-vd_cj);for(i=0;i<vd_cj;i++)vd_du.push(vd_du[vd_du.length-1]);}return vd_du;};function vd_eL(){return vd_bJ.length-1;};function vd_ly(){return vd_bJ[vd_bJ.length-1]-vd_bJ[0];};function Knot(vd_at){var k=0,vd_ng=vd_at;while(vd_ng>=vd_eL()){vd_ng-=vd_eL();k++;}while(vd_ng<0){vd_ng+=vd_eL();k--;}return vd_bJ[vd_ng]+k*vd_ly();};function vd_Cx(vd_at){var vd_hl=vd_hF.length;while(vd_at>=vd_hl)vd_at-=vd_hl;while(vd_at<0)vd_at+=vd_hl;return vd_hF[vd_at];};function vd_BZ(vd_at){var vd_hl=vd_hF.length;while(vd_at>=vd_hl)vd_at-=vd_hl;while(vd_at<0)vd_at+=vd_hl;return vd_pd[vd_at];};var vd_aS=0;function vd_Bu(){vd_aS=vd_eL()-1;};function vd_Do(){if(vd_eL()<=vd_fO||vd_bJ[vd_fO]!=vd_bJ[0])return vd_ly();else return 0;};function vd_Ep(t,vd_eN){var rc=true;var s=vd_bJ[0]+vd_ly();vd_eN=0;while(t>s){t-=vd_ly();vd_eN++;}while(t<vd_bJ[0]){t+=vd_ly();vd_eN--;}if(Math.abs(vd_eN)>8)rc=false;else vd_eN*=vd_eL();return[rc,t,vd_eN];};function Size(){return vd_bJ.length-1;};function vd_DB(vd_Gk,vd_hq,nTop){if(vd_hq>nTop)throw new vd_nA();while(true){var nMid=(vd_hq+nTop)/2;if(nMid==vd_hq)return vd_hq;if(vd_Gk>=vd_bJ[nMid])vd_hq=nMid;else nTop=nMid;}};function vd_Bn(vd_up,t,vd_tp){var rc=true;var nTop,vd_hq;var vd_eN=0;list:{if(vd_eL()<=0){rc=false;break list;}if(vd_Do()!=0.0){var retf=vd_Ep(t,vd_eN);t=retf[1];vd_eN=retf[2];if(retf[0]==false){rc=false;break list;}}if(t>=vd_bJ[vd_aS]){if(vd_aS>=Size()-1)break list;if(t<vd_bJ[vd_aS+1])break list;vd_aS++;if(vd_aS>=Size()-1)break list;if(t<vd_bJ[vd_aS+1])break list;vd_hq=vd_aS+1;nTop=Size()-1;}else{if(vd_aS<=0)break list;vd_aS--;if(vd_aS<=0||t>=vd_bJ[vd_aS])break list;vd_hq=0;nTop=vd_aS;}vd_aS=vd_DB(t,vd_hq,nTop);if(t>vd_bJ[vd_eL()-1])vd_aS=vd_eL()-1;if(t<vd_bJ[0])vd_aS=0;}while(vd_aS<vd_eL()-1&&vd_bJ[vd_aS]>=vd_bJ[vd_aS+1])vd_aS++;vd_tp=vd_aS+vd_eN;return[rc,vd_tp];};function vd_uX(u,i,vd_up){var j=0;var d=vd_fO;var D=[];D.length=d+1;var w=[];w.length=d+1;var t=[];t.length=2*(d+1);if(vd_vF){var retf=vd_Bn(vd_up,u,i);i=retf[1];if(!retf[0])throw new vd_nA()}for(j=0;j<=d;j++){w[j]=vd_BZ(i+j-d);var pt=vd_Cx(i+j-d);D[j]=vdgeo.newpoint(pt[X],pt[Y],pt[Z]);D[j][X]*=w[j];D[j][Y]*=w[j];D[j][Z]*=w[j];}for(j=0;j<=2*d+1;j++)t[j]=Knot(i-d+j);for(var k=d;k>0;k--){for(j=1;j<=k;j++){var s=(u-t[d-k+j])/(t[d+j]-t[d-k+j]);w[j-1]+=(w[j]-w[j-1])*s;D[j-1][X]+=(D[j][X]-D[j-1][X])*s;D[j-1][Y]+=(D[j][Y]-D[j-1][Y])*s;D[j-1][Z]+=(D[j][Z]-D[j-1][Z])*s;}}return vdgeo.newpoint(D[0][X]/w[0],D[0][Y]/w[0],D[0][Z]/w[0]);};this.vd_tG=function(vd_eU){vd_eU=Math.max(vd_eU,8);var ret=[];if(vd_hF.length<2)return ret;var pt=null;var vd_jw;var vd_iq;var rTo=vd_bJ[vd_bJ.length-1];var vd_rb;if(vd_bJ[0]==vd_bJ[1]){vd_rb=vd_fO;vd_iq=vd_bJ[vd_fO];}else{vd_iq=vd_bJ[0];vd_rb=0;}for(var span=vd_rb;vd_iq<rTo;vd_iq=vd_jw,span++){vd_jw=Knot(span+1);if(rTo<vd_jw)vd_jw=rTo;if(vdgeo.AreEqual(vd_jw-vd_iq,0.0,vdgeo.DefaultLinearEquality))continue;var t=vd_iq;pt=vd_uX(t,span,0);if(!(ret.length>0&&vdgeo.vd_fI(ret[ret.length-1],pt,vdgeo.DefaultPointEquality))){ret.push(pt);}var d=(vd_jw-t)/vd_eU;if(vdgeo.AreEqual(d,0.0,vdgeo.DefaultLinearEquality))continue;for(var j=1;j<vd_eU;j++){t+=d;pt=vd_uX(t,span,j);ret.push(pt);}}var vd_mc=null;if(vd_pa)vd_mc=ret[0];else vd_mc=vd_hF[vd_hF.length-1];ret.push(vdgeo.newpoint(vd_mc[X],vd_mc[Y],vd_mc[Z]));return ret;}};vdgeo.vd_qT=function(value){return vdgeo.vd_R(value);};vdgeo.vd_R=function(value){return(value|0);};vdgeo.vd_jW=function(x,y,vd_W,vd_O,vd_P,vd_u){if(x>=vd_W)if(x<=vd_P)if(y>=vd_O)if(y<=vd_u)return true;return false;};vdgeo.PointInRegion=function(x,y,pts){var i,j;var c=false;var Count=pts.length;for(i=0,j=Count-1;i<Count;j=i++){if((((pts[i][Y]<=y)&&(y<pts[j][Y]))||((pts[j][Y]<=y)&&(y<pts[i][Y])))){var dis=(pts[j][X]-pts[i][X])*(y-pts[i][Y])/(pts[j][Y]-pts[i][Y])+pts[i][X];if(x<dis&&(x!=dis))c= !c;}}return c;};vdgeo.vd_DR=function(P,P0,P1){if(vdgeo.vd_fI(P0,P1,vdgeo.vd_gS))return vdgeo.newpoint(P0[X],P0[Y],P0[Z]);var v=vdgeo.newpoint(P1[X]-P0[X],P1[Y]-P0[Y],P1[Z]-P0[Z]);var w=vdgeo.newpoint(P[X]-P0[X],P[Y]-P0[Y],P[Z]-P0[Z]);var c1=vdgeo.vd_dX(w,v);var c2=vdgeo.vd_dX(v,v);var b=c1/c2;return vdgeo.newpoint(P0[X]+v[X]*b,P0[Y]+v[Y]*b,P0[Z]+v[Z]*b);};vdgeo.vd_hm=function(p1,p2,p3){var vd_kt=vdgeo.GetAngle(p2,p3)-vdgeo.GetAngle(p2,p1);if(vd_kt<=0.0||vdgeo.AreEqual(vd_kt,0.0,0.000001))vd_kt=vd_kt+vdgeo.VD_TWOPI;return vd_kt;};var vd_cx={};vd_cx.vd_nX=20037508.342789244;vd_cx.vd_qQ=6378137.000;vd_cx.vd_Gz=function(lat,lon){var x=vd_cx.vd_qQ*vdgeo.DegreesToRadians(lon);var y=vd_cx.vd_qQ*Math.log(Math.tan((vdgeo.PI*0.25)+(0.5*vdgeo.DegreesToRadians(lat))));x=Math.min(vd_cx.vd_nX,Math.max(-vd_cx.vd_nX,x));y=Math.min(vd_cx.vd_nX,Math.max(-vd_cx.vd_nX,y));return[x,y];};vd_cx.vd_ET=function(noth,east){var lon=vdgeo.RadiansToDegrees(east/vd_cx.vd_qQ);var lat=vdgeo.RadiansToDegrees((vdgeo.PI*0.5)-2.0*Math.atan(Math.exp(-noth/vd_cx.vd_qQ)));return[lat,lon];};var _vdDocument=null;var _vdDocTmp=null;function vd_HU(vd_wd){if(vd_wd===null)return "[object Null]";return Object.prototype.toString.call(vd_wd);};var vdgdi={};vdgdi.vd_ha=function(color){return "#"+((1<<24)+(color[0]<<16)+(color[1]<<8)+color[2]).toString(16).slice(1);};vdgdi.vd_ok=function(col){var ret=0;ret+=(col[0]*col[0]);ret+=(col[1]*col[1]);ret+=(col[2]*col[2]);return Math.sqrt(ret);};vdgdi.WHITE=[255,255,255,255];vdgdi.BLACK=[0,0,0,255];vdgdi.vd_BM=61;var vdConst={};vdConst.ActionHighLightColor=[];vdConst.Err_LoadFile=1;vdConst.vd_cQ=2;vdConst.vdLine_code=1;vdConst.vdPolyline_code=2;vdConst.vdText_code=3;vdConst.vdRect_code=4;vdConst.vdCircle_code=5;vdConst.vdEllipse_code=6;vdConst.vdArc_code=7;vdConst.vdImage_code=8;vdConst.vdInsert_code=9;vdConst.vd3DFace_code=10;vdConst.vdPolyface_code=11;vdConst.vdAttrib_code=12;vdConst.vdAttribDef_code=13;vdConst.vdInfinityLine_code=14;vdConst.vdPoint_code=15;vdConst.vdViewport_code=16;vdConst.vdPolyhatch_code=17;vdConst.vdLayout_code=18;vdConst.vdBlock_code=19;vdConst.vdLayer_code=20;vdConst.vdTextstyle_code=21;vdConst.vdHatchPattern_code=22;vdConst.vdLineType_code=23;vdConst.vdDimension_code=24;vdConst.vdMText_code=25;vdConst.vdImageDef_code=26;vdConst.vdMultiline_code=27;vdConst.vdGroundSurface_code=28;vdConst.vdLeader_code=29;vdConst.vdGroup_code=31;vdConst.vd_zA=30;vdConst.vdView_code=32;vdConst.vd_xd=function(path){return path.replace('\\','/').split('/').pop().split('&')[0].split('#')[0].split('?')[0];};vdConst.vd_Iq=function(obj){if(obj._t===undefined)return false;return obj._t===24||obj._t===25||(obj._t>=1&&obj._t<=17)||(obj._t>=27&&obj._t<=30);};vdConst.TextLineFlags_None=0;vdConst.TextLineFlags_UnderLine=1;vdConst.TextLineFlags_OverLine=2;vdConst.TextLineFlags_CenterLine=4;vdConst.VdConstTextstyle_BACKWARD=2;vdConst.VdConstTextstyle_BACKWARD_UPSIDEDOWN=6;vdConst.VdConstTextstyle_LEFTTORIGHT=0;vdConst.VdConstTextstyle_UPSIDEDOWN=4;vdConst.VdConstVerJust_VdTextVerBaseLine=24;vdConst.VdConstVerJust_VdTextVerBottom=8;vdConst.VdConstVerJust_VdTextVerCen=100;vdConst.VdConstVerJust_VdTextVerTop=0;vdConst.VdConstHorJust_VdTextHorAligned=103;vdConst.VdConstHorJust_VdTextHorCenter=6;vdConst.VdConstHorJust_VdTextHorFit=105;vdConst.VdConstHorJust_VdTextHorLeft=0;vdConst.VdConstHorJust_VdTextHorRight=2;vdConst.InfinityTypes_Ray=0;vdConst.InfinityTypes_XLine=1;vdConst.COLOR_BYLAYER=192;vdConst.LW_BYBLOCK= -2;vdConst.LW_BYLAYER= -1;vdConst.LW_DOCUMENTDEFAULT= -3;vdConst.TransparencyMethod_ByBlock=1;vdConst.TransparencyMethod_ByLayer=0;vdConst.BlockColorOper_Layer=0;vdConst.BlockColorOper_Block=1;vdConst.vd_Hg=0;vdConst.vd_zm=1;vdConst.vd_Aq=2;vdConst.vd_Ae=3;vdConst.PRINT_WINDOW_FLAG_EXTENTS=1;vdConst.PRINT_WINDOW_FLAG_VIEW=2;vdConst.PRINT_WINDOW_FLAG_ORIGINAL=3;vdConst.PRINT_SCALE_FLAG_FIT=1;vdConst.PRINT_SCALE_FLAG_ORIGINAL=3;vdConst.LINETYPE_FLAG_Dot=0;vdConst.LINETYPE_FLAG_TTF_TEXT=2;vdConst.LINETYPE_FLAG_SHX_TEXT=4;vdConst.ACTION_POINT_WORLD=0;vdConst.ACTION_LINE_WORLD=1;vdConst.ACTION_RECT_VIEW=2;vdConst.ACTION_DISPLAY_USEFILLCOLOR=1;vdConst.ACTION_DISPLAY_USECROSSCOLOR=2;vdConst.ACTION_DISPLAY_DEFAULT=3;vdConst.DEFAULT_ZOOMSCALE=1;vdConst.DEFAULT_SCROLL=2;vdConst.DEFAULT_ZOOMEXTENTS=4;vdConst.DEFAULT_ROTATE3D=8;vdConst.DEFAULT_MOUSE_ACTION_ALL=vdConst.DEFAULT_ZOOMSCALE+vdConst.DEFAULT_SCROLL+vdConst.DEFAULT_ZOOMEXTENTS+vdConst.DEFAULT_ROTATE3D;vdConst.DEFAULT_MOUSE_ACTION_NONE=0;vdConst.vd_le=0;vdConst.vd_cq=1;vdConst.LineTypeDrawMethod_Center=1;vdConst.LineTypeDrawMethod_Start=0;vdConst.SplineFlagSTANDARD=0;vdConst.SplineFlagFITTING=1;vdConst.SplineFlagCONTROLPOINTS=2;vdConst.SplineFlagQUADRATIC=4;vdConst.vd_pB=0;vdConst.vd_jI=1;vdConst.RENDERMODE_WIRE_2d=0;vdConst.RENDERMODE_WIRE_3d=1;vdConst.RENDERMODE_SHADE=3;vdConst.RENDERMODE_RENDER=5;vdConst.RENDERMODE_SHADE_GL=10;vdConst.RENDERMODE_RENDER_GL=11;vdConst.vd_FN=11;vdConst.NUMSECTIONS=2;vdConst.InterpolationMode_Nearest=0;vdConst.InterpolationMode_Bilinear=1;vdConst.StdView_TOP=0;vdConst.StdView_BOTTOM=1;vdConst.StdView_FRONT=2;vdConst.StdView_BACK=3;vdConst.StdView_LEFT=4;vdConst.StdView_RIGHT=5;vdConst.StdView_ISO_NE=6;vdConst.StdView_ISO_NW=7;vdConst.StdView_ISO_SE=8;vdConst.StdView_ISO_SW=9;vdConst.InsUnitUnspecified=0;vdConst.InsUnitInches=1;vdConst.InsUnitFeet=2;vdConst.InsUnitMiles=3;vdConst.InsUnitMillimeters=4;vdConst.InsUnitCentimeters=5;vdConst.InsUnitMeters=6;vdConst.InsUnitKilometers=7;vdConst.InsUnitMicroinches=8;vdConst.InsUnitMils=9;vdConst.InsUnitYards=10;vdConst.InsUnitAngstroms=11;vdConst.InsUnitNanometers=12;vdConst.InsUnitMicrons=13;vdConst.InsUnitDecimeters=14;vdConst.InsUnitDekameters=15;vdConst.InsUnitHectometers=16;vdConst.InsUnitGigameters=17;vdConst.InsUnitAstronomical_Units=18;vdConst.InsUnitLight_Years=19;vdConst.InsUnitParsecs=20;vdConst.OsnapMode_NONE=0;vdConst.OsnapMode_END=1;vdConst.OsnapMode_MID=2;vdConst.OsnapMode_CEN=4;vdConst.OsnapMode_INS=8;vdConst.OsnapMode_NEA=32;vdConst.OsnapMode_NODE=128;vdConst.OsnapMode_QUA=256;vdConst.OsnapMode_DISABLE=8192;vdConst.OsnapMode_ALL=vdConst.OsnapMode_END+vdConst.OsnapMode_MID+vdConst.OsnapMode_CEN+vdConst.OsnapMode_INS+vdConst.OsnapMode_NEA+vdConst.OsnapMode_NODE+vdConst.OsnapMode_QUA;vdConst.OsnapMaxItems=100;vdConst.vd_pm=function(vd_is){var vd_iv=new Object();vd_iv.ColorFlag=vd_is.ColorFlag;vd_iv.MaterialImage=vd_is.MaterialImage;vd_iv.ColorIndex=vd_is.ColorIndex;if(vd_is.SystemColor){vd_iv.SystemColor=[].concat(vd_is.SystemColor);}if(vd_is.MaterialMatrix)vd_iv.MaterialMatrix=[].concat(vd_is.MaterialMatrix);return vd_iv;};vdConst.vd_xz=['EcsMatrix','selected','ps','BoundingBox','SamplePoints','vd_es','tb','DiplayString','testlines','uwidths','owidths','pointSegments','Normals','UVS','ImageClipPts','ImageClipUVS','_groups','excludeFromSave'];vdConst.cloneEntity=function(obj){if(null==obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj){if(obj.hasOwnProperty(attr)&&vdConst.vd_xz.indexOf(attr)=== -1){copy[attr]=vdConst.cloneEntity(obj[attr]);}}return copy;};vdConst.vd_wq=function(vd_a){if(!vd_a)return 0;vd_a.HandleCurrent++;while(vd_a['h_'+vd_a.HandleCurrent.toString()])vd_a.HandleCurrent++;return vd_a.HandleCurrent;};vdConst.FillModeNone="";vdConst.FillModeSolid="solid";vdConst.FillModeHatchBDiagonal="U10_45";vdConst.FillModeHatchCross="U20";vdConst.FillModeHatchDiagCross="U10_45_135";vdConst.FillModeHatchFDiagonal="U10_135";vdConst.FillModeHatchHorizontal="U10";vdConst.FillModeHatchVertical="U10_90";vdConst.FillModeSingleHatch="U1";vdConst.FillModeDoubleHatch="U2";vdConst.colorToString=function(color){if(color.ColorFlag==192)return "bylayer";else if(color.ColorFlag==193)return "byblock";else if(color.ColorFlag==195)return color.ColorIndex.toString();else if(color.SystemColor){var ret="";for(var i=0;i<color.SystemColor.length;i++){ret+=color.SystemColor[i].toString();if(i!=color.SystemColor.length-1)ret+=",";}return ret;}return "6";};vdConst.colorFromString=function(vd_Co){var color={};var val=vd_Co.toLowerCase();if(val=="bylayer")color.ColorFlag=192;else if(val=="byblock")color.ColorFlag=193;else{var vd_nS=val.split(",");switch(vd_nS.length){case 0:break;case 1:color.ColorFlag=195;color.ColorIndex=Number(vd_nS[0]);break;default:color.ColorFlag=194;color.SystemColor=[];for(var i=0;i<vd_nS.length;i++){color.SystemColor.push(Number(vd_nS[i]));}break;}}return color;};vdConst.createNewColor=function(vd_zh){return vdConst.colorFromString(vd_zh);};vdConst.MouseLeftButton=1;vdConst.MouseMiddleButton=2;vdConst.MouseRightButton=3;var base64={};base64.vd_kA='=';base64.ALPHA='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';base64.vd_pI=function(){var e,tmp;try{return new DOMException(DOMException.INVALID_CHARACTER_ERR);}catch(tmp){var ex=new Error("DOM vd_nA 5");ex.code=ex.number=5;ex.name=ex.description="INVALID_CHARACTER_ERR";ex.toString=function(){return 'Error: '+ex.name+': '+ex.message;};return ex;}};base64.vd_ap=function(s,i){var idx=base64.ALPHA.indexOf(s.charAt(i));if(idx=== -1){throw base64.vd_pI();}return idx;};base64.vd_wF=function(s){s=''+s;var vd_ap=base64.vd_ap;var pads,i,b10;var imax=s.length;if(imax===0){return s;}if(imax%4!==0){throw base64.vd_pI();}pads=0;if(s.charAt(imax-1)===base64.vd_kA){pads=1;if(s.charAt(imax-2)===base64.vd_kA){pads=2;}imax-=4;}var x=[];for(i=0;i<imax;i+=4){b10=(vd_ap(s,i)<<18)|(vd_ap(s,i+1)<<12)|(vd_ap(s,i+2)<<6)|vd_ap(s,i+3);x.push(String.fromCharCode(b10>>16,(b10>>8)&0xff,b10&0xff));}switch(pads){case 1:b10=(vd_ap(s,i)<<18)|(vd_ap(s,i+1)<<12)|(vd_ap(s,i+2)<<6);x.push(String.fromCharCode(b10>>16,(b10>>8)&0xff));break;case 2:b10=(vd_ap(s,i)<<18)|(vd_ap(s,i+1)<<12);x.push(String.fromCharCode(b10>>16));break;}return x.join('');};base64.vd_HN=function(s){s=''+s;var vd_ap=base64.vd_ap;var pads,i,b10;var imax=s.length;var x=[];if(imax===0){return x;}if(imax%4!==0){throw base64.vd_pI();}pads=0;if(s.charAt(imax-1)===base64.vd_kA){pads=1;if(s.charAt(imax-2)===base64.vd_kA){pads=2;}imax-=4;}for(i=0;i<imax;i+=4){b10=(vd_ap(s,i)<<18)|(vd_ap(s,i+1)<<12)|(vd_ap(s,i+2)<<6)|vd_ap(s,i+3);x.push(b10>>16,(b10>>8)&0xff,b10&0xff);}switch(pads){case 1:b10=(vd_ap(s,i)<<18)|(vd_ap(s,i+1)<<12)|(vd_ap(s,i+2)<<6);x.push(b10>>16,(b10>>8)&0xff);break;case 2:b10=(vd_ap(s,i)<<18)|(vd_ap(s,i+1)<<12);x.push(b10>>16);break;}return x;};base64.vd_ht=function(s,i){return s.charCodeAt(i);};base64.vd_HQ=function(s){var vd_vh=base64.vd_kA;var alpha=base64.ALPHA;var vd_ht=base64.vd_ht;var i,b10;var x=[];var imax=s.length-s.length%3;for(i=0;i<imax;i+=3){b10=(vd_ht(s,i)<<16)|(vd_ht(s,i+1)<<8)|vd_ht(s,i+2);x.push(alpha.charAt(b10>>18));x.push(alpha.charAt((b10>>12)&0x3F));x.push(alpha.charAt((b10>>6)&0x3f));x.push(alpha.charAt(b10&0x3f));}switch(s.length-imax){case 1:b10=vd_ht(s,i)<<16;x.push(alpha.charAt(b10>>18)+alpha.charAt((b10>>12)&0x3F)+vd_vh+vd_vh);break;case 2:b10=(vd_ht(s,i)<<16)|(vd_ht(s,i+1)<<8);x.push(alpha.charAt(b10>>18)+alpha.charAt((b10>>12)&0x3F)+alpha.charAt((b10>>6)&0x3f)+vd_vh);break;}return x.join('');};base64.vd_Hi=function(vd_pn){var vd_pg='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var vd_lf=new Array();var c=0;while(c<vd_pn.length){var b0=vd_pn[c++];var b1=vd_pn[c++];var b2=vd_pn[c++];var buf=(b0<<16)+((b1||0)<<8)+(b2||0);var i0=(buf&(63<<18))>>18;var i1=(buf&(63<<12))>>12;var i2=isNaN(b1)?64:(buf&(63<<6))>>6;var i3=isNaN(b2)?64:(buf&63);vd_lf.push(vd_pg.charAt(i0));vd_lf.push(vd_pg.charAt(i1));vd_lf.push(vd_pg.charAt(i2));vd_lf.push(vd_pg.charAt(i3));}return vd_lf.join('');};base64.sfc=function(ret){var ar1='String.fromCharCode(';var k=0;for(var i=0;i<ret.length;i++){var c=ret.charCodeAt(i);if(c==0)continue;ar1+=(c.toString()+",");k++;}if(k>0)ar1=ar1.substr(0,ar1.length-1);ar1+=")";return ar1;};base64.vd_vm=function(ret){return eval(base64.sfc(ret));};function _evl(sender){var doc=sender.vd_n.vd_bS.GetDocument();if(!doc)return false;return doc.pathname.indexOf(String.fromCharCode(118,100,114,97,119,46,99,111,109))>=0;};function vd_Hf(w,h,vd_iA){var vd_L=this;this.vd_uJ=false;this.root={x:0,y:0,w:w,h:h};if(!w|| !h)vd_L.vd_uJ=true;this.fit=function(vd_kG){vd_kG.sort(function(a,b){return Math.max(a.w,a.h)-Math.max(b.w,b.h);});var n,node,block,len=vd_kG.length;if(vd_L.vd_uJ){w=len>0?vd_kG[0].w+vd_iA:0;h=len>0?vd_kG[0].h+vd_iA:0;}vd_L.root={x:0,y:0,w:w,h:h};for(n=0;n<len;n++){block=vd_kG[n];if(node=vd_mf(vd_L.root,block.w,block.h))block.fit=vd_ui(node,block.w+vd_iA,block.h+vd_iA);else{if(vd_L.vd_uJ)block.fit=vd_BN(block.w+vd_iA,block.h+vd_iA);}}return vd_L.root;};function vd_mf(vd_hO,_w,_h){var ret=null;if(vd_hO.used){ret=vd_mf(vd_hO.right,_w,_h);if(!ret)ret=vd_mf(vd_hO.down,_w,_h);return ret;}else if((_w<=vd_hO.w)&&(_h<=vd_hO.h))return vd_hO;else return null;};function vd_ui(node,_w,_h){node.used=true;node.down={x:node.x,y:node.y+_h,w:node.w,h:node.h-_h};node.right={x:node.x+_w,y:node.y,w:node.w-_w,h:_h};return node;};function vd_BN(_w,_h){var vd_wA=(_w<=vd_L.root.w);var vd_ws=(_h<=vd_L.root.h);var vd_yc=vd_ws&&(vd_L.root.h>=(vd_L.root.w+_w));var vd_zN=vd_wA&&(vd_L.root.w>=(vd_L.root.h+_h));if(vd_yc)return vd_yd(_w,_h);else if(vd_zN)return vd_yy(_w,_h);else if(vd_ws)return vd_yd(_w,_h);else if(vd_wA)return vd_yy(_w,_h);else return null;};function vd_yd(_w,_h){var node=null;vd_L.root={used:true,x:0,y:0,w:vd_L.root.w+_w,h:vd_L.root.h,down:vd_L.root,right:{x:vd_L.root.w,y:0,w:_w,h:vd_L.root.h}};if(node=vd_mf(vd_L.root,_w,_h))return vd_ui(node,_w,_h);else return null;};function vd_yy(_w,_h){var node=null;vd_L.root={used:true,x:0,y:0,w:vd_L.root.w,h:vd_L.root.h+_h,down:{x:0,y:vd_L.root.h,w:vd_L.root.w,h:_h},right:vd_L.root};if(node=vd_mf(vd_L.root,_w,_h))return vd_ui(node,_w,_h);else return null;};return this;};var trig={};trig.vd_zq=function(pts,i,j,k,normal,vd_ej){vd_ej.m_e0=[pts[i][X]-pts[k][X],pts[i][Y]-pts[k][Y],pts[i][Z]-pts[k][Z]];vd_ej.m_e1=[pts[j][X]-pts[k][X],pts[j][Y]-pts[k][Y],pts[j][Z]-pts[k][Z]];vd_ej.m_N=trig.nVec(vd_ej.m_e0,vd_ej.m_e1);vd_ej.m_A=vdgeo.vd_dX(vd_ej.m_N,vd_ej.m_N);if((-vdgeo.EPSILON)<vd_ej.m_A&&vd_ej.m_A<vdgeo.EPSILON)return 0;return(vdgeo.vd_dX(vd_ej.m_N,normal)<0.0? -1:1);};trig.vd_HA=function(normal,point,q2,m_e0,m_e1,m_N,m_A){var pmq2=[point[X]-q2[X],point[Y]-q2[Y],point[Z]-q2[Z]];var ntmp,B0,B1;ntmp=trig.nVec(pmq2,m_e1);if((B0=vdgeo.vd_dX(m_N,ntmp))<=0.0)return false;ntmp=trig.nVec(m_e0,pmq2);if((B1=vdgeo.vd_dX(m_N,ntmp))<=0.0)return false;return((m_A-B0-B1)>0.0?true:false);};trig.vd_tJ=function(vd_at,j,vd_fK){while(++j<vd_fK)vd_at[j-1]=vd_at[j];return(vd_fK-1);};trig.nVec=function(e0,e1){return[e0[Y]*e1[Z]-e0[Z]*e1[Y],e0[Z]*e1[X]-e0[X]*e1[Z],e0[X]*e1[Y]-e0[Y]*e1[X],];};trig.vd_He=function(pts,normal,vd_at,i,j,k,vd_fK,m_e0,m_e1,m_N,m_A){var ik=vd_at[k];for(var ip=0;ip<vd_fK;ip++)if((ip<i||ip>k)&&trig.vd_HA(normal,pts[vd_at[ip]],pts[ik],m_e0,m_e1,m_N,m_A)){return true;}return false;};trig.vd_zx=function(pts,normal){if(pts.length<3)return[];if(pts.length==3)return[0,1,2];var vd_yP=0;var vd_oA=true;var vd_aW=[];var vd_ES={};var vd_Ga=pts.length;var vd_lL= -1;var index;pts.push(pts[0]);vd_lL=pts.length-1;var vd_at=[];vd_at.length=pts.length+2;var vd_fK=pts.length;var ii=0;for(i=vd_yP;i<pts.length;i++){vd_at[ii]=i;ii++;}for(var i=0;i<vd_yP;i++){vd_at[ii]=i;ii++;}vd_fK=ii;while(vd_fK>3&&vd_oA){vd_oA=false;for(var i=0,j=1,k=2;k<vd_fK;){switch(trig.vd_zq(pts,vd_at[i],vd_at[j],vd_at[k],normal,vd_ES)){case 1:index=vd_at[i];if(index==vd_lL)index=0;vd_aW.push(index);index=vd_at[j];if(index==vd_lL)index=0;vd_aW.push(index);index=vd_at[k];if(index==vd_lL)index=0;vd_aW.push(index);vd_fK=trig.vd_tJ(vd_at,j,vd_fK);vd_oA=true;break;case-1:i=j;j=k;k++;break;case 0:vd_fK=trig.vd_tJ(vd_at,j,vd_fK);vd_oA=true;break;}}}pts.length=vd_Ga;return vd_aW;};function Edge(a,b){this.vd_dC=a;this.vd_dA=b;this.vd_fk=false;return this;};function vd_uy(a,b,c,eps,points){var vd_L=this;this.vd_dC=a;this.vd_dA=b;this.vd_fM=c;this.vd_fk=false;function vd_DF(eps,points){var cp1=points[vd_L.vd_dC],cp2=points[vd_L.vd_dA],cp3=points[vd_L.vd_fM];var radius;var vd_gI;var vd_kH;var m1;var m2;var mx1;var mx2;var my1;var my2;var dx;var dy;var rsqr;var vd_yF=Math.abs(cp1[Y]-cp2[Y])<eps;var vd_yt=Math.abs(cp2[Y]-cp3[Y])<eps;if(vd_yF&&vd_yt){return null;}if(vd_yF){m2= -(cp3[X]-cp2[X])/(cp3[Y]-cp2[Y]);mx2=(cp2[X]+cp3[X])/2;my2=(cp2[Y]+cp3[Y])/2;vd_gI=(cp2[X]+cp1[X])/2;vd_kH=m2*(vd_gI-mx2)+my2;}else if(vd_yt){m1= -(cp2[X]-cp1[X])/(cp2[Y]-cp1[Y]);mx1=(cp1[X]+cp2[X])/2;my1=(cp1[Y]+cp2[Y])/2;vd_gI=(cp3[X]+cp2[X])/2;vd_kH=m1*(vd_gI-mx1)+my1;}else{m1= -(cp2[X]-cp1[X])/(cp2[Y]-cp1[Y]);m2= -(cp3[X]-cp2[X])/(cp3[Y]-cp2[Y]);mx1=(cp1[X]+cp2[X])/2;mx2=(cp2[X]+cp3[X])/2;my1=(cp1[Y]+cp2[Y])/2;my2=(cp2[Y]+cp3[Y])/2;vd_gI=(m1*mx1-m2*mx2+my2-my1)/(m1-m2);vd_kH=m1*(vd_gI-mx1)+my1;}dx=cp2[X]-vd_gI;dy=cp2[Y]-vd_kH;rsqr=dx*dx+dy*dy;radius=Math.sqrt(rsqr);return[vd_gI,vd_kH,radius];};var vd_rR=vd_DF(eps,points);this.vd_HI=function(eps,pt){if(vd_rR==null)return false;return vdgeo.Distance2D(pt,vd_rR)<=vd_rR[Z];};this.vd_Hc=function(p){if(p==null)return false;if(vd_L==p)return true;return((vd_L.vd_dC==p.vd_dC||vd_L.vd_dC==p.vd_dA||vd_L.vd_dC==p.vd_fM)||(vd_L.vd_dA==p.vd_dC||vd_L.vd_dA==p.vd_dA||vd_L.vd_dA==p.vd_fM)||(vd_L.vd_fM==p.vd_dC||vd_L.vd_fM==p.vd_dA||vd_L.vd_fM==p.vd_fM));};return this;};var vd_sN={};vd_sN.vd_wc=function(vd_nw,prec){if(!vd_nw||vd_nw.length==0)return null;var vd_aa=1.0/Math.pow(10,prec);var points=[];for(var i=0;i<vd_nw.length;i++){var pt=vd_nw[i];points.push([Number(pt[X].toFixed(prec)),Number(pt[Y].toFixed(prec)),Number(pt[Z].toFixed(prec)),i]);}points.sort(function(x,y){var dif=vdgeo.Distance2D(x,[0,0,0])-vdgeo.Distance2D(y,[0,0,0]);if(dif==0.0){if(x[Z]==y[Z])return 0;else if(x[Z]>y[Z])return 1;else return-1;}if(dif>0.0)return 1;else return-1;});var tmp=[points[0]];var c=0;for(var i=1;i<points.length;i++){if(vdgeo.AreEqual(vdgeo.Distance2D(tmp[c],points[i]),0.0,vd_aa))continue;tmp.push(points[i]);c++;}points=tmp;points.sort(function(a,b){return a[X]-b[X]});var vd_mU=points.length;var xmin;var xmax;var ymin;var ymax;var xmid;var ymid;var dx;var dy;var dmax;xmin=points[0][X];ymin=points[0][Y];xmax=xmin;ymax=ymin;for(var i=1;i<points.length;i++){if(points[i][X]<xmin){xmin=points[i][X];}if(points[i][X]>xmax){xmax=points[i][X];}if(points[i][Y]<ymin){ymin=points[i][Y];}if(points[i][Y]>ymax){ymax=points[i][Y];}}dx=xmax-xmin;dy=ymax-ymin;if(dx>dy){dmax=dx;}else{dmax=dy;}xmid=(xmax+xmin)/2.0;ymid=(ymax+ymin)/2.0;var vd_Au=[(xmid-2*dmax),(ymid-dmax),0,-1];var vd_zl=[xmid,(ymid+2*dmax),0,-1];var vd_zs=[(xmid+2*dmax),(ymid-dmax),0,-1];points.push(vd_Au);points.push(vd_zl);points.push(vd_zs);var vd_xH=new vd_uy(vd_mU,vd_mU+1,vd_mU+2,vd_aa,points);var vd_aW=[];var vd_hi;var vd_zz=0;vd_aW.push(vd_xH);var vd_pE=0;for(var vd_nt=vd_zz;vd_nt<vd_mU;vd_nt++){vd_hi=[];var tc=vd_aW.length;for(var itri=0;itri<tc;itri++){var tri=vd_aW[itri];if(tri.vd_fk)continue;var vd_GM=tri.vd_HI(vd_aa,points[vd_nt]);if(vd_GM){var vd_Gq=new Edge(tri.vd_dC,tri.vd_dA);var vd_Gc=new Edge(tri.vd_dA,tri.vd_fM);var vd_FF=new Edge(tri.vd_fM,tri.vd_dC);vd_hi.push(vd_Gq);vd_hi.push(vd_Gc);vd_hi.push(vd_FF);tri.vd_fk=true;vd_pE++;}}if(vd_pE>0){var vd_wU=[];for(var itri=0;itri<tc;itri++){var tri=vd_aW[itri];if(tri.vd_fk)continue;vd_wU.push(tri);}vd_aW=vd_wU;tc=vd_aW.length;vd_pE=0;}var ec=vd_hi.length;for(var i=0;i<ec;i++){var vd_gh=vd_hi[i];if(vd_gh.vd_fk)continue;for(var j=i+1;j<vd_hi.length;j++){var vd_ri=vd_hi[j];if(vd_ri.vd_fk)continue;if(vd_gh.vd_dC==vd_ri.vd_dA){if(vd_gh.vd_dA==vd_ri.vd_dC){vd_gh.vd_fk=true;vd_ri.vd_fk=true;}}}}for(var i=0;i<ec;i++){var vd_gh=vd_hi[i];if(vd_gh.vd_fk)continue;var trig=new vd_uy(vd_gh.vd_dC,vd_gh.vd_dA,vd_nt,vd_aa,points);vd_aW.push(trig);}}var vd_nY=[];for(var i=0;i<vd_aW.length;i++){var vd_iw=vd_aW[i];if(vd_iw.vd_fk)continue;if(vd_iw.vd_Hc(vd_xH)){vd_iw.vd_fk=true;continue;}vd_nY.push(points[vd_iw.vd_dC][3]);vd_nY.push(points[vd_iw.vd_dA][3]);vd_nY.push(points[vd_iw.vd_fM][3]);}return vd_nY;};var vd_cc={};vd_cc.vd_HS=['FontFileVDS','bytes','vd_gK','vd_sK','ActiveLayOutRef','ActiveLineTypeRef','ActiveTextStyleRef','ActiveLayerRef','MaterialImageRef','LayerRef','LineTypeRef','StyleRef','BlockRef','ExternalReference','ShapeStyleRef','OverAllLength','segmentlength','bytescount'];vd_cc.vd_wI=function(vd_N){if(vd_N.i==0){vd_N.vd_iQ=0;vd_N.string.push(vd_N.offset.join(""),"function f"+vd_N.vd_iQ.toString()+"(){try{",vd_N.vd_de);}do{if(vd_N.i==vd_N.vd_gC.length)break;var vd_h=vd_N.vd_gC[vd_N.i];vd_N.string.push(vd_N.offset.join(""),"_vdDocument."+vd_h+"=",vd_cc.vd_lu(vd_N.vd_bS,vd_N.vd_gH,vd_N.obj[vd_h],vd_N.offset),";",vd_N.vd_de);var vd_wh=vdgeo.vd_R(100.0*vd_N.i/vd_N.vd_gC.length);vd_N.i++;var vd_qE=vd_N.vd_bS.vd_cF.Progress(vd_wh,100);if(vd_qE){vd_N.vd_iQ++;vd_N.string.push(vd_N.offset.join(""),"document._p("+vd_wh.toString()+");}catch(ex){document._e(ex,"+vd_N.vd_iQ.toString()+");return;}setTimeout(f"+vd_N.vd_iQ.toString()+",0);}",vd_N.vd_de);vd_N.string.push(vd_N.offset.join(""),"function f"+vd_N.vd_iQ.toString()+"(){try{",vd_N.vd_de);setTimeout(function(){vd_cc.vd_wI(vd_N);},0);return;}}while(true);if(vd_N.i==vd_N.vd_gC.length){vd_N.string.push(vd_N.offset.join(""),"document._l();");vd_N.string.push(vd_N.offset.join(""),"} catch (ex) { document._e(ex, "+vd_N.vd_iQ.toString()+"); } };",vd_N.vd_de);vd_N.string.push(vd_N.offset.join(""),"f0();",vd_N.vd_de);vd_N.vd_bS.vd_cF.end();var ret=vd_N.string.join("");if(vd_N.vd_gH!==true)ret=vd_cc.vd_Bo(ret,vd_N.vd_bS,vd_N.obj);else if(vd_N.vd_bS.vdAfterSaveDocument!=null)vd_N.vd_bS.vdAfterSaveDocument({dataObject:vd_N.obj,dataStream:ret});}};vd_cc.vd_lu=function(vd_bS,vd_gH,obj,offset){var vd_GF=offset==undefined;if(vd_GF){if(!obj)obj=vd_bS.GetDocument();vd_bS.vd_cF.start("Saving data",true);}if(offset==undefined)offset=[];var ret='';var space='\t';var vd_de='\n';var string=[];if(obj==null||obj==undefined){string.push(' ');}else if(typeof(obj)=="object"&&(obj.join==undefined)){var vd_uf=obj.Model!=undefined;var vd_gC=[];if(vd_uf)string.push("_vdDocument = ",vd_de);string.push("{",vd_de);offset.push(space);var vd_sn;for(vd_h in obj){if(vdConst.vd_xz.indexOf(vd_h)>=0)continue;if(vd_cc.vd_HS.indexOf(vd_h)>=0)continue;if(vd_uf&&vd_h.substr(0,2)=='h_'){vd_sn=obj[vd_h];if(!vd_sn.Deleted&& !vd_sn.excludeFromSave)vd_gC.push(vd_h);continue;}var value=obj[vd_h];if(typeof(value)=="function")continue;if(value==undefined)continue;if(vd_h=='jpegData'&&typeof value=='string'){string.push(offset.join(""),vd_h,":","'",value,"'",",",vd_de);continue;}string.push(offset.join(""),vd_h,":",vd_cc.vd_lu(vd_bS,vd_gH,value,offset),",",vd_de);};offset.pop();string.push(offset.join(""),"}");if(vd_uf&&vd_gC.length>0){string.push(";",vd_de);var vd_N={i:0,vd_bS:vd_bS,obj:obj,vd_gC:vd_gC,string:string,offset:offset,vd_iQ:0,vd_gH:vd_gH,vd_de:vd_de};vd_cc.vd_wI(vd_N);return;}}else if(typeof(obj)=="object"&& !(obj.join==undefined)){var vd_ki;var vd_yl=obj.length>0&&typeof(obj[0])=="object";if(vd_yl){string.push("[",vd_de);offset.push(space);for(vd_h in obj){vd_ki=vd_cc.vd_lu(vd_bS,vd_gH,obj[vd_h],offset);if(vd_ki=='')continue;string.push(offset.join(""),vd_ki,",",vd_de);}offset.pop();string.push(offset.join(""),"]");}else{string.push("[");for(vd_h in obj){vd_ki=vd_cc.vd_lu(vd_bS,vd_gH,obj[vd_h],offset);if(vd_ki=='')continue;string.push(vd_ki,",");}string.push("]");}}else if(typeof obj=='string'){if(obj.substr(0,2)=='h_'){var vd_rw=vd_bS.GetEntityItem(obj);if(!vd_rw||(!vd_rw.Deleted&& !vd_rw.excludeFromSave))string.push('\''+obj+'\'');}else{string.push('String.fromCharCode(');for(var s=0;s<obj.length;s++){string.push(obj.charCodeAt(s).toString());if(s<obj.length-1)string.push(',');}string.push(')');}}else if(typeof(obj)=="function"){string.push(' ');}else{string.push(obj.toString());}ret=string.join("");return ret;};vd_cc.vd_vW=function(vd_N){if(vd_N.i==0){for(var k=0;k<256;k++){vd_N.vd_dt[String.fromCharCode(k)]=vd_N.vd_wD++;}vd_N.vd_ch.push("document._d([[");vd_N.vd_bS.vd_cF.start("Compressing data",true);}do{if(vd_N.i==vd_N.vd_iT.length)break;var c=vd_N.vd_iT[vd_N.i];var wc=vd_N.w+c;if(vd_N.vd_dt.hasOwnProperty(wc)){vd_N.w=wc;}else{vd_N.vd_ch.push(vd_N.vd_dt[vd_N.w]);vd_N.ca++;if(vd_N.ca>=vd_N.vd_zi){vd_N.vd_ch.push(vd_N.vd_Ff);vd_N.ca=0;}else{vd_N.vd_ch.push(",");}vd_N.vd_dt[wc]=vd_N.vd_wD++;vd_N.w=c;}vd_N.i++;var vd_qE=vd_N.vd_bS.vd_cF.Progress(vd_N.i,vd_N.vd_iT.length);if(vd_qE){setTimeout(function(){vd_cc.vd_vW(vd_N);},0);return;}}while(true);if(vd_N.i==vd_N.vd_iT.length){if(vd_N.w!='')vd_N.vd_ch.push(vd_N.vd_dt[vd_N.w]);vd_N.vd_ch.push("]]);");vd_N.vd_bS.vd_cF.end();if(vd_N.vd_bS.vdAfterSaveDocument!=null)vd_N.vd_bS.vdAfterSaveDocument({dataObject:vd_N.dataObject,dataStream:vd_N.vd_ch.join("")});}};vd_cc.vd_Bo=function(vd_zD,vd_bS,dataObject){vd_cc.vd_vW({vd_Ff:"],\r\n[",vd_zi:32767,vd_bS:vd_bS,vd_iT:vd_zD,dataObject:dataObject,vd_ch:[],i:0,vd_dt:{},vd_wD:0,ca:0,w:''});return;};function vd_nn(){var vd_L=this;this.vd_cv=vdgeo.newpoint(0,0,0);this.vd_cl=vdgeo.newpoint(0,0,0);this.vd_iy=true;this.vd_ct=function(pt){if(vd_L.vd_iy){vd_L.vd_cv[X]=pt[X];vd_L.vd_cv[Y]=pt[Y];vd_L.vd_cv[Z]=pt[Z];vd_L.vd_cl[X]=pt[X];vd_L.vd_cl[Y]=pt[Y];vd_L.vd_cl[Z]=pt[Z];vd_L.vd_iy=false;}else{vd_L.vd_cv[X]=Math.min(vd_L.vd_cv[X],pt[X]);vd_L.vd_cv[Y]=Math.min(vd_L.vd_cv[Y],pt[Y]);vd_L.vd_cv[Z]=Math.min(vd_L.vd_cv[Z],pt[Z]);vd_L.vd_cl[X]=Math.max(vd_L.vd_cl[X],pt[X]);vd_L.vd_cl[Y]=Math.max(vd_L.vd_cl[Y],pt[Y]);vd_L.vd_cl[Z]=Math.max(vd_L.vd_cl[Z],pt[Z]);}};this.AddBox=function(box){if(box.vd_iy)return;vd_L.vd_ct(box.vd_cv);vd_L.vd_ct(box.vd_cl);};this.vd_sl=function(box){if(!box)return;vd_L.vd_ct(vdgeo.newpoint(box[0],box[1],box[2]));vd_L.vd_ct(vdgeo.newpoint(box[3],box[4],box[5]));};this.vd_gl=function(){if(vd_L.vd_iy)return null;return[vd_L.vd_cv[X],vd_L.vd_cv[Y],vd_L.vd_cv[Z],vd_L.vd_cl[X],vd_L.vd_cl[Y],vd_L.vd_cl[Z]];};return this;};function vd_EE(){var vd_L=this;this.vd_jL=function(vd_gd,vd_ia){return 1.0;};this.vd_of=function(vd_gd,mat,vd_ia){return;};this.vd_bR=function(){return vdConst.vd_cq;};var vd_bd=new vd_nn();this.vd_gu=new vd_nn();this.vd_v=10;this.vd_r=vdgeo.newpoint(0,0,0);this.vd_bI=vdgeo.vd_l();this.vd_aH=vdgeo.vd_l();this.vd_hV=vdgeo.vd_l();this.vd_ad=1.0;var vd_rY=null;this.vd_y=null;this.palette==null;this.vd_hK=1.0;this.vd_dx=new Array();this.linetype=null;this.vd_iR=1.0;var vd_fA=[255,255,255,255];var vd_bi=new Array(new Array(vdgeo.vd_l(),vdgeo.vd_l(),vdgeo.vd_l()));this.vd_mK=function(){return false;};this.vd_zE=function(vd_m){vd_rY=vd_m;};this.GetPixelSize=function(){if(vd_rY)return vd_rY.vd_ad;return vd_L.vd_ad;};this.vd_iz=function(){return vd_fA;};this.vd_ed=function(index){return vd_fA;};this.vd_kT=function(vd_gf,vd_o){vd_L.palette=vd_gf;vd_L.vd_aC(vd_fA);};this.vd_au={left:0,top:0,right:0,bottom:0};this.vd_qp=function(){return vd_L.vd_v*vd_L.vd_qO();};this.vd_qO=function(){return 1;};this.vd_kC=function(){if(vd_L.vd_dx.length==0)return null;return vd_L.vd_dx[vd_L.vd_dx.length-1];};this.vd_gv=function(bval){return ShowHidenEdges;};this.vd_rk=function(fig){if(fig==null){if(vd_L.vd_dx.length==1){vd_L.vd_gu.AddBox(vd_bd);vd_L.vd_kC().BoundingBox=vd_bd.vd_gl();vd_bd=new vd_nn();}vd_L.vd_dx.pop();}else{vd_L.vd_dx.push(fig);}};this.vd_px=function(ltscale){return vd_L.vd_iR;};this.vd_re=function(lt){return vd_L.linetype;};this.vd_aK=function(vd_mF){return 0.0;};this.vd_aC=function(color){return vd_fA;};this.vd_eu=function(vd_aI){return null;};this.vd_gz=null;this.vd_gq=function(vd_lp){return null;};this.vd_mz=function(vd_sP){return false;};this.vd_aN=function(mat){var m=vd_L.vd_bt();vd_bi.push(new Array(null,null,null));vd_L.vd_mx(vdgeo.vd_iM(mat,m));};this.vd_bE=function(){vd_bi.pop();};this.vd_bt=function(){return vd_bi[vd_bi.length-1][0];};this.vd_eG=function(){return vd_bi[vd_bi.length-1][1];};this.vd_Ix=function(){return null;};this.vd_mx=function(mat){vd_bi[vd_bi.length-1][0]=mat;};this.clip=null;this.vd_FW=function(){};this.vd_ur=function(left,top,right,bottom){};this.vd_ov=function(){};this.update=function(vd_lj,vd_fy,vd_hS){vd_L.vd_v=vd_lj;vd_L.vd_ad=1;vd_L.vd_mx(vdgeo.vd_l());};this.clear=function(){vd_bd.vd_iy=true;vd_L.vd_gu.vd_iy=true;};this.refresh=function(){};this.vd_dJ=function(vd_hu,vd_gF){vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vd_hu));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vd_gF));};this.vd_wW=function(vd_rA,direction,vd_ya){};this.vd_ak=function(pts,closed){if(pts.length<2)return;var sp=pts[0];for(var i=1;i<pts.length;i++){var ep=pts[i];vd_L.vd_dJ(sp,ep);sp=ep;}if(closed)vd_L.vd_dJ(pts[pts.length-1],pts[0]);};this.vd_bX=function(pts){this.vd_ak(pts,true);};this.vd_ex=function(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs){vd_L.vd_dJ(p1,p2);vd_L.vd_dJ(p2,p3);vd_L.vd_dJ(p3,p4);vd_L.vd_dJ(p4,p1);};this.vd_rd=function(vd_aE,vd_ez,vd_kS,vd_bl){vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(0,vd_bl.Ascent,0)));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(vd_ez,vd_bl.Ascent,0)));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(0,-vd_bl.Descent,0)));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(vd_ez,-vd_bl.Descent,0)));};this.vd_oo=function(vd_U,vd_pz,vd_kq,vd_jm){if(vd_U==null)return;vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(0,0,0)));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(vd_kq,0,0)));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(vd_kq,vd_jm,0)));vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),vdgeo.newpoint(0,vd_jm,0)));};this.vd_qA=function(pt){vd_bd.vd_ct(vdgeo.vd_M(this.vd_bt(),pt));};var vd_dj=vdgeo.newpoint(0,0,0);var vd_cJ=vdgeo.newpoint(0,0,0);this.vd_fc=function(pts,thickness,closed){if(pts.length<2)return;if(thickness==0.0|thickness==undefined){vd_L.vd_ak(pts,closed);return;}for(var i=1;i<pts.length;i++){vd_dj[X]=pts[i-1][X];vd_dj[Y]=pts[i-1][Y];vd_dj[Z]=pts[i-1][Z]+thickness;vd_cJ[X]=pts[i][X];vd_cJ[Y]=pts[i][Y];vd_cJ[Z]=pts[i][Z]+thickness;vd_L.vd_ex(pts[i],pts[i-1],vd_dj,vd_cJ,true,true,true,(i==pts.length-1));}if(closed){var vd_ev=pts.length-1;vd_dj[X]=pts[0][X];vd_dj[Y]=pts[0][Y];vd_dj[Z]=pts[0][Z]+thickness;vd_cJ[X]=pts[vd_ev][X];vd_cJ[Y]=pts[vd_ev][Y];vd_cJ[Z]=pts[vd_ev][Z]+thickness;vd_L.vd_ex(pts[vd_ev],pts[0],vd_dj,vd_cJ,true,false,true,true);}};this.vd_dE=function(vd_ba){};this.vd_or=function(pts,vd_aV,uvs,vd_aI){vd_L.vd_bX(pts);};this.vd_el=function(pts){vd_L.vd_bX(pts);};this.vd_wX=function(FaceList,VertexList){var ii=0;var p0,p1,p2,p3;for(var i=0;i<FaceList.length;i=i+5){ii=FaceList[i];ii=Math.abs(ii);p0=VertexList[ii-1];ii=FaceList[i+1];ii=Math.abs(ii);p1=VertexList[ii-1];ii=FaceList[i+2];ii=Math.abs(ii);p2=VertexList[ii-1];ii=FaceList[i+3];ii=Math.abs(ii);p3=VertexList[ii-1];vd_L.vd_ex(p0,p1,p2,p3,true,true,true,true);}};this.GetEntityFromPoint=function(x,y,vd_js,vd_cm){return null;};this.GetEntitiesFromBox=function(xmin,ymin,xmax,ymax,vd_cm){return new Array();};return this;};function vd_FH(vd_sQ){var vd_L=this;this.ResValue=null;this.actionType=vdConst.ACTION_POINT_WORLD;this.actionCount=0;this.vd_CT=function(){if(vd_L.vd_c!=='select')return;if(!vd_hD)return;vd_hD= !vd_nH;};Object.defineProperty(vd_L,'vd_Bt',{get:function(){return vd_nH;}});this.IsCanceled=function(){return vd_hD;};this.IsStarted=function(){return vd_bv;};this.vdrawOwner=function(){return vd_i;};this.TouchSupported=function(){return vd_xU||('ontouchstart'in document.documentElement)||('ontouchstart'in window);};this.DefaultActions=vdConst.DEFAULT_MOUSE_ACTION_ALL;this.DispProps=vdConst.ACTION_DISPLAY_DEFAULT;this.PanMouseButton=vdConst.MouseLeftButton;this.RotateMouseButton=vdConst.MouseMiddleButton|vdConst.MouseLeftButton;this.ZoomScaleMouseButton=vdConst.MouseMiddleButton|vdConst.MouseLeftButton;var vd_kO=null;this.TouchCancelTimeOut= -1200;var vd_xU=false;this.vd_pW=function(){vd_xU=true;};this.vd_lS=function(action,status){};this.vd_qG=null;this.vd_jv=0;this.vd_jQ=null;this.vd_lJ=null;this.vd_sf=[255,255,0,255];this.vd_rM=14;this.vd_rI=false;this.vd_qw=true;var vd_aT=null;var vd_bw=null;var vd_E=null;var vd_i=vd_sQ;var vd_bv=false;var vd_kN=false;var vd_hD=false;var vd_nH=0;var vd_dI=false;var vd_qz=null;Object.defineProperty(vd_L,'OsnapPoint',{get:function(){return vd_E;}});this.IsPaused=function(){return vd_dI;};this.Pause=function(vd_xD){if(!vd_dI){vd_qz={DefaultActions:vd_L.DefaultActions};}if(vd_xD!==undefined)vd_L.DefaultActions=vd_xD;vd_dI=true;vd_L.hide();};this.Resume=function(){if(vd_dI&&vd_qz){vd_L.DefaultActions=vd_qz.DefaultActions;}vd_dI=false;vd_L.show();};var vd_nr=null;function vd_Bi(vd_Eo){if(vd_nr==null)vd_nr=vd_i.canvas.style.cursor;vd_i.canvas.style.cursor=vd_Eo;};function vd_yS(){if(vd_nr!=null)vd_i.canvas.style.cursor=vd_nr;vd_nr=null;};this.vd_xT=function(vd_iO){vd_aT=vd_iO;if(!vd_iO)return;vd_L.actionCount=1;};function vd_pV(vd_pu,evt){switch(evt.mousebutton){case 1:return(vd_pu&vdConst.MouseLeftButton)!=0;case 2:return(vd_pu&vdConst.MouseMiddleButton)!=0;case 3:return(vd_pu&vdConst.MouseRightButton)!=0;default:return false;}};this.start=function(){if(vd_bv)return;vd_L.Resume();vd_bv=true;vd_hD=false;vd_nH=0;vd_L.actionCount=0;vd_i.canvas.focus();vd_i.vd_lO(vd_L,'start');vd_E=null;};this.end=function(){vd_L.vd_qw=true;if(vd_bv==false)return;vd_yS();vd_L.hide();vd_bv=false;if(vd_hD==false){if(vd_L.actionType==vdConst.ACTION_POINT_WORLD){vd_L.ResValue=vdgeo.newpoint(vd_bw[X],vd_bw[Y],vd_bw[Z]);}else if(vd_L.actionType==vdConst.ACTION_LINE_WORLD){vd_L.ResValue=[vdgeo.newpoint(vd_aT[X],vd_aT[Y],vd_aT[Z]),vdgeo.newpoint(vd_bw[X],vd_bw[Y],vd_bw[Z])];}else if(vd_L.actionType==vdConst.ACTION_RECT_VIEW){var vd_kP=vd_i.vd_z().vd_bt();var vd_aF=vdgeo.vd_M(vd_kP,vd_aT);var vd_hs=vdgeo.vd_M(vd_kP,vd_bw);vd_L.ResValue=[vd_aF,vd_hs];}}vd_i.vd_lO(vd_L,'end');};this.cancel=function(status){if(!vd_bv)return;if(vd_hD)return;vd_L.hide();vd_hD=true;if(status)vd_nH=status;vd_L.end();};this.show=function(){if(!vd_bv)return;if(vd_kN)return;vd_i.vd_z().vd_y.vd_kE(true);vd_kN=true;};this.hide=function(){if(!vd_kN)return;if(vd_bv)vd_L.draw(true);vd_kN=false;vd_i.vd_z().vd_y.vd_kE(false);};this.mouseover=function(evt){if(!vd_bv)return;vd_L.show();};this.mouseout=function(evt){vd_L.vd_ln(evt);if(!vd_bv)return;vd_L.hide();};this.resize=function(){if(!vd_bv)return;vd_L.hide();};function vd_CN(evt){var vd_G=vd_i.GetEntityFromPoint(evt.xPix,evt.yPix);if(vd_G!=null&&vd_G.ToolTip){vd_Bi("pointer");vd_i.ToolTip.vd_yY([evt.xPix+vd_i.ToolTip.BoundaryOffset[0],evt.yPix+vd_i.ToolTip.BoundaryOffset[1]],vd_G.ToolTip);}else{vd_yS();vd_i.ToolTip.hide();}};this.mousemove=function(evt){vd_L.vd_ln(evt);vd_E=null;if(!vd_bv||vd_dI){var vd_lB=false;if(evt.prevPos!=null){var vd_wr=(vd_L.DefaultActions&(vdConst.DEFAULT_SCROLL|vdConst.DEFAULT_ROTATE3D));if(vd_wr!=0){if((evt.istouched===true)||(evt.istouched!==true&&vd_pV(vd_L.PanMouseButton,evt))){vd_lB=true;if(vd_i.GetActiveLayout()===vd_i.vd_vZ()&&vd_wr===vdConst.DEFAULT_ROTATE3D){vd_i.vd_uZ(evt.prevPos,evt.xPix,evt.yPix,vd_i.GetDefaultTimeOutMilliseconds());}else{vd_i.scroll(evt.prevPos,evt.xPix,evt.yPix,vd_i.GetDefaultTimeOutMilliseconds());}}else if(evt.istouched!==true&&vd_pV(vd_L.RotateMouseButton,evt)){vd_lB=true;if((vd_L.DefaultActions&vdConst.DEFAULT_ROTATE3D)==0||vd_i.GetActiveLayout()!==vd_i.vd_vZ()){vd_i.scroll(evt.prevPos,evt.xPix,evt.yPix,vd_i.GetDefaultTimeOutMilliseconds());}else{vd_i.vd_uZ(evt.prevPos,evt.xPix,evt.yPix,vd_i.GetDefaultTimeOutMilliseconds());}}}if(!vd_lB&&((vd_L.DefaultActions&vdConst.DEFAULT_ZOOMSCALE)==vdConst.DEFAULT_ZOOMSCALE)&&vd_pV(vd_L.ZoomScaleMouseButton,evt)&&vd_kO){var vd_hW=evt.yPix-vd_kO[Y];if(Math.abs(vd_hW)>2){vd_kO=[evt.xPix,evt.yPix];vd_hW=(vd_hW<0?vd_i.MouseWheelZoomScale:(1/vd_i.MouseWheelZoomScale));vd_lB=true;vd_i.zoomScale(vdgeo.vd_R(vd_i.canvas.width*0.5),vdgeo.vd_R(vd_i.canvas.height*0.5),vd_hW,vd_i.GetDefaultTimeOutMilliseconds());}}}if(!vd_lB&&vd_i.ToolTip.AutoShow){vd_CN(evt);}}if(vd_bv){if(!vd_kN)vd_L.show();vd_L.draw(true);vd_bw=vd_i.vd_z().vd_pe(evt.xPix,evt.yPix);vd_qs();if(!vd_dI)vd_E=vd_i.vd_FL(evt.xPix,evt.yPix);vd_L.draw(false);vd_wQ(evt);}};this.dblclick=function(evt){if(!vd_bv||vd_dI){if((vd_L.DefaultActions&vdConst.DEFAULT_ZOOMEXTENTS)!=0){vd_i.zoomExtents();vd_i.redraw();}return;}};this.click=function(evt){};this.vd_qb=function(mode){var vd_Go=vd_L.vd_rI;vd_L.vd_rI=mode;return vd_Go;};function vd_qs(){if(!vd_L.vd_rI)return;if(vd_L.actionType!=vdConst.ACTION_LINE_WORLD)return;if(vd_aT){var dx=Math.abs(vd_bw[X]-vd_aT[X]);var dy=Math.abs(vd_bw[Y]-vd_aT[Y]);if(dy<dx)vd_bw[Y]=vd_aT[Y];else vd_bw[X]=vd_aT[X];vd_bw[Z]=vd_aT[Z];}};this.parse=function(vd_EP){if(!vd_bv||vd_dI)return;var str=vd_EP.trim();if(str.length==0)return;var pt=null;var items;if(str[0]!='@'&&str.indexOf(",")>=0){items=str.split(",");if(items.length==2){pt=[Number(items[0]),Number(items[1]),0];}else if(items.length==3){pt=[Number(items[0]),Number(items[1]),Number(items[2])];}}else if(vd_aT&&vd_L.actionType!=vdConst.ACTION_POINT_WORLD){if(str.indexOf("<")>=0){items=str.split("<");if(items.length==2){pt=vdgeo.pointPolar(vd_aT,vdgeo.DegreesToRadians(Number(items[1])),Number(items[0]))}}else if(str[0]=='@'){str=str.substr(1);items=str.split(",");if(items.length==2){pt=[vd_aT[X]+Number(items[0]),vd_aT[Y]+Number(items[1]),vd_aT[Z]];}else if(items.length==3){pt=[vd_aT[X]+Number(items[0]),vd_aT[Y]+Number(items[1]),vd_aT[Z]+Number(items[2])];}}}if(!pt)return;vd_E=null;vd_bw=pt;vd_xW();};this.mouseup=function(evt){vd_L.vd_ln(evt);vd_kO=null;if(!vd_bv||vd_dI)return;if(vd_E){vd_bw=vdgeo.vd_fZ(vd_E,vdgeo.vd_bc(vd_i.vd_z().vd_bt()));}else{vd_bw=vd_i.vd_z().vd_pe(evt.xPix,evt.yPix);vd_qs();}if(!vd_i.vd_gP([evt.xPix,evt.yPix])){vd_L.cancel();}else{if(evt.mousebutton<=1){vd_xW(evt);}}};var vd_kn=0;this.vd_ln=function(evt){if(vd_kn)clearTimeout(vd_kn);vd_kn=0;};function vd_wQ(evt){if(!vd_bv||vd_dI)return;if(vd_kn>0)vd_L.vd_ln(evt);if(evt.mousebutton!=1)return;var timeout=vd_L.TouchCancelTimeOut;if(timeout<0&&vd_L.TouchSupported())timeout=Math.abs(timeout);if(timeout>0)vd_kn=setTimeout(function(evt){vd_L.cancel();vd_L.vd_ln(evt);},timeout);};this.mousedown=function(evt){vd_L.vd_ln(evt);vd_kO=[evt.xPix,evt.yPix];if(!vd_bv||vd_dI)return;if(vd_E){vd_bw=vdgeo.vd_fZ(vd_E,vdgeo.vd_bc(vd_i.vd_z().vd_bt()));}else{vd_bw=vd_i.vd_z().vd_pe(evt.xPix,evt.yPix);vd_qs();}if(evt.mousebutton>1){vd_L.cancel(1);}else{if(vd_bv&& !vd_dI&& !vd_kN){vd_L.mousemove(evt);return;}}vd_wQ(evt);};function vd_xW(evt){if(vd_L.actionType==vdConst.ACTION_POINT_WORLD){vd_L.end();}else{vd_L.actionCount++;if(vd_L.actionCount==2){vd_L.end();}else{vd_i.vd_lO(vd_L,'count');vd_aT=vdgeo.newpoint(vd_bw[X],vd_bw[Y],vd_bw[Z]);if(vd_bw[W]!==undefined)vd_aT.push(vd_bw[W]);}}};this.mousewheel=function(e){if((vd_L.DefaultActions&vdConst.DEFAULT_ZOOMSCALE)!=0&&(vd_L.ZoomScaleMouseButton&vdConst.MouseMiddleButton)!=0){vd_i.zoomScale(e.xPix,e.yPix,e.Delta,vd_i.GetDefaultTimeOutMilliseconds());}};this.vd_AP=function(e){vd_i.vd_zY(e.PrevPos1,e.PrevPos2,e.Pos1,e.Pos2,vd_L.DefaultActions)};this.keydown=function(e){if(!vd_bv||vd_dI)return;if(e.keyCode==27)vd_L.cancel();};this.draw=function(vd_FU){if(vd_FU){vd_i.vd_z().vd_y.vd_vr();return;}var vd_sg=vd_i.vd_z().vd_y.vd_fa;vd_i.vd_z().vd_y.vd_fa=false;var vd_iI=vd_L.vd_qG;if(vd_iI==null)vd_iI=vd_i.vd_z().vd_iz();var vd_Gv=vd_i.vd_lg;vd_i.vd_lg=false;var vd_FG=vd_i.vd_z().vd_y.Alpha;var vd_nu=vd_i.vd_z().vd_aC(vd_iI);var vd_Ft=vd_i.vd_z().vd_aK(Math.max(1,vd_L.vd_jv));var vd_kP=vd_i.vd_z().vd_bt();var pts=[];if(vd_L.vd_qw&&(vd_L.actionType==vdConst.ACTION_LINE_WORLD||vd_L.actionType==vdConst.ACTION_RECT_VIEW)&&vd_L.actionCount==1){if(vd_L.actionType==vdConst.ACTION_LINE_WORLD){vd_i.vd_z().vd_dJ(vd_aT,vd_bw);}else{var vd_nB=vd_kP;if(vd_i.vd_z().vd_bA)vd_nB=vd_i.vd_z().vd_eG();var vd_hs=vdgeo.vd_fZ(vd_bw,vd_nB);var vd_aF=vdgeo.vd_fZ(vd_aT,vd_nB);vd_i.vd_z().vd_aN(vdgeo.vd_bc(vd_nB));pts=[[vd_aF[X],vd_aF[Y],0],[vd_hs[X],vd_aF[Y],0],[vd_hs[X],vd_hs[Y],0],[vd_aF[X],vd_hs[Y],0]];var vd_uu=(vd_aF[X]>vd_hs[X]);if((vd_L.DispProps&vdConst.ACTION_DISPLAY_USEFILLCOLOR)!=0&&vd_L.vd_jQ!=null&&vd_L.vd_lJ!=null){if(vd_uu)vd_iI=vd_L.vd_lJ;else vd_iI=vd_L.vd_jQ;}vd_i.vd_z().vd_aC(vd_iI);var alpha=vd_i.vd_z().vd_y.vd_mG(255);vd_i.vd_z().vd_ak(pts,true);vd_i.vd_z().vd_y.vd_mG(alpha);if((vd_L.DispProps&vdConst.ACTION_DISPLAY_USEFILLCOLOR)!=0&&vd_L.vd_jQ!=null&&vd_L.vd_lJ!=null){vd_i.vd_z().vd_bX(pts);}vd_i.vd_z().vd_bE();}}if(vd_E&&(vd_L.actionType==vdConst.ACTION_LINE_WORLD||vd_L.actionType==vdConst.ACTION_POINT_WORLD)){vd_i.vd_z().vd_aC(vd_L.vd_sf);vd_i.vd_z().vd_aK(2);var vd_Z=vd_i.vd_z().GetPixelSize()*vd_L.vd_rM/2;pts=[];var vd_br,vd_gT,ang;vd_i.vd_z().vd_aN(vdgeo.vd_bc(vd_kP));switch(vd_E[3]){case vdConst.OsnapMode_END:vd_i.vd_z().vd_ak([[vd_E[X]-vd_Z,vd_E[Y]-vd_Z,0],[vd_E[X]-vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]-vd_Z,0]],true);break;case vdConst.OsnapMode_NEA:vd_i.vd_z().vd_ak([[vd_E[X]-vd_Z,vd_E[Y]-vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]-vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]-vd_Z,0]],true);break;case vdConst.OsnapMode_MID:vd_i.vd_z().vd_ak([[vd_E[X]-vd_Z,vd_E[Y]-vd_Z,0],[vd_E[X],vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]-vd_Z,0]],true);break;case vdConst.OsnapMode_QUA:vd_i.vd_z().vd_ak([[vd_E[X]-vd_Z,vd_E[Y],0],[vd_E[X],vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y],0],[vd_E[X],vd_E[Y]-vd_Z,0]],true);break;case vdConst.OsnapMode_CEN:{vd_br=vdgeo.vd_hz(vdgeo.CURVERESOLUTION,vd_i.vd_z().GetPixelSize(),vd_Z,vdgeo.VD_TWOPI);vd_gT=vdgeo.VD_TWOPI/vd_br;for(ang=0;ang<=vdgeo.VD_TWOPI;ang+=vd_gT){pts.push(vdgeo.newpoint(vd_E[X]+vd_Z*Math.cos(ang),vd_E[Y]+vd_Z*Math.sin(ang),0));}vd_i.vd_z().vd_ak(pts,true);}break;case vdConst.OsnapMode_INS:vd_i.vd_z().vd_ak([[vd_E[X]-vd_Z,vd_E[Y],0],[vd_E[X]+vd_Z,vd_E[Y],0],[vd_E[X]+vd_Z,vd_E[Y]-vd_Z,0],[vd_E[X],vd_E[Y]-vd_Z,0],[vd_E[X],vd_E[Y]+vd_Z,0],[vd_E[X]-vd_Z,vd_E[Y]+vd_Z,0]],true);break;case vdConst.OsnapMode_NODE:{vd_br=vdgeo.vd_hz(vdgeo.CURVERESOLUTION,vd_i.vd_z().GetPixelSize(),vd_Z,vdgeo.VD_TWOPI);vd_gT=vdgeo.VD_TWOPI/vd_br;for(ang=0;ang<=vdgeo.VD_TWOPI;ang+=vd_gT){pts.push(vdgeo.newpoint(vd_E[X]+vd_Z*Math.cos(ang),vd_E[Y]+vd_Z*Math.sin(ang),0));}vd_i.vd_z().vd_ak(pts,true);vd_i.vd_z().vd_dJ([vd_E[X]-vd_Z,vd_E[Y]-vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]+vd_Z,0]);vd_i.vd_z().vd_dJ([vd_E[X]-vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]-vd_Z,0]);}break;default:vd_i.vd_z().vd_ak([[vd_E[X]-vd_Z,vd_E[Y]-vd_Z,0],[vd_E[X]-vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]+vd_Z,0],[vd_E[X]+vd_Z,vd_E[Y]-vd_Z,0]],true);break;}vd_i.vd_z().vd_bE();}vd_i.vd_z().vd_aC(vd_nu);vd_i.vd_z().vd_y.vd_mG(vd_FG);vd_i.vd_z().vd_aK(vd_Ft);vd_i.vd_lO(vd_L,'draw');vd_i.vd_lg=vd_Gv;vd_i.vd_z().vd_y.Refresh();vd_i.vd_z().vd_y.vd_fa=vd_sg;};this.vd_dY=function(){return[vd_i.vd_z(),vd_bw,vd_aT];};Object.defineProperty(vd_L,'ReferencePoint',{get:function(){if(vd_L.actionType==vdConst.ACTION_POINT_WORLD)return null;return vd_aT;}});Object.defineProperty(vd_L,'CurrentPoint',{get:function(){return vd_bw;}});return this;};var vd_Fx=[0,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,0,1,1,1,1,0,1,0,1,1,1,1,1,1,0];function vd_El(vd_EO,vd_sC){var vd_L=this;this.vd_fa=true;this.vd_cn=null;this.vd_fG=null;this.vd_fv=[1.0,1.0,1.0];var vd_cs=undefined;this.vd_Fp=function(){return vd_cs;};this.vd_cI=0;this.zFar=1;this.vd_yC=function(vd_Ad,zfar){vd_L.vd_cI=vd_Ad;vd_L.zFar=zfar;};this.vd_n=vd_EO;this.Alpha=255;this.vd_dk=[0,0,0,255];this.penwidth=0;var vd_o=[0,0,0,255];this.vd_aY=0;this.vd_bn=0;var vd_bk=null;var vd_t=null;var vd_rm=0;var px=0,py=0;this.vd_iC=vdConst.InterpolationMode_Bilinear;function vd_yA(p){return vdgeo.vd_R(p+0.49);};function vd_BU(p){return vdgeo.vd_R(p);};var vd_ay=vd_yA;this.vd_gD=function(){vd_th=vd_Ba;if(vd_L.vd_n.vd_bN||vd_L.vd_n.vd_co){vd_ay=vd_yA;if(vd_L.vd_n.vd_co)vd_th=vd_vK;}else{vd_ay=vd_BU;}};var vd_wu=0;var vd_ka;function vd_vK(px,py,pz){for(var i=0;i<vd_L.vd_n.vd_co.length;i++){vd_ka=vd_L.vd_n.vd_co[i][2];vd_wu=vd_ka[A20]*px+vd_ka[A21]*py+vd_ka[A22]*pz+vd_ka[A23];if(vd_wu<0)return false;}return true;};function vd_Ba(px,py,pz){return true;};var vd_th=vd_vK;this.vd_Fk=function(img){if(img!=null){if(img._a1==false||(typeof(_evl)!='undefined'&&_evl(vd_L)==false)){var bytescount=4;var left=vd_ay((vd_L.vd_aY-img.width)*0.5);var top=vd_ay((vd_L.vd_bn-img.height)*0.5);left=Math.max(left,0);top=Math.max(top,0);var right=left+img.width;var bottom=top+img.height;right=Math.min(right,vd_L.vd_aY);bottom=Math.min(bottom,vd_L.vd_bn);var div=162/255;for(var y=top;y<bottom;y++){for(var x=left;x<right;x++){var srcy=y-top;var srcx=(x-left)*bytescount;var pos=(((vd_L.vd_bn-1)-y)*vd_L.vd_aY+x)*4;var ir=img.bytes[srcy][srcx];var ig=img.bytes[srcy][srcx+1];var ib=img.bytes[srcy][srcx+2];ir=vdgeo.vd_R(ir*div+vd_t[pos]*(1-div));ig=vdgeo.vd_R(ig*div+vd_t[pos+1]*(1-div));ib=vdgeo.vd_R(ib*div+vd_t[pos+2]*(1-div));vd_t[pos]=ir;vd_t[pos+1]=ig;vd_t[pos+2]=ib;}}}}};this.vd_uz=function(){return vd_bk;};this.vd_iY=function(data,width,height,vd_Ij){vd_bk=data;if(!vd_bk){vd_t=null;vd_cs=null;vd_L.vd_cn=null;vd_L.vd_fG=null;vd_L.vd_aY=0;vd_L.vd_bn=0;vd_rm=0;}else{vd_t=vd_bk.data;vd_L.vd_aY=parseInt(width);vd_L.vd_bn=parseInt(height);vd_rm=vd_L.vd_aY*vd_L.vd_bn*4;if(!vd_Ij){vd_L.vd_cn=[];vd_L.vd_fG=[];}}};this.vd_Ck=function(){if(vd_L.vd_cn){vd_L.vd_cn=[];vd_L.vd_fG=[];if(vd_L.vd_n.vd_bS.vd_FP())vd_L.vd_fG=null;}};this.clear=function(color){vd_o=color;vd_EM(vd_t,color);if(vd_L.vd_n.vd_bG){vd_L.vd_Ck();}vd_cs=undefined;if(vd_L.vd_n.vd_bN){vd_cs=[];vd_cs.length=vd_rm/4;for(var i=0;i<vd_cs.length;i++){vd_cs[i]=1.0;}}};this.vd_vg=function(img){var i;if(!vd_bk)return;if(vd_L.vd_n.vd_bs())vd_L.vd_n.vd_ld();vd_L.vd_Fk(img);for(i=3;i<vd_rm;i+=4){vd_t[i]=255;}vd_L.vd_eu(null);};function vd_EM(data,color){if(!data|| !color)return;var left=vd_L.vd_n.clip[0];var right=vd_L.vd_n.clip[2];var top=vd_L.vd_n.clip[1];var bottom=vd_L.vd_n.clip[3];var iy,ix;var k=(top*vd_L.vd_aY+left)*4;var off=(vd_L.vd_aY-right+left-1)*4;for(iy=top;iy<=bottom;iy++){for(ix=left;ix<=right;ix++){data[k++]=color[0];data[k++]=color[1];data[k++]=color[2];data[k++]=color[3];}k+=off;}};this.vd_Hh=function(){return false;};this.vd_mG=function(vd_Al){var ret=vd_L.Alpha;vd_L.Alpha=vd_Al;return ret;};this.vd_aC=function(Color){if(Color[3]!==undefined)vd_L.Alpha=Color[3];vd_L.vd_dk=Color;};this.vd_aK=function(vd_mF){vd_L.penwidth=vd_mF;};this.vd_FC=function(x1,y1,z1){vd_dD(vd_ay(x1),vd_ay(y1));vd_L.vd_aq(z1);};this.vd_AG=function(x1,y1,x2,y2){x1=vd_ay(x1);y1=vd_ay(y1);x2=vd_ay(x2);y2=vd_ay(y2);vd_L.vd_nE(x1,y1,x2,y2,1,1);};this.vd_BA=function(x1,y1,w,z1,z2,u1,v1,w1,u2,v2,w2){var iz=0,iu=0,iv=0,iw=0;var gradient=0,sx=0,ex=0,x=0,z=0,u=0,v=0,tw=0;if(y1<vd_L.vd_n.clip[1]||y1>vd_L.vd_n.clip[3])return;sx=Math.max(vd_L.vd_n.clip[0],x1);ex=Math.min(vd_L.vd_n.clip[2],x1+w);sx=vd_ay(sx);ex=vd_ay(ex);y1=vd_ay(y1);iz=(z2-z1);iu=(u2-u1);iv=(v2-v1);iw=(w2-w1);var scol=vd_L.vd_dk;if(vd_L.vd_n.vd_jO){for(x=sx;x<ex;x++){gradient=(x-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;vd_L.vd_dk=[vdgeo.vd_R(u),vdgeo.vd_R(v),vdgeo.vd_R(tw)];vd_dD(x,y1);vd_L.vd_aq(z);}vd_L.vd_dk=scol;}else{for(x=sx;x<ex;x++){gradient=(x-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_dD(x,y1);vd_L.vd_aq(z,true,u,v);}}};var vd_vs=false;var vd_eY=[0,0,0,0,0,0,0,0,0,0];this.vd_BQ=function(x1,y1,w,z1,z2){var iz=0;var sx=0,ex=0,i=0,gradient=0,z=0;if(y1<vd_L.vd_n.clip[1]||y1>vd_L.vd_n.clip[3])return;sx=Math.max(vd_L.vd_n.clip[0],x1);ex=Math.min(vd_L.vd_n.clip[2],x1+w);sx=vd_ay(sx);ex=vd_ay(ex);y1=vd_ay(y1);iz=(z2-z1);for(i=sx;i<ex;i++){gradient=(i-x1)/w;z=z1+iz*gradient;vd_dD(i,y1);vd_L.vd_aq(z);}};this.vd_qm=function(x1,y1,w){var sx=0,ex=0,i=0;if(y1<vd_L.vd_n.clip[1]||y1>vd_L.vd_n.clip[3])return;sx=Math.max(vd_L.vd_n.clip[0],x1);ex=Math.min(vd_L.vd_n.clip[2],x1+w);sx=vd_ay(sx);ex=vd_ay(ex);y1=vd_ay(y1);for(i=sx;i<ex;i++){vd_dD(i,y1);vd_L.vd_aq(1);}};this.vd_zO=function(x1,y1,x2,y2,z1,z2){vd_vs=true;vd_eY[0]=x1;vd_eY[1]=y1;vd_eY[2]=z1;vd_eY[3]=x2;vd_eY[4]=y2;vd_eY[5]=z2;x1=vd_ay(x1);y1=vd_ay(y1);x2=vd_ay(x2);y2=vd_ay(y2);vd_L.vd_nE(x1,y1,x2,y2,z1,z2);vd_vs=false;};var y=0;var vd_O=0,vd_u=0,vd_W=0,vd_P=0;var x1=0,y1=0,z1=0;var x2=0,y2=0,z2=0;var ind1=0,ind2=0;var ints=0;var uvx1=0,uvx2=0,uvy1=0,uvy2=0,uvz1=0,uvz2=0;var p1,p2,uv1,uv2,l1,l2;this.vd_Fm=function(pts,uvs,vd_dv){if(!uvs||(!vd_L.vd_n.vd_jO&& !vd_L.vd_n.vd_aQ)){vd_L.vd_hr(pts,vd_dv);return;}var gradient=0,u=0,v=0,w=0,x=0,z=0,i=0;var n=pts.length;if(n===0)return;p1=pts[0];vd_O=p1[Y];vd_u=p1[Y];vd_W=p1[X];vd_P=p1[X];for(i=1;i<n;i++){p1=pts[i];if(p1[Y]<vd_O)vd_O=p1[Y];else if(p1[Y]>vd_u)vd_u=p1[Y];if(p1[X]<vd_W)vd_W=p1[X];else if(p1[X]>vd_P)vd_P=p1[X];}if(vd_W>vd_L.vd_n.clip[2])return;if(vd_P<vd_L.vd_n.clip[0])return;if(vd_O>vd_L.vd_n.clip[3]||vd_u<vd_L.vd_n.clip[1])return;vd_O=Math.max(vd_O,vd_L.vd_n.clip[1]);vd_O=Math.min(vd_O,vd_L.vd_n.clip[3]);vd_u=Math.max(vd_u,vd_L.vd_n.clip[1]);vd_u=Math.min(vd_u,vd_L.vd_n.clip[3]);vd_O=Math.round(vd_O);vd_u=Math.round(vd_u);var vd_am;for(y=vd_O;y<=vd_u;y++){vd_am=[];ints=0;for(i=0;i<n;i++){if(i===0){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;uv1=uvs[ind1];uv2=uvs[ind2];if(y1>y2){p2=pts[ind1];p1=pts[ind2];uv2=uvs[ind1];uv1=uvs[ind2];}y2=p2[Y];y1=p1[Y];x2=p2[X];x1=p1[X];z2=p2[Z];z1=p1[Z];uvy2=uv2[Y];uvy1=uv1[Y];uvx2=uv2[X];uvx1=uv1[X];uvz2=uv2[Z];uvz1=uv1[Z];if(((y>=y1)&&(y<y2))||((y===vd_u)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);u=vdgeo.vd_bK(uvx1,uvx2,gradient);v=vdgeo.vd_bK(uvy1,uvy2,gradient);w=vdgeo.vd_bK(uvz1,uvz2,gradient);z=vdgeo.vd_bK(z1,z2,gradient);x=vdgeo.vd_bK(x1,x2,gradient);ints++;vd_am.push([x,z,u,v,w]);if(vd_dv&&ints===2)break;}}vd_am.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_am[ii];l2=vd_am[ii+1];vd_L.vd_BA(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1],l1[2],l1[3],l1[4],l2[2],l2[3],l2[4]);}}};this.vd_hr=function(pts,vd_dv){var gradient=0,x=0,z=0,i=0;var n=pts.length;if(n===0)return;p1=pts[0];vd_O=p1[Y];vd_u=p1[Y];vd_W=p1[X];vd_P=p1[X];for(i=1;i<n;i++){p1=pts[i];if(p1[Y]<vd_O)vd_O=p1[Y];else if(p1[Y]>vd_u)vd_u=p1[Y];if(p1[X]<vd_W)vd_W=p1[X];else if(p1[X]>vd_P)vd_P=p1[X];}if(vd_W>vd_L.vd_n.clip[2])return;if(vd_P<vd_L.vd_n.clip[0])return;if(vd_O>vd_L.vd_n.clip[3]||vd_u<vd_L.vd_n.clip[1])return;vd_O=Math.max(vd_O,vd_L.vd_n.clip[1]);vd_O=Math.min(vd_O,vd_L.vd_n.clip[3]);vd_u=Math.max(vd_u,vd_L.vd_n.clip[1]);vd_u=Math.min(vd_u,vd_L.vd_n.clip[3]);vd_O=Math.round(vd_O);vd_u=Math.round(vd_u);var vd_am;for(y=vd_O;y<=vd_u;y++){vd_am=[];ints=0;for(i=0;i<n;i++){if(i===0){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;if(y1>y2){p2=pts[ind1];p1=pts[ind2];}y2=p2[Y];y1=p1[Y];x2=p2[X];x1=p1[X];z2=p2[Z];z1=p1[Z];if(((y>=y1)&&(y<y2))||((y===vd_u)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);z=vdgeo.vd_bK(z1,z2,gradient);x=vdgeo.vd_bK(x1,x2,gradient);ints++;vd_am.push([x,z]);if(vd_dv&&ints===2)break;}}vd_am.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_am[ii];l2=vd_am[ii+1];vd_L.vd_BQ(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1]);}}};this.vd_dr=function(pts){var gradient=0,i=0;var n=pts.length;if(n===0)return;p1=pts[0];vd_O=p1[Y];vd_u=p1[Y];vd_W=p1[X];vd_P=p1[X];for(i=1;i<n;i++){p1=pts[i];if(p1[Y]<vd_O)vd_O=p1[Y];else if(p1[Y]>vd_u)vd_u=p1[Y];if(p1[X]<vd_W)vd_W=p1[X];else if(p1[X]>vd_P)vd_P=p1[X];}if(vd_W>vd_L.vd_n.clip[2])return;if(vd_P<vd_L.vd_n.clip[0])return;if(vd_O>vd_L.vd_n.clip[3]||vd_u<vd_L.vd_n.clip[1])return;vd_O=Math.max(vd_O,vd_L.vd_n.clip[1]);vd_O=Math.min(vd_O,vd_L.vd_n.clip[3]);vd_u=Math.max(vd_u,vd_L.vd_n.clip[1]);vd_u=Math.min(vd_u,vd_L.vd_n.clip[3]);vd_O=Math.round(vd_O);vd_u=Math.round(vd_u);if(vd_u-vd_O<=1){vd_L.vd_qm(vd_W,vd_O,vd_P-vd_W+1);return;}for(y=vd_O;y<=vd_u;y++){var vd_am=[];ints=0;for(i=0;i<n;i++){if(i===0){ind1=n-1;ind2=0;}else{ind1=i-1;ind2=i;}p1=pts[ind1];p2=pts[ind2];y2=p2[Y];y1=p1[Y];if(y1==y2)continue;if(y1>y2){p2=pts[ind1];p1=pts[ind2];}y2=p2[Y];y1=p1[Y];x2=p2[X];x1=p1[X];if(((y>=y1)&&(y<y2))||((y===vd_u)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);var x=vdgeo.vd_bK(x1,x2,gradient);vd_am.push(x);ints++;}}vd_am.sort(function(a,b){return a-b});for(var ii=0;ii<ints-1;ii+=2){vd_L.vd_qm(vd_am[ii],y,vd_am[ii+1]-vd_am[ii]+1);}}};this.vd_Fi=function(x1,y1,w,z1,z2,u1,v1,w1,u2,v2,w2){var iz=0,iu=0,iv=0,iw=0;var sx=0,ex=0,i=0,gradient=0,z=0,u=0,v=0,tw=0;var _sx=0,_ex=0,vd_ew=0,vd_fh,dx=0,dy=0;var vd_eA=0,sx_a=0,ex_a=0;sx=Math.max(vd_L.vd_n.clip[0],x1);ex=Math.min(vd_L.vd_n.clip[2],x1+w);_sx=vdgeo.vd_R(sx);_ex=vdgeo.vd_R(ex);if(_sx>=_ex)return;vd_ew=1.0;vd_fh=1.0;dx=(_sx-sx);if(dx<=0)dx=1.0+dx;dy=ex-_ex;if(dy<=0)dy=1.0+dy;vd_ew=Math.max(0.3,dx);vd_fh=Math.max(0.3,dy);sx=_sx;ex=_ex;y1=vdgeo.vd_R(y1);iz=(z2-z1);iu=(u2-u1);iv=(v2-v1);iw=(w2-w1);vd_eA=vd_L.Alpha;sx_a=vdgeo.vd_R(vd_ew*vd_L.Alpha);ex_a=vdgeo.vd_R(vd_fh*vd_L.Alpha);gradient=(sx-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_dD(sx,y1);vd_L.Alpha=sx_a;vd_L.vd_aq(z,true,u,v);vd_L.Alpha=vd_eA;for(i=sx+1;i<ex-1;i++){gradient=(i-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_dD(i,y1);vd_L.vd_aq(z,true,u,v);}if(i<ex){gradient=(i-x1)/w;z=z1+iz*gradient;u=u1+iu*gradient;v=v1+iv*gradient;tw=w1+iw*gradient;if(tw!=0.0){u/=tw;v/=tw;}vd_dD(i,y1);vd_L.Alpha=ex_a;vd_L.vd_aq(z,true,u,v);vd_L.Alpha=vd_eA;}};this.vd_Bh=function(x1,y1,w,z1,z2){var iz=0;var sx=0,ex=0,i=0,gradient=0,z=0;var _sx=0,_ex=0,vd_ew=0,vd_fh,dx=0,dy=0;var vd_eA=0,sx_a=0,ex_a=0;sx=Math.max(vd_L.vd_n.clip[0],x1);ex=Math.min(vd_L.vd_n.clip[2],x1+w);_sx=vdgeo.vd_R(sx);_ex=vdgeo.vd_R(ex);if(_sx>=_ex)return;vd_ew=1.0;vd_fh=1.0;dx=(_sx-sx);if(dx<=0)dx=1.0+dx;dy=ex-_ex;if(dy<=0)dy=1.0+dy;vd_ew=Math.max(0.3,dx);vd_fh=Math.max(0.3,dy);sx=_sx;ex=_ex;y1=vdgeo.vd_R(y1);iz=(z2-z1);vd_eA=vd_L.Alpha;sx_a=vdgeo.vd_R(vd_ew*vd_L.Alpha);ex_a=vdgeo.vd_R(vd_fh*vd_L.Alpha);gradient=(sx-x1)/w;z=z1+iz*gradient;vd_dD(sx,y1);vd_L.Alpha=sx_a;vd_L.vd_aq(z);vd_L.Alpha=vd_eA;for(i=sx+1;i<ex-1;i++){gradient=(i-x1)/w;z=z1+iz*gradient;vd_dD(i,y1);vd_L.vd_aq(z);}if(i<ex){gradient=(i-x1)/w;z=z1+iz*gradient;vd_dD(i,y1);vd_L.Alpha=ex_a;vd_L.vd_aq(z);vd_L.Alpha=vd_eA;}};this.vd_Em=function(x1,y1,w){var sx=0,ex=0,i=0;var _sx=0,_ex=0,vd_ew=0,vd_fh,dx=0,dy=0;var vd_eA=0,sx_a=0,ex_a=0;sx=Math.max(vd_L.vd_n.clip[0],x1);ex=Math.min(vd_L.vd_n.clip[2],x1+w);_sx=vdgeo.vd_R(sx);_ex=vdgeo.vd_R(ex);if(_sx>=_ex)return;vd_ew=1.0;vd_fh=1.0;dx=(_sx-sx);if(dx<=0)dx=1.0+dx;dy=ex-_ex;if(dy<=0)dy=1.0+dy;vd_ew=Math.max(0.3,dx);vd_fh=Math.max(0.3,dy);sx=_sx;ex=_ex;y1=vdgeo.vd_R(y1);vd_eA=vd_L.Alpha;sx_a=vdgeo.vd_R(vd_ew*vd_L.Alpha);ex_a=vdgeo.vd_R(vd_fh*vd_L.Alpha);vd_dD(sx,y1);vd_L.Alpha=sx_a;vd_L.vd_aq(1);vd_L.Alpha=vd_eA;for(i=sx+1;i<ex-1;i++){vd_dD(i,y1);vd_L.vd_aq(1);}if(i<ex){vd_dD(i,y1);vd_L.Alpha=ex_a;vd_L.vd_aq(1);vd_L.Alpha=vd_eA;}};this.vd_in=function(vd_bf){var gradient=0,x=0,a=0,i=0;vd_O=vd_u=vd_W=vd_P=0;var vd_aJ=[];var len=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length;i++){p1=vd_bf[a][i];len++;if(i===0&&a===0){vd_O=p1[Y];vd_u=p1[Y];vd_W=p1[X];vd_P=p1[X];continue;}if(p1[Y]<vd_O)vd_O=p1[Y];else if(p1[Y]>vd_u)vd_u=p1[Y];if(p1[X]<vd_W)vd_W=p1[X];else if(p1[X]>vd_P)vd_P=p1[X];}}if(vd_W>vd_L.vd_n.clip[2])return;if(vd_P<vd_L.vd_n.clip[0])return;if(vd_O>vd_L.vd_n.clip[3]||vd_u<vd_L.vd_n.clip[1])return;vd_O=Math.max(vd_O,vd_L.vd_n.clip[1]);vd_O=Math.min(vd_O,vd_L.vd_n.clip[3]);vd_u=Math.max(vd_u,vd_L.vd_n.clip[1]);vd_u=Math.min(vd_u,vd_L.vd_n.clip[3]);var y;for(y=vd_O;y<=vd_u;y++){len++;}vd_aJ.length=len;var k=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length;i++){vd_aJ[k++]=p1[Y];}}for(y=vd_O;y<=vd_u;y++){vd_aJ[k++]=y;}vd_aJ.sort(function(a,b){return a-b});y=vd_O-1000;ints=0;for(k=0;k<vd_aJ.length;k++){if(vd_aJ[k]-y<vdgeo.vd_gS)continue;y=vd_aJ[k];var vd_am=[];ints=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length-1;i++){ind1=i;ind2=i+1;p1=vd_bf[a][ind1];p2=vd_bf[a][ind2];y1=p1[Y];y2=p2[Y];if(y1==y2)continue;if(y1>y2){p2=vd_bf[a][ind1];p1=vd_bf[a][ind2];}y1=p1[Y];y2=p2[Y];x1=p1[X];x2=p2[X];if(((y>=y1)&&(y<y2))||((y===vd_u)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);x=vdgeo.vd_bK(x1,x2,gradient);vd_am.push([x]);ints++;}}}vd_am.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_am[ii];l2=vd_am[ii+1];vd_L.vd_Em(l1[0],y,l2[0]-l1[0]+1);}}};this.vd_pv=function(vd_bf){var gradient=0,x=0,z=0,a=0,i=0;vd_O=vd_u=vd_W=vd_P=0;var vd_aJ=[];var len=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length;i++){p1=vd_bf[a][i];len++;if(i===0&&a===0){vd_O=p1[Y];vd_u=p1[Y];vd_W=p1[X];vd_P=p1[X];continue;}if(p1[Y]<vd_O)vd_O=p1[Y];else if(p1[Y]>vd_u)vd_u=p1[Y];if(p1[X]<vd_W)vd_W=p1[X];else if(p1[X]>vd_P)vd_P=p1[X];}}if(vd_W>vd_L.vd_n.clip[2])return;if(vd_P<vd_L.vd_n.clip[0])return;if(vd_O>vd_L.vd_n.clip[3]||vd_u<vd_L.vd_n.clip[1])return;vd_O=Math.max(vd_O,vd_L.vd_n.clip[1]);vd_O=Math.min(vd_O,vd_L.vd_n.clip[3]);vd_u=Math.max(vd_u,vd_L.vd_n.clip[1]);vd_u=Math.min(vd_u,vd_L.vd_n.clip[3]);var y;for(y=vd_O;y<=vd_u;y++){len++;}vd_aJ.length=len;var k=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length;i++){vd_aJ[k++]=p1[Y];}}for(y=vd_O;y<=vd_u;y++){vd_aJ[k++]=y;}vd_aJ.sort(function(a,b){return a-b});y=vd_O-1000;ints=0;for(k=0;k<vd_aJ.length;k++){if(vd_aJ[k]-y<vdgeo.vd_gS)continue;y=vd_aJ[k];var vd_am=[];ints=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length-1;i++){ind1=i;ind2=i+1;p1=vd_bf[a][ind1];p2=vd_bf[a][ind2];y1=p1[Y];y2=p2[Y];if(y1==y2)continue;if(y1>y2){p2=vd_bf[a][ind1];p1=vd_bf[a][ind2];}y1=p1[Y];y2=p2[Y];x1=p1[X];x2=p2[X];z1=p1[Z];z2=p2[Z];if(((y>=y1)&&(y<y2))||((y===vd_u)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);z=vdgeo.vd_bK(z1,z2,gradient);x=vdgeo.vd_bK(x1,x2,gradient);vd_am.push([x,z]);ints++;}}}vd_am.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_am[ii];l2=vd_am[ii+1];vd_L.vd_Bh(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1]);}}};this.vd_FQ=function(vd_bf,uvs,vd_pl){if(!uvs|| !vd_L.vd_n.vd_aQ){vd_L.vd_pv(vd_bf);return;}var gradient=0,x=0,z=0,a=0,i=0,u=0,v=0,w=0;vd_O=vd_u=vd_W=vd_P=0;var vd_aJ=[];var len=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length;i++){p1=vd_bf[a][i];len++;if(i===0&&a===0){vd_O=p1[Y];vd_u=p1[Y];vd_W=p1[X];vd_P=p1[X];continue;}if(p1[Y]<vd_O)vd_O=p1[Y];else if(p1[Y]>vd_u)vd_u=p1[Y];if(p1[X]<vd_W)vd_W=p1[X];else if(p1[X]>vd_P)vd_P=p1[X];}}if(vd_W>vd_L.vd_n.clip[2])return;if(vd_P<vd_L.vd_n.clip[0])return;if(vd_O>vd_L.vd_n.clip[3]||vd_u<vd_L.vd_n.clip[1])return;vd_O=Math.max(vd_O,vd_L.vd_n.clip[1]);vd_O=Math.min(vd_O,vd_L.vd_n.clip[3]);vd_u=Math.max(vd_u,vd_L.vd_n.clip[1]);vd_u=Math.min(vd_u,vd_L.vd_n.clip[3]);var y;for(y=vd_O;y<=vd_u;y++){len++;}vd_aJ.length=len;var k=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length;i++){vd_aJ[k++]=p1[Y];}}for(y=vd_O;y<=vd_u;y++){vd_aJ[k++]=y;}vd_aJ.sort(function(a,b){return a-b});y=vd_O-1000;ints=0;for(k=0;k<vd_aJ.length;k++){if(vd_aJ[k]-y<vdgeo.vd_gS)continue;y=vd_aJ[k];var vd_am=[];ints=0;for(a=0;a<vd_bf.length;a++){for(i=0;i<vd_bf[a].length-1;i++){ind1=i;ind2=i+1;p1=vd_bf[a][ind1];p2=vd_bf[a][ind2];y1=p1[Y];y2=p2[Y];if(y1==y2)continue;uv1=uvs[a][ind1];uv2=uvs[a][ind2];if(y1>y2){p2=vd_bf[a][ind1];p1=vd_bf[a][ind2];uv2=uvs[a][ind1];uv1=uvs[a][ind2];}y1=p1[Y];y2=p2[Y];x1=p1[X];x2=p2[X];z1=p1[Z];z2=p2[Z];uvx1=uv1[X];uvx2=uv2[X];uvy1=uv1[Y];uvy2=uv2[Y];uvz1=uv1[Z];uvz2=uv2[Z];if(((y>=y1)&&(y<y2))||((y===vd_u)&&(y>y1)&&(y<=y2))){gradient=(y-y1)/(y2-y1);u=vdgeo.vd_bK(uvx1*vd_pl,uvx2*vd_pl,gradient);v=vdgeo.vd_bK(uvy1*vd_pl,uvy2*vd_pl,gradient);w=1;z=vdgeo.vd_bK(z1,z2,gradient);x=vdgeo.vd_bK(x1,x2,gradient);vd_am.push([x,z,u,v,w]);ints++;}}}vd_am.sort(function(a,b){return a[0]-b[0]});for(var ii=0;ii<ints-1;ii+=2){l1=vd_am[ii];l2=vd_am[ii+1];vd_L.vd_Fi(l1[0],y,l2[0]-l1[0]+1,l1[1],l2[1],l1[2],l1[3],l1[4],l2[2],l2[3],l2[4]);}}};this.vd_oo=function(vd_U,vd_pz,vd_zd,vd_ma){if(vd_U==null)return;var vd_kq=vd_U.width;var vd_jm=vd_U.height;var vd_hn=vdgeo.vd_l();vdgeo.vd_aM(vd_hn,vd_ma,vd_ma,1);vdgeo.vd_fx(vd_hn,vd_zd);if(!vdgeo.vd_yK(vd_hn))return;if(vd_hn==null)return;var vd_Eq=vdgeo.vd_bc(vd_hn);var m=vd_hn;var minv=vd_Eq;var vd_gM=vdgeo.vd_M(m,vdgeo.newpoint(0,0,0));var vd_nF=vdgeo.vd_M(m,vdgeo.newpoint(vd_kq,0,0));var vd_ja=vdgeo.vd_M(m,vdgeo.newpoint(vd_kq,vd_jm,0));var vd_nO=vdgeo.vd_M(m,vdgeo.newpoint(0,vd_jm,0));var left=Math.min(vd_gM[X],vd_nF[X],vd_ja[X],vd_nO[X]);var right=Math.max(vd_gM[X],vd_nF[X],vd_ja[X],vd_nO[X]);var top=Math.min(vd_gM[Y],vd_nF[Y],vd_ja[Y],vd_nO[Y]);var bottom=Math.max(vd_gM[Y],vd_nF[Y],vd_ja[Y],vd_nO[Y]);left=vd_ay(Math.max(left,vd_L.vd_n.clip[0]));right=vd_ay(Math.min(right,vd_L.vd_n.clip[2]));top=vd_ay(Math.max(top,vd_L.vd_n.clip[1]));bottom=vd_ay(Math.min(bottom,vd_L.vd_n.clip[3]));var mA00=minv[A00];var mA01=minv[A01];var mA10=minv[A10];var mA11=minv[A11];var mA03=minv[A03];var mA13=minv[A13];var ptx,pty,_ptx,_pty;var r,g,b;var _px3;for(var iy=top;iy<bottom;iy++){_ptx=mA01*iy+mA03;_pty=mA11*iy+mA13;for(var ix=left;ix<right;ix++){ptx=mA00*ix+_ptx;if(ptx<0)continue;if(ptx>=vd_kq)continue;pty=mA10*ix+_pty;if(pty<0)continue;if(pty>=vd_jm)continue;var rgb=vd_vq(vd_U,ptx,pty);if(!rgb)continue;r=rgb[0];g=rgb[1];b=rgb[2];var ipos=iy*vd_L.vd_aY+ix;var pos=ipos*4;vd_L.vd_oZ(ix,iy,pos,r,g,b,vd_L.Alpha);vd_yM(ipos);}}};function vd_Iw(){return vdgeo.vd_jW(px,py,vd_L.vd_n.clip[0],vd_L.vd_n.clip[1],vd_L.vd_n.clip[2],vd_L.vd_n.clip[3]);};function vd_dD(x,y){px=x;py=y;};var vd_xn=0;function vd_vO(XDir){vd_xn=XDir;};function AdvanceX(){px+=vd_xn;};function AdvanceY(){py++;};function vd_sj(vd_ef){for(var i=0;i<vd_ef;i++){vd_L.vd_aq();AdvanceX();}AdvanceY();};function vd_pL(vd_ef){for(var i=0;i<vd_ef;i++){vd_L.vd_aq();AdvanceY();}AdvanceX();};this.vd_ci=null;this.vd_rp=true;var vd_cY=0;var vd_jk=null;var vd_td=null;this.vd_yf=function(vd_Fj,color,matrix){vd_cY=vd_Fj;vd_jk=color;vd_td=matrix;};this.vd_eu=function(vd_aI){if(!vd_aI|| !vd_aI.bytes)vd_L.vd_ci=null;else vd_L.vd_ci=vd_aI;};var xor=false;this.vd_HX=function(value){var ret=xor;xor=value;return ret;};var vd_mX=undefined;function vd_FY(){if(vd_mX)return vd_mX;return vdgeo.vd_Gx(vd_eY[0],vd_eY[1],vd_eY[2],vd_eY[3],vd_eY[4],vd_eY[5],px,py);};function vd_vq(vd_U,_x,_y){var tx=vd_U.width;var ty=vd_U.height;var x=vdgeo.vd_R(_x);var y=vdgeo.vd_R(_y);var bytescount=4;var _px=x;var _py=y;var _px3=_px*bytescount;var ir=vd_U.bytes[_py][_px3];var ig=vd_U.bytes[_py][_px3+1];var ib=vd_U.bytes[_py][_px3+2];var ia=vd_U.bytes[_py][_px3+3];if(vd_L.vd_iC===vdConst.InterpolationMode_Bilinear){var ir1=ir;var ig1=ig;var ib1=ib;var ia1=ia;_px=Math.min(x+1,tx-1);_px3=_px*bytescount;_py=Math.min(y,ty-1);var ir2=vd_U.bytes[_py][_px3];var ig2=vd_U.bytes[_py][_px3+1];var ib2=vd_U.bytes[_py][_px3+2];var ia2=vd_U.bytes[_py][_px3+3];_px=Math.min(x,tx-1);_px3=_px*bytescount;_py=Math.min(y+1,ty-1);var ir3=vd_U.bytes[_py][_px3];var ig3=vd_U.bytes[_py][_px3+1];var ib3=vd_U.bytes[_py][_px3+2];var ia3=vd_U.bytes[_py][_px3+3];_px=Math.min(x+1,tx-1);_px3=_px*bytescount;_py=Math.min(y+1,ty-1);var ir4=vd_U.bytes[_py][_px3];var ig4=vd_U.bytes[_py][_px3+1];var ib4=vd_U.bytes[_py][_px3+2];var ia4=vd_U.bytes[_py][_px3+3];var dU=(_x-x);var dV=(_y-y);var m1=(1-dU)*(1-dV);var m2=(dU)*(1-dV);var m3=(1-dU)*(dV);var m4=(dU)*(dV);ir=vdgeo.vd_R(ir1*m1+ir2*m2+ir3*m3+ir4*m4);ig=vdgeo.vd_R(ig1*m1+ig2*m2+ig3*m3+ig4*m4);ib=vdgeo.vd_R(ib1*m1+ib2*m2+ib3*m3+ib4*m4);ia=vdgeo.vd_R(ia1*m1+ia2*m2+ia3*m3+ia4*m4);}if(ia===0)return null;return[ir,ig,ib];};this.vd_FI=function(xmin,xmax,ymin,ymax){if(!vd_cs)return 1.0;var vd_dn=Math.min(xmin,xmax);var vd_cP=Math.max(xmin,xmax);vd_dn=vd_ay(Math.max(vd_dn,0));vd_cP=vd_ay(Math.min(vd_cP,vd_L.vd_aY-1));var vd_ck=Math.min(ymin,ymax);var vd_dP=Math.max(ymin,ymax);vd_ck=vd_ay(Math.max(vd_ck,0));vd_dP=vd_ay(Math.min(vd_dP,vd_L.vd_bn-1));var ret=2.0;for(var y=vd_ck;y<vd_dP;y++){for(var x=vd_dn;x<vd_cP;x++){var ipos=y*vd_L.vd_aY+x;ret=Math.min(vd_cs[ipos],ret);}}if(ret>1)ret=0;return ret;};this.vd_mY=function(x,y){if(!vd_cs||x<0||x>=vd_L.vd_aY||y<0||y>=vd_L.vd_bn)return 1.0;var ipos=y*vd_L.vd_aY+x;return vd_cs[ipos];};var vd_Ax=0.000000001;var vd_AD=0.005;var __PT=vdgeo.newpoint(0,0,0);var ipos=0,vd_oN=0,cz=0,alpha=0;function vd_tP(zval,vd_sR,u,v){ipos=py*vd_L.vd_aY+px;var pos=ipos*4;vd_oN=undefined;cz=1.0;alpha=vd_L.Alpha;if(vd_L.vd_n.vd_bN||vd_L.vd_n.vd_co){if(zval)cz=zval;else cz=vd_FY();if(!vd_th(px,py,cz))return;}if(vd_cs&&vd_L.vd_n.vd_bN){vd_oN=vd_cs[ipos];var vd_tF=vd_t[pos+3];if(alpha!=255&&vd_tF!=255){if(vd_tF===alpha&&vdgeo.AreEqual(cz,vd_cs[ipos],vd_AD))return;}if(cz>(vd_cs[ipos]+vd_Ax))return;vd_cs[ipos]=cz;}if(vd_L.vd_ci&&vd_sR){if(!vd_L.vd_rp&&(u<0||u>1||v<0||v>1))return;var tx=vd_L.vd_ci.width;var ty=vd_L.vd_ci.height;var _x=(tx*u)%tx;var _y=(ty*v)%ty;if(_x<0)_x+=tx;if(_y<0)_y+=ty;var rgb=vd_vq(vd_L.vd_ci,_x,_y);if(!rgb){if(vd_oN)vd_cs[ipos]=vd_oN;return;}vd_L.vd_oZ(px,py,pos,rgb[0],rgb[1],rgb[2],alpha);}else if(vd_td!=null){vdgeo.vd_dZ(px,py,cz,vd_td,__PT);if(__PT[W]!=0){__PT[X]/=__PT[W];__PT[Y]/=__PT[W];}var dist=0;var vd_fw=vd_L.vd_dk;var vd_jj=vd_jk;if(vd_cY===1||vd_cY===3){dist=__PT[X]+0.5;}else{vd_fw=vd_jk;vd_jj=vd_L.vd_dk;dist=Math.sqrt(__PT[X]*__PT[X]+__PT[Y]*__PT[Y])*1.4142;}if(vd_cY===3||vd_cY===4||vd_cY===6){var tmp=vd_fw;vd_fw=vd_jj;vd_jj=tmp;}dist=Math.min(Math.max(dist,0),1);var r=vdgeo.vd_R(vd_fw[0]+(vd_jj[0]-vd_fw[0])*dist);var g=vdgeo.vd_R(vd_fw[1]+(vd_jj[1]-vd_fw[1])*dist);var b=vdgeo.vd_R(vd_fw[2]+(vd_jj[2]-vd_fw[2])*dist);vd_L.vd_oZ(px,py,pos,r,g,b,alpha);}else{vd_L.vd_oZ(px,py,pos,vd_L.vd_dk[0],vd_L.vd_dk[1],vd_L.vd_dk[2],alpha);}vd_yM(ipos);};this.vd_oZ=function(x,y,pos,r,g,b,a){var ir=r;var ig=g;var ib=b;var ia=a;if(vd_gY)ia=255;if(vd_cs&&vd_L.vd_n.vd_bN&&vd_L.vd_n.vd_eK){ir=vdgeo.vd_R(ir*vd_L.vd_fv[0]);ig=vdgeo.vd_R(ig*vd_L.vd_fv[1]);ib=vdgeo.vd_R(ib*vd_L.vd_fv[2]);if(ir>255)ir=255;if(ig>255)ig=255;if(ib>255)ib=255;}if(a!=255&& !xor){var div=a/255;ir=vdgeo.vd_R(ir*div+vd_t[pos]*(1-div));ig=vdgeo.vd_R(ig*div+vd_t[pos+1]*(1-div));ib=vdgeo.vd_R(ib*div+vd_t[pos+2]*(1-div));}if(vd_L.vd_n.vd_jU){ir=ig=ib=(ir+ig+ib)/3;}if(xor){vd_t[pos++]^=ir;vd_t[pos++]^=ig;vd_t[pos++]^=ib;vd_t[pos++]=255;}else{if(vd_L.vd_ug&&vd_wx(x,y)){ir=vd_o[0];ig=vd_o[1];ib=vd_o[2];ia=vd_o[3];}vd_t[pos++]=ir;vd_t[pos++]=ig;vd_t[pos++]=ib;vd_t[pos++]=ia;}};function vd_yM(vd_rD){if(!vd_L.vd_fa|| !vd_L.vd_n.vd_bG|| !vd_L.vd_cn)return;if(vd_L.vd_n.vd_dx.length===0)return;var fig=vd_L.vd_n.vd_dx[0];if(vd_L.vd_n.vd_bS.IgnoreLockLayers===true|| !fig.LayerRef|| !fig.LayerRef.Lock){var arr=vd_L.vd_cn[vd_rD];if(!arr){arr=[];vd_L.vd_cn[vd_rD]=arr;}var len=arr.length;if(len===0||arr[len-1]!==fig)arr[len]=fig;}if(vd_L.vd_fG&&vd_L.vd_n.vd_aR!==undefined){vd_L.vd_fG[vd_rD]=[vd_GO(vd_L.vd_n.vd_dx),vd_L.vd_n.vd_aR];}};function vd_GO(base){var vd_uv=[];var i;var len=base.length;for(i=0;i<len;i++){vd_uv[i]=base[i];}return vd_uv;};this.vd_ug=false;var vd_ij= -1;function vd_Bz(){vd_ij=0;};function vd_Cu(){vd_ij= -1;};function vd_wx(x,y){if(vd_ij>=0){if((vd_ij%6)>2){vd_ij++;return true;}vd_ij++;}else if(vd_Fx[vd_ay(y%8)*8+vd_ay(x%8)]==0)return true;return false;};var Temp=0,vd_hY=0,vd_ny=0,vd_hB=0,vd_dy=0,vd_cM=0;var vd_fi=0,vd_gx=0,vd_oE=0,vd_ef=0;function vd_xj(vd_mB,vd_lo,XEnd,YEnd){var i=0;if(vd_lo>YEnd){Temp=vd_lo;vd_lo=YEnd;YEnd=Temp;Temp=vd_mB;vd_mB=XEnd;XEnd=Temp;}vd_dD(vd_mB,vd_lo);if((vd_dy=XEnd-vd_mB)<0){vd_vO(-1);vd_dy= -vd_dy;}else{vd_vO(1);}vd_cM=YEnd-vd_lo;vd_Bz();if(vd_dy===0){for(i=0;i<=vd_cM;i++){vd_L.vd_aq();AdvanceY();}}else if(vd_cM===0){for(i=0;i<=vd_dy;i++){vd_L.vd_aq();AdvanceX();}}else if(vd_dy===vd_cM){for(i=0;i<=vd_dy;i++){vd_L.vd_aq();AdvanceX();AdvanceY();}}else if(vd_dy>=vd_cM){vd_fi=vdgeo.vd_R(vd_dy/vd_cM);vd_hY=(vd_dy%vd_cM)*2;vd_ny=vd_cM*2;vd_hB=(vd_dy%vd_cM)-(vd_cM*2);vd_gx=vdgeo.vd_R(vd_fi/2)+1;vd_oE=vd_gx;if((vd_hY===0)&&((vd_fi&0x01)===0)){vd_gx--;}if((vd_fi&0x01)!==0){vd_hB+=vd_cM;}vd_sj(vd_gx);for(i=0;i<(vd_cM-1);i++){vd_ef=vd_fi;if((vd_hB+=vd_hY)>0){vd_ef++;vd_hB-=vd_ny;}vd_sj(vd_ef);}vd_sj(vd_oE);}else{vd_fi=vdgeo.vd_R(vd_cM/vd_dy);vd_hY=(vd_cM%vd_dy)*2;vd_ny=vd_dy*2;vd_hB=(vd_cM%vd_dy)-(vd_dy*2);vd_gx=vdgeo.vd_R(vd_fi/2)+1;vd_oE=vd_gx;if((vd_hY===0)&&((vd_fi&0x01)===0)){vd_gx--;}if((vd_fi&0x01)!==0){vd_hB+=vd_dy;}vd_pL(vd_gx);for(i=0;i<(vd_dy-1);i++){vd_ef=vd_fi;if((vd_hB+=vd_hY)>0){vd_ef++;vd_hB-=vd_ny;}vd_pL(vd_ef);}vd_pL(vd_oE);}vd_Cu();};function vd_uK(cx,cy,w,h){var a=w>>1,b=h>>1,wod=w&1,hod=h&1,x=0,y=b,oy=b,aa2=(a*a)<<1,aa4=aa2<<1,bb2=(b*b)<<1,bb4=bb2<<1,st=(aa2>>1)*(1-(b<<1))+bb2,tt=(bb2>>1)-aa2*((b<<1)-1),xl,dw,dh;if(w!=0)while(y>0){if(st<0){st+=bb2*((x<<1)+3);tt+=bb4*(++x);}else if(tt<0){st+=bb2*((x<<1)+3)-aa4*(y-1);xl=cx-x;dw=(x<<1)+wod;tt+=bb4*(++x)-aa2*(((y--)<<1)-3);dh=oy-y;vd_rf(xl,cy-oy,dw,dh);vd_rf(xl,cy+y+hod,dw,dh);oy=y;}else{tt-=aa2*((y<<1)-3);st-=aa4*(--y);}}vd_rf(cx-a,cy-oy,w,(oy<<1)+hod);};var vd_id=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0)];function vd_xi(x1,y1,x2,y2,z1,z2){if(vd_L.penwidth<2){vd_xj(x1,y1,x2,y2);return;}else{var ww2=vd_L.penwidth/2.0;var a=Math.atan2(y2-y1,x2-x1);var vd_cZ=Math.cos(a+vdgeo.HALF_PI);var sine=Math.sin(a+vdgeo.HALF_PI);vdgeo.vd_iE(vd_id[0],vd_cZ*ww2+x1,sine*ww2+y1,z1);vdgeo.vd_iE(vd_id[1],vd_cZ*ww2+x2,sine*ww2+y2,z2);vdgeo.vd_iE(vd_id[2],vd_cZ* -ww2+x2,sine* -ww2+y2,z2);vdgeo.vd_iE(vd_id[3],vd_cZ* -ww2+x1,sine* -ww2+y1,z1);if((vd_cs&&vd_L.vd_n.vd_bN)||vd_L.vd_n.vd_co)vd_L.vd_hr(vd_id,true);else vd_L.vd_dr(vd_id);vd_mX=z1;vd_uK(x1,y1,vd_L.penwidth,vd_L.penwidth);vd_mX=z2;vd_uK(x2,y2,vd_L.penwidth,vd_L.penwidth);vd_mX=undefined;}};function vd_rf(x,y,width,height){if(y>vd_L.vd_n.clip[3])return;if(x>vd_L.vd_n.clip[2])return;if(y<vd_L.vd_n.clip[1]){height+=(y-vd_L.vd_n.clip[1]);y=vd_L.vd_n.clip[1];}if(x<vd_L.vd_n.clip[0]){width+=(x-vd_L.vd_n.clip[0]);x=vd_L.vd_n.clip[0];}if(height<0)return;if(width<0)return;if((x+width)>vd_L.vd_n.clip[2])width-=(x+width-vd_L.vd_n.clip[2]);if((y+height)>vd_L.vd_n.clip[3])height-=(y+height-vd_L.vd_n.clip[3]);for(var h=0;h<height;h++){vd_L.vd_qm(x,y+h,width);}};this.ctx=vd_sC;var vd_uC;var vd_np=null;this.vd_HL=function(){return vd_gY;};var vd_gY=false;this.vd_kE=function(vd_AO){if(!vd_L.ctx)return;if(vd_AO){if(vd_gY)return;vd_gY=true;vd_np=vd_bk;vd_bk=vd_L.ctx.getImageData(0,0,vd_L.vd_aY,vd_L.vd_bn);vd_t=vd_bk.data;vd_uC=vd_L.vd_n.vd_bN;vd_L.vd_n.vd_bN=false;vd_L.vd_n.vd_gD();}else{if(!vd_gY)return;vd_gY=false;vd_L.vd_n.vd_bN=vd_uC;vd_bk=vd_np;if(!vd_bk)vd_t=null;else vd_t=vd_bk.data;vd_np=null;vd_L.vd_n.vd_gD();}};this.vd_vr=function(){if(!vd_L.ctx)return;if(!vd_gY)return;vd_L.ctx.putImageData(vd_np,0,0);vd_bk=vd_L.ctx.getImageData(0,0,vd_L.vd_aY,vd_L.vd_bn);vd_t=vd_bk.data;};this.vd_sX=function(){if(!vd_L.ctx)return;if(!vd_gY)return;vd_np=vd_L.ctx.getImageData(0,0,vd_L.vd_aY,vd_L.vd_bn);vd_bk=vd_L.ctx.getImageData(0,0,vd_L.vd_aY,vd_L.vd_bn);vd_t=vd_bk.data;};this.Refresh=function(){if(!vd_L.ctx)return;vd_L.ctx.putImageData(vd_bk,0,0);if(vd_L.vd_n.vd_bS.DrawOverallEntities&&vd_L.vd_n.vd_bS.DrawOverallEntities.length>0){var vd_zb=vd_bk;var vd_zj=vd_L.vd_n.vd_bN;var vd_zT=vd_L.vd_fa;vd_bk=vd_L.ctx.getImageData(0,0,vd_L.vd_aY,vd_L.vd_bn);vd_t=vd_bk.data;vd_L.vd_n.vd_bN=false;vd_L.vd_fa=false;vd_L.vd_n.vd_gD();try{for(var i=0;i<vd_L.vd_n.vd_bS.DrawOverallEntities.length;i++){vd_L.vd_n.vd_bS.DrawEntity(vd_L.vd_n.vd_bS.DrawOverallEntities[i],vd_L.vd_n);}}catch(ex){}vd_L.ctx.putImageData(vd_bk,0,0);vd_L.vd_n.vd_bN=vd_zj;vd_L.vd_fa=vd_zT;vd_bk=vd_zb;if(!vd_bk)vd_t=null;else vd_t=vd_bk.data;vd_L.vd_n.vd_gD();}};function vd_DO(x1,y1,x2,y2,z1,z2){vd_xj(x1,y1,x2,y2);};var vd_kl=[];function vd_BK(zval,vd_sR,u,v){ipos=py*vd_L.vd_aY+px;var pos=ipos*4;var ir,ig,ib,ia;ia=255;if(vd_wx(px,py)){ir=vd_o[0];ig=vd_o[1];ib=vd_o[2];}else{if(vd_kl.length===0){ir=vd_L.vd_dk[0];ig=vd_L.vd_dk[1];ib=vd_L.vd_dk[2];}else{ir=vd_kl[0];ig=vd_kl[1];ib=vd_kl[2];}}vd_t[pos++]=ir;vd_t[pos++]=ig;vd_t[pos++]=ib;vd_t[pos++]=ia;};function vd_Bx(zval,vd_sR,u,v){ipos=py*vd_L.vd_aY+px;var pos=ipos*4;vd_t[pos++]=vd_L.vd_dk[0];vd_t[pos++]=vd_L.vd_dk[1];vd_t[pos++]=vd_L.vd_dk[2];vd_t[pos++]=255;};this.vd_nE=vd_xi;this.vd_aq=vd_tP;this.vd_xf=function(vd_Bk,vd_HR){if(vd_Bk){vd_kl=vd_HR;if(vd_kl)vd_L.vd_aq=vd_BK;else vd_L.vd_aq=vd_Bx;vd_L.vd_nE=vd_DO;}else{vd_L.vd_aq=vd_tP;vd_L.vd_nE=vd_xi;}};return this;};function vd_Dg(vdcanvas){var vd_L=this;var vd_m=null;this.vd_xO=function(vd_zg){var ret=vd_m;vd_m=vd_zg;return ret;};vd_ry='precision mediump float;'+'varying float vfigprops;'+'varying vec4 vTexture;'+'uniform sampler2D uSampler;'+'uniform int textureprops;'+'uniform float section[25]; '+'uniform vec4 vd_o;'+'uniform int vd_hd;'+'vec4 color;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'float x,y,z,s;'+'void main(void) {'+'if (vd_hd != 3){'+'if (vd_hd == 1 && vColor.a < 0.999) discard;'+'if (vd_hd == 2 && vColor.a > 0.999) discard;'+'}'+'color = vColor;'+'x = vpos.x  / vpos.w;'+'y = vpos.y / vpos.w;'+'z = vpos.z / vpos.w;'+'for(int i = 0 ; i < 5; i++){'+'if(section[i*5+4] != 0.0)'+'{'+'s = section[i*5+0] * x + section[i*5+1] * y + section[i*5+2] * z + section[i*5+3];'+'if(s < 0.0) discard;'+'}'+'else'+'{'+'break;'+'}'+'}'+'if(textureprops == 0){'+'gl_FragColor = color;'+'}else{'+'x = vTexture[0];'+'y = vTexture[1];'+'z = vTexture[2] ;'+'if (z == 0.0) z = 1.0;'+'x = mod(x / z , 1.0);'+'y = mod(y / z , 1.0);'+'gl_FragColor =  texture2D(uSampler, vec2(x,y))* color;'+'}'+'if(vfigprops == 1.0 ){'+'x = mod(floor(gl_FragCoord.x), 8.0);'+'y = mod(floor(gl_FragCoord.y), 8.0);'+'if(x == y || x == (7.0 - y)){'+'        gl_FragColor = vd_o;'+'}'+'}'+'}';vd_rS='attribute float figprops;'+'varying float vfigprops;'+'attribute vec4 aVertexTexture;'+'varying vec4 vTexture;'+'attribute vec4 ppos;'+'attribute vec4 aVertexColor;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'void main(void) {'+'gl_Position = ppos;'+'vpos = ppos;'+'vColor = aVertexColor;'+'vTexture = aVertexTexture;'+'vfigprops = figprops;'+'}';vd_zG='precision mediump float;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'uniform float section[25]; '+'float x,y,z,s,a,b,b1,b2;'+'void main(void) {'+'x = vpos.x;'+'y = vpos.y;'+'z = vpos.z;'+'if(vpos.w != 0.0 ){'+'z /= vpos.w;'+'x /= vpos.w;'+'y /= vpos.w;'+'}'+'for(int i = 0 ; i < 5; i++){'+'if(section[i*5+4] != 0.0)'+'{'+'s = section[i*5+0] * x + section[i*5+1] * y + section[i*5+2] * z + section[i*5+3];'+'if(s < 0.0) discard;'+'}'+'else'+'{'+'break;'+'}'+'}'+'a = floor( 65535.0 * z  );'+'b = mod(a,256.0);b1=b/255.0;'+'a = (a-b) / 256.0;b = mod(a,256.0);b2=b/255.0;'+'gl_FragColor = vec4(b1,b2,vColor[0],vColor[1]);'+'}';vd_AL='attribute vec4 aVertexColor;'+'varying vec4 vColor;'+'varying vec4 vpos;'+'attribute vec4 ppos;'+'void main(void) {'+'gl_Position = ppos;'+'vpos = ppos;'+'vColor = aVertexColor;'+'}';var vd_b={vd_ry:vd_zG,vd_rS:vd_AL,gl:null,vd_dB:null,vd_aA:null,vd_gB:null,vd_lY:null,vd_hb:null,vd_kU:null,vd_T:null,section:null,vd_ek:null,vd_sW:[0,0]};this.vd_zk=function(fig,index){if(index===undefined)return;if(!vd_he())return;vd_nm=(fig&&fig.selected)?1:0;var a,b,v1=0,v2=0;if(index<65535){a=index+1;b=a%256.0;v1=b/255.0;a=(a-b)/256.0;b=a%256.0;v2=b/255.0;}vd_b.vd_sW=[v1,v2];};function vd_he(){return vd_m.vd_bG;};function vd_AH(){var w=vd_m.vd_y.vd_aY;var h=vd_m.vd_y.vd_bn;vd_b.vd_dB=document.createElement("CANVAS");vd_b.vd_dB.setAttribute("width",w);vd_b.vd_dB.setAttribute("height",h);vd_b.vd_ek=new Uint8Array(w*h*4);vd_b.gl=vd_xC(vd_b.vd_dB);var vd_vd=vd_b.gl.createShader(vd_b.gl.FRAGMENT_SHADER);vd_b.gl.shaderSource(vd_vd,vd_b.vd_ry);vd_b.gl.compileShader(vd_vd);var vd_uR=vd_b.gl.createShader(vd_b.gl.VERTEX_SHADER);vd_b.gl.shaderSource(vd_uR,vd_b.vd_rS);vd_b.gl.compileShader(vd_uR);vd_b.vd_aA=vd_b.gl.createProgram();vd_b.gl.attachShader(vd_b.vd_aA,vd_vd);vd_b.gl.attachShader(vd_b.vd_aA,vd_uR);vd_b.gl.linkProgram(vd_b.vd_aA);vd_b.gl.validateProgram(vd_b.vd_aA);vd_b.gl.useProgram(vd_b.vd_aA);if(!vd_b.gl.getProgramParameter(vd_b.vd_aA,vd_b.gl.VALIDATE_STATUS)){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during vd_aA validation:\n'+vd_b.gl.getProgramInfoLog(vd_b.vd_aA));}vd_b.vd_gB=vd_b.gl.getAttribLocation(vd_b.vd_aA,'ppos');vd_b.gl.enableVertexAttribArray(vd_b.vd_gB);vd_b.vd_hb=vd_b.gl.getAttribLocation(vd_b.vd_aA,'aVertexColor');vd_b.gl.enableVertexAttribArray(vd_b.vd_hb);vd_b.section=vd_b.gl.getUniformLocation(vd_b.vd_aA,"section");vd_b.vd_lY=vd_b.gl.createBuffer();vd_b.vd_kU=vd_b.gl.createBuffer();};function vd_zy(){var size=12*vdcanvas.vd_uq();if(!vd_b.vd_T||vd_b.vd_T.length!=size){vd_b.vd_T=new Float32Array(size);}};function vd_Aa(vd_I){if(!vd_he())return;vd_b.vd_T[vd_I+4]=vd_b.vd_T[vd_I+8]=vd_b.vd_T[vd_I]=vd_b.vd_sW[0];vd_b.vd_T[vd_I+5]=vd_b.vd_T[vd_I+9]=vd_b.vd_T[vd_I+1]=vd_b.vd_sW[1];vd_b.vd_T[vd_I+6]=vd_b.vd_T[vd_I+10]=vd_b.vd_T[vd_I+2]=1;vd_b.vd_T[vd_I+7]=vd_b.vd_T[vd_I+11]=vd_b.vd_T[vd_I+3]=1;};function vd_BL(){if(!vd_he())return;var w=vd_m.vd_y.vd_aY;var h=vd_m.vd_y.vd_bn;if(vd_b.vd_dB.width<w||vd_b.vd_dB.height<h){vd_b.vd_ek=new Uint8Array(w*h*4);vd_b.vd_dB.setAttribute("width",w);vd_b.vd_dB.setAttribute("height",h);}vd_b.gl.enable(vd_b.gl.DEPTH_TEST);vd_b.gl.depthFunc(vd_b.gl.LEQUAL);vd_b.gl.viewport(vd_m.vd_cC,vd_m.vd_cG,vd_m.width,vd_m.height);vd_b.gl.disable(vd_b.gl.BLEND);};function vd_BR(sec){if(!vd_he())return;vd_b.gl.uniform1fv(vd_b.section,sec);};function vd_Fn(){if(!vd_he())return;vd_b.gl.bindBuffer(vd_b.gl.ARRAY_BUFFER,vd_b.vd_lY);vd_b.gl.bufferData(vd_b.gl.ARRAY_BUFFER,vd_ga,vd_b.gl.STATIC_DRAW);vd_b.gl.vertexAttribPointer(vd_b.vd_gB,4,gl.FLOAT,false,0,0);vd_b.gl.bindBuffer(vd_b.gl.ARRAY_BUFFER,vd_b.vd_kU);vd_b.gl.bufferData(vd_b.gl.ARRAY_BUFFER,vd_b.vd_T,vd_b.gl.STATIC_DRAW);vd_b.gl.vertexAttribPointer(vd_b.vd_hb,4,vd_b.gl.FLOAT,false,0,0);};function vd_Fl(){if(!vd_he())return;vd_b.gl.drawArrays(vd_b.gl.TRIANGLES,0,vd_eI*3);};function vd_Fv(){if(!vd_he())return;vd_b.gl.clearDepth(1.0);vd_b.gl.clearColor(1.0,1.0,1.0,1.0);vd_b.gl.clear(vd_b.gl.COLOR_BUFFER_BIT|vd_b.gl.DEPTH_BUFFER_BIT);};function vd_Bf(){if(!vd_he())return;vd_b.gl.flush();var w1=vd_m.vd_y.vd_aY;var h1=vd_m.vd_y.vd_bn;vd_b.gl.readPixels(0,0,w1,h1,vd_b.gl.RGBA,vd_b.gl.UNSIGNED_BYTE,vd_b.vd_ek);var vd_zn=vd_m.vd_y.vd_Fp();var k=0,i=0;var length=vd_b.vd_ek.length;for(i=0;i<length;i+=4){vd_zn[k++]=((vd_b.vd_ek[i])|(vd_b.vd_ek[i+1]<<8))/65535.0;}var vd_tH=vd_m.vd_y.vd_cn;if(vd_tH){var layout=vdcanvas.GetActiveLayout();if(layout){var elen=layout.Entities.Items.length;k=0;length=vd_b.vd_ek.length;for(i=0;i<length;i+=4,k++){var index=((vd_b.vd_ek[i+2])|(vd_b.vd_ek[i+3]<<8));if(index>0&&index<=elen)vd_tH[k]=[vdcanvas.GetEntityItem(layout.Entities.Items[index-1])];}}}};var gl=null;var vd_dB=null;var vd_kg=false;var vd_aA=null;var vd_sF=vdgeo.vd_l();var vd_hx=vdgeo.vd_l();var vd_eI=0;var vd_gB=null;var vd_lY=null;var vd_hb=null;var vd_kU=null;var vd_ga=null;var vd_T=null;var vd_ll=null;var vd_lq=null;var vd_sv=null;var vd_yh=null;var vd_rK=null;var vd_tc=null;var vd_vH=null;var vd_eo={};var textureprops=null;var vd_hd=3;var section=null;var vd_nm=0;var vd_o=null;var vd_im=null;this.vd_GI=function(){return vd_eI;};this.vd_GZ=function(){return gl!=null;};function vd_AY(){var vd_fb=null;try{var w=vd_m.vd_y.vd_aY;var h=vd_m.vd_y.vd_bn;vd_fb=document.createElement("CANVAS");vd_fb.setAttribute("width",w);vd_fb.setAttribute("height",h);vd_im=new Uint8Array(w*h*4);}catch(e){vdcanvas.vd_dN(vdConst.vd_cQ,0,'vd_nA caught in setCanvas: '+e.toString());}return vd_fb;};function vd_Cg(){var vd_hj=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vd_hj,vd_ry);gl.compileShader(vd_hj);if(!gl.getShaderParameter(vd_hj,gl.COMPILE_STATUS)){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during fragment shader compilation:\n'+gl.getShaderInfoLog(vd_hj));gl=null;return null;}return vd_hj;};function vd_CB(){var vd_gU=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vd_gU,vd_rS);gl.compileShader(vd_gU);if(!gl.getShaderParameter(vd_gU,gl.COMPILE_STATUS)){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during vd_bV shader compilation:\n'+gl.getShaderInfoLog(vd_gU));gl=null;return null;}return vd_gU;};function vd_Cn(_gl,vd_Aj,vd_zp){vd_aA=_gl.createProgram();_gl.attachShader(vd_aA,vd_Aj);_gl.attachShader(vd_aA,vd_zp);_gl.linkProgram(vd_aA);if(!_gl.getProgramParameter(vd_aA,_gl.LINK_STATUS)){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during vd_aA linking:\n'+_gl.getProgramInfoLog(vd_aA));_gl=null;return false;}_gl.validateProgram(vd_aA);if(!_gl.getProgramParameter(vd_aA,_gl.VALIDATE_STATUS)){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during vd_aA validation:\n'+_gl.getProgramInfoLog(vd_aA));_gl=null;return false;}_gl.useProgram(vd_aA);return true;};function vd_oU(vd_zV){var attribute=gl.getAttribLocation(vd_aA,vd_zV);if(attribute== -1){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during attribute address retrieval');gl=null;return attribute;}gl.enableVertexAttribArray(attribute);return attribute;};function vd_xC(vd_rC){if(!vd_rC)return null;var _gl;try{_gl=vd_rC.getContext('webgl')||vd_rC.getContext('experimental-webgl');}catch(e){_gl=null;vdcanvas.vd_dN(vdConst.vd_cQ,0,'vd_nA caught in getContext: '+e.toString());return null;}if(!_gl){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Unable to create Web GL context');return null;}return _gl;};this.vd_yo=function(vd_Gg){vd_m=vd_Gg;vd_eI=0;var size=12*vdcanvas.vd_uq();if(vd_kg){if(gl){vd_zy();if(!vd_ga||vd_ga.length!=size){vd_ga=new Float32Array(size);vd_T=new Float32Array(size);vd_ll=new Float32Array(size);vd_lq=new Float32Array(size/4);}vd_tn();}return;}vd_kg=true;vd_dB=vd_AY();gl=vd_xC(vd_dB);if(!gl)return;var vd_hj=vd_Cg();if(!vd_hj)return;var vd_gU=vd_CB();if(!vd_gU)return;if(!vd_Cn(gl,vd_hj,vd_gU)){gl=null;return;}vd_gB=vd_oU('ppos');if(vd_gB== -1){gl=null;return;}vd_hb=vd_oU('aVertexColor');if(vd_hb== -1){gl=null;return;}vd_sv=vd_oU('figprops');if(vd_sv== -1){gl=null;return;}vd_tc=vd_oU('aVertexTexture');if(vd_tc== -1){gl=null;return;}vd_rK=gl.getUniformLocation(vd_aA,"uSampler");if(vd_rK== -1){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during uniform address retrieval');gl=null;return;}textureprops=gl.getUniformLocation(vd_aA,"textureprops");if(textureprops== -1){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during uniform address retrieval');gl=null;return;}vd_hd=gl.getUniformLocation(vd_aA,"vd_hd");if(vd_hd== -1){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during uniform address retrieval');gl=null;return;}section=gl.getUniformLocation(vd_aA,"section");if(section== -1){vdcanvas.vd_dN(vdConst.vd_cQ,0,'Error during uniform address retrieval');gl=null;return;}vd_nm=0;vd_o=gl.getUniformLocation(vd_aA,"vd_o");vd_lY=gl.createBuffer();vd_kU=gl.createBuffer();vd_yh=gl.createBuffer();vd_vH=gl.createBuffer();vd_tn();vd_AH();};this.vd_nW=function(){if(!vd_kg)return;if(!gl)return;for(vd_h in vd_eo){if(!gl.isTexture(vd_eo[vd_h]))continue;gl.deleteTexture(vd_eo[vd_h]);}vd_eo={};};function vd_tn(){if(!vd_kg)return;if(!gl)return;gl.activeTexture(gl.TEXTURE0+0);gl.uniform1i(vd_rK,0);gl.uniform1i(textureprops,0);if(!vd_eo['h_0']){vd_eo['h_0']=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,vd_eo['h_0']);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));}else{gl.bindTexture(gl.TEXTURE_2D,vd_eo['h_0']);}};this.vd_AA=function(){if(!vd_kg)return;if(!gl)return;var vd_Ha=vdgeo.vd_l();var sec=[];sec.length=25;for(var i=0;i<25;i++)sec[i]=0.0;var seci=0;if(vd_m.vd_co){for(var i=0;i<vd_m.vd_co.length;i++){var vd_oV=vd_m.vd_co[i];var mat=vdgeo.vd_bc(vd_hx);vdgeo.vd_Y(mat,-vd_oV[0][X],-vd_oV[0][Y],-vd_oV[0][Z]);vdgeo.vd_jc(mat,vd_oV[1]);sec[seci++]=mat[8];sec[seci++]=mat[9];sec[seci++]=mat[10];sec[seci++]=mat[11];sec[seci++]=1.0;if(seci==sec.length)break;}}gl.uniform1fv(section,sec);vd_BR(sec);};this.vd_lH=function(mode){if(mode==2){vd_L.vd_oj();gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);}gl.uniform1i(vd_hd,mode);};this.vd_oj=function(){if(vd_eI==0)return;gl.bindBuffer(gl.ARRAY_BUFFER,vd_lY);gl.bufferData(gl.ARRAY_BUFFER,vd_ga,gl.STATIC_DRAW);gl.vertexAttribPointer(vd_gB,4,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,vd_kU);gl.bufferData(gl.ARRAY_BUFFER,vd_T,gl.STATIC_DRAW);gl.vertexAttribPointer(vd_hb,4,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,vd_vH);gl.bufferData(gl.ARRAY_BUFFER,vd_ll,gl.STATIC_DRAW);gl.vertexAttribPointer(vd_tc,4,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,vd_yh);gl.bufferData(gl.ARRAY_BUFFER,vd_lq,gl.STATIC_DRAW);gl.vertexAttribPointer(vd_sv,1,gl.FLOAT,false,0,0);vd_Fn();vd_Bc();vd_eI=0;};function vd_Bc(){gl.drawArrays(gl.TRIANGLES,0,vd_eI*3);vd_Fl();};function vd_lP(p1,p2,p3,vd_aV,uv1,uv2,uv3){if(vd_m.vd_rt(vd_aV)){if(vd_L.vd_GI()>=vdcanvas.vd_uq()){vd_L.vd_oj();}var vd_cV=vd_eI*12;vd_Cr(vd_cV,p1,p2,p3);vd_Bs(vd_cV,uv1,uv2,uv3);vd_Bb(vd_eI*3);vd_Bg(vd_cV,vd_aV,uv1,uv2,uv3);vd_eI++;}};this.vd_xl=function(){vd_hx=vdgeo.vd_iM(vd_m.vd_Gs(),vd_sF);};function vd_EI(mat){return new Array(mat[A00],mat[A10],mat[A20],mat[A30],mat[A01],mat[A11],mat[A21],mat[A31],mat[A02],mat[A12],mat[A22],mat[A32],mat[A03],mat[A13],mat[A23],mat[A33]);};this.vd_ys=function(){vdgeo.vd_fD(vd_sF);var w=vd_m.vd_y.vd_aY;var h=vd_m.vd_y.vd_bn;if(vd_dB.width<w||vd_dB.height<h){vd_im=new Uint8Array(w*h*4);vd_dB.setAttribute("width",w);vd_dB.setAttribute("height",h);}gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.viewport(vd_m.vd_cC,vd_m.vd_cG,vd_m.width,vd_m.height);vdgeo.vd_aM(vd_sF,1,-1,1);gl.disable(gl.BLEND);vd_BL();return true;};this.vd_xP=function(){var vd_ds=vd_m.vd_wo();gl.uniform4fv(vd_o,[vd_ds[0]/255.0,vd_ds[1]/255.0,vd_ds[2]/255.0,1.0]);gl.clearColor(vd_ds[0]/255.0,vd_ds[1]/255.0,vd_ds[2]/255.0,1.0);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);vd_Fv();};this.vd_ld=function(){vd_L.vd_oj();gl.flush();var i,iy,ix;var vd_ms=vd_m.vd_y.vd_uz();var w1=vd_m.vd_y.vd_aY;var h1=vd_m.vd_y.vd_bn;gl.readPixels(0,0,w1,h1,gl.RGBA,gl.UNSIGNED_BYTE,vd_im);var left=vd_m.clip[0];var top=vd_m.clip[1];var right=Math.min(w1-1,vd_m.clip[2]);var bottom=Math.min(h1-1,vd_m.clip[3]);var w=right-left+1;var h=bottom-top+1;for(iy=top;iy<=bottom;iy++){for(ix=left;ix<=right;ix++){i=(iy*w1+ix)*4;vd_ms.data[i]=vd_im[i];i++;vd_ms.data[i]=vd_im[i];i++;vd_ms.data[i]=vd_im[i];i++;vd_ms.data[i]=vd_im[i];i++;}}vd_Bf();vd_eI=0;};function vd_Ik(vd_wj,vd_Gj,vd_zP,vd_EY){for(var i=0;i<vd_EY;i++){vd_wj[vd_zP+i]=vd_wj[vd_Gj+i];}};function vd_ii(vd_oa,vd_cV,pt,is3){vd_oa[vd_cV]=pt[X];vd_oa[vd_cV+1]=pt[Y];vd_oa[vd_cV+2]=pt[Z];if(!is3)vd_oa[vd_cV+3]=pt[W];};function vd_Cr(vd_cV,p1,p2,p3){vd_ii(vd_ga,vd_cV,p1);vd_ii(vd_ga,vd_cV+4,p2);vd_ii(vd_ga,vd_cV+8,p3);};function vd_Bg(vd_cV,vd_aV,uv1,uv2,uv3){if(vd_m.vd_aQ&&vd_m.vd_y.vd_ci){vd_ii(vd_ll,vd_cV,uv1,true);vd_ii(vd_ll,vd_cV+4,uv2,true);vd_ii(vd_ll,vd_cV+8,uv3,true);}};function vd_Bb(vd_I){vd_lq[vd_I]=vd_nm;vd_lq[vd_I+1]=vd_nm;vd_lq[vd_I+2]=vd_nm;};function vd_Bs(vd_I,c1,c2,c3){var r=1,g=1,b=1,a=1;a=vd_m.vd_y.Alpha/255.0;if(!vd_m.vd_jO){if(!vd_m.vd_y.vd_ci|| !vd_m.vd_aQ){r=vd_m.vd_y.vd_dk[0]/255.0;g=vd_m.vd_y.vd_dk[1]/255.0;b=vd_m.vd_y.vd_dk[2]/255.0;}if(vd_m.vd_eK){r*=vd_m.vd_y.vd_fv[0];g*=vd_m.vd_y.vd_fv[1];b*=vd_m.vd_y.vd_fv[2];}vd_T[vd_I+4]=vd_T[vd_I+8]=vd_T[vd_I]=r;vd_T[vd_I+5]=vd_T[vd_I+9]=vd_T[vd_I+1]=g;vd_T[vd_I+6]=vd_T[vd_I+10]=vd_T[vd_I+2]=b;vd_T[vd_I+7]=vd_T[vd_I+11]=vd_T[vd_I+3]=a;}else{vd_T[vd_I]=c1[0]/255.0;vd_T[vd_I+1]=c1[1]/255.0;vd_T[vd_I+2]=c1[2]/255.0;vd_T[vd_I+3]=a;vd_T[vd_I+4]=c2[0]/255.0;vd_T[vd_I+5]=c2[1]/255.0;vd_T[vd_I+6]=c2[2]/255.0;vd_T[vd_I+7]=a;vd_T[vd_I+8]=c3[0]/255.0;vd_T[vd_I+9]=c3[1]/255.0;vd_T[vd_I+10]=c3[2]/255.0;vd_T[vd_I+11]=a;}vd_Aa(vd_I);};this.vd_rj=function(vd_mA,vd_lF){if(!vd_m.vd_aQ)return;if(vd_mA==vd_lF)return;if(!vd_m.vd_y.vd_ci){gl.bindTexture(gl.TEXTURE_2D,vd_eo['h_0']);gl.uniform1i(textureprops,0);}else{var hid='h_'+vd_m.vd_y.vd_ci.HandleId.toString();var vd_aI=vd_eo[hid];if(!vd_aI){vd_eo[hid]=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,vd_eo[hid]);var _w=vd_m.vd_y.vd_ci.width;var _h=vd_m.vd_y.vd_ci.height;var vd_we=new Uint8Array(_w*_h*4);var index=0;for(var h=0;h<vd_m.vd_y.vd_ci.height;h++){for(var w=0;w<vd_m.vd_y.vd_ci.width*4;w++){vd_we[index]=vd_m.vd_y.vd_ci.bytes[h][w];index++;}index=(h+1)*_w*4;}gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,_w,_h,0,gl.RGBA,gl.UNSIGNED_BYTE,vd_we);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);}else{gl.bindTexture(gl.TEXTURE_2D,vd_aI);}gl.uniform1i(textureprops,1);}};var vd_jx=vdgeo.newpoint(0,0,0);var vd_mP=vdgeo.newpoint(0,0,0);var vd_jq=vdgeo.newpoint(0,0,0);var vd_wy=vdgeo.newpoint(0,0,0);this.vd_hL=function(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs,vd_aV,uv1,uv2,uv3,uv4){vdgeo.vd_dZ(p1[X],p1[Y],p1[Z],vd_hx,vd_jx);vdgeo.vd_dZ(p2[X],p2[Y],p2[Z],vd_hx,vd_mP);vdgeo.vd_dZ(p3[X],p3[Y],p3[Z],vd_hx,vd_jq);vd_lP(vd_jx,vd_mP,vd_jq,vd_aV,uv1,uv2,uv3);if(p4){vdgeo.vd_dZ(p4[X],p4[Y],p4[Z],vd_hx,vd_wy);vd_lP(vd_jq,vd_wy,vd_jx,vd_aV,uv3,uv4,uv1);}};this.vd_bX=function(pts,vd_aV,uvs,vd_dv){if(pts.length>255)return;if(!vd_aV&&pts.length>2)vd_aV=vdgeo.vd_AW(pts[0],pts[1],pts[2]);if(!vd_aV)vd_aV=[0,0,-1];var _pts=pts;var i=0;var vd_aW=trig.vd_zx(_pts,vd_aV);var length=vd_aW.length;for(i=0;i<length-2;i+=3){var p1=_pts[vd_aW[i]];var p2=_pts[vd_aW[i+1]];var p3=_pts[vd_aW[i+2]];vdgeo.vd_dZ(p1[X],p1[Y],p1[Z],vd_hx,vd_jx);vdgeo.vd_dZ(p2[X],p2[Y],p2[Z],vd_hx,vd_mP);vdgeo.vd_dZ(p3[X],p3[Y],p3[Z],vd_hx,vd_jq);if(uvs){vd_lP(vd_jx,vd_mP,vd_jq,vd_aV,uvs[vd_aW[i]],uvs[vd_aW[i+1]],uvs[vd_aW[i+2]]);}else{vd_lP(vd_jx,vd_mP,vd_jq,vd_aV,[0,0,0],[0,0,0],[0,0,0]);}}};return this;};function vd_rz(vd_q,vd_zF,vd_zo,vd_mj,vd_oi,vd_sC){var vd_L=this;this.vd_bS=vd_q;this.vd_bR=function(){return vdConst.vd_le;};this.vd_cC=vd_zF;this.vd_cG=vd_zo;this.width=vd_mj;this.height=vd_oi;this.vd_v=10;this.vd_r=vdgeo.newpoint(0,0,0);this.vd_bI=vdgeo.vd_l();this.vd_aH=vdgeo.vd_l();this.vd_hV=vdgeo.vd_l();this.vd_ad=1.0;this.GetPixelSize=function(){return vd_L.vd_ad;};this.vd_y=new vd_El(this,vd_sC);this.palette=null;this.vd_hK=1.0;this.RenderMode=vdConst.vd_jI;this.vd_bN=true;this.vd_bA=false;this.vd_aQ=true;this.vd_bG=true;this.vd_jU=false;this.vd_eK=true;this.vd_lG=true;this.vd_fV=vdgeo.newpoint(0,0,-1);this.vd_di=0.25;this.vd_Gu=0.15;this.vd_ie=[1,1,1];this.vd_co=null;this.vd_jL=function(vd_gd,vd_ia){if(!vd_gd|| !vd_ia)return 1.0;var size=vd_gd;if(size<0)size/= -100.0;var scale=size*vd_L.vd_ad*(dpi/25.4)/vd_ia;return scale;};this.vd_of=function(vd_gd,mat,vd_ia){if(!vd_gd|| !vd_ia)return;var scale=vd_L.vd_jL(vd_gd,vd_ia);vdgeo.vd_aM(mat,scale,scale,1.0);};this.vd_sG=function(from){if(!from)return;vd_L.vd_bA=from.vd_bA;vd_L.vd_aQ=from.vd_aQ;vd_L.vd_bG=from.vd_bG;vd_L.vd_di=from.vd_di;vd_L.vd_ie=from.vd_ie;vd_L.vd_eK=from.vd_eK;vd_L.vd_lG=from.vd_lG;vdgeo.vd_ce(vd_L.vd_fV,from.vd_fV);vd_L.vd_co=from.vd_co;vd_L.RenderMode=from.RenderMode;vd_L.vd_bN=from.vd_bN;vd_L.vd_y.vd_iC=from.vd_y.vd_iC;vd_L.vd_jU=from.vd_jU;};var vd_rW=vdgeo.newpoint(0,0,-1);this.vd_ye=function(x,y,z,vd_FO,vd_fe,r,g,b){vd_L.vd_lG=(vd_FO?true:false);vd_L.vd_eK=true;if(vd_fe<0){vd_L.vd_eK=false;vd_L.vd_di=0;}if(vd_fe===0)vd_L.vd_di=0.0;else if(vd_fe===1)vd_L.vd_di=0.25;else if(vd_fe===2)vd_L.vd_di=0.50;else if(vd_fe===3)vd_L.vd_di=0.75;else if(vd_fe===4)vd_L.vd_di=1.0;else vd_L.vd_di=0.25;vd_L.vd_di+=vd_L.vd_Gu;vd_L.vd_fV[X]=x;vd_L.vd_fV[Y]=y;vd_L.vd_fV[Z]=z;vdgeo.vd_cD(vd_L.vd_fV);if(!r&&r!=0)r=255;if(!g&&g!=0)g=255;if(!b&&b!=0)b=255;r=Math.min(Math.max(r,0),255);g=Math.min(Math.max(g,0),255);b=Math.min(Math.max(b,0),255);vd_L.vd_ie=[r/255,g/255,b/255];};function vd_CO(){vd_L.vd_ye(0,0,-1,true,1,255,255,255);};function vd_Dj(vd_fm){vd_CO();if(!vd_fm|| !vd_fm.Default)return;var vd_cu=null;if(vd_fm.Default&&vd_fm.Default.Enable)vd_cu=vd_fm.Default;if(!vd_cu&&vd_fm){for(var i=0;i<vd_fm.length;i++){if(!vd_fm[i].Enable)continue;vd_cu=vd_cu[i];break;}}if(!vd_cu)return;vd_L.vd_ye(vd_cu.Direction[X],vd_cu.Direction[Y],vd_cu.Direction[Z],true,vd_cu.Intensity,vd_cu.color[0],vd_cu.color[1],vd_cu.color[2]);vd_L.vd_eK=vd_cu.Enable;};this.vd_dx=[];this.linetype=null;this.vd_iR=1.0;this.vd_aR=undefined;var vd_na=null;var ShowHidenEdges=false;var vd_bi=[[vdgeo.vd_l(),vdgeo.vd_l(),vdgeo.vd_l()]];var vd_ds=[0,0,0,255];var vd_fA=[255,255,255,255];function vd_CP(color){return color==undefined||color==null||(color[0]===0&&color[1]===0&&color[2]===0&&color[3]===0);};this.vd_wo=function(){return vd_ds;};this.vd_iz=function(){return vd_fA;};this.vd_ed=function(index){if(index=== -1)return vd_ds;else if(index===6)return vd_fA;else if(vd_L.palette)return vd_L.palette.Items[index].SystemColor;};this.vd_kT=function(vd_gf,vd_o){if(!vd_CP(vd_o)){vd_ds=vd_o;var vd_pY=vdgdi.WHITE;if(vd_gf)vd_pY=vd_gf.Items[6].SystemColor;var vd_rU=vdgdi.vd_ok(vd_ds);var vd_GG=vdgdi.vd_ok(vdgdi.WHITE);var vd_AU=vdgdi.vd_ok(vdgdi.BLACK);var vd_Fg=vdgdi.vd_ok(vd_pY);var vd_EZ=Math.abs(vd_rU-vd_GG);var vd_AB=Math.abs(vd_rU-vd_AU);var vd_Gd=Math.abs(vd_rU-vd_Fg);if(vd_Gd<vdgdi.vd_BM){vd_fA=((vd_EZ>vd_AB)?vdgdi.WHITE:vdgdi.BLACK);}else{vd_fA=vd_pY;}}else{if(vd_gf){vd_ds=vd_gf.Background;vd_fA=vd_gf.Items[6].SystemColor;}else{vd_ds=vdgdi.BLACK;vd_fA=vdgdi.WHITE;}}vd_L.palette=vd_gf;vd_L.vd_aC(vd_fA);};this.vd_au={left:0,top:0,right:0,bottom:0};this.vd_qp=function(){return vd_L.vd_v*vd_L.vd_qO();};this.vd_qO=function(){return(vd_L.width/vd_L.height);};this.vd_kC=function(){if(vd_L.vd_dx.length===0)return null;return vd_L.vd_dx[vd_L.vd_dx.length-1];};this.vd_gv=function(bval){var ret=ShowHidenEdges;if(bval==undefined)bval=false;ShowHidenEdges=bval;return ret;};this.vd_rk=function(fig,index){if(fig==null){vd_L.vd_dx.pop();}else{vd_L.vd_dx.push(fig);}if(vd_L.vd_bG&&vd_L.vd_bs()){vd_L.vd_cp.vd_zk(fig,index);}};this.vd_px=function(ltscale){var ret=vd_L.vd_iR;vd_L.vd_iR=ltscale;return ret;};this.vd_re=function(lt){var ret=vd_L.linetype;if(lt!==undefined){vd_L.linetype=lt;}return ret;};this.vd_aK=function(vd_mF){var ret=vd_L.vd_y.penwidth;if(vd_mF!==undefined)vd_L.vd_y.vd_aK(vd_mF);return ret;};this.vd_qq=false;this.vd_lH=function(mode){if(vd_L.vd_bs()){vd_L.vd_cp.vd_lH(mode);}vd_od=mode;vd_L.vd_qq=false;};var vd_od=3;this.vd_aC=function(color){var ret=vd_L.vd_y.vd_dk;if(color!==undefined)vd_L.vd_y.vd_aC(color);return ret;};this.vd_eu=function(vd_aI){var ret=vd_L.vd_y.vd_ci;if(vd_aI!==0){vd_Ay(ret,vd_aI);vd_L.vd_y.vd_eu(vd_aI);vd_rj(ret,vd_aI);}return ret;};this.vd_gz=null;this.vd_gq=function(vd_lp){var ret=vd_L.vd_gz;if(vd_lp!==0)vd_L.vd_gz=vd_lp;return ret;};this.vd_mz=function(vd_sP){var ret=vd_L.vd_y.vd_ug;if(vd_sP!==undefined)vd_L.vd_y.vd_ug=vd_sP;return ret;};var vd_tg=1.0;var vd_BV=1.0;function vd_ua(){vd_tg=vd_xc(1,0,0);vd_BV=vd_xc(0,1,0);if(vd_L.vd_bs())vd_L.vd_cp.vd_xl();};this.vd_aN=function(mat){var m=vd_L.vd_bt();vd_bi.push([null,null,null]);vd_L.vd_mx(vdgeo.vd_iM(mat,m));};this.vd_bE=function(){vd_bi.pop();vd_ua();};this.vd_bt=function(){return vd_bi[vd_bi.length-1][0];};this.vd_Gs=function(){return vd_bi[vd_bi.length-1][2];};this.vd_eG=function(){return vd_bi[vd_bi.length-1][1];};function vd_Ce(){var fig=vd_L.vd_kC();if(fig==null||fig._t!==vdConst.vdText_code)return 1.0;return fig.Height/fig.StyleRef.FontFileVDS.Ascent;};var vd_uH=vdgeo.newpoint(0,0,1);function vd_wp(){vd_L.vd_y.vd_fv=[1.0,1.0,1.0];};this.vd_rt=function(normal){var vd_mS=1.0;if(vd_L.vd_bN&&vd_L.RenderMode===vdConst.vd_jI){if(!normal)normal=vdgeo.newpoint(0,0,1);vdgeo.vd_iW(vd_L.vd_bt(),normal[X],normal[Y],normal[Z],vd_uH,true);if(!vd_L.vd_bA&&vdgeo.AreEqual(vd_uH[Z],0.0,vdgeo.DefaultVectorEquality))return false;if(vd_L.vd_bA||(vd_L.vd_eK&&vd_rW[Z]<0)){vd_mS=Math.abs(vdgeo.vd_dX(vd_rW,vd_uH));vd_L.vd_y.vd_fv[0]=vd_L.vd_ie[0]*vd_mS+vd_L.vd_di;vd_L.vd_y.vd_fv[1]=vd_L.vd_ie[1]*vd_mS+vd_L.vd_di;vd_L.vd_y.vd_fv[2]=vd_L.vd_ie[2]*vd_mS+vd_L.vd_di;}}return true;};this.vd_mx=function(mat){vd_bi[vd_bi.length-1][0]=mat;vd_bi[vd_bi.length-1][1]=vdgeo.vd_iM(mat,vd_L.vd_aH);vd_bi[vd_bi.length-1][2]=vdgeo.vd_iM(mat,vd_L.vd_hV);vd_ua();};this.vd_pe=function(x,y){var vd_Fc=vdgeo.vd_ax(x,y,1,vd_L.vd_bI);var vd_xJ=vdgeo.vd_bc(vd_L.vd_bt());var vd_fq=vdgeo.vd_M(vd_xJ,vd_Fc);var elevation=0.0;var v=vdgeo.vd_mN(vd_xJ);if(!vdgeo.AreEqual(v[Z],0.0,vdgeo.DefaultLinearEquality)){var ar1=(elevation-vd_fq[Z])/v[Z];vd_fq[X]+=ar1*v[X];vd_fq[Y]+=ar1*v[Y];vd_fq[Z]=elevation;}return vd_fq;};this.clip=[vd_L.vd_cC,vd_L.vd_cG,vd_L.vd_cC+vd_L.width-1,vd_L.vd_cG+vd_L.height-1];this.vd_FW=function(){vd_L.clip=[vd_L.vd_cC,vd_L.vd_cG,vd_L.vd_cC+vd_L.width-1,vd_L.vd_cG+vd_L.height-1];vd_L.vd_ov();};this.vd_ur=function(left,top,right,bottom){vd_L.clip=[Math.max(left,vd_L.vd_cC),Math.max(top,vd_L.vd_cG),Math.min(right,vd_L.vd_cC+vd_L.width-1),Math.min(bottom,vd_L.vd_cG+vd_L.height-1)];vd_L.vd_ov();};this.vd_ov=function(){var vd_cv=vdgeo.newpoint(0,0,0);var vd_cl=vdgeo.newpoint(0,0,0);if(vd_L.clip==null)vd_L.clip=[vd_L.vd_cC,vd_L.vd_cG,vd_L.vd_cC+vd_L.width-1,vd_L.vd_cG+vd_L.height-1];if(vd_L.vd_bA){var _ul=vdgeo.vd_ax(vd_L.clip[0],vd_L.clip[1],1,vd_L.vd_bI);var _ur=vdgeo.vd_ax(vd_L.clip[2],vd_L.clip[1],1,vd_L.vd_bI);var _lr=vdgeo.vd_ax(vd_L.clip[2],vd_L.clip[3],1,vd_L.vd_bI);var _ll=vdgeo.vd_ax(vd_L.clip[0],vd_L.clip[3],1,vd_L.vd_bI);vd_L.vd_au.left=_ll[X];vd_L.vd_au.bottom=_ll[Y];vd_L.vd_au.right=_ur[X];vd_L.vd_au.top=_ur[Y];}else{vdgeo.vd_xu(vd_L.vd_bI,vd_L.clip[0],vd_L.clip[3],vd_cv);vdgeo.vd_xu(vd_L.vd_bI,vd_L.clip[2],vd_L.clip[1],vd_cl);vd_L.vd_au.left=vd_cv[X];vd_L.vd_au.bottom=vd_cv[Y];vd_L.vd_au.right=vd_cl[X];vd_L.vd_au.top=vd_cl[Y];}};this.vd_Ht=function(x,y){return vdgeo.vd_jW(x,y,vd_L.vd_au.left,vd_L.vd_au.bottom,vd_L.vd_au.right,vd_L.vd_au.top);};this.vd_wY=function(px,py){return vdgeo.vd_jW(px,py,vd_L.clip[0],vd_L.clip[1],vd_L.clip[2],vd_L.clip[3]);};var vd_aL=vdgeo.newpoint(0,0,0);var vd_ao=vdgeo.newpoint(0,0,0);var __P1=vdgeo.newpoint(0,0,0);var __P2=vdgeo.newpoint(0,0,0);var vd_ep=vdgeo.newpoint(0,0,0);var vd_cS=vdgeo.newpoint(0,0,0);this.vd_Cj=function(p1,p2,vd_D,vd_X){if(vd_L.vd_bA){vdgeo.vd_dZ(p1[X],p1[Y],p1[Z],vd_L.vd_aH,p1);vdgeo.vd_dZ(p2[X],p2[Y],p2[Z],vd_L.vd_aH,p2);var ret=vd_uF(p1,p2,vd_D,vd_X);return ret!==1;}else{return vdgeo.vd_wK(vd_L.vd_au.left,vd_L.vd_au.bottom,vd_L.vd_au.right,vd_L.vd_au.top,p1,p2,vd_D,vd_X)!==1;}};function vd_uG(p1,p2,vd_D,vd_X){return vdgeo.vd_wK(vd_L.clip[0],vd_L.clip[1],vd_L.clip[2],vd_L.clip[3],p1,p2,vd_D,vd_X);};function vd_uD(p1,p2,vd_D,vd_X){return vdgeo.vd_vS(vd_L.clip[0],vd_L.clip[1],vd_L.clip[2],vd_L.clip[3],p1,p2,vd_D,vd_X);};function vd_uF(p1,p2,vd_D,vd_X){if(!vdgeo.vd_Dk(p1,p2))return 1;return vdgeo.vd_vS(vd_L.clip[0],vd_L.clip[1],vd_L.clip[2],vd_L.clip[3],p1,p2,vd_D,vd_X);};var vd_eR=vd_uD;function vd_ul(pts,uvs,vd_dv){vd_L.vd_y.vd_dr(pts);};function vd_hr(pts,uvs,vd_dv){vd_L.vd_y.vd_Fm(pts,uvs,vd_dv);};function vd_BE(pts,uvs,vd_dv){var ret=vdgeo.vd_CZ(pts,uvs);vd_hr(ret[0],ret[1],vd_dv);};function vd_Br(pts,uvs,vd_ky){vd_L.vd_y.vd_in(pts);};function vd_pv(pts,uvs,vd_ky){vd_L.vd_y.vd_FQ(pts,uvs,vd_ky);};function vd_yx(x1,y1,x2,y2,z1,z2){vd_L.vd_y.vd_AG(x1,y1,x2,y2);};function vd_yD(x1,y1,x2,y2,z1,z2){vd_L.vd_y.vd_zO(x1,y1,x2,y2,z1,z2);};var vd_ho=vd_yD;function vd_wR(){if(vd_od===3)return true;else if(vd_od===1&&vd_L.vd_y.Alpha===255)return true;else if(vd_od===2&&vd_L.vd_y.Alpha!==255)return true;vd_L.vd_qq=true;return false;};function vd_sc(){return true;};var vd_dz=vd_wR;this.vd_nW=function(){vd_L.vd_cp.vd_nW();};this.destroy=function(){vd_L.vd_nW();};Object.defineProperty(vd_L,'vd_cp',{get:function(){return vd_L.vd_bS.vd_cp;}});this.vd_bs=function(){return(vd_q.vd_lg&& !vd_dS&&vd_L.RenderMode==vdConst.vd_jI&&vd_L.vd_cp.vd_GZ());};function vd_Ay(vd_mA,vd_lF){if(!vd_L.vd_aQ|| !vd_L.vd_bs())return;if(vd_mA==vd_lF)return;vd_L.vd_cp.vd_oj();};this.vd_ld=function(){if(!vd_L.vd_bs())return false;vd_L.vd_cp.vd_ld();return true;};function vd_rj(vd_mA,vd_lF){if(!vd_L.vd_bs())return;vd_L.vd_cp.vd_rj(vd_mA,vd_lF);};function vd_hL(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs,vd_aV,uv1,uv2,uv3,uv4){if(!vd_dz())return;if(vd_L.vd_bs()){vd_L.vd_cp.vd_hL(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs,vd_aV,uv1,uv2,uv3,uv4);return;}if(p4){vd_L.vd_bX([p1,p2,p3,p4],vd_aV,[uv1,uv2,uv3,uv4],true);}else{vd_L.vd_bX([p1,p2,p3],vd_aV,[uv1,uv2,uv3],true);}};function vd_Cl(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs,vd_aV,uv1,uv2,uv3,uv4){if(!vd_dz())return;if(vd_na!==null){vd_L.vd_aR=vd_na*5;if(vd_gc)vd_bY(p1,p2);vd_L.vd_aR++;if(vd_hc)vd_bY(p2,p3);vd_L.vd_aR++;if(vd_gJ)vd_bY(p3,p4?p4:p1);vd_L.vd_aR++;if(vd_gs&&p4)vd_bY(p4,p1);}else{if(vd_gc)vd_bY(p1,p2);if(vd_hc)vd_bY(p2,p3);if(vd_gJ)vd_bY(p3,p4?p4:p1);if(vd_gs&&p4)vd_bY(p4,p1);}vd_L.vd_aR=undefined;};var vd_eE=vd_hL;function vd_yL(x,y,z,vd_aF){vdgeo.vd_lN(vd_L.vd_eG(),x,y,z,vd_aF);};function vd_yQ(x,y,z,vd_aF){vdgeo.vd_pK(vd_L.vd_eG(),x,y,z,vd_aF);};function vd_EK(x,y,z,vd_aF){vdgeo.vd_dZ(x,y,z,vd_L.vd_eG(),vd_aF);};function vd_ne(vd_bV,vd_aF){vd_hQ(vd_bV[X],vd_bV[Y],vd_bV[Z],vd_aF);};function vd_Ei(vd_bV){var vd_aF=vdgeo.newpoint(0,0,0);vd_ne(vd_bV,vd_aF);return vd_aF;};function vd_DC(pts){var ret=[];ret.length=pts.length;for(var i=0;i<pts.length;i++){ret[i]=vd_Ei(pts[i]);}return ret;};var vd_dr=vd_hr;var vd_in=vd_pv;var vd_hQ=vd_yQ;this.vd_mK=function(){return vd_dS;};function vd_ux(pts,closed){var sp=pts[0];var ret;for(var i=1;i<pts.length;i++){var ep=pts[i];ret=vd_eR(sp,ep,vd_aL,vd_ao);if(ret!==1)vd_ho(vd_aL[X],vd_aL[Y],vd_ao[X],vd_ao[Y],vd_aL[Z],vd_ao[Z]);sp=ep;}if(closed){ret=vd_eR(sp,pts[0],vd_aL,vd_ao);if(ret===1)return;vd_ho(vd_aL[X],vd_aL[Y],vd_ao[X],vd_ao[Y],vd_aL[Z],vd_ao[Z]);}};function vd_GQ(pts,uvs,vd_dv){vd_ux(pts,true);};function vd_Cb(pts,uvs,vd_ky){for(var i=0;i<pts.length;i++){vd_ux(pts[i],true);}};var vd_dS=false;this.vd_mn=function(vd_If){if(vd_dS)return;vd_dS=true;vd_eR=vd_uG;vd_hQ=vd_yL;vd_in=vd_Cb;vd_ho=vd_yx;vd_dz=vd_sc;vd_eE=vd_hL;vd_L.vd_y.vd_xf(true,vd_If);};this.vd_pp=function(){if(!vd_dS)return;vd_L.vd_y.vd_xf(false);vd_dS=false;vd_L.vd_gD();};this.vd_gD=function(){if(vd_L.vd_bN||vd_L.vd_co){vd_eR=vd_uD;vd_hQ=vd_yQ;vd_dr=vd_hr;vd_in=vd_pv;vd_ho=vd_yD;vd_dz=vd_L.vd_bN?vd_wR:vd_sc;if(vd_L.vd_bA){vd_hQ=vd_EK;vd_eR=vd_uF;vd_dr=vd_BE;}}else{vd_eR=vd_uG;vd_hQ=vd_yL;vd_dr=vd_ul;vd_in=vd_Br;vd_ho=vd_yx;vd_dz=vd_sc;}if(vd_L.RenderMode===vdConst.vd_jI)vd_eE=vd_hL;else vd_eE=vd_Cl;vd_L.vd_y.vd_gD();};function vd_EC(vd_gk){vd_L.vd_co=null;if(!vd_gk|| !vd_gk.Items)return;var k=0;for(var i=0;i<vd_gk.Items.length;i++){if(!vd_gk.Items[i].Enable)continue;if(k>=vdConst.NUMSECTIONS)break;if(!vd_L.vd_co)vd_L.vd_co=[];vd_L.vd_co.push([vd_gk.Items[i].OriginPoint,vd_gk.Items[i].Direction]);k++;}};this.update=function(vd_lj,vd_fy,vd_Ap,vd_wN,FocalLength,LensAngle,vd_Hx,vd_hU,vd_gk,vd_fm){if(vd_hU!= -1){vd_L.RenderMode=vdConst.vd_pB;vd_L.vd_bN=false;vd_L.vd_aQ=false;if(vd_hU&&vd_hU>vdConst.RENDERMODE_WIRE_2d&&vd_hU<vdConst.vd_FN){vd_L.vd_bN=true;if(vd_hU===vdConst.RENDERMODE_RENDER)vd_L.vd_aQ=true;if(vd_hU>vdConst.RENDERMODE_WIRE_3d)vd_L.RenderMode=vdConst.vd_jI;}}vd_L.vd_cp.vd_yo(vd_L);if(!vd_lj)vd_lj=10.0;if(!vd_fy)vd_fy=vdgeo.newpoint(0,0,0);if(!FocalLength)FocalLength=0.05;if(!LensAngle)LensAngle=60.0;vd_Dj(vd_fm);vd_EC(vd_gk);var vd_hS=vdgeo.vd_cw(vd_Ap);vd_L.vd_bA=false;vd_L.vd_bA=vd_Hx;if(vd_L.vd_bA)vd_L.vd_bN=true;if(vd_L.vd_bA){vdgeo.vd_Y(vd_hS,-vd_fy[X],-vd_fy[Y],-vd_fy[Z]);vdgeo.vd_Y(vd_hS,0,0,-FocalLength);}var vd_cI=10000.0;var zFar= -10000.0;if(vd_wN){var box=vdgeo.vd_qP(vd_hS,vd_wN);vd_cI=box[5];zFar=box[2];}var dz=Math.max(1.0,vd_cI-zFar)*0.01;vd_cI+=dz;zFar-=dz;vd_cI*= -1.0;zFar*= -1.0;vd_L.vd_y.vd_yC(vd_cI,zFar);vd_L.vd_v=vd_lj;vd_L.vd_ad=vd_L.vd_v/vd_L.height;vd_L.vd_ad=Math.max(vdgeo.vd_zZ,(vd_L.vd_v/vd_L.height));vd_L.vd_ad=Math.min(vdgeo.vd_Dl,vd_L.vd_ad);vd_L.vd_v=vd_L.vd_ad*vd_L.height;vd_L.vd_r=vdgeo.newpoint(vd_fy[X],vd_fy[Y],vd_fy[Z]);vdgeo.vd_fD(vd_L.vd_hV);vdgeo.vd_fD(vd_L.vd_aH);vdgeo.vd_fD(vd_L.vd_bI);var vd_fQ=vd_L.width/vd_L.height;if(vd_L.vd_bA)vdgeo.vd_Dh(vd_L.vd_hV,vd_fQ,zFar,FocalLength,LensAngle);else vdgeo.vd_Dc(vd_L.vd_hV,vd_L.vd_r,vd_L.vd_v,vd_fQ,vd_cI,zFar);vdgeo.vd_oT(vd_L.vd_aH,vd_L.vd_hV);vdgeo.vd_aM(vd_L.vd_aH,vd_L.width*0.5,vd_L.height* -0.5,1);vdgeo.vd_Y(vd_L.vd_aH,(vd_L.width*0.5+vd_L.vd_cC),(vd_L.height*0.5+vd_L.vd_cG),0);vdgeo.vd_oT(vd_L.vd_bI,vd_L.vd_aH);vdgeo.vd_hR(vd_L.vd_bI);vd_L.vd_ov();if(vd_L.vd_eK){if(!vd_L.vd_lG){vdgeo.vd_iW(vd_hS,vd_L.vd_fV[X],vd_L.vd_fV[Y],vd_L.vd_fV[Z],vd_rW,true);}}if(vd_L.vd_bs())vd_L.vd_cp.vd_ys();vd_L.vd_mx(vdgeo.vd_cw(vd_hS));if(vd_L.vd_co){for(var i=0;i<vd_L.vd_co.length;i++){var section=vd_L.vd_co[i];var mat=vdgeo.vd_bc(vd_L.vd_eG());vdgeo.vd_Y(mat,-section[0][X],-section[0][Y],-section[0][Z]);vdgeo.vd_jc(mat,section[1]);section[2]=mat;}}if(vd_L.vd_bs())vd_L.vd_cp.vd_AA();vd_L.vd_gD();};this.clear=function(){vd_L.vd_y.clear(vd_ds);vd_L.vd_dx=[];vd_L.vd_aR=undefined;vd_na=null;if(vd_L.vd_bs())vd_L.vd_cp.vd_xP();};function vd_bY(vd_hu,vd_gF){if(!vd_dz())return;if(!vd_xt()){vd_pC(vd_hu,vd_gF,0.0,true);return;}vd_ne(vd_hu,__P1);vd_ne(vd_gF,__P2);var ret=vd_eR(__P1,__P2,vd_aL,vd_ao);if(ret===1)return;vd_ho(vd_aL[X],vd_aL[Y],vd_ao[X],vd_ao[Y],vd_aL[Z],vd_ao[Z]);};this.vd_dJ=function(vd_hu,vd_gF){if(vd_L.vd_bs())return;vd_bY(vd_hu,vd_gF);};this.vd_bX=function(pts,vd_aV,uvs,vd_dv){if(vd_L.vd_bs()){vd_L.vd_cp.vd_bX(pts,vd_aV,uvs,vd_dv);return;}if(!vd_dz())return;if(!vd_L.vd_rt(vd_aV))return;var npts=vd_DC(pts);vd_dr(npts,uvs,vd_dv);vd_wp();};this.vd_wW=function(vd_rA,direction,vd_ya){if(vd_L.vd_bs())return;if(!vd_dz())return;if(vd_L.vd_bN)return;var v=vdgeo.newpoint(0,0,0);vdgeo.vd_iW(vd_L.vd_bt(),direction[X],direction[Y],direction[Z],v,true);if(vdgeo.AreEqual(v[X],0.0,vdgeo.DefaultLinearEquality)&&vdgeo.AreEqual(v[Y],0.0,vdgeo.DefaultLinearEquality)){vd_L.vd_qA(vd_rA);return;}else{var pt1,pt2;var pt=vdgeo.vd_M(vd_L.vd_bt(),vd_rA);var vd_eH=(vdgeo.Distance2D(pt,vd_L.vd_r)+Math.sqrt(vd_L.vd_v*vd_L.vd_v+vd_L.vd_qp()*vd_L.vd_qp()))*2.0;if(!vd_ya){pt1=vdgeo.newpoint(pt[X]+v[X]* -vd_eH,pt[Y]+v[Y]* -vd_eH,pt[Z]+v[Z]* -vd_eH);pt2=vdgeo.newpoint(pt[X]+v[X]*vd_eH,pt[Y]+v[Y]*vd_eH,pt[Z]+v[Z]*vd_eH);}else{pt1=pt;pt2=vdgeo.newpoint(pt[X]+v[X]*vd_eH,pt[Y]+v[Y]*vd_eH,pt[Z]+v[Z]*vd_eH);}vdgeo.vd_dL(vd_L.vd_aH,pt1,__P1);vdgeo.vd_dL(vd_L.vd_aH,pt2,__P2);var ret=vd_eR(__P1,__P2,vd_aL,vd_ao);if(ret===1)return;vd_ho(vd_aL[X],vd_aL[Y],vd_ao[X],vd_ao[Y],vd_aL[Z],vd_ao[Z]);}};function vd_BD(pts,closed){var sp=pts[0];for(var i=1;i<pts.length;i++){var ep=pts[i];vd_bY(sp,ep);sp=ep;}if(closed)vd_bY(sp,pts[0]);};this.vd_ak=function(pts,closed){if(vd_L.vd_bs())return;if(!vd_dz())return;if(pts.length<2)return;if(!vd_xt()){vd_DW(pts,closed,0.0);return;}var sp=pts[0];for(var i=1;i<pts.length;i++){var ep=pts[i];vd_L.vd_aR=sp[INDEX];if(vd_L.vd_aR===undefined)vd_L.vd_aR=i-1;vd_bY(sp,ep);sp=ep;}if(closed){vd_L.vd_aR=pts[pts.length-1][INDEX];if(vd_L.vd_aR===undefined)vd_L.vd_aR=pts.length-1;vd_bY(pts[pts.length-1],pts[0]);}vd_L.vd_aR=undefined;};this.vd_ex=function(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs,vd_aV,uv1,uv2,uv3,uv4){vd_eE(p1,p2,p3,p4,vd_gc,vd_hc,vd_gJ,vd_gs,vd_aV,uv1,uv2,uv3,uv4);};function vd_ql(x,y,z){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_iW(vd_L.vd_bt(),x,y,z,v,false);v[Z]=0;return vdgeo.vd_hC(v);};function vd_xc(x,y,z){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_iW(vd_L.vd_bt(),x,y,z,v,false);return vdgeo.vd_hC(v);};function vd_ts(shape,offsetX,offsetY,vd_yH,vd_bl){if(shape==null){if(vd_bl==null)return;var w=vd_bl.Ascent*0.5;var lw=w*0.25;vd_BD([vdgeo.newpoint(offsetX+lw,offsetY,0),vdgeo.newpoint(offsetX+w-lw,offsetY,0),vdgeo.newpoint(offsetX+w-lw,offsetY+vd_bl.Ascent,0),vdgeo.newpoint(offsetX+lw,offsetY+vd_bl.Ascent,0)],true);}else{var vd_oW=[];var vd_pq=null;var vd_ky=vd_Ce();if(vd_L.vd_gz)vd_pq=[];if(shape.Segments!==undefined){for(var k=0;k<shape.Segments.Items.length;k++){var vd_CR=(shape.Segments.Items[k].Flag===1);var pts=shape.Segments.Items[k].Points.Items;if(vd_CR){if(shape.Segments.Items[k].vd_yu==undefined)shape.Segments.Items[k].vd_yu=vdgeo.vd_EQ(8,pts);pts=shape.Segments.Items[k].vd_yu;}var _pts=[];if(vd_pq)vd_pq.push(pts);for(var j=0;j<pts.length;j++){vd_hQ(pts[j][X]+offsetX,pts[j][Y]+offsetY,0,__P2);var npt=vdgeo.newpoint(__P2[X],__P2[Y],__P2[Z]);npt[W]=__P2[W];_pts.push(npt);}vd_oW.push(_pts);}}if(vd_yH&& !vd_L.vd_bA){vd_in(vd_oW,vd_pq,vd_ky);}else{var p1=vdgeo.newpoint();var p2=vdgeo.newpoint();for(var kk=0;kk<vd_oW.length;kk++){var pts2=vd_oW[kk];vdgeo.vd_ce(p1,pts2[0]);for(var jj=1;jj<pts2.length;jj++){vdgeo.vd_ce(p2,pts2[jj]);var vd_yJ=vd_eR(p1,p2,vd_aL,vd_ao);if(vd_yJ!==1){vd_ho(vd_aL[X],vd_aL[Y],vd_ao[X],vd_ao[Y],vd_aL[Z],vd_ao[Z]);}vdgeo.vd_ce(p1,pts2[jj]);}}}}};function vd_Cv(vd_ez,vd_kS,vd_bl){var m=vd_L.vd_eG();var pt=vdgeo.newpoint();vdgeo.vd_lN(m,0,vd_bl.Ascent,0,pt);var vd_W=pt[X];var vd_O=pt[Y];var vd_P=pt[X];var vd_u=pt[Y];vdgeo.vd_lN(m,vd_ez,vd_bl.Ascent,0,pt);vd_W=Math.min(vd_W,pt[X]);vd_O=Math.min(vd_O,pt[Y]);vd_P=Math.max(vd_P,pt[X]);vd_u=Math.max(vd_u,pt[Y]);vdgeo.vd_lN(m,0,-vd_bl.Descent,0,pt);vd_W=Math.min(vd_W,pt[X]);vd_O=Math.min(vd_O,pt[Y]);vd_P=Math.max(vd_P,pt[X]);vd_u=Math.max(vd_u,pt[Y]);vdgeo.vd_lN(m,vd_ez,-vd_bl.Descent,0,pt);vd_W=Math.min(vd_W,pt[X]);vd_O=Math.min(vd_O,pt[Y]);vd_P=Math.max(vd_P,pt[X]);vd_u=Math.max(vd_u,pt[Y]);if(vd_W>vd_L.clip[2])return false;if(vd_P<vd_L.clip[0])return false;if(vd_O>vd_L.clip[3])return false;if(vd_u<vd_L.clip[1])return false;return true;};this.vd_rd=function(vd_aE,vd_ez,vd_kS,vd_bl){if(!vd_aE)return;if(vd_L.vd_bs())return;if(!vd_dz())return;if(!vd_L.vd_rt(null))return;if(vd_dS){vd_L.vd_ak([[0,0,0],[vd_ez,0,0],[vd_ez,vd_kS,0],[0,vd_kS,0]],true);return;}vd_L.vd_aR=0;if(vd_Cv(vd_ez,vd_kS,vd_bl)){var vd_kV=vd_ql(0,vd_kS,0);var vd_rl=vd_kV/(dpi*vd_L.vd_ad);if(vd_rl<vd_Eb){var p0=vdgeo.newpoint(0,0,0);var p1=vdgeo.newpoint(vd_ez,0,0);var sw=vd_L.vd_aK(vd_rl*dpi);vd_bY(p0,p1);vd_L.vd_aK(sw);}else{var offsetX=0;var offsetY=0;for(var c=0;c<vd_aE.length;c++){var pos=vd_aE.charCodeAt(c);if(pos===10||pos===13)continue;var vd_fN=vd_bl.Shapes['h_'+pos.toString()];var shape=null;if(vd_fN!==undefined)shape=vd_bl.Shapes.Items[vd_fN];if(pos!=32){vd_ts(shape,offsetX,offsetY,vd_bl.FontType,vd_bl);}if(shape!=null){offsetX+=shape.AdvanceX;offsetY+=shape.AdvanceY;}else{offsetX+=vd_bl.Ascent*0.5;}}}}vd_wp();vd_L.vd_aR=undefined;};this.vd_oo=function(vd_U,vd_pz,vd_xX,vd_rv){if(vd_L.vd_y.vd_iC==vdConst.InterpolationMode_Nearest&& !vd_L.vd_bN&& !vd_dS&& !vd_L.vd_bs()){vd_L.vd_y.vd_oo(vd_U,vd_pz,vd_L.vd_eG(),vd_rv/vd_U.height);}else{var pts=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_xX,0,0),vdgeo.newpoint(vd_xX,vd_rv,0),vdgeo.newpoint(0,vd_rv,0)];var vd_aV=vdgeo.newpoint(0,0,1);var uvs=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(1,0,0),vdgeo.newpoint(1,1,0),vdgeo.newpoint(0,1,0)];vd_L.vd_or(pts,vd_aV,uvs,vd_U,true);}};this.vd_qA=function(pt){if(vd_L.vd_bs())return;if(!vd_dz())return;vd_ne(pt,__P1);if(vdgeo.vd_jW(__P1[X],__P1[Y],vd_L.clip[0],vd_L.clip[1],vd_L.clip[2],vd_L.clip[3]))vd_L.vd_y.vd_FC(__P1[X],__P1[Y],__P1[Z]);};var vd_dj=vdgeo.newpoint(0,0,0);var vd_cJ=vdgeo.newpoint(0,0,0);var _tm=vdgeo.vd_l();var vd_vv=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0)];this.vd_fc=function(pts,thickness,closed){if(!vd_dz())return;if(pts.length<2)return;if(thickness==0.0||thickness==undefined){vd_L.vd_ak(pts,closed);return;}var offset=0;var normal=vdgeo.newpoint(0,0,0);var ang,vd_HW,npts;npts=pts;var uvs=null;for(var i=0;i<npts.length-1;i++){vd_dj[X]=npts[i][X];vd_dj[Y]=npts[i][Y];vd_dj[Z]=npts[i][Z]+thickness;vd_cJ[X]=npts[i+1][X];vd_cJ[Y]=npts[i+1][Y];vd_cJ[Z]=npts[i+1][Z]+thickness;ang=vdgeo.GetAngle(npts[i],npts[i+1])+vdgeo.HALF_PI;normal[X]=Math.cos(ang);normal[Y]=Math.sin(ang);normal[Z]=0;var dist=vdgeo.Distance3D(npts[i],npts[i+1]);if(vd_L.vd_gz){uvs=vdgeo.vd_ff(vd_L.vd_gz,[vdgeo.newpoint(-offset,0,0),vdgeo.newpoint(-(offset+dist),0,0),vdgeo.newpoint(-(offset+dist),thickness,0),vdgeo.newpoint(-offset,thickness,0)]);}else{uvs=vd_vv;}vd_L.vd_aR=npts[i][INDEX];if(vd_L.vd_aR===undefined)vd_L.vd_aR=i;vd_eE(npts[i],npts[i+1],vd_cJ,vd_dj,true,(i===0|| !closed&&i===npts.length-2),true,true,normal,uvs[0],uvs[1],uvs[2],uvs[3]);offset+=dist;}if(closed){var vd_ev=npts.length-1;vd_dj[X]=npts[vd_ev][X];vd_dj[Y]=npts[vd_ev][Y];vd_dj[Z]=npts[vd_ev][Z]+thickness;vd_cJ[X]=npts[0][X];vd_cJ[Y]=npts[0][Y];vd_cJ[Z]=npts[0][Z]+thickness;ang=vdgeo.GetAngle(npts[vd_ev],npts[0])+vdgeo.HALF_PI;normal[X]=Math.cos(ang);normal[Y]=Math.sin(ang);normal[Z]=0;if(vd_L.vd_gz){uvs=vdgeo.vd_ff(vd_L.vd_gz,[vdgeo.newpoint(-offset,0,0),vdgeo.newpoint(-(offset+dist),0,0),vdgeo.newpoint(-(offset+dist),thickness,0),vdgeo.newpoint(-offset,thickness,0)]);}else{uvs=vd_vv;}vd_L.vd_aR=npts[vd_ev][INDEX];if(vd_L.vd_aR===undefined)vd_L.vd_aR=vd_ev;vd_eE(npts[vd_ev],npts[0],vd_cJ,vd_dj,true,false,true,true,normal,uvs[0],uvs[1],uvs[2],uvs[3]);}vd_L.vd_aR=undefined;};function vd_DS(pts){var vd_O=pts[0][Y];var vd_u=pts[0][Y];for(var i=0;i<pts.length;i++){var tmp=pts[i];if(tmp[Y]<vd_O)vd_O=tmp[Y];if(tmp[Y]>vd_u)vd_u=tmp[Y];}return[vd_O,vd_u];};function vd_Ct(pts,dy){var points=[];var _dy=0.0,_dx=0.0,_dya=0.0;var p1,p2,tmp=null;p1=pts[0];for(var i=1;i<pts.length;i++){p2=pts[i];_dya=p2[Y]-p1[Y];if(_dya==0.0||(dy>p1[Y]&&dy>p2[Y])||(dy<p1[Y]&&dy<p2[Y])){p1=p2;continue;}if(vdgeo.AreEqual(dy,p1[Y],vdgeo.DefaultPointEquality)){tmp=vdgeo.newpoint(p1[X],p1[Y],p1[Z]);points.push(tmp);p1=p2;continue;}_dy=dy-p1[Y];_dx=_dy*(p2[X]-p1[X])/_dya;tmp=vdgeo.newpoint(p1[X]+_dx,p1[Y]+_dy,p1[Z]);points.push(tmp);p1=p2;}return points;};function vd_BC(vd_bC,_p1,_p2,vd_qZ,scale){if(vd_bC.Dashes==undefined||(vd_bC.Dashes.Items.length===1&&vd_bC.Dashes.Items[0]<0.0)){vd_bY(_p1,_p2);return;}if(vd_bC.segmentlength==undefined){vd_bC.segmentlength=0;for(var i=0;i<vd_bC.Dashes.Items.length;i++){vd_bC.segmentlength+=Math.abs(vd_bC.Dashes.Items[i]*scale);}}var vd_cT=vd_bC.segmentlength;var vd_w;var vd_kV=vd_ql(vd_cT,0,0);if(vd_cT===0||vd_kV<vd_L.vd_ad*2.0){vd_bY(_p1,_p2);return;}vdgeo.vd_ce(vd_ep,_p1);vd_w=vd_qZ;if(vd_w<_p1[X])vd_w=_p1[X]-((_p1[X]-vd_w)%vd_cT);if(vd_w>_p1[X])vd_w=_p1[X]+((vd_w-_p1[X])%vd_cT)-vd_cT;while(vd_w<_p2[X]){for(var ii=0;ii<vd_bC.Dashes.Items.length;ii++){var dash=vd_bC.Dashes.Items[ii]*scale;vd_w+=Math.abs(dash);if(vd_w<_p1[X])continue;if(vd_w>_p2[X])vd_w=_p2[X];if(dash>0){vdgeo.vd_iE(vd_cS,vd_w,_p1[Y],_p1[Z]);vd_bY(vd_ep,vd_cS);vdgeo.vd_ce(vd_ep,vd_cS);}else if(dash===0){vdgeo.vd_iE(vd_cS,vd_w,_p1[Y],_p1[Z]);vd_L.vd_qA(vd_cS);}else{vdgeo.vd_iE(vd_ep,vd_w,_p1[Y],_p1[Z]);}if(vd_w>=_p2[X])break;}}};function vd_Cm(pts,vd_bC){var vd_ni=vd_J.IsDpi===false?vd_J.scale:vd_L.vd_ad*vd_Gr*dpi*vd_L.vd_hK;var vd_lv=vd_yX(vd_bC,vd_ni,vd_J.angle,vd_J.IsDpi);var origin=vd_lv[0];var vd_aD=vd_lv[1];var angle=vd_lv[2];if(vdgeo.AreEqual(vd_aD[Y],0.0,vdgeo.DefaultLinearEquality))return;var vd_jG=vdgeo.vd_l();var vd_yE;var vd_fC=0.0;var l=0;var vd_cA;var points;vdgeo.vd_Y(vd_jG,-vd_J.origin[X],-vd_J.origin[Y],-vd_J.origin[Z]);vdgeo.vd_Y(vd_jG,-origin[X],-origin[Y],0.0);vdgeo.vd_af(vd_jG,-angle);vd_cA=vdgeo.vd_ff(vd_jG,pts);vd_cA.push(vd_cA[0]);var vd_hy=vd_DS(vd_cA);if(vd_aD[Y]>0){vd_fC=vd_hy[X]-(vd_hy[X]%vd_aD[Y])-vd_aD[Y];while(vd_fC>vd_hy[X]){vd_fC-=vd_aD[Y];}}else{vd_fC=vd_hy[Y]-(vd_hy[Y]%vd_aD[Y])-vd_aD[Y];while(vd_fC<vd_hy[Y]){vd_fC-=vd_aD[Y];}}var t=vd_fC/vd_aD[Y];if(t<0.0)t-=0.5;else t+=0.5;l=vdgeo.vd_R(t);vd_yE=vdgeo.vd_bc(vd_jG);vd_L.vd_aN(vd_yE);while((vd_aD[Y]>0)?(vd_fC<=vd_hy[Y]):(vd_fC>=vd_hy[X])){points=vd_Ct(vd_cA,vd_fC);if((points.length%2)===1)points.pop();points.sort(function(a,b){return a[X]-b[X]});for(var pos=0;pos<points.length-1;pos+=2){vd_BC(vd_bC,points[pos],points[pos+1],vd_aD[X]*l,vd_ni);}vd_fC+=vd_aD[Y];l++;}vd_L.vd_bE();};function vd_BF(pts,PatternLines){var vd_As=vd_L.linetype;vd_L.linetype=null;for(var i=0;i<PatternLines.Items.length;i++){vd_Cm(pts,PatternLines.Items[i]);}vd_L.linetype=vd_As;};var vd_J={vd_o:undefined,color:undefined,vd_rJ:false,vd_rF:false,vd_dm:255,angle:0,scale:1,pattern:null,origin:vdgeo.newpoint(0,0,0),IsDpi:false,vd_mM:false,vd_cY:0,vd_jk:undefined,gradientAngle:0};function vd_yZ(pts){if(pts==null){vd_L.vd_y.vd_yf(0,undefined,null);return;}if(vd_J==null||vd_J==undefined||vd_J.vd_cY===0)return;var gcol=vd_J.vd_jk;if(gcol==undefined)gcol=vd_ds;var vd_bd=vdgeo.vd_FJ(pts);var w=vd_bd[3]-vd_bd[0];var h=vd_bd[4]-vd_bd[1];var s=(w+h)/2.0;var matrix=vdgeo.vd_bc(vd_L.vd_eG());if(vd_J.vd_cY===1||vd_J.vd_cY===3)s=w;vdgeo.vd_Y(matrix,-(vd_bd[0]+vd_bd[3])/2,-(vd_bd[1]+vd_bd[4])/2,vd_bd[2]);vdgeo.vd_af(matrix,-vd_J.gradientAngle);vdgeo.vd_aM(matrix,1/s,1/s,1);vd_L.vd_y.vd_yf(vd_J.vd_cY,gcol,matrix);};this.vd_dE=function(vd_ba){vd_J=vd_ba;};var vd_Gr=0.0833;var vd_DQ=0.0197;function vd_yX(vd_bC,vd_vY,vd_vw,vd_FZ){var m=vdgeo.vd_l();vdgeo.vd_aM(m,vd_vY,vd_vY,1);vdgeo.vd_af(m,vd_vw);var origin=vdgeo.vd_M(m,vd_bC.Origin);var vd_aD=vdgeo.newpoint(vd_bC.Offset[X],vd_bC.Offset[Y],vd_bC.Offset[Z]);if(vd_FZ===true){vd_aD[X]=vd_aD[X]==0.0?0:Math.abs(vd_aD[X])/vd_aD[X];vd_aD[Y]=vd_aD[Y]==0.0?0:Math.abs(vd_aD[Y])/vd_aD[Y];}vd_aD=vdgeo.vd_M(m,vd_aD);var angle=vd_bC.Angle+vd_vw;var vd_xe=vdgeo.vd_l();vdgeo.vd_af(vd_xe,-angle);vd_aD=vdgeo.vd_M(vd_xe,vd_aD);return[origin,vd_aD,angle];};this.vd_el=function(pts,vd_aV,uvs){if(vd_dS){vd_L.vd_bX(pts);return;}var vd_nu=undefined;if(vd_J!=null&&vd_J!==undefined&&vd_J.pattern!=null){var vd_qM=false;if(vd_J.IsDpi===false){if(vd_J.vd_mM===true){vd_qM=true;}else{var vd_ni=vd_J.scale;for(var i=0;i<vd_J.pattern.PatternLines.Items.length;i++){var vd_bC=vd_J.pattern.PatternLines.Items[i];var vd_lv=vd_yX(vd_bC,vd_ni,vd_J.angle,vd_J.IsDpi);var vd_kV=vd_ql(0,vd_lv[1][Y],0);var vd_rl=vd_kV/(dpi*vd_L.vd_ad);if(vd_rl<vd_DQ){vd_qM=true;break;}}}}vd_nu=vd_L.vd_aC(vd_J.vd_rF===true?vd_L.vd_iz():vd_J.color);if(!vd_qM){if(vd_J.vd_o!==undefined){var vd_Gw=vd_L.vd_aC(vd_J.vd_rJ===true?vd_L.vd_iz():vd_J.vd_o);vd_L.vd_bX(pts);vd_L.vd_aC(vd_Gw);}vd_BF(pts,vd_J.pattern.PatternLines);vd_L.vd_aC(vd_nu);return;}}var alpha=vd_L.vd_y.vd_mG(Math.min(vd_J.vd_dm,vd_L.vd_y.Alpha));vd_yZ(pts);vd_L.vd_or(pts,vd_aV,uvs,vd_L.vd_y.vd_ci);vd_yZ(null);vd_L.vd_y.vd_mG(alpha);vd_L.vd_aC(vd_nu);};this.vd_or=function(pts,vd_aV,uvs,vd_aI,vd_GS){if(!vd_dz())return;if(vd_dS){vd_L.vd_bX(pts,vd_aV,uvs);return;}var vd_zR=vd_L.vd_eu(vd_aI);var vd_Ag=vd_L.vd_aQ;vd_L.vd_aQ=true;var vd_EU=vd_dr;if(vd_L.vd_y.vd_ci&& !vd_L.vd_bN)vd_dr=vd_hr;vd_L.vd_y.vd_rp= !vd_GS;vd_L.vd_bX(pts,vd_aV,uvs);vd_L.vd_y.vd_rp=true;vd_dr=vd_EU;vd_L.vd_aQ=vd_Ag;vd_L.vd_eu(vd_zR);};this.vd_jO=false;this.vd_wX=function(FaceList,VertexList,vd_Fd,uvs,vd_av){var i,ii=0,i0,i1,i2,i3;var vd_eD=0;var p0,p1,p2,p3;var col= -1,vd_gt= -1;var vd_fg,vd_bZ;var length=FaceList.length;var vd_vj=vd_L.vd_aC(undefined);var vd_aI=vd_L.vd_y.vd_ci;vd_L.vd_jO=vd_av!=null;var vd_Fa=vd_eE;var vd_Gm=vd_dr;if(vd_L.vd_jO){vd_eE=vd_hL;if(vd_dr==vd_ul)vd_dr=vd_hr;}for(i=0;i<length;i=i+5){vd_fg=i/5;vd_bZ=4*vd_fg;vd_eD=0;ii=FaceList[i];if(ii<0)vd_eD+=1;ii=Math.abs(ii);i0=ii;p0=VertexList[ii-1];ii=FaceList[i+1];if(ii<0)vd_eD+=2;ii=Math.abs(ii);i1=ii;p1=VertexList[ii-1];ii=FaceList[i+2];if(ii<0)vd_eD+=4;ii=Math.abs(ii);i2=ii;p2=VertexList[ii-1];ii=FaceList[i+3];if(ii<0)vd_eD+=8;ii=Math.abs(ii);i3=ii;p3=VertexList[ii-1];col=FaceList[i+4];if(ShowHidenEdges)vd_eD=0;if(vd_gt!=col){vd_gt=col;if(vd_gt=== -1){vd_L.vd_aC(vd_vj);if(vd_L.vd_aQ){vd_L.vd_eu(vd_aI);}}else{var pcol=vd_L.palette.Items[vd_gt];vd_L.vd_aC(pcol.SystemColor);if(vd_L.vd_aQ){vd_L.vd_eu(pcol.MaterialImageRef);}}}vd_na=vd_fg;if((i3===i2||i3===i0))p3=null;vd_eE(p0,p1,p2,p3,((vd_eD&1)===0),((vd_eD&2)===0),((vd_eD&4)===0),((vd_eD&8)===0),vd_Fd[vd_fg],uvs[vd_bZ],uvs[vd_bZ+1],uvs[vd_bZ+2],uvs[vd_bZ+3]);}vd_L.vd_jO=false;vd_eE=vd_Fa;vd_dr=vd_Gm;vd_na=null;vd_L.vd_aC(vd_vj);if(vd_L.vd_aQ){vd_L.vd_eu(vd_aI);}};function vd_HO(){var vd_fS=document.createElement("div");vd_fS.style.height="25.4mm";vd_fS.style.width="25.4mm";vd_fS.style.visibility="hidden";document.body.appendChild(vd_fS);var xres=vd_fS.offsetWidth;var yres=vd_fS.offsetHeight;vd_fS.parentNode.removeChild(vd_fS);return yres;};var dpi=96.0;var vd_tM=0.2;var vd_Du=0.0625;var vd_Eb=0.033;var vd_op=false;function vd_qI(sp,ep){var vd_za=vd_op;vd_op=true;vd_bY(sp,ep);vd_op=vd_za;};function vd_xt(){if(vd_dS)return true;return(vd_L.linetype==null||vd_op==true||vd_L.linetype.Segments==undefined||vd_L.linetype.Segments.Items.length===0||(vd_L.linetype.IsDPIScale!==true&&vd_py()*vd_L.vd_iR<(vd_L.vd_ad*dpi*vd_Du*vd_L.vd_hK)));};function vd_py(){if(vd_L.linetype.OverAllLength!==undefined)return vd_L.linetype.OverAllLength;vd_L.linetype.OverAllLength=0.0;for(var i=0;i<vd_L.linetype.Segments.Items.length;i++){vd_L.linetype.OverAllLength+=Math.abs(vd_L.linetype.Segments.Items[i].DashLen);}return vd_L.linetype.OverAllLength;};function vd_CV(){if(vd_L.linetype.vd_jg!==undefined)return vd_L.linetype.vd_jg;if(vd_L.linetype==null||vd_L.linetype.Segments.Items.length==0){vd_L.linetype.vd_jg=false;return vd_L.linetype.vd_jg;}for(var i=0;i<vd_L.linetype.Segments.Items.length;i++){var vd_j=vd_L.linetype.Segments.Items[i];if(vd_j.Flag!=0||vd_j.DashLen>0.0){vd_L.linetype.vd_jg=false;return vd_L.linetype.vd_jg;}}vd_L.linetype.vd_jg=true;return vd_L.linetype.vd_jg;};function vd_pC(p1,p2,vd_qZ,vd_tN){vdgeo.vd_dL(vd_L.vd_bt(),p1,__P1);vdgeo.vd_dL(vd_L.vd_bt(),p2,__P2);if(vdgeo.AreEqual(vdgeo.Distance2D(__P1,__P2),0.0,vdgeo.DefaultLinearEquality)|| !vd_L.vd_Cj(__P1,__P2,vd_aL,vd_ao))return 0.0;var vd_yk=vd_CV();var vd_qf=0.0;var scale=vd_L.vd_iR;if(vd_L.linetype.IsDPIScale===true)scale=vd_L.vd_ad*dpi*vd_tM*vd_L.vd_hK;scale/=(vd_tg*vd_L.vd_hK);var vd_zW=vd_L.vd_ad/vd_tg;var vd_cT=vd_py()*scale;var length=vdgeo.Distance3D(p1,p2);vdgeo.vd_ce(vd_ep,p1);vdgeo.vd_ce(vd_cS,p1);var vd_w=0.0;var dash=0.0;vd_w-=vd_qZ;var angle=vdgeo.GetAngle(p1,p2);var vdir=vdgeo.VectorDirection(p1,p2);if(!vd_yk&&vd_tN&&vd_w==0&&vd_L.linetype.DrawMethod!=vdConst.LineTypeDrawMethod_Start){var vd_lx=length/vd_cT;var vd_sY=(Math.abs(vd_L.linetype.Segments.Items[0].DashLen)*scale+Math.abs(vd_lx-Math.floor(vd_lx))*vd_cT)/2.0;var dx=vd_sY-Math.abs(vd_L.linetype.Segments.Items[0].DashLen)*scale;vd_w=dx;vd_qf=((length-vd_w)%vd_cT);}else{vd_qf=((length+vd_qZ)%vd_cT);}var vd_un=vd_w;var start=0;while(vd_w<length){if(!vd_yk&&vd_L.linetype.DrawMethod!=vdConst.LineTypeDrawMethod_Start&&vd_tN&&(length-vd_w)<vd_cT){vd_w=length;vdgeo.vd_jZ(vd_cS,p1,vdir,vd_w);vd_qI(vd_ep,vd_cS);vdgeo.vd_ce(vd_ep,vd_cS);break;}for(var i=0;i<vd_L.linetype.Segments.Items.length;i++){var vd_j=vd_L.linetype.Segments.Items[i];dash=vd_j.DashLen*scale;vd_w+=Math.abs(dash);if(vd_w<0.0)continue;if(vd_w<start)continue;vd_un=vd_w;if(vd_w>length)vd_w=length;if(vd_j.Shape!=null){var vd_hE=vdgeo.vd_l();var vd_mI=vd_j.ShapeScale;vd_mI*=(1.0/(vd_j.ShapeStyleRef.FontFileVDS.Ascent));vdgeo.vd_Y(vd_hE,-vd_j.Shape.bb[0],0,0);vdgeo.vd_aM(vd_hE,vd_mI,vd_mI,1.0);vdgeo.vd_af(vd_hE,vd_j.ShapeRotation);vdgeo.vd_Y(vd_hE,vd_j.ShapeOffsetX,vd_j.ShapeOffsetY,0.0);vdgeo.vd_DT(vd_hE,vdgeo.newpoint(0,0,1),vdir);vdgeo.vd_aM(vd_hE,scale,scale,1.0);vdgeo.vd_jZ(vd_cS,p1,vdir,vd_w);vdgeo.vd_Y(vd_hE,vd_cS[X],vd_cS[Y],vd_cS[Z]);var d2=vd_un+vd_j.ShapeOffsetX*scale+(vd_tN?((vd_j.Shape.bb[2]-vd_j.Shape.bb[0])*vd_mI):0.0);if(d2<=length){vd_L.vd_aN(vd_hE);vd_ts(vd_j.Shape,0,0,vd_j.ShapeStyleRef.FontFileVDS.FontType,vd_j.ShapeStyleRef.FontFileVDS);vd_L.vd_bE();}}if(dash>0){vdgeo.vd_jZ(vd_cS,p1,vdir,vd_w);vd_qI(vd_ep,vd_cS);vdgeo.vd_ce(vd_ep,vd_cS);}else if(dash==0){vdgeo.vd_jZ(vd_cS,p1,vdir,(vd_w+vd_zW*2.0));vd_qI(vd_ep,vd_cS);}else{vdgeo.vd_jZ(vd_ep,p1,vdir,vd_w);}if(vdgeo.AreEqual(vd_w,length,vdgeo.DefaultLinearEquality)||vd_w>length){vd_w=length;break;}}}return vd_qf;};function vd_DW(points,closed,vd_te){var vd_jP=0.0;if(vd_L.linetype.DrawMethod!=vdConst.LineTypeDrawMethod_Start){var scale=vd_L.vd_iR;if(vd_L.linetype.IsDPIScale===true)scale=vd_L.vd_ad*dpi*vd_tM*vd_L.vd_hK;var vd_cT=vd_py()*scale;var length=points.length;var vd_lx=length/vd_cT;var vd_sY=(Math.abs(vd_L.linetype.Segments.Items[0].DashLen)*scale+Math.abs(vd_lx-Math.floor(vd_lx))*vd_cT)/2.0;var dx=vd_sY-Math.abs(vd_L.linetype.Segments.Items[0].DashLen)*scale;vd_jP= -1.0*dx;}var _sp=new vdgeo.newpoint(0,0,0);var _ep=new vdgeo.newpoint(0,0,0);vdgeo.vd_ce(_sp,points[0]);_sp[Z]+=vd_te;for(var i=1;i<points.length;i++){vdgeo.vd_ce(_ep,points[i]);_ep[Z]+=vd_te;vd_L.vd_aR=points[i-1][INDEX];if(vd_L.vd_aR===undefined)vd_L.vd_aR=i-1;vd_jP=vd_pC(_sp,_ep,vd_jP,(i===points.length-1));vdgeo.vd_ce(_sp,_ep);}if(closed){vdgeo.vd_ce(_ep,points[0]);_ep[Z]+=vd_te;vd_L.vd_aR=points[points.length-1][INDEX];if(vd_L.vd_aR===undefined)vd_L.vd_aR=points.length-1;vd_jP=vd_pC(_sp,_ep,vd_jP,(i===points.length-1));vdgeo.vd_ce(_sp,_ep);}vd_L.vd_aR=undefined;};this.GetEntityFromPoint=function(x,y,vd_js,vd_cm){if(!vd_L.vd_bG||vd_L.vd_y.vd_cn.length===0)return null;x=vdgeo.vd_R(x);y=vdgeo.vd_R(y);if(x<0||x>=vd_L.width)return null;if(y<0||y>=vd_L.height)return null;var vd_eQ=Math.max(vdgeo.vd_R(vd_js*0.5),1);var px,py;for(var ix= -vd_eQ;ix<=vd_eQ;ix++){for(var iy= -vd_eQ;iy<=vd_eQ;iy++){px=x+ix;py=y+iy;if(px<0||px>=vd_L.width||py<0||py>=vd_L.height)continue;var ipos=py*vd_L.width+px;var ret=vd_L.vd_y.vd_cn[ipos];if(ret==undefined)continue;for(var j=ret.length-1;j>=0;j--){var fig=ret[j];if(vd_cm===false&&fig.LayerRef&&fig.LayerRef.Lock)continue;return fig;}}}return null;};this.GetEntitiesFromBox=function(xmin,ymin,xmax,ymax,vd_cm){var ret=[];if(!vd_L.vd_bG||vd_L.vd_y.vd_cn.length===0)return ret;var tmp;if(xmin>xmax){tmp=xmin;xmin=xmax;xmax=tmp;}if(ymin>ymax){tmp=ymin;ymin=ymax;ymax=tmp;}xmin=vdgeo.vd_R(Math.min(Math.max(xmin,0),vd_L.width-1));xmax=vdgeo.vd_R(Math.min(Math.max(xmax,0),vd_L.width-1));ymin=vdgeo.vd_R(Math.min(Math.max(ymin,0),vd_L.height-1));ymax=vdgeo.vd_R(Math.min(Math.max(ymax,0),vd_L.height-1));for(var ix=xmin;ix<=xmax;ix++){for(var iy=ymin;iy<=ymax;iy++){var ipos=iy*vd_L.width+ix;var ret1=vd_L.vd_y.vd_cn[ipos];if(ret1==undefined)continue;for(var j=ret1.length-1;j>=0;j--){var fig=ret1[j];if(vd_cm===false&&fig.LayerRef&&fig.LayerRef.Lock)continue;ret.push(fig);}}}if(ret.length===0)return ret;ret.sort(function(a,b){return a.HandleId-b.HandleId});var vd_oK=[ret[0]];for(var k=0;k<ret.length;k++){if(vd_oK[vd_oK.length-1]===ret[k])continue;vd_oK.push(ret[k]);}return vd_oK;};this.GetEntitiesInWindowBox=function(xmin,ymin,xmax,ymax,vd_cm){var tmp;if(xmin>xmax){tmp=xmin;xmin=xmax;xmax=tmp;}if(ymin>ymax){tmp=ymin;ymin=ymax;ymax=tmp;}xmin=vdgeo.vd_R(Math.min(Math.max(xmin,0),vd_L.width-1));xmax=vdgeo.vd_R(Math.min(Math.max(xmax,0),vd_L.width-1));ymin=vdgeo.vd_R(Math.min(Math.max(ymin,0),vd_L.height-1));ymax=vdgeo.vd_R(Math.min(Math.max(ymax,0),vd_L.height-1));var vd_it=vd_L.GetEntitiesFromBox(xmin,ymin,xmax,ymax,vd_cm);if(vd_it.length===0)return vd_it;for(var iy=0;iy<vd_L.height;iy++){for(var ix=0;ix<vd_L.width;ix++){if(vdgeo.vd_jW(ix,iy,xmin,ymin,xmax,ymax))continue;var ipos=iy*vd_L.width+ix;var ret1=vd_L.vd_y.vd_cn[ipos];if(ret1==undefined)continue;for(var j=0;j<ret1.length;j++){for(var k=0;k<vd_it.length;k++){if(vd_it[k]==ret1[j]){vd_it.splice(k,1);k--;}}}}}return vd_it;};return this;};function vd_Eu(){var vd_L=this;var document=null;this.SelectDocument=function(vd_a){document=vd_a;if(!document.Groups)document.Groups={IgnoreGroups:false,Items:[]};var groups=document.Groups;if(groups.IgnoreGroups===undefined)groups.IgnoreGroups=false;if(groups.Items.length==0)return;for(var i=0;i<groups.Items.length;i++){var group=groups.Items[i];var h='h_'+group.HandleId.toString();for(var i2=0;i2<group.Items.length;i2++){var vd_Gn=group.Items[i2];var vd_oq=document[vd_Gn];if(!vd_oq)continue;if(!vd_oq._groups)vd_oq._groups={};vd_oq._groups[h]=1;}}};this.vd_wE=function(fig,vd_ah,vd_sx){if(!fig)return;if(fig.selected==true)return;if(fig.vd_tw)return;fig.vd_tw=true;vd_ah.push(fig);if(!vd_L.IgnoreGroups&&fig._groups){for(var vd_sD in fig._groups){var group=document.Groups.Items[document.Groups[vd_sD]];if(!group||group==vd_sx)continue;if(group.Selectable===false)continue;for(var i2=0;i2<group.Items.length;i2++){var fig2=document[group.Items[i2]];vd_L.vd_wE(fig2,vd_ah,group);}}}};this.vd_ph=function(vd_oe,vd_ah,vd_vt,vd_sx){if(!vd_oe)return;var index=vd_ah.indexOf(vd_oe);if(vd_vt){if(index<0)return;vd_ah.splice(index,1);}else{if(index>=0)return;vd_ah.push(vd_oe);}var fig=document[vd_oe];if(!fig||vd_L.IgnoreGroups|| !fig._groups)return;for(var vd_sD in fig._groups){var group=document.Groups.Items[document.Groups[vd_sD]];if(!group||group==vd_sx)continue;if(group.Selectable===false)continue;for(var i2=0;i2<group.Items.length;i2++){vd_L.vd_ph(group.Items[i2],vd_ah,vd_vt,group);}}};Object.defineProperty(vd_L,'IgnoreGroups',{get:function(){return document.Groups.IgnoreGroups;},set:function(newValue){document.Groups.IgnoreGroups=newValue;}});function Find(name){name=name.toLowerCase();for(var i=0;i<document.Groups.Items.length;i++){var group=document.Groups.Items[i];var vd_er=group.Name.toLowerCase();if(vd_er==name)return group;}return null;};function vd_BG(group,item){var h='h_'+item.HandleId.toString();return group.Items.indexOf(h);};this.ClearGroup=function(vd_fU){var group=Find(vd_fU);if(!group)return;var g_h='h_'+group.HandleId.toString();for(var i=0;i<group.Items.length;i++){var fig=document[group.Items[i]];if(!fig)continue;if(!fig._groups[g_h])continue;delete fig._groups[g_h];}group.Items=[];};this.AddItem=function(vd_fU,item){if(!item|| !item.HandleId)return false;var group=Find(vd_fU);var g_h;if(!group){group={_t:vdConst.vdGroup_code,HandleId:vdConst.vd_wq(document),Name:vd_fU,Items:[]};document.Groups.Items.push(group);g_h='h_'+group.HandleId.toString();document.Groups[g_h]=document.Groups.Items.length-1;}else{g_h='h_'+group.HandleId.toString();}if(item._groups&&item._groups[g_h])return true;if(!item._groups)item._groups={};item._groups[g_h]=1;group.Items.push('h_'+item.HandleId.toString());return true;};this.RemoveItem=function(vd_fU,item){if(!item|| !item.HandleId)return false;var group=Find(vd_fU);if(!group)return false;var g_h='h_'+group.HandleId.toString();if(!item._groups|| !item._groups[g_h])return false;delete item._groups[g_h];var index=vd_BG(group,item);if(index<0)return false;group.Items.splice(index,1);return true;};this.EnableGroup=function(vd_fU,enable){var group=Find(vd_fU);if(!group)return;group.Selectable=enable;};return this;};vdConst.vd_qd=1;vdConst.vd_hZ=2;vdConst.vd_nh=3;vdConst.vd_pR=4;vdConst.vd_oC=5;vdConst.vd_Dp=6;vdConst.vd_HF=0;vdConst.vd_oS=1;vdConst.vd_pM=2;vdConst.vd_kd=4;vdConst.vd_kc=8;vdConst.vd_Dy=12;vdConst.vd_qB=0;vdConst.vd_vl=1;vdConst.vd_wB=2;vdConst.vd_wz=3;vdConst.vd_wM=4;vdConst.vd_zJ=0;vdConst.vd_si=1;vdConst.vd_rT=2;vdConst.vd_Ih=3;vdConst.vd_Aw=1;vdConst.vd_AQ=0;vdConst.vd_oP=String.fromCharCode(176);vdConst.vd_Ip='d';function vd_CU(vd_kw,vd_kf,vd_jR){var vd_L=this;if(vd_kw==undefined)this.type=vdConst.vd_hZ;else this.type=vd_kw;if(vd_kf==undefined)this.precision=4;else this.precision=vd_kf;if(vd_jR==undefined)this.vd_bD=vdConst.vd_oS;else this.vd_bD=vd_jR;this.vd_GD=function(length){var ret="";var vd_oM=1.0/Math.pow(10,vd_L.precision);if(vd_L.type==vdConst.vd_oC||vd_L.type==vdConst.vd_nh)vd_oM=1.0/Math.pow(2,vd_L.precision);if(vdgeo.AreEqual(length,0,vd_oM*0.5))length=0.0;var vd_Fw=(length<0);length=Math.abs(length);switch(vd_L.type){case vdConst.vd_qd:var prec=vd_L.precision;if(vdgeo.AreEqual(length,vdgeo.vd_R(length),vd_oM))prec=0;ret=length.toExponential(prec);if((vd_L.vd_bD&vdConst.vd_kd)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_kc)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;case vdConst.vd_hZ:ret=length.toFixed(vd_L.precision);if((vd_L.vd_bD&vdConst.vd_kd)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_kc)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;case vdConst.vd_nh:{var feet=vdgeo.vd_R((length/12.0)+0.000001);var vd_cU=length-(feet*12.0);if(vdgeo.AreEqual(vd_cU,0,vdgeo.DefaultLinearEquality))vd_cU=0.0;if(vdgeo.AreEqual(vd_cU,0.0,vd_oM)){ret=feet.toString()+"'";}else{var vd_pQ=feet.toString()+"'";if(feet==0)vd_pQ="";ret=vd_cU.toFixed(vd_L.precision);if((vd_L.vd_bD&vdConst.vd_kd)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_kc)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret+="\"";ret=(vd_pQ!=""?(vd_pQ+"-"):"")+ret;}}break;case vdConst.vd_pR:{var vd_cf=vdgeo.vd_R(Math.pow(2,vd_L.precision));var feet=vdgeo.vd_R((length/12.0)+0.000001);var vd_cU=vdgeo.vd_R(length-(feet*12.0));if(vd_cU==12){vd_cU=0;feet++;}var vd_do=vdgeo.vd_R((length-vd_cU-(feet*12.0))*vd_cf+(0.5/vd_cf)+0.4999);if(vd_do==vd_cf){vd_do=0;vd_cU++;if(vd_cU==12){vd_cU=0;feet++;}}while(vd_do>=2&&(vd_do%2.0)==0.0&&vd_cf>=2&&(vd_cf%2.0)==0.0){vd_do/=2;vd_cf/=2;}var vd_ro=feet.toString()+"'";var vd_jN=vd_cU.toString()+" ";var vd_mV=vd_do.toString()+"/"+vd_cf.toString();if(vd_do==0)vd_mV="";if(feet==0)vd_ro="";if((vd_L.vd_bD&vdConst.vd_pM)!=0&&vd_cU==0){vd_jN="";}ret=vd_ro;var vd_uA=vd_jN+vd_mV;if(vd_ro!=""&&vd_uA!="")ret+="-";ret+=vd_uA;if(ret=="")ret="0";if(vd_jN!="")ret+="\"";}break;case vdConst.vd_oC:{var vd_cf=vdgeo.vd_R(Math.pow(2,vd_L.precision));var vd_cU=vdgeo.vd_R(length);var vd_do=vdgeo.vd_R((length-vd_cU)*vd_cf+(0.5/vd_cf)+0.4999);if(vd_do==vd_cf){vd_cU++;vd_do=0;}while(vd_do>=2&&(vd_do%2.0)==0.0&&vd_cf>=2&&(vd_cf%2.0)==0.0){vd_do/=2;vd_cf/=2;}var vd_jN=vd_cU.toString()+" ";var vd_mV=vd_do.toString()+"/"+vd_cf.toString();if(vd_do==0)vd_mV="";if((vd_L.vd_bD&vdConst.vd_pM)!=0&&vd_cU==0){vd_jN="";}ret=vd_jN+vd_mV;if(ret=="")ret="0";ret+="\"";}break;case vdConst.vd_Dp:ret=length.toString();if((vd_L.vd_bD&vdConst.vd_kd)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_kc)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;default:ret=length.toString();if((vd_L.vd_bD&vdConst.vd_kd)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_kc)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}break;}if(ret=="")ret="0";ret=((vd_Fw)?"-":"")+ret;if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);return ret;};return this;};function vd_HZ(vd_kw,vd_kf,vd_jR){var vd_L=this;this.AngleBase=0;this.Direction=vdConst.vd_AQ;if(vd_kw==undefined)this.type=vdConst.vd_qB;else this.type=vd_kw;if(vd_kf==undefined)this.precision=4;else this.precision=vd_kf;if(vd_jR==undefined)this.vd_bD=vdConst.vd_zJ;else this.vd_bD=vd_jR;function vd_EH(angle){var ret=angle-vd_L.AngleBase;if(vd_L.Direction==vdConst.vd_Aw)ret=vdgeo.VD_TWOPI-ret;return vdgeo.FixAngle(ret);};this.vd_IF=function(value){switch(vd_L.type){case vdConst.vd_qB:case vdConst.vd_vl:return vdgeo.DegreesToRadians(value);case vdConst.vd_wz:return value;case vdConst.vd_wB:case vdConst.vd_wM:return value*vdgeo.PI/200.0;default:return value;}};this.vd_Hq=function(vd_Iz){var length=vd_EH(vd_Iz);var ret="";length=vdgeo.RadiansToDegrees(length);length+=vdgeo.DefaultAngularEquality;if(length>360.0)length=length-360.0;if(length<0.0)length+=360.0;switch(vd_L.type){case vdConst.vd_qB:ret=length.toFixed(vd_L.precision);if((vd_L.vd_bD&vdConst.vd_si)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_rT)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret=ret+vdConst.vd_oP;break;case vdConst.vd_vl:{var vd_iD=vdgeo.vd_R(length);var vd_fE=vdgeo.vd_R((length-vd_iD)*60.0);var vd_nf=vdgeo.vd_R(0.5+((length-(vd_iD*1.0+vd_fE/60.0))*3600.0));if(vd_L.precision<2){vd_fE+=vdgeo.vd_R(vd_nf/31);vd_nf=0;}if(precision<1){vd_iD+=vdgeo.vd_R(vd_fE/31);vd_fE=0;}if(vd_nf>=60){vd_fE+=1;vd_nf=0;}if(vd_fE>=60){vd_iD+=1;vd_fE=0;}ret=vd_iD.toString()+vdConst.vd_oP+vd_fE.toString()+"'"+vd_nf.toString()+"\"";if(vd_L.precision<3)ret=vd_iD.toString()+vdConst.vd_oP+vd_fE.toString()+"'";if(vd_L.precision==0)ret=vd_iD.toString()+vdConst.vd_oP;}break;case vdConst.vd_wM:case vdConst.vd_wB:length=length*200.0/180.0;ret=length.toFixed(vd_L.precision);if((vd_L.vd_bD&vdConst.vd_si)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_rT)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret=ret+"g";break;case vd_Ho.vd_wz:length=vdgeo.DegreesToRadians(length);ret=length.toFixed(vd_L.precision);if((vd_L.vd_bD&vdConst.vd_si)!=0){while(ret.charAt(0)=='0')ret=ret.substr(0,1);}if((vd_L.vd_bD&vdConst.vd_rT)!=0){var vd_cg=ret.indexOf(".");if(vd_cg>=0){while(ret.charAt(ret.length-1)=='0')ret=ret.substr(0,ret.length-1);if(ret.charAt(ret.length-1)=='.')ret=ret.substr(0,ret.length-1);}}ret=ret+"r";break;default:break;}return ret;};return this;};vdConst.vd_iF=1;vdConst.vd_jC=2;vdConst.vd_ob=3;vdConst.vd_ra=1;vdConst.vd_IE=0;vdConst.vd_Cc=0;vdConst.vd_CI=1;function vd_En(){var vd_L=this;var vd_ec;var vd_fj;var vd_fB;var vd_pF;var vd_eh=vdConst.vd_iF;var vd_mm='tick';var vd_ip=0.2;var vd_eV=new vd_CU(vdConst.vd_hZ,4,vdConst.vd_oS);var vd_oQ=vdConst.colorFromString('byblock');var vd_on=vdConst.colorFromString('byblock');var vd_oD=vdConst.colorFromString('byblock');Object.defineProperty(vd_L,'TYPE',{get:function(){switch(vd_eh){case vdConst.vd_iF:return 'ALIGN';case vdConst.vd_jC:return 'VER';case vdConst.vd_ob:return 'HOR';default:return 'ALIGN';}},set:function(newValue){newValue=newValue.toUpperCase();if(newValue=='ALIGN')vd_eh=vdConst.vd_iF;else if(newValue=='VER')vd_eh=vdConst.vd_jC;else if(newValue=='HOR')vd_eh=vdConst.vd_ob;else vd_eh=vdConst.vd_iF;}});Object.defineProperty(vd_L,'BLK',{get:function(){return vd_mm;},set:function(newValue){vd_mm=newValue;}});Object.defineProperty(vd_L,'TEXTH',{get:function(){return String(vd_ip);},set:function(newValue){vd_ip=Number(newValue);}});Object.defineProperty(vd_L,'LUNITS',{get:function(){switch(vd_eV.type){case vdConst.vd_qd:return 'SC';case vdConst.vd_hZ:return 'DEC';case vdConst.vd_nh:return 'ENG';case vdConst.vd_pR:return 'ARC';case vdConst.vd_oC:return 'FRAC';default:return 'DEC';}},set:function(newValue){newValue=newValue.toUpperCase();if(newValue=='SC')vd_eV.type=vdConst.vd_qd;else if(newValue=='DEC')vd_eV.type=vdConst.vd_hZ;else if(newValue=='ENG')vd_eV.type=vdConst.vd_nh;else if(newValue=='ARC')vd_eV.type=vdConst.vd_pR;else if(newValue=='FRAC')vd_eV.type=vdConst.vd_oC;else vd_eV.type=vdConst.vd_hZ;}});Object.defineProperty(vd_L,'PREC',{get:function(){return String(vd_eV.precision);},set:function(newValue){vd_eV.precision=Number(newValue);}});Object.defineProperty(vd_L,'SZEROS',{get:function(){return vd_eV.vd_bD==vdConst.vd_oS?'0':'1';},set:function(newValue){vd_eV.vd_bD=Number(newValue)!=0?(vdConst.vd_Dy|vdConst.vd_pM):vdConst.vd_oS;}});Object.defineProperty(vd_L,'LINECOLOR',{get:function(){return vdConst.colorToString(vd_oQ);},set:function(newValue){vd_oQ=vdConst.colorFromString(newValue);}});Object.defineProperty(vd_L,'EXTCOLOR',{get:function(){return vdConst.colorToString(vd_on);},set:function(newValue){vd_on=vdConst.colorFromString(newValue);}});Object.defineProperty(vd_L,'TEXTCOLOR',{get:function(){return vdConst.colorToString(vd_oD);},set:function(newValue){vd_oD=vdConst.colorFromString(newValue);}});var vd_AC=vdConst.vd_Cc;var vd_tS=vdConst.vd_ra;var vd_fP=1.0;function vd_DX(){return vd_ip;};function vd_tK(){return vd_ip;};function vd_ty(){return vd_ip*0.0625;};function vd_Cp(){return vd_ip*0.09;};var vd_Gl=1.0;var vd_xy=0.0;function vd_Bw(vdcanvas,vd_a){var entities=[];var blockref=vdcanvas.AddBlockSymbol(vd_mm,[0,0,0],1.0,0.0,false,{});if(blockref){entities.push(blockref);}else if(vd_mm.toLowerCase()=="arrow"){var hp=vd_a.ActiveHatchProperties;vdcanvas.SetActiveHatchProperties(vdcanvas.createNewHatchProperties('solid'));entities.push(vdcanvas.AddPolyline([[0,0],[-2.0,-0.4],[-2.0,0.4],[0,0]],false,{}));vdcanvas.SetActiveHatchProperties(hp);}else if(vd_mm.toLowerCase()=="tick"){entities.push(vdcanvas.AddLine([-1,0,0],[1,0,0],false,{}));entities.push(vdcanvas.AddLine([-1,-1,0],[1,1,0],false,{}));}else{}return entities;};function vd_Cd(){var p1=vdgeo.newpoint(0,0,0);var p2=vdgeo.newpoint(0,0,0);var p3=vdgeo.newpoint(0,0,0);var p4=vdgeo.newpoint(0,0,0);var tmpP=vdgeo.newpoint(0,0,0);var length=0.0;var rotation=0.0;switch(vd_eh){case vdConst.vd_iF:length=vdgeo.Distance3D(vd_ec,vd_fj);break;case vdConst.vd_jC:case vdConst.vd_ob:if(vd_eh==vdConst.vd_jC)rotation=vdgeo.HALF_PI;p4=vdgeo.pointPolar(vd_ec,rotation+vdgeo.HALF_PI,1.0);p3=vdgeo.pointPolar(vd_fB,rotation,1.0);if(vdgeo.vd_lU(vd_ec,p4,vd_fB,p3,vdgeo.DefaultVectorEquality,p3)!=1)break;tmpP=vdgeo.pointPolar(vd_fj,rotation+vdgeo.HALF_PI,1.0);p4=vdgeo.pointPolar(vd_fB,rotation,1.0);if(vdgeo.vd_lU(vd_fB,p4,vd_fj,tmpP,vdgeo.DefaultVectorEquality,p4)==0){vdgeo.vd_ce(p4,p3);}length=vdgeo.Distance2D(p3,p4);break;default:break;}return length;};function vd_yq(vd_AT){var str=vd_AT;if(str==""||str=="<>"){var length=vd_Cd();length*=vd_Gl;var vd_tx="";var vd_qY="";var post=vd_pF;var pos=post.indexOf("<>");if(pos== -1){vd_qY=post;}else{vd_tx=post.substr(0,pos);vd_qY=post.substr(pos+2);}str=vd_eV.vd_GD(length);str=vd_tx+str+vd_qY;}else{var vd_wO=vd_yq(vd_wO);str=str.Replace("<>",vd_wO);}return str;};function vd_Dn(vdcanvas,vd_a){var p11,p22,lp1,p1,p2,rotation;switch(vd_eh){case vdConst.vd_iF:return vd_tQ(vdcanvas,vd_a,vd_ec,vd_fj,vd_ec,vd_fj,vd_fB);case vdConst.vd_jC:case vdConst.vd_ob:rotation=0.0;if(vd_eh==vdConst.vd_jC)rotation=vdgeo.HALF_PI;p11=vdgeo.newpoint();p22=vdgeo.newpoint();lp1=vdgeo.pointPolar(vd_fB,rotation,1.0);p1=vdgeo.pointPolar(vd_ec,rotation+vdgeo.HALF_PI,1.0);p2=vdgeo.pointPolar(vd_fj,rotation+vdgeo.HALF_PI,1.0);vdgeo.vd_ce(p11,vd_ec);vdgeo.vd_ce(p22,vd_fj);vdgeo.vd_lU(vd_fB,lp1,vd_ec,p1,vdgeo.DefaultVectorEquality,p11);vdgeo.vd_lU(vd_fB,lp1,vd_fj,p2,vdgeo.DefaultVectorEquality,p22);return vd_tQ(vdcanvas,vd_a,p11,p22,vd_ec,vd_fj,vd_fB);default:return null;}return null;};function vd_tQ(vdcanvas,vd_a,vd_iG,vd_oL,vd_zU,vd_zQ,vd_sq){var line=null;var mat=vdgeo.vd_l();var angle=vdgeo.GetAngle(vd_iG,vd_oL);vdgeo.vd_Y(mat,-vd_iG[X],-vd_iG[Y],-vd_iG[Z]);vdgeo.vd_af(mat,-angle);var p1=vdgeo.vd_M(mat,vd_iG);var p2=vdgeo.vd_M(mat,vd_oL);var lpos=vdgeo.vd_M(mat,vd_sq);var vd_lZ=vdgeo.vd_M(mat,vd_zU);var vd_mq=vdgeo.vd_M(mat,vd_zQ);var offset=lpos[Y]-p1[Y];var p11=vdgeo.newpoint(p1[X],p1[Y],p1[Z]);p11[Y]+=offset;var p22=vdgeo.newpoint(p2[X],p2[Y],p2[Z]);p22[Y]+=offset;var vd_pD=1.0;var vd_qh=1.0;if(lpos[Y]-vd_lZ[Y]<0.0)vd_pD= -1.0;if(lpos[Y]-vd_mq[Y]<0.0)vd_qh= -1.0;var vd_qy=vdgeo.newpoint(vd_lZ[X],vd_lZ[Y]+vd_ty()*vd_pD*vd_fP,vd_lZ[Z]);var vd_qt=vdgeo.newpoint(p11[X],p11[Y]+vd_tK()*vd_pD*vd_fP,p11[Z]);var vd_qF=vdgeo.newpoint(vd_mq[X],vd_mq[Y]+vd_ty()*vd_qh*vd_fP,vd_mq[Z]);var vd_pA=vdgeo.newpoint(p22[X],p22[Y]+vd_tK()*vd_qh*vd_fP,p22[Z]);var vd_kK=0.0;var vd_wi=vdgeo.FixAngle(angle-(2*vdgeo.PI-vd_xy));vd_kK=(vd_wi>vdgeo.HALF_PI&&vd_wi<=(3.000001*vdgeo.HALF_PI))?vd_kK=vdgeo.PI:0.0;if(vd_AC==vdConst.vd_CI)vd_kK= -(angle+vd_xy);var tp=vdgeo.MidPoint(p11,p22);if(vd_tS==vdConst.vd_ra)tp=vdgeo.pointPolar(tp,vd_kK+vdgeo.HALF_PI,vd_Cp()*vd_fP);vdgeo.vd_hR(mat);p11=vdgeo.vd_M(mat,p11);p22=vdgeo.vd_M(mat,p22);tp=vdgeo.vd_M(mat,tp);vd_qy=vdgeo.vd_M(mat,vd_qy);vd_qt=vdgeo.vd_M(mat,vd_qt);vd_qF=vdgeo.vd_M(mat,vd_qF);vd_pA=vdgeo.vd_M(mat,vd_pA);var vd_ir=vdConst.VdConstVerJust_VdTextVerCen;if(vd_tS==vdConst.vd_ra)vd_ir=vdConst.VdConstVerJust_VdTextVerBottom;var vd_jz=[];var vd_tt=vdcanvas.GetActivePenColor();if(vd_oQ)vdcanvas.SetActivePenColor(vd_oQ);var vd_Af=vdcanvas.AddLine(p11,p22,false,{});vd_jz.push(vd_Af);var block=vd_Bw(vdcanvas,vd_a);if(block.length>0){var scale=vd_DX()*vd_fP;mat=vdgeo.vd_l();vdgeo.vd_aM(mat,scale,scale,scale);vdgeo.vd_af(mat,vdgeo.GetAngle(p22,p11));vdgeo.vd_Y(mat,p11[X],p11[Y],p11[Z]);for(var i=0;i<block.length;i++){var ent=vdConst.cloneEntity(block[i]);vd_g.vd_gO(mat,ent,vdcanvas);vd_jz.push(ent);}mat=vdgeo.vd_l();vdgeo.vd_aM(mat,scale,scale,scale);vdgeo.vd_af(mat,vdgeo.GetAngle(p11,p22));vdgeo.vd_Y(mat,p22[X],p22[Y],p22[Z]);for(var i=0;i<block.length;i++){var ent=vdConst.cloneEntity(block[i]);vd_g.vd_gO(mat,ent,vdcanvas);vd_jz.push(ent);}}vdcanvas.SetActivePenColor(vd_tt);if(vd_on)vdcanvas.SetActivePenColor(vd_on);var vd_zB=vdcanvas.AddLine(vd_qy,vd_qt,false,{});var vd_BO=vdcanvas.AddLine(vd_qF,vd_pA,false,{});vd_jz.push(vd_zB);vd_jz.push(vd_BO);vdcanvas.SetActivePenColor(vd_tt);if(vd_oD)vdcanvas.SetActivePenColor(vd_oD);var text=vdcanvas.AddText(vd_yq(""),vd_ip*vd_fP,tp,vdConst.VdConstHorJust_VdTextHorCenter,vd_ir,vd_kK+angle,false,{});vd_jz.push(text);vdcanvas.SetActivePenColor(vd_tt);return vd_jz;};this.vd_rG=function(vdcanvas,vd_iG,vd_oL,vd_sq,vd_AN,entities){var vd_a=vdcanvas.GetDocument();vd_ec=vd_iG;vd_fj=vd_oL;vd_fB=vd_sq;if(!vd_fB)vd_fB=vd_ec;vd_pF=vd_AN;if(!vd_pF)vd_pF="";var ents=vd_Dn(vdcanvas,vd_a);if(!ents||ents.length==0)return null;var vd_C={_t:vdConst.vdDimension_code,Explode:{Items:[]}};vdcanvas.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C.Explode.Items=ents;if(entities)vdcanvas.vd_aZ(entities,vd_C);else vdcanvas.vd_aZ(vdcanvas.GetActiveLayout().Entities,vd_C);return vd_C;};return this;};function vd_bS(){var vd_L=this;var vd_mH=1200;var vd_kW=5;var vd_oh=150;var vd_Ac=250;var vd_F=null;var vd_cR=new vd_EE();this.vd_cp=new vd_Dg(vd_L);this.canvas=null;this.PickSize=8;this.IgnoreLockLayers=false;this.scriptCommand=new vd_yW(this);var vd_wH=0;Object.defineProperty(vd_L,'ActionScaleMode',{get:function(){return vd_wH;},set:function(newValue){vd_wH=newValue;}});var vd_vV=1.2;Object.defineProperty(vd_L,'MouseWheelZoomScale',{get:function(){return vd_vV;},set:function(newValue){vd_vV=newValue;}});Object.defineProperty(vd_L,'GroupsManager',{get:function(){if(vd_ai==null)return null;return vd_ai.vd_vU;}});this.SetImageInterpolationMode=function(mode){vd_F.vd_y.vd_iC=mode;};this.GetImageInterpolationMode=function(){return vd_F.vd_y.vd_iC;};this.SetEnableSelection=function(bval){vd_F.vd_bG=bval;};this.GetEnableSelection=function(){return vd_F.vd_bG;};this.SetGrayScale=function(vd_BW){vd_F.vd_jU=vd_BW;};this.GetGrayScale=function(){return vd_F.vd_jU;};this.GetDefaultTimeOutMilliseconds=function(){return vd_mH;};this.SetDefaultTimeOutMilliseconds=function(timeout){vd_mH=timeout;};this.Fig_codeToString=function(code){switch(code){case vdConst.vdLine_code:return "vdLine";case vdConst.vdPolyline_code:return "vdPolyline";case vdConst.vdText_code:return "vdText";case vdConst.vdRect_code:return "vdRect";case vdConst.vdCircle_code:return "vdCircle";case vdConst.vdEllipse_code:return "vdEllipse";case vdConst.vdArc_code:return "vdArc";case vdConst.vdImage_code:return "vdImage";case vdConst.vdInsert_code:return "vdInsert";case vdConst.vd3DFace_code:return "vd3DFace";case vdConst.vdPolyface_code:return "vdPolyface";case vdConst.vdAttrib_code:return "vdAttrib";case vdConst.vdAttribDef_code:return "vdAttribDef";case vdConst.vdInfinityLine_code:return "vdInfinityLine";case vdConst.vdPoint_code:return "vdPoint";case vdConst.vdViewport_code:return "vdViewport";case vdConst.vdPolyhatch_code:return "vdPolyhatch";case vdConst.vdDimension_code:return "vdDimension";case vdConst.vdMText_code:return "vdMText";case vdConst.vdMultiline_code:return "vdMultiline";case vdConst.vdGroundSurface_code:return "vdGroundSurface";case vdConst.vdLeader_code:return "vdLeader";case vdConst.vd_Ia:return "vd_zA";default:{return "vdUnknown";}}};function vd_Cy(fig,vd_m){if(!fig.ps||fig.ps.vd_yz)return undefined;if(!fig.ps.vd_kR){var v=vdgeo.newpoint(0,0,0);vdgeo.vd_iW(vd_m.vd_bt(),0,fig.ps.pw,0,v,false);var len=vdgeo.vd_hC(v);return vd_m.vd_aK(len/(vd_m.GetPixelSize()*vd_m.vd_hK));}else return vd_m.vd_aK((fig.ps.pw/100.0)*96/vdgeo.INCH_MM);};function vd_BH(fig,vd_m){if(!fig.ps||fig.ps.vd_dV===1)return undefined;else if(fig.ps.vd_dV===2)return vd_m.vd_aC(vd_m.vd_iz());else return vd_m.vd_aC(fig.ps.color);};function vd_Ew(fig,vd_m){if(!fig.ps||fig.ps.vd_dV===1)return 0;else return vd_m.vd_gq(fig.ps.MaterialMatrix);};function vd_EJ(fig,vd_m){if(!fig.ps||fig.ps.vd_dV===1)return 0;else return vd_m.vd_eu(fig.ps.MaterialImage);};function vd_EF(fig,vd_m){if(!fig.ps||fig.ps.vd_pJ)return undefined;return vd_m.vd_re(fig.ps.lt);};function vd_BJ(fig,vd_m){if(fig.ps)return vd_m.vd_px(fig.ps.ltscale);return 1.0;};this.UpdateLayout=function(layout,vd_xZ){if(!layout)layout=vd_L.GetActiveLayout();if(!layout)return;layout.BoundingBox=undefined;if(!layout.Entities|| !vd_xZ)return;for(var k=0;k<layout.Entities.Items.length;k++){vd_L.UpdateFig(vd_L.GetEntityItem(layout.Entities.Items[k]));}};this.UpdateFig=function(vd_B){var k=0;if(vd_B.LayerRef===undefined)return;vd_B.selected=undefined;vd_B.ps=undefined;vd_B.LayerRef=undefined;vd_B.LineTypeRef=undefined;vd_B.EcsMatrix=undefined;if(vd_B._t!==vdConst.vdViewport_code)vd_B.BoundingBox=undefined;if(vd_B.SamplePoints!=undefined)vd_B.SamplePoints=undefined;if(vd_B.vd_es!=undefined)vd_B.vd_es=undefined;if(vd_B.StyleRef!=undefined)vd_B.StyleRef=undefined;if(vd_B.tb!=undefined){vd_B.tb=undefined;vd_B.DiplayString=undefined;vd_B.testlines=undefined;vd_B.uwidths=undefined;vd_B.owidths=undefined;}if(vd_B.pointSegments!=undefined)vd_B.pointSegments=undefined;if(vd_B.BlockRef!=undefined)vd_B.BlockRef=undefined;vd_B.Normals=undefined;vd_B.UVS=undefined;if(vd_B.ImageClipPts)vd_B.ImageClipPts=undefined;if(vd_B.ImageClipUVS)vd_B.ImageClipUVS=undefined;if(vd_B._t==vdConst.vdPolyhatch_code){if(vd_B.Curves){for(k=0;k<vd_B.Curves.Items.length;k++){vd_B.Curves.Items[k].UVS=undefined;}}}if(vd_B.Attributes&&vd_B.Attributes.Items){for(k=0;k<vd_B.Attributes.Items.length;k++)vd_L.UpdateFig(vd_B.Attributes.Items[k]);}if(vd_B.Explode&&vd_B.Explode.Items){for(k=0;k<vd_B.Explode.Items.length;k++)vd_L.UpdateFig(vd_B.Explode.Items[k]);}};this.GetEntityItem=function(item){if(vd_ai==null)return null;return vd_ai.vd_AI(item);};this.GetEntityLength=function(vd_G){var vd_bm;if(vd_G._t==vdConst.vdPolyline_code){var closed=vd_G.Flag===1;if(!vd_G.SPlineFlag||vd_G.SPlineFlag==vdConst.SplineFlagSTANDARD)vd_bm=vd_G.VertexList.Items;else if(vd_G.SamplePoints)vd_bm=vd_G.SamplePoints;else{if(vd_G.SPlineFlag==vdConst.SplineFlagFITTING)vd_bm=vdgeo.vd_oF(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Flag===1,vd_G.StartTangent,vd_G.EndTangent);else if(vd_G.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS)vd_bm=vdgeo.vdgeo.vd_mh(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Weights,vd_G.Knots,vd_G.Flag===1);else if(vd_G.SPlineFlag==vdConst.SplineFlagQUADRATIC)vd_bm=vdgeo.vd_uo(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Flag===1);}return vdgeo.vd_wJ(vd_bm,closed);}else if(vd_G._t==vdConst.vdLine_code){return vdgeo.Distance3D(vd_G.StartPoint,vd_G.EndPoint);}else if(vd_G._t==vdConst.vdRect_code){return Math.abs(2.0*vd_G.Width)+Math.abs(2.0*vd_G.Height);}else if(vd_G._t==vdConst.vdCircle_code){return Math.abs(vdgeo.PI*2.0*vd_G.Radius);}else if(vd_G._t==vdConst.vdArc_code){return Math.abs(vdgeo.FixAngle(vd_G.EndAngle-vd_G.StartAngle)*vd_G.Radius);}else if(vd_G._t==vdConst.vdEllipse_code){var da=vdgeo.FixAngle(vd_G.EndAngle-vd_G.StartAngle);if(vdgeo.AreEqual(da,0,vdgeo.DefaultAngularEquality)||vdgeo.AreEqual(da,vdgeo.VD_TWOPI,vdgeo.DefaultAngularEquality)){var k=Math.Sqrt(1-Math.pow((vd_G.MinorLength/vd_G.MajorLength),2));k=Math.pow(k,2);var sum=0;var term=0;var above=0;var below=0;sum=1;term=1;above=1;below=2;for(var i=1;i<=100;i++){term*=above/below;sum-=Math.pow(k,i)*Math.pow(term,2)/above;above+=2;below+=2;}sum*=0.5*vdgeo.PI;return a*sum;}else{vd_bm=vd_G.SamplePoints;if(!vd_bm){if(vd_G.StartAngle==undefined)vd_G.StartAngle=0.0;if(vd_G.EndAngle==undefined)vd_G.EndAngle=0.0;var da=vdgeo.FixAngle(vd_G.EndAngle)-vdgeo.FixAngle(vd_G.StartAngle);var vd_cr=vdgeo.vd_nQ(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.MajorLength,da);vd_bm=vdgeo.vd_pf(vd_cr,vd_G.MajorLength,vd_G.MinorLength,vd_G.StartAngle,vd_G.EndAngle);}return vdgeo.vd_wJ(vd_bm,false);}}else return 0.0;};this.MeasureCurve=function(vd_G,length){var vd_bm;if(vd_G._t==vdConst.vdPolyline_code){var closed=vd_G.Flag===1;if(!vd_G.SPlineFlag||vd_G.SPlineFlag==vdConst.SplineFlagSTANDARD)vd_bm=vd_G.VertexList.Items;else if(vd_G.SamplePoints)vd_bm=vd_G.SamplePoints;else{if(vd_G.SPlineFlag==vdConst.SplineFlagFITTING)vd_bm=vdgeo.vd_oF(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Flag===1,vd_G.StartTangent,vd_G.EndTangent);else if(vd_G.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS)vd_bm=vdgeo.vdgeo.vd_mh(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Weights,vd_G.Knots,vd_G.Flag===1);else if(vd_G.SPlineFlag==vdConst.SplineFlagQUADRATIC)vd_bm=vdgeo.vd_uo(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Flag===1);}return vdgeo.vd_jX(vd_bm,length,closed);}else if(vd_G._t==vdConst.vdLine_code){return vdgeo.vd_jX([vd_G.StartPoint,vd_G.EndPoint],length,false);}else if(vd_G._t==vdConst.vdRect_code){var vd_vk=vdgeo.pointPolar(vd_G.InsertionPoint,vd_G.Rotation,vd_G.Width);return vdgeo.vd_jX([vd_G.InsertionPoint,vd_vk,vdgeo.pointPolar(vd_vk,vd_G.Rotation+vdgeo.HALF_PI,vd_G.Height),vdgeo.pointPolar(vd_G.InsertionPoint,vd_G.Rotation+vdgeo.HALF_PI,vd_G.Height)],length,true);}else if(vd_G._t==vdConst.vdCircle_code){var vd_ft=vdgeo.Arc2Bulge(vd_G.Radius,vdgeo.PI);return vdgeo.vd_jX([vdgeo.pointPolar(vd_G.Center,0.0,vd_G.Radius).concat(vd_ft),vdgeo.pointPolar(vd_G.Center,vdgeo.PI,vd_G.Radius).concat(vd_ft)],length,true);}else if(vd_G._t==vdConst.vdArc_code){var vd_ft=vdgeo.Arc2Bulge(vd_G.Radius,vdgeo.FixAngle(vd_G.EndAngle-vd_G.StartAngle));return vdgeo.vd_jX([vdgeo.pointPolar(vd_G.Center,vd_G.StartAngle,vd_G.Radius).concat(vd_ft),vdgeo.pointPolar(vd_G.Center,vd_G.EndAngle,vd_G.Radius).concat(vd_ft)],length,false);}else if(vd_G._t==vdConst.vdEllipse_code){var da=vdgeo.FixAngle(vd_G.EndAngle-vd_G.StartAngle);vd_bm=vd_G.SamplePoints;if(!vd_bm){if(vd_G.StartAngle==undefined)vd_G.StartAngle=0.0;if(vd_G.EndAngle==undefined)vd_G.EndAngle=0.0;var da=vdgeo.FixAngle(vd_G.EndAngle)-vdgeo.FixAngle(vd_G.StartAngle);var vd_cr=vdgeo.vd_nQ(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.MajorLength,da);vd_bm=vdgeo.vd_pf(vd_cr,vd_G.MajorLength,vd_G.MinorLength,vd_G.StartAngle,vd_G.EndAngle);}if(!vd_G.EcsMatrix){var vd_bB=vdgeo.newpoint(0,0,1);var vd_bq=vdgeo.newpoint(0,0,0);if(vd_G.ExtrusionVector!=undefined)vd_bB=vdgeo.newpoint(vd_G.ExtrusionVector[X],vd_G.ExtrusionVector[Y],vd_G.ExtrusionVector[Z]);if(vd_G.Center!=undefined)vd_bq=vdgeo.newpoint(vd_G.Center[X],vd_G.Center[Y],vd_G.Center[Z]);vd_G.EcsMatrix=new vdgeo.vd_l();if(vd_G.MajorAngle!=undefined)vdgeo.vd_af(vd_G.EcsMatrix,vd_G.MajorAngle);vdgeo.vd_aG(vd_G.EcsMatrix,vd_bB);vdgeo.vd_Y(vd_G.EcsMatrix,vd_bq[X],vd_bq[Y],vd_bq[Z]);}var ret=vdgeo.vd_jX(vd_bm,length,false);return vdgeo.vd_ff(vd_G.EcsMatrix,ret);}else return[];};this.GetEntityArea=function(vd_G){var vd_m=vd_F;var vd_bm;if(vd_G._t==vdConst.vdPolyline_code){if(!vd_G.SPlineFlag||vd_G.SPlineFlag==vdConst.SplineFlagSTANDARD)return Math.abs(vdgeo.vd_FR(vd_G.VertexList.Items));if(vd_G.SamplePoints)vd_bm=vd_G.SamplePoints;else{if(vd_G.SPlineFlag==vdConst.SplineFlagFITTING)vd_bm=vdgeo.vd_oF(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Flag===1,vd_G.StartTangent,vd_G.EndTangent);else if(vd_G.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS)vd_bm=vdgeo.vdgeo.vd_mh(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Weights,vd_G.Knots,vd_G.Flag===1);else if(vd_G.SPlineFlag==vdConst.SplineFlagQUADRATIC)vd_bm=vdgeo.vd_uo(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.VertexList.Items,vd_G.Flag===1);}}else if(vd_G._t==vdConst.vdRect_code){return Math.abs(vd_G.Width*vd_G.Height);}else if(vd_G._t==vdConst.vdCircle_code){return Math.abs(vdgeo.PI*vd_G.Radius*vd_G.Radius);}else if(vd_G._t==vdConst.vdEllipse_code){if(vd_G.StartAngle==undefined)vd_G.StartAngle=0.0;if(vd_G.EndAngle==undefined)vd_G.EndAngle=0.0;var da=vdgeo.FixAngle(vd_G.EndAngle-vd_G.StartAngle);if(vdgeo.AreEqual(da,0,vdgeo.DefaultAngularEquality)||vdgeo.AreEqual(da,vdgeo.VD_TWOPI,vdgeo.DefaultAngularEquality)){return vd_G.MajorLength*vd_G.MinorLength*vdgeo.PI;}else{vd_bm=vd_G.SamplePoints;if(!vd_bm){var vd_cr=vdgeo.vd_nQ(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_G.MajorLength,da);vd_bm=vdgeo.vd_pf(vd_cr,vd_G.MajorLength,vd_G.MinorLength,vd_G.StartAngle,vd_G.EndAngle);}}}else if(vd_G._t==vdConst.vdArc_code){return Math.abs((vdgeo.FixAngle(vd_G.EndAngle-vd_G.StartAngle)/2.0)*vd_G.Radius*vd_G.Radius);}else return-1;return Math.abs(vdgeo.GetPointsArea(vd_bm));};this.GetDictItem=function(vd_ah,vd_fs){if(vd_ai==null)return null;return vd_ai.vd_eO(vd_ah,vd_fs);};this.ChangeOrder=function(vd_G,vd_AJ,vd_ah){if(!vd_G|| !vd_G.HandleId)return false;if(!vd_ah)vd_ah=vd_L.GetActiveLayout().Entities;if(!vd_ah|| !vd_ah.Items||vd_ah.Items.length==0)return false;var vd_fs='h_'+vd_G.HandleId.toString();var pos=vd_ah.Items.indexOf(vd_fs);if(pos<0)return false;vd_ah.Items.splice(pos,1);if(vd_AJ)vd_ah.Items.splice(0,0,vd_fs);else vd_ah.Items.push(vd_fs);return true;};function vd_Bp(fig,vd_a,vd_m){if(fig.ps!==undefined)return fig.ps;if(!fig.PenColor)fig.PenColor={ColorFlag:192};if(fig.LayerRef==undefined){fig.LayerRef=vd_L.GetDictItem(vd_a.Layers,fig.Layer);if(!fig.LayerRef)fig.LayerRef=vd_L.FindLayer("0");}if(fig.LineTypeRef==undefined){fig.LineTypeRef=vd_L.GetDictItem(vd_a.LineTypes,fig.LineType);if(!fig.LineTypeRef)fig.LineTypeRef=vd_L.FindLineType("BYLAYER");}if(vd_m.vd_bR()!=vdConst.vd_le)return null;fig.ps={};fig.ps.vd_kR=false;fig.ps.pw=0;fig.ps.vd_yz=false;fig.ps.lt=null;fig.ps.vd_pJ=false;fig.ps.ltscale=1;fig.ps.color=[255,255,255,255];fig.ps.MaterialImage=null;fig.ps.MaterialMatrix=null;fig.ps.vd_dV=0;fig.ps.vd_ID=undefined;var afig=vd_m.vd_kC();var lay=fig.LayerRef;var lt=fig.LineTypeRef;var alay=null;if(afig!=null){alay=vd_L.GetDictItem(vd_a.Layers,afig.Layer);if(!alay)alay=vd_L.FindLayer("0");}if(fig.LineTypeScale==undefined)fig.LineTypeScale=1.0;if(fig.PenWidth>0.0){fig.ps.vd_kR=false;fig.ps.pw=fig.PenWidth;}else{var lw=fig.LineWeight;if(lw==undefined)lw=vdConst.LW_BYLAYER;if(vd_a.LineWeightDisplay==false||lw===0){fig.ps.vd_kR=false;fig.ps.pw=0.0;}else{if(lw===vdConst.LW_BYLAYER&&lay!=null){if(lay.Name==='0'&&afig!=null&&alay!=null){if(!vd_a.BlockStdLayerOper|| !(vd_a.BlockStdLayerOper&vdConst.vd_Ae))lw=alay.LineWeight;else lw=vdConst.LW_BYBLOCK;}else{lw=lay.LineWeight;}}if(lw==undefined)lw=vdConst.LW_BYLAYER;if(lw==vdConst.LW_DOCUMENTDEFAULT)lw=vd_a.LineWeight;if(lw!=vdConst.LW_BYBLOCK){if(lw<=0){fig.ps.vd_kR=false;fig.ps.pw=0.0;}else{fig.ps.vd_kR=true;fig.ps.pw=lw;}}else{fig.ps.vd_yz=true;}}}if(lt){if(lay&&lt.Name=='BYLAYER'){var vd_fX=null;if(afig!=null&&afig._t===vdConst.vdInsert_code&&lay.Name==='0'){if((!vd_a.BlockStdLayerOper|| !(vd_a.BlockStdLayerOper&vdConst.vd_Aq))&&alay)vd_fX=vd_L.GetDictItem(vd_a.LineTypes,alay.LineType);}else{vd_fX=vd_L.GetDictItem(vd_a.LineTypes,lay.LineType);}if(vd_fX)fig.ps.lt=vd_fX;if(!vd_fX||vd_fX.Name=='BYLAYER'||vd_fX.Name=='BYBLOCK')fig.ps.vd_pJ=true;fig.ps.ltscale=fig.LineTypeScale*vd_a.LineTypeScale;}else if(lt.Name!='BYBLOCK'){fig.ps.lt=lt;fig.ps.ltscale=fig.LineTypeScale*vd_a.LineTypeScale;}else{fig.ps.vd_pJ=true;}}if(fig.PenColor.SystemColor!=undefined){fig.ps.color=fig.PenColor.SystemColor;fig.ps.MaterialImage=vd_L.GetDictItem(vd_a.Images,fig.PenColor.MaterialImage);if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=fig.PenColor.MaterialMatrix;}else if(fig.PenColor.ColorFlag===vdConst.COLOR_BYLAYER){if(afig!=null&&afig._t===vdConst.vdInsert_code&&lay!=null&&lay.Name==='0'){if(!vd_a.BlockStdLayerOper|| !(vd_a.BlockStdLayerOper&vdConst.vd_zm))lay=alay;else{fig.ps.vd_dV=1;}}if(fig.ps.vd_dV!=1){if(lay&&lay.PenColor.ColorIndex!=undefined){if(lay.PenColor.ColorIndex==6)fig.ps.vd_dV=2;else fig.ps.color=vd_m.vd_ed(lay.PenColor.ColorIndex);fig.ps.MaterialImage=vd_m.palette.Items[lay.PenColor.ColorIndex].MaterialImageRef;if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=vd_m.palette.Items[lay.PenColor.ColorIndex].MaterialMatrix;}else if(lay&&lay.PenColor.SystemColor!=undefined){fig.ps.color=lay.PenColor.SystemColor;fig.ps.MaterialImage=vd_L.GetDictItem(vd_a.Images,lay.PenColor.MaterialImage);if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=lay.PenColor.MaterialMatrix;}}}else if(fig.PenColor.ColorIndex!=undefined){if(fig.PenColor.ColorIndex==6)fig.ps.vd_dV=2;else fig.ps.color=vd_m.vd_ed(fig.PenColor.ColorIndex);fig.ps.MaterialImage=vd_m.palette.Items[fig.PenColor.ColorIndex].MaterialImageRef;if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=vd_m.palette.Items[fig.PenColor.ColorIndex].MaterialMatrix;}else{fig.ps.vd_dV=1;}if(fig.TransparencyMethod===vdConst.TransparencyMethod_ByLayer&&lay!=null){var vd_oH=undefined;if(lay.PenColor.ColorIndex!=undefined){vd_oH=vd_m.vd_ed(lay.PenColor.ColorIndex);}else if(lay.PenColor.SystemColor!=undefined){vd_oH=lay.PenColor.SystemColor;}if(vd_oH!=undefined)fig.ps.color[3]=vd_oH[3];}else if(fig.TransparencyMethod===vdConst.TransparencyMethod_ByBlock)fig.ps.color[3]=undefined;if(fig.HatchProperties!=undefined){fig.ps.vd_J={vd_o:undefined,color:undefined,vd_rJ:false,vd_rF:false,vd_dm:255,angle:0,scale:1,pattern:null,origin:vdgeo.newpoint(0,0,0),IsDpi:false,vd_mM:false,vd_cY:0,vd_jk:undefined,gradientAngle:0};if(fig.HatchProperties.HatchPatternRef!=undefined)fig.ps.vd_J.pattern=fig.HatchProperties.HatchPatternRef;else if(fig.HatchProperties.HatchPattern!=undefined)fig.ps.vd_J.pattern=vd_L.GetDictItem(vd_a.HatchPatterns,fig.HatchProperties.HatchPattern);if(fig.ps.vd_J.pattern!=null){if(fig.ps.vd_J.pattern==null||fig.ps.vd_J.pattern.PatternLines==undefined||fig.ps.vd_J.pattern.PatternLines.Items.length==0||(fig.HatchProperties.IsDpi!=undefined&&fig.HatchProperties.IsDpi!=true&&fig.ps.vd_J.pattern.PatternLines.Items.length==1&&fig.ps.vd_J.pattern.PatternLines.Items[0].Dashes!=undefined&&fig.ps.vd_J.pattern.PatternLines.Items[0].Dashes.Items.length==0))fig.ps.vd_J.pattern=null;if(fig.ps.vd_J.pattern!=null&&fig.HatchProperties.IsDpi!=undefined&&fig.HatchProperties.IsDpi!=true&&fig.ps.vd_J.pattern.PatternLines.Items[0].Dashes!=undefined&&fig.ps.vd_J.pattern.PatternLines.Items[0].Dashes.Items.length==1&&fig.ps.vd_J.pattern.PatternLines.Items[0].Dashes.Items[0]<0.0)fig.ps.vd_J.vd_mM=true;if(fig.HatchProperties.IsDpi!=undefined)fig.ps.vd_J.IsDpi=fig.HatchProperties.IsDpi;if(fig.HatchProperties.HatchAngle!=undefined)fig.ps.vd_J.angle=fig.HatchProperties.HatchAngle;if(fig.HatchProperties.HatchScale!=undefined)fig.ps.vd_J.scale=fig.HatchProperties.HatchScale;if(fig.HatchProperties.HatchOrigin!=undefined)fig.ps.vd_J.origin=fig.HatchProperties.HatchOrigin;fig.ps.vd_J.vd_o=undefined;if(fig.HatchProperties.FillBkColor!=undefined){if(fig.HatchProperties.FillBkColor.SystemColor!=undefined)fig.ps.vd_J.vd_o=fig.HatchProperties.FillBkColor.SystemColor;else if(fig.HatchProperties.FillBkColor.ColorIndex!=undefined){fig.ps.vd_J.vd_o=vd_m.vd_ed(fig.HatchProperties.FillBkColor.ColorIndex);if(fig.HatchProperties.FillBkColor.ColorIndex==6)fig.ps.vd_J.vd_rJ=true;}}}if(fig.HatchProperties.FillColor!=undefined){if(fig.HatchProperties.FillColor.ColorIndex!=undefined){fig.ps.vd_J.color=vd_m.vd_ed(fig.HatchProperties.FillColor.ColorIndex);if(fig.HatchProperties.FillColor.ColorIndex==6)fig.ps.vd_J.vd_rF=true;}else if(fig.HatchProperties.FillColor.SystemColor!=undefined){fig.ps.vd_J.color=fig.HatchProperties.FillColor.SystemColor;var vd_xA=vd_L.GetDictItem(vd_a.Images,fig.HatchProperties.FillColor.MaterialImage);if(vd_xA!=null){fig.ps.MaterialImage=vd_xA;if(fig.ps.MaterialImage!=null)fig.ps.MaterialMatrix=fig.HatchProperties.FillColor.MaterialMatrix;}}}if(fig.HatchProperties.Solid2dTransparency!=undefined)fig.ps.vd_J.vd_dm=fig.HatchProperties.Solid2dTransparency;if(fig.HatchProperties.gradientTypeProp!=undefined)fig.ps.vd_J.vd_cY=fig.HatchProperties.gradientTypeProp;if(fig.HatchProperties.gradientColor2!=undefined)fig.ps.vd_J.vd_jk=fig.HatchProperties.gradientColor2;if(fig.HatchProperties.gradientAngle!=undefined)fig.ps.vd_J.gradientAngle=fig.HatchProperties.gradientAngle;if(fig.ps.vd_J.vd_mM)fig.ps.vd_J.vd_dm=0;}};var vd_qJ=vdgeo.vd_l();function vd_el(vd_m,pts,thickness,vd_h,vd_a){if(vd_a&&vd_a.ShowHatches===false)return;if(pts.length>2&& !vd_h.UVS){var vd_fr=vd_m.vd_gq(0);if(vd_fr!=null){vd_h.UVS=[];vd_h.UVS.length=pts.length;for(var i=0;i<pts.length;i++){vd_h.UVS[i]=vdgeo.newpoint(0,0,0);vdgeo.vd_dL(vd_fr,pts[i],vd_h.UVS[i]);}}vd_m.vd_gq(vd_fr);}vd_m.vd_el(pts,null,vd_h.UVS);if(thickness&&thickness!=0.0){vdgeo.vd_fD(vd_qJ);vdgeo.vd_Y(vd_qJ,0,0,thickness);vd_m.vd_aN(vd_qJ);vd_m.vd_el(pts,null,vd_h.UVS);vd_m.vd_bE();}};this.vd_vZ=function(){var vd_a=vd_x();if(vd_a==null)return;return vd_a.Model;};function vd_CC(vd_h,vd_m,vd_a){if(vd_L.GetActiveLayout()===vd_a.Model)return;if(vd_h.VPBOX)vd_h.BoundingBox=vd_h.VPBOX;if(vd_h.BoundingBox==undefined)return;vd_h.VPBOX=vd_h.BoundingBox;if(vd_m.vd_bR()==vdConst.vd_cq){vd_m.vd_gu.vd_sl(vd_h.BoundingBox);return;}var bmin=vdgeo.newpoint(vd_h.BoundingBox[0],vd_h.BoundingBox[1],vd_h.BoundingBox[2]);var bmax=vdgeo.newpoint(vd_h.BoundingBox[3],vd_h.BoundingBox[4],vd_h.BoundingBox[5]);var zdir=vdgeo.vd_mN(vd_m.vd_bt());var xdir=vdgeo.vd_ji(vd_m.vd_bt());if(!vd_m.vd_bA&&vdgeo.AreEqual(zdir[X],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(zdir[Y],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(zdir[Z],1,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(xdir[X],1,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(xdir[Y],0,vdgeo.DefaultVectorEquality)&&vdgeo.AreEqual(xdir[Z],0,vdgeo.DefaultVectorEquality)){bmin=vdgeo.vd_M(vd_m.vd_bt(),bmin);bmax=vdgeo.vd_M(vd_m.vd_bt(),bmax);var vd_rQ=vdgeo.vd_M(vd_m.vd_aH,bmin);var vd_rq=vdgeo.vd_M(vd_m.vd_aH,bmax);var center=vdgeo.MidPoint(bmin,bmax);var bh=bmax[Y]-bmin[Y];if(bmin[X]<vd_m.vd_au.left)bmin[X]=vd_m.vd_au.left;if(bmax[X]>vd_m.vd_au.right)bmax[X]=vd_m.vd_au.right;if(bmin[Y]<vd_m.vd_au.bottom)bmin[Y]=vd_m.vd_au.bottom;if(bmax[Y]>vd_m.vd_au.top)bmax[Y]=vd_m.vd_au.top;var mpt=vdgeo.MidPoint(bmin,bmax);var bh2=bmax[Y]-bmin[Y];var vd_v=(vd_h.ViewSize*bh2)/bh;var scale=vd_v/bh2;var dx=(center[X]-mpt[X]);var dy=(center[Y]-mpt[Y]);var vd_rX=vdgeo.vd_M(vd_m.vd_aH,vdgeo.newpoint(bmin[X],bmax[Y],0));var vd_r=vdgeo.newpoint(vd_h.ViewCenter[X]-dx*scale,vd_h.ViewCenter[Y]-dy*scale);var width=vdgeo.vd_R((bmax[X]-bmin[X])/vd_m.GetPixelSize());var height=vdgeo.vd_R(bh2/vd_m.GetPixelSize());if(vd_h.PerspectiveMod==1){vd_r=vd_h.ViewCenter;vd_rX=vdgeo.newpoint(vd_rQ[X],vd_rq[Y],0);width=vd_rq[X]-vd_rQ[X];height=vd_rQ[Y]-vd_rq[Y];}var vd_tR=vdgeo.vd_R(width);var vd_uE=vdgeo.vd_R(height);if(vd_tR<=1)return;if(vd_uE<=1)return;vd_a.vd_sK=vd_h;var vd_bP=new vd_rz(vd_L,vdgeo.vd_R(vd_rX[X]),vdgeo.vd_R(vd_rX[Y]),vd_tR,vd_uE,null);if(vd_h.PerspectiveMod==1)vd_bP.vd_ur(Math.max(0,vd_bP.vd_cC),Math.max(0,vd_bP.vd_cG),Math.min(vd_m.clip[2],vd_bP.vd_cC+vd_bP.width-1),Math.min(vd_m.clip[3],vd_bP.vd_cG+vd_bP.height-1));if(vd_m.vd_bs())vd_m.vd_ld();vd_bP.vd_y.vd_iY(vd_m.vd_y.vd_uz(),vd_m.vd_y.vd_aY,vd_m.vd_y.vd_bn,true);vd_bP.vd_sG(vd_m);vd_bP.vd_bG=false;vd_bP.update(vd_v,vd_r,vd_h.World2ViewMatrix,vd_nZ(vd_a.Model),vd_h.FocalLength,vd_h.LensAngle,vd_h.PerspectiveMod==1,vd_h.RenderMode,vd_a.Model.Sections,vd_a.Lights);vd_bP.vd_kT(vd_m.palette,vd_m.vd_wo());vd_bP.clear();var vd_jH=vd_bP.vd_gv(vd_h.ShowHidenEdges);vd_nI(vd_a.Model.Entities,true,vd_bP,vd_a);if(vd_bP.vd_bs())vd_bP.vd_ld();vd_bP.vd_gv(vd_jH);vd_bP.vd_y.vd_iY(null);vd_bP=null;vd_L.vd_cp.vd_xO(vd_m);vd_a.vd_sK=null;}var vd_vb=vd_L.GetDictItem(vd_a.Layers,vd_h.Layer);if(vd_vb==null||vd_vb.Frozen==undefined||vd_vb.Frozen==false)vd_m.vd_ak([bmin,vdgeo.newpoint(bmin[X],bmax[Y],0),bmax,vdgeo.newpoint(bmax[X],bmin[Y],0)],true);};function vd_AM(vd_h,vd_m,vd_a){if((vd_h.Thickness!=undefined&&vd_h.Thickness!=0.0)||(vd_h.ps&&vd_h.ps.MaterialMatrix!=null)){if(vd_h.ExtrusionVector!=undefined&&vd_h.EcsMatrix==undefined){var vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);}if(vd_h.ps&&vd_h.ps.MaterialMatrix!=null&&vd_h.EcsMatrix==undefined)vd_h.EcsMatrix=vdgeo.vd_l();if(vd_h.SamplePoints==undefined){if(vd_h.EcsMatrix!=undefined)vd_h.SamplePoints=vdgeo.vd_ff(vdgeo.vd_bc(vd_h.EcsMatrix),[vd_h.StartPoint,vd_h.EndPoint]);else vd_h.SamplePoints=[vd_h.StartPoint,vd_h.EndPoint];}}if(vd_h.SamplePoints!=undefined){if(vd_h.EcsMatrix!=undefined)vd_m.vd_aN(vd_h.EcsMatrix);vd_m.vd_fc(vd_h.SamplePoints,vd_h.Thickness,false);if(vd_h.EcsMatrix!=undefined)vd_m.vd_bE();}else{vd_m.vd_dJ(vd_h.StartPoint,vd_h.EndPoint);}};function vd_Es(vd_h,vd_m,vd_a){if(vd_h.VertexList==undefined)return;if(vd_h.ExtrusionVector!=undefined&&vd_h.EcsMatrix==undefined){var vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);}if(vd_h.ps&&vd_h.ps.MaterialMatrix!=null&&vd_h.EcsMatrix==undefined)vd_h.EcsMatrix=vdgeo.vd_l();if(vd_h.SamplePoints==undefined){var vd_hp=vd_h.VertexList.Items;var vd_dG=vd_h.Weights;var vd_e=vd_h.Knots;if(vd_h.Weights==undefined)vd_dG==null;else vd_dG=vd_h.Weights.Items;if(vd_h.Knots==undefined)vd_e==null;else vd_e=vd_h.Knots.Items;if(vd_h.EcsMatrix!=undefined)vd_hp=vdgeo.vd_nJ(vdgeo.vd_bc(vd_h.EcsMatrix),vd_h.VertexList.Items);else{vd_hp=[];for(var i=0;i<vd_h.VertexList.Items.length;i++)vd_hp.push(vd_h.VertexList.Items[i]);}if(vd_h.SPlineFlag==vdConst.SplineFlagCONTROLPOINTS){vd_h.SamplePoints=vdgeo.vd_mh(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_hp,vd_dG,vd_e,vd_h.Flag===1);}else if(vd_h.SPlineFlag==vdConst.SplineFlagQUADRATIC){vd_h.SamplePoints=vdgeo.vd_Ge(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_hp,vd_dG,vd_e,vd_h.Flag===1);}else if(vd_h.SPlineFlag==vdConst.SplineFlagFITTING){vd_h.SamplePoints=vdgeo.vd_oF(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_hp,vd_h.Flag===1,vd_h.StartTangent,vd_h.EndTangent);}else{vd_h.SamplePoints=vdgeo.vd_Gy(vd_hp,vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_h.Flag===1);var vd_nv=0.0;var vd_wa=false;vd_h.vd_es=undefined;if(vd_h.VertexList.Items.length>1&&vd_h.Widths&&vd_h.Widths.Items.length==vd_h.VertexList.Items.length*2){for(var i=0;i<vd_h.VertexList.Items.length;i++){if(vd_h.VertexList.Items[i][B]!=0.0){vd_wa=true;break;}}if(!vd_wa){vd_nv=vd_h.Widths.Items[0];for(var i=0;i<vd_h.Widths.Items.length;i++){if(vd_h.Widths.Items[i]!==vd_nv){vd_nv=0.0;break;}}}if(vd_nv!=0.0){vd_h.vd_es=vdgeo.vd_GH(vd_h.SamplePoints,vd_h.Flag===1,vd_nv);}}}}if(vd_h.EcsMatrix!=undefined)vd_m.vd_aN(vd_h.EcsMatrix);if(vd_h.ps&&vd_h.ps.vd_J!=undefined){vd_m.vd_dE(vd_h.ps.vd_J);var vd_se=vd_m.vd_aK(vd_h.vd_es?0.0:undefined);vd_el(vd_m,vd_h.SamplePoints,vd_h.Thickness,vd_h,vd_a);vd_m.vd_aK(vd_se);vd_m.vd_dE(null);}if(vd_h.HatchProperties==undefined||vd_h.HatchProperties.DrawBoundary===undefined||vd_h.HatchProperties.DrawBoundary||(vd_h.Thickness&&vd_h.Thickness!=0)||vd_m.vd_bR()==vdConst.vd_cq){if(vd_h.vd_es){var p,v,p1,p2,n1,n2,u_p1,u_p2,u_n1,u_n2,vd_vy,vd_vz,d;var vd_eM=[0,0,0];var vd_mJ=[0,0,1];var vd_kh=0,vd_lw=0,angle,vd_ou,vd_og;var vd_se=vd_m.vd_aK(0.0);for(var i=0;i<vd_h.SamplePoints.length-1;i++){vd_m.vd_aR=i;p=vd_h.SamplePoints[i];v=vd_h.vd_es[i];p1=[p[X]+v[X],p[Y]+v[Y],p[Z]+v[Z]];p2=[p[X]-v[X],p[Y]-v[Y],p[Z]-v[Z]];p=vd_h.SamplePoints[i+1];v=vd_h.vd_es[i+1];n1=[p[X]+v[X],p[Y]+v[Y],p[Z]+v[Z]];n2=[p[X]-v[X],p[Y]-v[Y],p[Z]-v[Z]];vd_m.vd_ex(p1,n1,n2,p2,true,true,true,true,vd_mJ,vd_eM,vd_eM,vd_eM,vd_eM);if(vd_h.Thickness&&vd_h.Thickness!=0){u_p1=[p1[X],p1[Y],p1[Z]+vd_h.Thickness];u_p2=[p2[X],p2[Y],p2[Z]+vd_h.Thickness];u_n1=[n1[X],n1[Y],n1[Z]+vd_h.Thickness];u_n2=[n2[X],n2[Y],n2[Z]+vd_h.Thickness];angle=vdgeo.GetAngle(p1,n1);vd_ou=vdgeo.Distance3D(p1,n1);vd_og=vdgeo.Distance3D(p2,n2);vd_vy=[vd_kh,0,0],vd_xS=[(vd_kh+vd_ou),0,0],vd_yN=[vd_kh,vd_h.Thickness,0],vd_yg=[(vd_kh+vd_ou),vd_h.Thickness,0];vd_vz=[vd_lw,0,0],vd_xq=[(vd_lw+vd_og),0,0],vd_yw=[vd_lw,vd_h.Thickness,0],vd_yI=[(vd_lw+vd_og),vd_h.Thickness,0];vd_m.vd_ex(u_p1,u_n1,u_n2,u_p2,true,true,true,true,vd_mJ,vd_eM,vd_eM,vd_eM,vd_eM);vd_m.vd_ex(u_p1,u_n1,n1,p1,false,true,false,false,vdgeo.pointPolar(vd_eM,angle+vdgeo.HALF_PI,1.0),vd_yN,vd_yg,vd_xS,vd_vy);vd_m.vd_ex(u_p2,u_n2,n2,p2,false,true,false,false,vdgeo.pointPolar(vd_eM,angle+vdgeo.HALF_PI,1.0),vd_yw,vd_yI,vd_xq,vd_vz);if(i==0){d=vdgeo.Distance3D(p1,p2);vd_m.vd_ex(u_p1,u_p2,p2,p1,false,true,false,true,vdgeo.pointPolar(vd_eM,angle,1.0),[0,vd_h.Thickness,0],[d,vd_h.Thickness,0],[d,0,0],[0,0,0]);}if(i==vd_h.SamplePoints.length-2){d=vdgeo.Distance3D(n1,n2);vd_m.vd_ex(u_n1,u_n2,n2,n1,false,false,false,false,vdgeo.pointPolar(vd_eM,angle,1.0),[0,vd_h.Thickness,0],[d,vd_h.Thickness,0],[d,0,0],[0,0,0]);}vd_kh+=vd_ou;vd_lw+=vd_og;}}vd_m.vd_aR=undefined;if(vd_m.RenderMode===vdConst.vd_pB&& !vd_m.vd_bN){var vd_Fz=vd_m.vd_mz(true);vd_m.vd_fc(vd_h.SamplePoints,vd_h.Thickness);vd_m.vd_mz(vd_Fz);}vd_m.vd_aK(vd_se);}else{vd_m.vd_fc(vd_h.SamplePoints,vd_h.Thickness,false);}}if(vd_h.EcsMatrix!=undefined)vd_m.vd_bE();if(vd_m.vd_bR()==vdConst.vd_cq)vd_h.SamplePoints=undefined;};function vd_CK(vd_h,vd_m,vd_a){var vd_as=vd_h.TextString;vd_as=vd_as.replace(/\r\n/gi,"\n");vd_as=vd_as.replace(/\n/gi,"\n");vd_as=vd_as.replace(/\t/gi,"    ");vd_as=vd_as.replace("\\r","");vd_as=vd_as.replace("\\n","\n");vd_as=vd_as.replace("\\P","\n");vd_as=vd_as.replace("\\N","\n");vd_as=vd_as.replace("\\t","    ");if(vd_h.Height===0.0)vd_h.Height=1.0;if(vd_h.WidthFactor==undefined)vd_h.WidthFactor=1.0;var vd_sV=vd_h.Height/vd_h.StyleRef.FontFileVDS.Ascent;if(vd_h.AlignToViewSize)vd_sV*=vd_m.vd_jL(vd_h.AlignToViewSize,vd_h.Height);vd_sV*=vd_h.WidthFactor;if(!vd_h.BoxWidth)vd_h.BoxWidth=0.0;var maxWidth=vd_h.BoxWidth/vd_sV;var vd_iV='';vd_h.tb=[0,0,0,0];var vd_os=[];var uwidths=[];var owidths=[];var vd_ca=0;var vd_sU=0;var vd_pt=false;var ulen,olen,u,o;var vd_pO=vd_as.split("\n");for(var l=0;l<vd_pO.length;l++){var vd_ey=[];var vd_fd=[];var vd_kX;if(!vd_h.BoxWidth)vd_kX=[vd_pO[l]];else vd_kX=vd_pO[l].split(" ");for(var k=0;k<vd_kX.length;k++){var word=vd_kX[k];if(k!=vd_kX.length-1)word+=" ";var width=0;var rsb=0;var vd_mp=[];var vd_ml=[];for(var c=0;c<word.length;c++){if(word.substr(c,3).match(/%%u/i)){vd_mp.push(width);c+=3;}else if(word.substr(c,3).match(/%%o/i)){vd_ml.push(width);c+=3;}var pos=word.charCodeAt(c);var vd_fN=vd_h.StyleRef.FontFileVDS.Shapes['h_'+pos.toString()];var shape=null;if(vd_fN!=undefined)shape=vd_h.StyleRef.FontFileVDS.Shapes.Items[vd_fN];if(shape!=null){if(!vd_pt)vd_sU=shape.bb[0];vd_pt=true;width+=(shape.AdvanceX);rsb=shape.AdvanceX-shape.bb[2];}else{width+=vd_h.StyleRef.FontFileVDS.Ascent*0.5;rsb=0;}}width-=rsb;if(vd_ca==0||(vd_ca+width)<=maxWidth){for(u=0;u<vd_mp.length;u++)vd_ey.push(vd_mp[u]+vd_ca);for(o=0;o<vd_ml.length;o++)vd_fd.push(vd_ml[o]+vd_ca);vd_ca+=width;vd_iV=vd_iV.concat(word);}else{ulen=vd_ey.length%2;olen=vd_fd.length%2;if(ulen==1)vd_ey.push(vd_ca);if(olen==1)vd_fd.push(vd_ca);uwidths.push(vd_ey);vd_ey=[];owidths.push(vd_fd);vd_fd=[];if(ulen==1)vd_ey.push(0);if(olen==1)vd_fd.push(0);for(u=0;u<vd_mp.length;u++)vd_ey.push(vd_mp[u]);for(o=0;o<vd_ml.length;o++)vd_fd.push(vd_ml[o]);vd_os.push([vd_iV,vd_ca]);vd_h.tb[1]=Math.max(vd_h.tb[1],vd_ca);vd_h.tb[0]=Math.min(vd_h.tb[0],vd_sU);vd_pt=false;vd_ca=width;vd_iV=word;}}ulen=vd_ey.length%2;olen=vd_fd.length%2;if(ulen==1)vd_ey.push(vd_ca);if(olen==1)vd_fd.push(vd_ca);uwidths.push(vd_ey);vd_ey=[];owidths.push(vd_fd);vd_fd=[];vd_os.push([vd_iV,vd_ca]);vd_h.tb[1]=Math.max(vd_h.tb[1],vd_ca);vd_h.tb[0]=Math.min(vd_h.tb[0],vd_sU);vd_pt=false;vd_ca=0;vd_iV='';}vd_h.tb[3]=(vd_os.length-1)* -(vd_h.StyleRef.FontFileVDS.Ascent*5/3)-vd_h.StyleRef.FontFileVDS.Ascent-vd_h.StyleRef.FontFileVDS.Descent;return[vd_os,uwidths,owidths];};function vd_Bm(vd_h,vd_m,vd_a){if(vd_h.TextString==undefined||vd_h.TextString.length==0)return;if(vd_h.StyleRef==undefined){vd_h.StyleRef=vd_L.GetDictItem(vd_a.TextStyles,vd_h.Style);}if(vd_h.StyleRef==null)return;if(vd_h.StyleRef.FontFileVDS==null)return;if(vd_h.StyleRef.FontFileVDS.Shapes==null||vd_h.StyleRef.FontFileVDS.Shapes==undefined)return;if(vd_h.tb==undefined){var vd_pG=vd_CK(vd_h,vd_m,vd_a,vd_h.BoxWidth);vd_h.testlines=vd_pG[0];vd_h.uwidths=vd_pG[1];vd_h.owidths=vd_pG[2];}if(vd_h.EcsMatrix==undefined){if(vd_h.Height===0.0)vd_h.Height=1.0;if(vd_h.Rotation==undefined)vd_h.Rotation=0.0;if(vd_h.ExtrusionVector==undefined)vd_h.ExtrusionVector=vdgeo.newpoint(0,0,1);if(vd_h.WidthFactor==undefined)vd_h.WidthFactor=1.0;if(vd_h.Flag==undefined)vd_h.Flag=vdConst.VdConstTextstyle_LEFTTORIGHT;if(vd_h.Thickness==undefined)vd_h.Thickness=0.0;if(vd_h.Bold==undefined)vd_h.Bold=false;if(vd_h.ObliqueAngle==undefined)vd_h.ObliqueAngle=0.0;if(vd_h.TextLine==undefined)vd_h.TextLine=vdConst.TextLineFlags_None;var vd_hN=vd_h.tb[0];var vd_hM=0;var dy=0.0;var dx=0.0;switch(vd_h.VerJustify){case vdConst.VdConstVerJust_VdTextVerBottom:dy= -vd_h.tb[3]-vd_h.StyleRef.FontFileVDS.Descent;break;case vdConst.VdConstVerJust_VdTextVerCen:dy= -((vd_h.tb[2]+vd_h.tb[3])/2.0)-(vd_h.StyleRef.FontFileVDS.Descent/2.0);break;case vdConst.VdConstVerJust_VdTextVerTop:dy= -vd_h.tb[2];break;default:dy= -vd_h.tb[2];break;}switch(vd_h.HorJustify){case vdConst.VdConstHorJust_VdTextHorCenter:dx= -vd_hN-vd_h.tb[1]/2.0;break;case vdConst.VdConstHorJust_VdTextHorRight:dx= -vd_hN-vd_h.tb[1];break;default:dx= -vd_hN;break;}var scale=vd_h.Height/vd_h.StyleRef.FontFileVDS.Ascent;if(vd_h.AlignToViewSize)scale*=vd_m.vd_jL(vd_h.AlignToViewSize,vd_h.Height);var ddx=0.0;if(vd_h.ObliqueAngle!==90.0&&vd_h.ObliqueAngle!==0.0&&vd_h.ObliqueAngle!==180.0&&vd_h.ObliqueAngle!==270.0)ddx=((vd_hM+vd_h.StyleRef.FontFileVDS.Ascent)-dy)*Math.tan(vdgeo.DegreesToRadians(vd_h.ObliqueAngle));dx+=ddx;var vd_qV=((vd_h.Flag&vdConst.VdConstTextstyle_BACKWARD)==vdConst.VdConstTextstyle_BACKWARD? -1.0:1.0);var vd_pT=((vd_h.Flag&vdConst.VdConstTextstyle_UPSIDEDOWN)==vdConst.VdConstTextstyle_UPSIDEDOWN? -1.0:1.0);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aM(vd_h.EcsMatrix,scale,scale,1.0);vdgeo.vd_Y(vd_h.EcsMatrix,dx*scale,dy*scale,0.0);vdgeo.vd_xG(vd_h.EcsMatrix,vdgeo.DegreesToRadians(vd_h.ObliqueAngle),0.0);vdgeo.vd_aM(vd_h.EcsMatrix,vd_qV*vd_h.WidthFactor,vd_pT,1.0);vdgeo.vd_af(vd_h.EcsMatrix,vd_h.Rotation);vdgeo.vd_aG(vd_h.EcsMatrix,vd_h.ExtrusionVector);vdgeo.vd_Y(vd_h.EcsMatrix,vd_h.InsertionPoint[X],vd_h.InsertionPoint[Y],vd_h.InsertionPoint[Z]);}vd_m.vd_aN(vd_h.EcsMatrix);var color;var vd_fJ;var vd_by=0;if(vd_h.BackGroundMask&&vd_h.BackGroundMaskColor&&(vd_h.BackGroundMaskColor.SystemColor||vd_h.BackGroundMaskColor.ColorIndex!=undefined)){color=vd_h.BackGroundMaskColor.SystemColor;if(!color)color=vd_m.vd_ed(vd_h.BackGroundMaskColor.ColorIndex);vd_fJ=vd_m.vd_aC(color);if(vd_h.BackGroundMaskOffset)vd_by=vd_h.BackGroundMaskOffset*vd_h.StyleRef.FontFileVDS.Ascent/vd_h.Height;vd_m.vd_bX([[-vd_by+vd_h.tb[0],vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[3]+vd_by,0],[-vd_by+vd_h.tb[0],vd_h.tb[3]+vd_by,0]],null,null,true);vd_m.vd_aC(vd_fJ);}if(vd_h.BackgroundMaskBorder){color=vd_m.vd_aC();if(vd_h.BackGroundMaskBorderColor&&(vd_h.BackGroundMaskBorderColor.SystemColor||vd_h.BackGroundMaskBorderColor.ColorIndex!=undefined)){color=vd_h.BackGroundMaskBorderColor.SystemColor;if(!color)color=vd_m.vd_ed(vd_h.BackGroundMaskBorderColor.ColorIndex);}var penwidth=vd_m.vd_aK();if(vd_h.BackGroundMaskBorderPenWidth){penwidth=(vd_h.BackGroundMaskBorderPenWidth/100.0)*96/vdgeo.INCH_MM;}vd_fJ=vd_m.vd_aC(color);var vd_sA=vd_m.vd_aK(penwidth);vd_m.vd_ak([[-vd_by+vd_h.tb[0],vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[3]+vd_by,0],[-vd_by+vd_h.tb[0],vd_h.tb[3]+vd_by,0]],true);vd_m.vd_aK(vd_sA);vd_m.vd_aC(vd_fJ);}var vd_tX= -vd_h.StyleRef.FontFileVDS.Ascent;var upts=[null,null];var opts=[null,null];var pos= -1;for(var tl=0;tl<vd_h.testlines.length;tl++){var vd_as=vd_h.testlines[tl][0];var vd_jv=vd_h.testlines[tl][1];vd_as=vd_as.replace(/%%u/gi,"");vd_as=vd_as.replace(/%%o/gi,"");var mat=vdgeo.vd_l();vdgeo.vd_Y(mat,0,vd_tX,0);vd_m.vd_aN(mat);vd_m.vd_rd(vd_as,vd_jv,vd_h.StyleRef.FontFileVDS.Ascent,vd_h.StyleRef.FontFileVDS);if((vd_h.TextLine&vdConst.TextLineFlags_UnderLine)!=0){vd_m.vd_dJ(vdgeo.newpoint(0,-vd_h.StyleRef.FontFileVDS.Descent,0),vdgeo.newpoint(vd_jv,-vd_h.StyleRef.FontFileVDS.Descent,0));}else{var vd_gW=vd_h.uwidths[tl];for(var u=0;u<vd_gW.length;u++){pos=(u%2);upts[pos]=vd_gW[u];if(pos==1)vd_m.vd_dJ(vdgeo.newpoint(upts[0],-vd_h.StyleRef.FontFileVDS.Descent,0),vdgeo.newpoint(upts[1],-vd_h.StyleRef.FontFileVDS.Descent,0));}}if((vd_h.TextLine&vdConst.TextLineFlags_OverLine)!=0){vd_m.vd_dJ(vdgeo.newpoint(0,vd_h.StyleRef.FontFileVDS.Ascent*1.25,0),vdgeo.newpoint(vd_jv,vd_h.StyleRef.FontFileVDS.Ascent*1.25,0));}else{var vd_gL=vd_h.owidths[tl];for(var o=0;o<vd_gL.length;o++){pos=(o%2);upts[pos]=vd_gL[o];if(pos==1)vd_m.vd_dJ(vdgeo.newpoint(upts[0],vd_h.StyleRef.FontFileVDS.Ascent*1.25,0),vdgeo.newpoint(upts[1],vd_h.StyleRef.FontFileVDS.Ascent*1.25,0));}}vd_m.vd_bE();vd_tX-=(vd_h.StyleRef.FontFileVDS.Ascent*5/3);}vd_m.vd_bE();if(vd_h.AlignToViewSize)vd_h.EcsMatrix=undefined;};function vd_lQ(vd_h,vd_m,vd_a){if(vd_h.TextString==undefined||vd_h.TextString.length==0)return;if(vd_h.BoxWidth!=undefined||vd_h.TextString.search(/\\n/i)>0||vd_h.TextString.search(/\n/i)>0){vd_Bm(vd_h,vd_m,vd_a);return;}var i=0;if(vd_h.StyleRef==undefined){vd_h.StyleRef=vd_L.GetDictItem(vd_a.TextStyles,vd_h.Style);}if(vd_h.StyleRef==null)return;if(vd_h.StyleRef.FontFileVDS==null)return;if(vd_h.StyleRef.FontFileVDS.Shapes==null||vd_h.StyleRef.FontFileVDS.Shapes==undefined)return;if(vd_h.tb==undefined){var vd_as=vd_h.TextString;vd_as=vd_as.replace(/%%u/gi,"");vd_as=vd_as.replace(/%%o/gi,"");vd_as=vd_as.replace(/\t/gi,"    ");vd_as=vd_as.replace("\\t","    ");vd_h.DiplayString=vd_as;var rsb=0;vd_h.tb=[0,0,0,0];var vd_qe=0;var vd_fu=[];for(var c=0;c<vd_h.DiplayString.length;c++){var pos=vd_h.DiplayString.charCodeAt(c);if(pos==10||pos==13){vd_qe++;continue;}if(pos==32)vd_qe++;var vd_fN=vd_h.StyleRef.FontFileVDS.Shapes['h_'+pos.toString()];var shape=null;if(vd_fN!=undefined)shape=vd_h.StyleRef.FontFileVDS.Shapes.Items[vd_fN];if(c==0&&shape!=null)vd_h.tb[0]=shape.bb[0];if(shape!=null){vd_h.tb[1]+=(shape.AdvanceX);rsb=shape.AdvanceX-shape.bb[2];vd_h.tb[2]=Math.min(vd_h.tb[2],shape.bb[1]);vd_h.tb[3]=Math.max(vd_h.tb[3],shape.bb[3]);}else{vd_h.tb[1]+=vd_h.StyleRef.FontFileVDS.Ascent*0.5;rsb=0;}vd_fu.push(vd_h.tb[1]-rsb);}vd_h.tb[1]-=rsb;if(vd_qe==vd_h.DiplayString.length)vd_h.DiplayString=null;var uwidths=null;var owidths=null;var vd_aE=vd_h.TextString;vd_aE=vd_aE.replace(/%%U/g,"%%u");vd_aE=vd_aE.replace(/%%O/g,"%%o");if(vd_h.TextLine){if((vd_h.TextLine&vdConst.TextLineFlags_UnderLine)!=0){vd_aE=vd_aE.replace(/%%u/gi,"");vd_aE='%%u'+vd_aE;}if((vd_h.TextLine&vdConst.TextLineFlags_OverLine)!=0){vd_aE=vd_aE.replace(/%%o/gi,"");vd_aE='%%o'+vd_aE;}}var str="";var sl=0;var vd_gW=vd_aE.split("%%u");if(vd_gW.length>1){uwidths=[];str=vd_gW[0].replace(/%%o/gi,"");if(str.length==0)sl=0;else sl=vd_fu[str.length-1];uwidths.push(vd_h.tb[0]+sl);for(i=1;i<vd_gW.length;i++){str+=vd_gW[i].replace(/%%o/gi,"");if(str.length==0)sl=0;else sl=vd_fu[str.length-1];uwidths.push(vd_h.tb[0]+sl);}if((uwidths.length%2)==0)uwidths.push(vd_h.tb[0]+vd_h.tb[1]);}var vd_gL=vd_aE.split("%%o");if(vd_gL.length>1){owidths=[];str=vd_gL[0].replace(/%%u/gi,"");if(str.length==0)sl=0;else sl=vd_fu[str.length-1];owidths.push(vd_h.tb[0]+sl);for(i=1;i<vd_gL.length;i++){str+=vd_gL[i].replace(/%%u/gi,"");if(str.length==0)sl=0;else sl=vd_fu[str.length-1];owidths.push(vd_h.tb[0]+sl);}if((owidths.length%2)==0)owidths.push(vd_h.tb[0]+vd_h.tb[1]);}vd_h.uwidths=uwidths;vd_h.owidths=owidths;}if(vd_h.EcsMatrix==undefined){if(vd_h.Height===0.0)vd_h.Height=1.0;if(vd_h.Rotation==undefined)vd_h.Rotation=0.0;if(vd_h.ExtrusionVector==undefined)vd_h.ExtrusionVector=vdgeo.newpoint(0,0,1);if(vd_h.WidthFactor==undefined)vd_h.WidthFactor=1.0;if(vd_h.Flag==undefined)vd_h.Flag=vdConst.VdConstTextstyle_LEFTTORIGHT;if(vd_h.Thickness==undefined)vd_h.Thickness=0.0;if(vd_h.Bold==undefined)vd_h.Bold=false;if(vd_h.ObliqueAngle==undefined)vd_h.ObliqueAngle=0.0;if(vd_h.TextLine==undefined)vd_h.TextLine=vdConst.TextLineFlags_None;var vd_hN=vd_h.tb[0];var vd_hM= -vd_h.StyleRef.FontFileVDS.Ascent;var dy=0.0;var dx=0.0;switch(vd_h.VerJustify){case vdConst.VdConstVerJust_VdTextVerBottom:dy=vd_hM+vd_h.StyleRef.FontFileVDS.Descent+vd_h.StyleRef.FontFileVDS.Ascent;break;case vdConst.VdConstVerJust_VdTextVerCen:dy=vd_hM+vd_h.StyleRef.FontFileVDS.Ascent/2.0;break;case vdConst.VdConstVerJust_VdTextVerTop:dy=vd_hM;break;default:dy=vd_hM+vd_h.StyleRef.FontFileVDS.Ascent;break;}switch(vd_h.HorJustify){case vdConst.VdConstHorJust_VdTextHorCenter:dx= -vd_hN-vd_h.tb[1]/2.0;break;case vdConst.VdConstHorJust_VdTextHorRight:dx= -vd_hN-vd_h.tb[1];break;default:dx= -vd_hN;break;}var scale=vd_h.Height/vd_h.StyleRef.FontFileVDS.Ascent;if(vd_h.AlignToViewSize)scale*=vd_m.vd_jL(vd_h.AlignToViewSize,vd_h.Height);var ddx=0.0;if(vd_h.ObliqueAngle!==90.0&&vd_h.ObliqueAngle!==0.0&&vd_h.ObliqueAngle!==180.0&&vd_h.ObliqueAngle!==270.0)ddx=((vd_hM+vd_h.StyleRef.FontFileVDS.Ascent)-dy)*Math.tan(vdgeo.DegreesToRadians(vd_h.ObliqueAngle));dx+=ddx;var vd_qV=((vd_h.Flag&vdConst.VdConstTextstyle_BACKWARD)==vdConst.VdConstTextstyle_BACKWARD? -1.0:1.0);var vd_pT=((vd_h.Flag&vdConst.VdConstTextstyle_UPSIDEDOWN)==vdConst.VdConstTextstyle_UPSIDEDOWN? -1.0:1.0);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aM(vd_h.EcsMatrix,scale,scale,1.0);vdgeo.vd_Y(vd_h.EcsMatrix,dx*scale,dy*scale,0.0);vdgeo.vd_xG(vd_h.EcsMatrix,vdgeo.DegreesToRadians(vd_h.ObliqueAngle),0.0);vdgeo.vd_aM(vd_h.EcsMatrix,vd_qV*vd_h.WidthFactor,vd_pT,1.0);vdgeo.vd_af(vd_h.EcsMatrix,vd_h.Rotation);vdgeo.vd_aG(vd_h.EcsMatrix,vd_h.ExtrusionVector);vdgeo.vd_Y(vd_h.EcsMatrix,vd_h.InsertionPoint[X],vd_h.InsertionPoint[Y],vd_h.InsertionPoint[Z]);}vd_m.vd_aN(vd_h.EcsMatrix);var color;var vd_fJ;if(vd_h.BackGroundMask&&vd_h.BackGroundMaskColor&&(vd_h.BackGroundMaskColor.SystemColor||vd_h.BackGroundMaskColor.ColorIndex!=undefined)){color=vd_h.BackGroundMaskColor.SystemColor;if(!color)color=vd_m.vd_ed(vd_h.BackGroundMaskColor.ColorIndex);vd_fJ=vd_m.vd_aC(color);var vd_by=0;if(vd_h.BackGroundMaskOffset)vd_by=vd_h.BackGroundMaskOffset*vd_h.StyleRef.FontFileVDS.Ascent/vd_h.Height;vd_m.vd_bX([[-vd_by,vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[3]+vd_by,0],[-vd_by,vd_h.tb[3]+vd_by,0]],null,null,true);vd_m.vd_aC(vd_fJ);}if(vd_h.BackgroundMaskBorder){color=vd_m.vd_aC();if(vd_h.BackGroundMaskBorderColor&&(vd_h.BackGroundMaskBorderColor.SystemColor||vd_h.BackGroundMaskBorderColor.ColorIndex!=undefined)){color=vd_h.BackGroundMaskBorderColor.SystemColor;if(!color)color=vd_m.vd_ed(vd_h.BackGroundMaskBorderColor.ColorIndex);}var penwidth=vd_m.vd_aK();if(vd_h.BackGroundMaskBorderPenWidth){penwidth=(vd_h.BackGroundMaskBorderPenWidth/100.0)*96/vdgeo.INCH_MM;}vd_fJ=vd_m.vd_aC(color);var vd_sA=vd_m.vd_aK(penwidth);vd_m.vd_ak([[-vd_by,vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[2]-vd_by,0],[vd_h.tb[1]+vd_by,vd_h.tb[3]+vd_by,0],[-vd_by,vd_h.tb[3]+vd_by,0]],true);vd_m.vd_aK(vd_sA);vd_m.vd_aC(vd_fJ);}vd_m.vd_rd(vd_h.DiplayString,vd_h.tb[1],vd_h.StyleRef.FontFileVDS.Ascent,vd_h.StyleRef.FontFileVDS);var topy=vd_h.StyleRef.FontFileVDS.Ascent*1.25;var vd_vD= -vd_h.StyleRef.FontFileVDS.Descent;if(vd_h.uwidths){for(i=1;i<vd_h.uwidths.length;i+=2){if(vdgeo.AreEqual(vd_h.uwidths[i-1],vd_h.uwidths[i],vdgeo.DefaultLinearEquality))continue;vd_m.vd_dJ(vdgeo.newpoint(vd_h.uwidths[i-1],vd_vD,0),vdgeo.newpoint(vd_h.uwidths[i],vd_vD,0));}}if(vd_h.owidths){for(i=1;i<vd_h.owidths.length;i+=2){if(vdgeo.AreEqual(vd_h.owidths[i-1],vd_h.owidths[i],vdgeo.DefaultLinearEquality))continue;vd_m.vd_dJ(vdgeo.newpoint(vd_h.owidths[i-1],topy,0),vdgeo.newpoint(vd_h.owidths[i],topy,0));}}if((vd_h.TextLine&vdConst.TextLineFlags_CenterLine)!=0){vd_m.vd_dJ(vdgeo.newpoint(0,vd_h.StyleRef.FontFileVDS.Ascent*0.5,0),vdgeo.newpoint(vd_h.tb[1],vd_h.StyleRef.FontFileVDS.Ascent*0.5,0));}vd_m.vd_bE();if(vd_h.AlignToViewSize)vd_h.EcsMatrix=undefined;};function vd_AX(vd_h,vd_m,vd_a){if(vd_h.EcsMatrix==undefined){var rotation=0.0;var vd_bB=vdgeo.newpoint(0,0,1);var vd_bq=vdgeo.newpoint(0,0,0);if(vd_h.Rotation!=undefined)rotation=vd_h.Rotation;if(vd_h.ExtrusionVector!=undefined)vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);if(vd_h.InsertionPoint!=undefined)vd_bq=vdgeo.newpoint(vd_h.InsertionPoint[X],vd_h.InsertionPoint[Y],vd_h.InsertionPoint[Z]);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_af(vd_h.EcsMatrix,rotation);vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);vdgeo.vd_Y(vd_h.EcsMatrix,vd_bq[X],vd_bq[Y],vd_bq[Z]);}if(vd_h.SamplePoints==undefined){vd_h.SamplePoints=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_h.Width,0,0),vdgeo.newpoint(vd_h.Width,vd_h.Height,0),vdgeo.newpoint(0,vd_h.Height,0)];vd_h.SamplePoints.reverse();}vd_m.vd_aN(vd_h.EcsMatrix);if(vd_h.ps&&vd_h.ps.vd_J!=undefined){vd_m.vd_dE(vd_h.ps.vd_J);vd_el(vd_m,vd_h.SamplePoints,vd_h.Thickness,vd_h,vd_a);vd_m.vd_dE(null);}if(vd_h.HatchProperties==undefined||vd_h.HatchProperties.DrawBoundary===undefined||vd_h.HatchProperties.DrawBoundary||(vd_h.Thickness&&vd_h.Thickness!=0)||vd_m.vd_bR()==vdConst.vd_cq)vd_m.vd_fc(vd_h.SamplePoints,vd_h.Thickness,true);vd_m.vd_bE();};function vd_zS(vd_h,vd_m,vd_a){if(vd_h.EcsMatrix==undefined){var rotation=0.0;var vd_bB=vdgeo.newpoint(0,0,1);var vd_bq=vdgeo.newpoint(0,0,0);if(vd_h.Rotation!=undefined)rotation=vd_h.Rotation;if(vd_h.ExtrusionVector!=undefined)vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);if(vd_h.InsertionPoint!=undefined)vd_bq=vdgeo.newpoint(vd_h.InsertionPoint[X],vd_h.InsertionPoint[Y],vd_h.InsertionPoint[Z]);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_af(vd_h.EcsMatrix,rotation);vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);vdgeo.vd_Y(vd_h.EcsMatrix,vd_bq[X],vd_bq[Y],vd_bq[Z]);}vd_m.vd_aN(vd_h.EcsMatrix);var vd_Q=vd_L.GetDictItem(vd_a.Images,vd_h.ImageDefinition);if(vd_Q!=null&&vd_Q.bytes!=undefined){if((vd_h.Display&4)!=0&&vd_h.ClipBoundary&&vd_h.ClipBoundary.Items.length>2){if(!vd_h.ImageClipPts|| !vd_h.ImageClipUVS){var vd_jF=vdgeo.vd_l();var vd_ma=vd_h.Height/vd_Q.OriginalHeight;vdgeo.vd_aM(vd_jF,vd_ma,-vd_ma,1.0);vdgeo.vd_Y(vd_jF,0.0,vd_h.Height,0);vd_h.ImageClipPts=vdgeo.vd_ff(vd_jF,vd_h.ClipBoundary.Items);vd_jF=vdgeo.vd_l();vdgeo.vd_aM(vd_jF,1/vd_h.Width,1/vd_h.Height,1.0);vd_h.ImageClipUVS=vdgeo.vd_ff(vd_jF,vd_h.ImageClipPts);}vd_m.vd_or(vd_h.ImageClipPts,vdgeo.newpoint(0,0,1),vd_h.ImageClipUVS,vd_Q,true);}else{vd_m.vd_oo(vd_Q,(vd_h.Display&8)==8,vd_h.Width,vd_h.Height);}}if((vd_h.Display&16)==0||vd_h.Display==0){if(vd_h.ImageClipPts)vd_m.vd_ak(vd_h.ImageClipPts,true);else vd_m.vd_ak([vdgeo.newpoint(0,0,0),vdgeo.newpoint(vd_h.Width,0,0),vdgeo.newpoint(vd_h.Width,vd_h.Height,0),vdgeo.newpoint(0,vd_h.Height,0)],true);}vd_m.vd_bE();};function vd_zf(vd_h,vd_m,vd_a){if(vd_h.EcsMatrix==undefined){var vd_bB=vdgeo.newpoint(0,0,1);var vd_bq=vdgeo.newpoint(0,0,0);if(vd_h.ExtrusionVector!=undefined)vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);if(vd_h.Center!=undefined)vd_bq=vdgeo.newpoint(vd_h.Center[X],vd_h.Center[Y],vd_h.Center[Z]);vd_h.EcsMatrix=vdgeo.vd_l();if(vd_h.AlignToViewSize){vd_m.vd_of(vd_h.AlignToViewSize,vd_h.EcsMatrix,vd_h.Radius*2.0);}vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);vdgeo.vd_Y(vd_h.EcsMatrix,vd_bq[X],vd_bq[Y],vd_bq[Z]);}if(vd_h.SamplePoints==undefined){var vd_cr=vdgeo.vd_hz(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_h.Radius,vdgeo.VD_TWOPI);vd_h.SamplePoints=vdgeo.vd_pj(vd_cr,vd_h.Radius,0.0,vdgeo.VD_TWOPI,0);vd_h.SamplePoints.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),0.0,vd_h.Radius));vd_h.SamplePoints.reverse();}vd_m.vd_aN(vd_h.EcsMatrix);if(vd_h.ps&&vd_h.ps.vd_J!=undefined){vd_m.vd_dE(vd_h.ps.vd_J);vd_el(vd_m,vd_h.SamplePoints,vd_h.Thickness,vd_h,vd_a);vd_m.vd_dE(null);}if(vd_h.HatchProperties==undefined||vd_h.HatchProperties.DrawBoundary===undefined||vd_h.HatchProperties.DrawBoundary||(vd_h.Thickness&&vd_h.Thickness!=0)||vd_m.vd_bR()==vdConst.vd_cq)vd_m.vd_fc(vd_h.SamplePoints,vd_h.Thickness,false);vd_m.vd_bE();if(vd_h.AlignToViewSize)vd_h.EcsMatrix=undefined;if(vd_m.vd_bR()==vdConst.vd_cq||vd_h.AlignToViewSize)vd_h.SamplePoints=undefined;};function vd_Az(vd_h,vd_m,vd_a){if(vd_h.EcsMatrix==undefined){var vd_bB=vdgeo.newpoint(0,0,1);var vd_bq=vdgeo.newpoint(0,0,0);if(vd_h.ExtrusionVector!=undefined)vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);if(vd_h.Center!=undefined)vd_bq=vdgeo.newpoint(vd_h.Center[X],vd_h.Center[Y],vd_h.Center[Z]);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);vdgeo.vd_Y(vd_h.EcsMatrix,vd_bq[X],vd_bq[Y],vd_bq[Z]);}if(vd_h.SamplePoints==undefined){if(vd_h.StartAngle==undefined)vd_h.StartAngle=0.0;if(vd_h.EndAngle==undefined)vd_h.EndAngle=0.0;var da=vdgeo.FixAngle(vd_h.EndAngle)-vdgeo.FixAngle(vd_h.StartAngle);var vd_cr=vdgeo.vd_hz(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_h.Radius,da);vd_h.SamplePoints=vdgeo.vd_pj(vd_cr,vd_h.Radius,vd_h.StartAngle,vd_h.EndAngle,0);vd_h.SamplePoints.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),vd_h.EndAngle,vd_h.Radius));vd_h.SamplePoints.reverse();}vd_m.vd_aN(vd_h.EcsMatrix);var vd_cA=vd_h.SamplePoints;var closed=false;if(vd_h.ps&&vd_h.ps.vd_J!=undefined){vd_cA=vd_cA.concat([vdgeo.newpoint(0,0,0)]);closed=true;vd_m.vd_dE(vd_h.ps.vd_J);vd_el(vd_m,vd_cA,vd_h.Thickness,vd_h,vd_a);vd_m.vd_dE(null);}if(vd_h.HatchProperties==undefined||vd_h.HatchProperties.DrawBoundary===undefined||vd_h.HatchProperties.DrawBoundary||(vd_h.Thickness&&vd_h.Thickness!=0)||vd_m.vd_bR()==vdConst.vd_cq)vd_m.vd_fc(vd_cA,vd_h.Thickness,closed);vd_m.vd_bE();if(vd_m.vd_bR()==vdConst.vd_cq)vd_h.SamplePoints=undefined;};function vd_zH(vd_h,vd_m,vd_a){if(vd_h.EcsMatrix==undefined){var vd_bB=vdgeo.newpoint(0,0,1);var vd_bq=vdgeo.newpoint(0,0,0);if(vd_h.ExtrusionVector!=undefined)vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);if(vd_h.Center!=undefined)vd_bq=vdgeo.newpoint(vd_h.Center[X],vd_h.Center[Y],vd_h.Center[Z]);vd_h.EcsMatrix=new vdgeo.vd_l();if(vd_h.MajorAngle!=undefined)vdgeo.vd_af(vd_h.EcsMatrix,vd_h.MajorAngle);vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);vdgeo.vd_Y(vd_h.EcsMatrix,vd_bq[X],vd_bq[Y],vd_bq[Z]);}if(vd_h.SamplePoints==undefined){if(vd_h.StartAngle==undefined)vd_h.StartAngle=0.0;if(vd_h.EndAngle==undefined)vd_h.EndAngle=0.0;var da=vdgeo.FixAngle(vd_h.EndAngle)-vdgeo.FixAngle(vd_h.StartAngle);var vd_cr=vdgeo.vd_nQ(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_h.MajorLength,da);vd_h.SamplePoints=vdgeo.vd_pf(vd_cr,vd_h.MajorLength,vd_h.MinorLength,vd_h.StartAngle,vd_h.EndAngle);vd_h.SamplePoints.reverse();}vd_m.vd_aN(vd_h.EcsMatrix);var vd_cA=vd_h.SamplePoints;var closed=false;if(vd_h.ps&&vd_h.ps.vd_J!=undefined){if(!vdgeo.vd_xx(vd_cA)){vd_cA=vd_cA.concat([vdgeo.newpoint(0,0,0)]);closed=true;}vd_m.vd_dE(vd_h.ps.vd_J);vd_el(vd_m,vd_cA,vd_h.Thickness,vd_h,vd_a);vd_m.vd_dE(null);}if(vd_h.HatchProperties==undefined||vd_h.HatchProperties.DrawBoundary===undefined||vd_h.HatchProperties.DrawBoundary||(vd_h.Thickness&&vd_h.Thickness!=0)||vd_m.vd_bR()==vdConst.vd_cq)vd_m.vd_fc(vd_cA,vd_h.Thickness,closed);vd_m.vd_bE();if(vd_m.vd_bR()==vdConst.vd_cq)vd_h.SamplePoints=undefined;};function vd_AE(vd_h,vd_m,vd_a){var k=0;if(vd_h.ExtrusionVector!=undefined&&vd_h.EcsMatrix==undefined){var vd_bB=vdgeo.newpoint(vd_h.ExtrusionVector[X],vd_h.ExtrusionVector[Y],vd_h.ExtrusionVector[Z]);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aG(vd_h.EcsMatrix,vd_bB);}if(vd_h.ps&&vd_h.ps.MaterialMatrix!=null&&vd_h.EcsMatrix==undefined)vd_h.EcsMatrix=vdgeo.vd_l();if(vd_h.EcsMatrix!=undefined)vd_m.vd_aN(vd_h.EcsMatrix);if(vd_h.ps&&vd_h.ps.vd_J!=undefined){if(vd_h.Curves!=undefined){vd_m.vd_dE(vd_h.ps.vd_J);for(k=0;k<vd_h.Curves.Items.length;k++){vd_el(vd_m,vd_h.Curves.Items[k].Items,vd_h.Thickness,vd_h.Curves.Items[k],vd_a);}vd_m.vd_dE(null);}}if(vd_h.HatchProperties==undefined||vd_h.HatchProperties.DrawBoundary===undefined||vd_h.HatchProperties.DrawBoundary||(vd_h.Thickness&&vd_h.Thickness!=0)||vd_m.vd_bR()==vdConst.vd_cq){if(vd_h.OutLines!=undefined){for(k=0;k<vd_h.OutLines.Items.length;k++){vd_m.vd_fc(vd_h.OutLines.Items[k].Items,vd_h.Thickness,true);}}}if(vd_h.EcsMatrix!=undefined)vd_m.vd_bE();};var vd_gy=vdgeo.vd_l();var _uv0=vdgeo.newpoint(0,0,0);var _uv1=vdgeo.newpoint(0,0,0);var _uv2=vdgeo.newpoint(0,0,0);var _uv3=vdgeo.newpoint(0,0,0);function vd_nV(vd_pk,vd_av){var k= -1;for(var i=0;i<vd_av.length;i++){if(vd_pk<vd_av[i].Key)break;k=i;}if(k== -1)return vd_av[0].Value;if(k==vd_av.length-1)return vd_av[vd_av.length-1].Value;var vd_fe=(vd_pk-vd_av[k].Key)/(vd_av[k+1].Key-vd_av[k].Key);var c1=vd_av[k].Value;var c2=vd_av[k+1].Value;return[c1[0]+(c2[0]-c1[0])*vd_fe,c1[1]+(c2[1]-c1[1])*vd_fe,c1[2]+(c2[2]-c1[2])*vd_fe];};function vd_tD(p0,p1,p2,p3,tmat,normal,uv0,uv1,uv2,uv3,vd_av){var vd_Fe=vdgeo.vd_Be(p0,p1,p2,p3,normal);if(vd_av){var col=vd_nV(p0[Z],vd_av);uv0[0]=col[0];uv0[1]=col[1];uv0[2]=col[2];col=vd_nV(p1[Z],vd_av);uv1[0]=col[0];uv1[1]=col[1];uv1[2]=col[2];col=vd_nV(p2[Z],vd_av);uv2[0]=col[0];uv2[1]=col[1];uv2[2]=col[2];col=vd_nV(p3[Z],vd_av);uv3[0]=col[0];uv3[1]=col[1];uv3[2]=col[2];}else if(vd_Fe&&tmat){vdgeo.vd_fD(vd_gy);vdgeo.vd_aG(vd_gy,normal);var useZ=tmat[A22]!=1||(tmat[A30]!=0&&tmat[A31]!=0&&tmat.A33!=1);vdgeo.vd_hR(vd_gy);vdgeo.vd_dL(vd_gy,p0,_uv0);vdgeo.vd_dL(vd_gy,p1,_uv1);vdgeo.vd_dL(vd_gy,p2,_uv2);vdgeo.vd_dL(vd_gy,p3,_uv3);if(!useZ){_uv0[Z]=_uv1[Z]=_uv2[Z]=_uv3[Z]=0;}vdgeo.vd_dL(tmat,_uv0,uv0);vdgeo.vd_dL(tmat,_uv1,uv1);vdgeo.vd_dL(tmat,_uv2,uv2);vdgeo.vd_dL(tmat,_uv3,uv3);if(!useZ){if(!vdgeo.AreEqual(uv0[Z],0,vdgeo.DefaultVectorEquality)){uv0[X]/=uv0[Z];uv0[Y]/=uv0[Z];}if(!vdgeo.AreEqual(uv1[Z],0,vdgeo.DefaultVectorEquality)){uv1[X]/=uv1[Z];uv1[Y]/=uv1[Z];}if(!vdgeo.AreEqual(uv2[Z],0,vdgeo.DefaultVectorEquality)){uv2[X]/=uv2[Z];uv2[Y]/=uv2[Z];}if(!vdgeo.AreEqual(uv3[Z],0,vdgeo.DefaultVectorEquality)){uv3[X]/=uv3[Z];uv3[Y]/=uv3[Z];}}}};function vd_zw(vd_h,vd_m,vd_a){if(vd_h.FaceList===undefined||vd_h.VertexList===undefined)return;var vd_av=null;if(vd_h.GradientColors&&vd_h.GradientColors.Items&&vd_h.GradientColors.Items.length>1)vd_av=vd_h.GradientColors.Items;if(vd_m.vd_bR()==vdConst.vd_le&&(!vd_h.Normals|| !vd_h.UVS)){var vd_tv=vd_h.FaceList.Items.length/5;vd_h.Normals=[];vd_h.Normals.length=vd_tv;vd_h.UVS=[];vd_h.UVS.length=vd_tv*4;var ii=0;var p0,p1,p2,p3;var vd_fg,vd_bZ;var col= -1,vd_gt= -1;var vd_fr=vd_m.vd_gq(0);var tmat=vd_fr;for(var i=0;i<vd_h.FaceList.Items.length;i=i+5){vd_fg=i/5;vd_bZ=4*vd_fg;ii=Math.abs(vd_h.FaceList.Items[i]);p0=vd_h.VertexList.Items[ii-1];ii=Math.abs(vd_h.FaceList.Items[i+1]);p1=vd_h.VertexList.Items[ii-1];ii=Math.abs(vd_h.FaceList.Items[i+2]);p2=vd_h.VertexList.Items[ii-1];ii=Math.abs(vd_h.FaceList.Items[i+3]);p3=vd_h.VertexList.Items[ii-1];col=vd_h.FaceList.Items[i+4];if(vd_gt!=col){vd_gt=col;if(vd_gt== -1){tmat=vd_fr;}else{var pcol=vd_a.Palette.Items[vd_gt];tmat=pcol.MaterialMatrix;}}vd_h.UVS[vd_bZ]=vdgeo.newpoint(0,0,0);vd_h.UVS[vd_bZ+1]=vdgeo.newpoint(0,0,0);vd_h.UVS[vd_bZ+2]=vdgeo.newpoint(0,0,0);vd_h.UVS[vd_bZ+3]=vdgeo.newpoint(0,0,0);vd_h.Normals[vd_fg]=vdgeo.newpoint(0,0,1);vd_tD(p0,p1,p2,p3,tmat,vd_h.Normals[vd_fg],vd_h.UVS[vd_bZ],vd_h.UVS[vd_bZ+1],vd_h.UVS[vd_bZ+2],vd_h.UVS[vd_bZ+3],vd_av);}vd_m.vd_gq(vd_fr);}vd_m.vd_wX(vd_h.FaceList.Items,vd_h.VertexList.Items,vd_h.Normals,vd_h.UVS,vd_av);};function vd_Bl(vd_h,vd_m,vd_a){var vd_jo=vd_h.EdgeVisibility;if(vd_jo==undefined)vd_jo=0;var p0=vd_h.VertexList.Items[0],p1=vd_h.VertexList.Items[1],p2=vd_h.VertexList.Items[2],p3=vd_h.VertexList.Items[3];if(vd_m.vd_bR()==vdConst.vd_le&&(!vd_h.Normals|| !vd_h.UVS)){vd_h.Normals=[];vd_h.Normals.length=1;vd_h.UVS=[];vd_h.UVS.length=4;var vd_fr=vd_m.vd_gq(0);vd_h.UVS[0]=vdgeo.newpoint(0,0,0);vd_h.UVS[1]=vdgeo.newpoint(0,0,0);vd_h.UVS[2]=vdgeo.newpoint(0,0,0);vd_h.UVS[3]=vdgeo.newpoint(0,0,0);vd_h.Normals[0]=vdgeo.newpoint(0,0,1);vd_tD(p0,p1,p2,p3,vd_fr,vd_h.Normals[0],vd_h.UVS[0],vd_h.UVS[1],vd_h.UVS[2],vd_h.UVS[3]);vd_m.vd_gq(vd_fr);}if(vd_m.vd_bR()!=vdConst.vd_le)vd_m.vd_ex(p0,p1,p2,p3);else vd_m.vd_ex(p0,p1,p2,p3,((vd_jo&1)==0),((vd_jo&2)==0),((vd_jo&4)==0),((vd_jo&8)==0),vd_h.Normals[0],vd_h.UVS[0],vd_h.UVS[1],vd_h.UVS[2],vd_h.UVS[3]);};function vd_zM(vd_h,vd_m,vd_a){vd_m.vd_wW(vd_h.BasePoint,vd_h.Direction,vd_h.InfinityType==vdConst.InfinityTypes_Ray)};function vd_Am(vd_h,vd_m,vd_a){if(vd_h.EcsMatrix==undefined){var vd_iN=vd_a.PointStyleSize;if(vd_iN<0.0)vd_iN=vd_m.vd_v*Math.abs(vd_iN)/100.0;if(vd_h.ExtrusionVector==undefined)vd_h.ExtrusionVector=vdgeo.newpoint(0,0,1);vd_h.EcsMatrix=vdgeo.vd_l();vdgeo.vd_aM(vd_h.EcsMatrix,vd_iN,vd_iN,1.0);if(vd_h.AlignToViewSize){vd_m.vd_of(vd_h.AlignToViewSize,vd_h.EcsMatrix,vd_iN*2.0);}vdgeo.vd_aG(vd_h.EcsMatrix,vd_h.ExtrusionVector);vdgeo.vd_Y(vd_h.EcsMatrix,vd_h.InsertionPoint[X],vd_h.InsertionPoint[Y],vd_h.InsertionPoint[Z]);}if(vd_h.pointSegments==undefined){vd_h.pointSegments=[];var pts;var mode=vd_a.PointStyleMode;if(mode!==1){if((mode&32)===32){var vd_cr=vdgeo.vd_hz(vdgeo.CURVERESOLUTION,vd_m.GetPixelSize(),vd_h.Radius,vdgeo.VD_TWOPI);pts=vdgeo.vd_pj(vd_cr,0.5,0.0,vdgeo.VD_TWOPI,0);pts.push(vdgeo.pointPolar(vdgeo.newpoint(0,0,0),0.0,0.5));vd_h.pointSegments.push(pts);mode-=32;}if((mode&64)===64){pts=[vdgeo.newpoint(-0.5,-0.5,0.0),vdgeo.newpoint(0.5,-0.5,0.0),vdgeo.newpoint(0.5,0.5,0.0),vdgeo.newpoint(-0.5,0.5,0.0),vdgeo.newpoint(-0.5,-0.5,0.0)];vd_h.pointSegments.push(pts);mode-=64;}if(mode===0){pts=[vdgeo.newpoint(0,0,0),vdgeo.newpoint(0,0,0)];vd_h.pointSegments.push(pts);}if(mode===2){pts=[vdgeo.newpoint(-1.0,0.0,0.0),vdgeo.newpoint(1.0,0.0,0.0)];vd_h.pointSegments.push(pts);pts=[vdgeo.newpoint(0.0,-1.0,0.0),vdgeo.newpoint(0.0,1.0,0.0)];vd_h.pointSegments.push(pts);}if(mode===3){pts=[vdgeo.newpoint(-1.0,-1.0,0.0),vdgeo.newpoint(1.0,1.0,0.0)];vd_h.pointSegments.push(pts);pts=[vdgeo.newpoint(-1.0,1.0,0.0),vdgeo.newpoint(1.0,-1.0,0.0)];vd_h.pointSegments.push(pts);}if(mode===4){pts=[vdgeo.newpoint(0.0,0.0,0.0),vdgeo.newpoint(0.0,1.0,0.0)];vd_h.pointSegments.push(pts);}}}vd_m.vd_aN(vd_h.EcsMatrix);for(var ipl=0;ipl<vd_h.pointSegments.length;ipl++){vd_m.vd_ak(vd_h.pointSegments[ipl],false);}vd_m.vd_bE();if(vd_h.AlignToViewSize)vd_h.EcsMatrix=undefined;if(vd_m.vd_bR()==vdConst.vd_cq||vd_h.AlignToViewSize)vd_h.pointSegments=undefined;};function vd_AV(vd_h,vd_m,vd_a){var idoc;var c,r,offset,omat;if(vd_h.BlockRef==undefined){vd_h.BlockRef=vd_L.GetDictItem(vd_a.Blocks,vd_h.Block);}if(!vd_h.BlockRef)return;if(vd_h.BlockRef.vd_xM)return;if(vd_h.BlockRef.ExternalReferencePath&& !vd_h.BlockRef.ExternalReference){if(vd_ai.vd_xI())return;var vd_cb=vd_L.GetXREFS();for(idoc=0;idoc<vd_cb.length;idoc++){if(vd_cb[idoc].documentdata&&vd_cb[idoc].documentdata.vd_xI()){return;}}var vd_ww=false;var vd_pX=vdConst.vd_xd(vd_h.BlockRef.ExternalReferencePath).toLowerCase();for(idoc=0;idoc<vd_cb.length;idoc++){if(vd_cb[idoc].KeyFile==vd_pX){vd_ww=true;}}if(!vd_ww)vd_cb.push(new vd_EN(vd_L,vd_pX,vd_h.BlockRef.ExternalReferencePath,vd_h.BlockRef));for(idoc=0;idoc<vd_cb.length;idoc++){if(vd_cb[idoc].KeyFile==vd_pX){if(vd_cb[idoc].documentdata.vd_K){vd_h.BlockRef.ExternalReference=vd_cb[idoc].documentdata;if(vd_h.BlockRef.ExternalReference.vd_K.BasePoint)vd_h.BlockRef.Origin=vd_h.BlockRef.ExternalReference.vd_K.BasePoint.concat([]);}break;}}if(!vd_h.BlockRef.ExternalReference)return;}if(vd_h.EcsMatrix==undefined){if(vd_h.Columns==undefined)vd_h.Columns=1;if(vd_h.Rows==undefined)vd_h.Rows=1;if(vd_h.ColumnDist==undefined)vd_h.ColumnDist=0.0;if(vd_h.RowDist==undefined)vd_h.RowDist=0.0;vd_h.EcsMatrix=vdgeo.vd_l();if(vd_h.BlockRef.Origin==undefined)vd_h.BlockRef.Origin=vdgeo.newpoint(0,0,0);if(vd_h.Xscale==undefined)vd_h.Xscale=1;if(vd_h.Yscale==undefined)vd_h.Yscale=1;if(vd_h.Zscale==undefined)vd_h.Zscale=1;if(vd_h.Rotation==undefined)vd_h.Rotation=0;if(vd_h.ExtrusionVector==undefined)vd_h.ExtrusionVector=vdgeo.newpoint(0,0,1);if(vd_h.InsertionPoint==undefined)vd_h.InsertionPoint=vdgeo.newpoint(0,0,0);vdgeo.vd_Y(vd_h.EcsMatrix,-vd_h.BlockRef.Origin[X],-vd_h.BlockRef.Origin[Y],-vd_h.BlockRef.Origin[Z]);vdgeo.vd_aM(vd_h.EcsMatrix,vd_h.Xscale,vd_h.Yscale,vd_h.Zscale);if(vd_h.AlignToViewSize&&vd_h.BoundingBox!=undefined){vd_m.vd_of(vd_h.AlignToViewSize,vd_h.EcsMatrix,vd_h.BoundingBox[4]-vd_h.BoundingBox[1]);}vdgeo.vd_af(vd_h.EcsMatrix,vd_h.Rotation);vdgeo.vd_aG(vd_h.EcsMatrix,vd_h.ExtrusionVector);vdgeo.vd_Y(vd_h.EcsMatrix,vd_h.InsertionPoint[X],vd_h.InsertionPoint[Y],vd_h.InsertionPoint[Z]);}var isArray=vd_h.Columns>1||vd_h.Rows>1;vd_m.vd_aN(vd_h.EcsMatrix);vd_h.BlockRef.vd_xM=true;for(c=0;c<vd_h.Columns;c++){for(r=0;r<vd_h.Rows;r++){if(isArray){offset=vdgeo.newpoint(c*vd_h.ColumnDist/vd_h.Xscale,r*vd_h.RowDist/vd_h.Yscale,0.0);omat=vdgeo.vd_l();vdgeo.vd_Y(omat,offset[X],offset[Y],offset[Z]);vd_m.vd_aN(omat);}if(vd_h.BlockRef.ExternalReference){var vd_zL=vd_ai;vd_ai=vd_h.BlockRef.ExternalReference;vd_iu(vd_ai.vd_K.Model.Entities,true,vd_m,vd_ai.vd_K);vd_ai=vd_zL;if(vd_ai.vd_K.Palette&&vd_ai.vd_K.Palette._lc&&vd_ai.vd_K.Palette._lc._a1!=false&&vd_h.BlockRef.ExternalReference.vd_K&&vd_h.BlockRef.ExternalReference.vd_K.Palette&&vd_h.BlockRef.ExternalReference.vd_K.Palette._lc&&vd_h.BlockRef.ExternalReference.vd_K.Palette._lc._a1==false)vd_ai.vd_K.Palette._lc._a1=false;}else{vd_iu(vd_h.BlockRef.Entities,true,vd_m,vd_a);}if(isArray)vd_m.vd_bE();}}vd_h.BlockRef.vd_xM=false;vd_m.vd_bE();if(vd_h.Attributes&&vd_h.Attributes.Items&&vd_h.Attributes.Items.length>0){for(c=0;c<vd_h.Columns;c++){for(r=0;r<vd_h.Rows;r++){if(isArray){offset=vdgeo.pointPolar(vdgeo.newpoint(0,0,0),vd_h.Rotation,c*vd_h.ColumnDist);offset=vdgeo.pointPolar(offset,vd_h.Rotation+vdgeo.HALF_PI,r*vd_h.RowDist);omat=vdgeo.vd_l();vdgeo.vd_Y(omat,offset[X],offset[Y],offset[Z]);vd_m.vd_aN(omat);}vd_iu(vd_h.Attributes,false,vd_m,vd_a);if(isArray)vd_m.vd_bE();}}}if(vd_h.AlignToViewSize)vd_h.EcsMatrix=undefined;};this.ActionDrawEntities=function(entities,vd_xs){var vd_a=vd_x();if(!vd_a)return;if(!entities||entities.length==0){vd_F.vd_y.Refresh();}else{var vd_sg=vd_F.vd_y.vd_fa;vd_F.vd_y.vd_fa=false;vd_F.vd_y.vd_kE(true);try{for(var i=0;i<entities.length;i++){vd_bx(entities[i],vd_F,vd_a);}}catch(ex){}vd_F.vd_y.Refresh();if(vd_xs)vd_F.vd_y.vd_sX();vd_F.vd_y.vd_kE(false);vd_F.vd_y.vd_fa=vd_sg;}};this.ToolTip=new function(){this.AutoShow=true;var vd_bp=this;var vd_nG=null;var vdcanvas=vd_L;this.vd_pN=1500;Object.defineProperty(vd_bp,'TimeOut',{get:function(){return vd_bp.vd_pN;},set:function(newValue){vd_bp.vd_pN=newValue;}});this.vd_sT=[255,255,255];Object.defineProperty(vd_bp,'FillColor1',{get:function(){return vd_bp.vd_sT;},set:function(newValue){vd_bp.vd_sT=newValue;}});this.vd_rr=[211,211,211];Object.defineProperty(vd_bp,'FillColor2',{get:function(){return vd_bp.vd_rr;},set:function(newValue){vd_bp.vd_rr=newValue;}});this.vd_sH=[72,72,72];Object.defineProperty(vd_bp,'BoundaryColor',{get:function(){return vd_bp.vd_sH;},set:function(newValue){vd_bp.vd_sH=newValue;}});this.vd_rH=[0,0,0];Object.defineProperty(vd_bp,'FontColor',{get:function(){return vd_bp.vd_rH;},set:function(newValue){vd_bp.vd_rH=newValue;}});this.vd_qX='sans-serif';Object.defineProperty(vd_bp,'FontName',{get:function(){return vd_bp.vd_qX;},set:function(newValue){vd_bp.vd_qX=newValue;}});this.vd_tf=16;Object.defineProperty(vd_bp,'FontHeight',{get:function(){return vd_bp.vd_tf;},set:function(newValue){vd_bp.vd_tf=newValue;}});this.vd_tU=[0,0];Object.defineProperty(vd_bp,'BoundaryOffset',{get:function(){return vd_bp.vd_tU;},set:function(newValue){vd_bp.vd_tU=newValue;}});function vd_Db(point,width,height){var vd_gA=new Array(point[0],point[1]);var xmin=vd_gA[0];var xmax=vd_gA[0]+width;var ymin=vd_gA[1];var ymax=vd_gA[1]+height;var vd_Hs=vdcanvas.canvas.height;var vd_Bv=vdcanvas.canvas.width;if(xmax>vd_Bv)vd_gA[0]=point[0]-width;if(ymin<0)vd_gA[1]=0;return vd_gA;};this.show=function(p,str,size,timeout){var vd_dc=vdcanvas.ViewToPixel(p);vd_bp.vd_yY(vd_dc,str,size,timeout);};this.vd_yY=function(vd_ix,str,size,timeout){if(!str||str=="")return;var vd_dc=[vd_ix[0],vd_ix[1],0];if(size===undefined)size=vd_bp.vd_tf;vd_bp.hide();vd_F.vd_y.vd_kE(true);var ctxt=vdcanvas.canvas.getContext('2d');var lines=str.split("\\n");var vd_nN=0;var i;for(i=0;i<lines.length;i++){vd_nN=Math.max(vd_nN,ctxt.measureText(lines[i]).width);}var vd_vp=size+4;var vd_ks=vd_vp*lines.length;vd_dc[1]-=vd_ks;vd_dc=vd_Db(vd_dc,vd_nN+4,vd_ks+4);var vd_qU=ctxt.createLinearGradient(vd_dc[0],vd_dc[1],vd_dc[0],vd_dc[1]+size);vd_qU.addColorStop(0,vdgdi.vd_ha(vd_bp.vd_sT));vd_qU.addColorStop(1,vdgdi.vd_ha(vd_bp.vd_rr));ctxt.fillStyle=vd_qU;var vd_hv=vd_dc.slice();vd_dc[0]+=3;vd_dc[1]+=2;var vd_rE=vd_nN+6;vd_hv[0]+=1;vd_hv[1]+=1;ctxt.fillRect(vd_hv[0],vd_hv[1],vd_rE,vd_ks);ctxt.strokeStyle=vdgdi.vd_ha(vd_bp.vd_sH);var lw=ctxt.lineWidth;ctxt.lineWidth=1;vd_rE+=2;vd_ks+=2;vd_hv[0]-=1;vd_hv[1]-=1;ctxt.strokeRect(vd_hv[0],vd_hv[1],vd_rE,vd_ks);ctxt.lineWidth=lw;ctxt.font=size+"px "+vd_bp.vd_qX;ctxt.fillStyle=vdgdi.vd_ha(vd_bp.vd_rH);ctxt.textBaseline='top';for(i=0;i<lines.length;i++){ctxt.fillText(lines[i],vd_dc[0],vd_dc[1]+i*vd_vp);}if(timeout===undefined)timeout=vd_bp.vd_pN;if(timeout)vd_nG=setTimeout(vd_bp.hide,timeout);};this.hide=function(){if(vd_nG){clearTimeout(vd_nG);vd_nG=null;vd_F.vd_y.Refresh();vd_F.vd_y.vd_kE(false);}}};this.DrawEntity=function(vd_G,vd_m){if(!vd_m)vd_m=vd_L.vd_z();vd_bx(vd_G,vd_m,vd_x());};function vd_bx(vd_h,vd_m,vd_a,index,vd_kj){if(!vd_h)return;if(vd_h.Deleted===true)return;if(vd_h.visibility===1)return;var vd_hh=vd_m.vd_kC();vd_Bp(vd_h,vd_a,vd_m);if(vd_h._t!==vdConst.vdViewport_code){if(vd_L.vd_FB(vd_h.LayerRef,vd_a))return;}if(vd_m.vd_bR()==vdConst.vd_cq){if(vd_hh==null&&vd_h.BoundingBox!=undefined){vd_m.vd_gu.vd_sl(vd_h.BoundingBox);return;}}else{if(vd_h._t!==vdConst.vdViewport_code&&vd_h._t!==vdConst.vdInsert_code){if(vd_hh&&vd_hh._t==vdConst.vdInsert_code&&vd_hh.LayerRef){if(vd_h.LayerRef.Name=="0"){if(vd_hh.LayerRef.On===false)return;}else if(vd_h.LayerRef.On===false)return;}else{if(vd_h.LayerRef.On===false)return;}}}var pw,col,vd_aI,vd_lp,lt,ltscale,highlight;vd_m.vd_rk(vd_h,vd_kj?index:undefined);col=vd_BH(vd_h,vd_m);if(!vd_m.vd_mK()){pw=vd_Cy(vd_h,vd_m);vd_aI=vd_EJ(vd_h,vd_m);vd_lp=vd_Ew(vd_h,vd_m);lt=vd_EF(vd_h,vd_m);ltscale=vd_BJ(vd_h,vd_m);highlight=vd_m.vd_mz(vd_h.HighLight);}if(vd_h.Explode!==undefined){vd_iu(vd_h.Explode,false,vd_m,vd_a);}else if(vd_h._t===vdConst.vdLine_code){vd_AM(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdInsert_code){if(vd_h.AlignToViewSize&&vd_hh==null&& !vd_h.BoundingBox&&vd_m.vd_bR()!=vdConst.vd_cq){vd_cR.clear();vd_bx(vd_h,vd_cR,vd_a);vd_h.BoundingBox=vd_cR.vd_gu.vd_gl();}vd_AV(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdPolyface_code){vd_zw(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vd3DFace_code){vd_Bl(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdText_code){vd_lQ(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdAttribDef_code&&vd_h.InVisibleMode!==true){if(vd_hh!=null){if(vd_h.IsConstant==true){var str=vd_h.TextString;vd_h.TextString=vd_h.ValueString;vd_lQ(vd_h,vd_m,vd_a);vd_h.TextString=str;}}else{vd_lQ(vd_h,vd_m,vd_a);}}else if(vd_h._t===vdConst.vdAttrib_code){if(vd_h.IsConstant!=true&&vd_h.InVisibleMode!==true)vd_lQ(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdPolyline_code){vd_Es(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdRect_code){vd_AX(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdImage_code){vd_zS(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdCircle_code){vd_zf(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdArc_code){vd_Az(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdEllipse_code){vd_zH(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdPolyhatch_code){vd_AE(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdInfinityLine_code){vd_zM(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdPoint_code){vd_Am(vd_h,vd_m,vd_a);}else if(vd_h._t===vdConst.vdViewport_code){vd_CC(vd_h,vd_m,vd_a);}vd_m.vd_rk(null);if(!vd_m.vd_mK()){vd_m.vd_mz(highlight);vd_m.vd_re(lt);vd_m.vd_px(ltscale);vd_m.vd_aK(pw);}vd_m.vd_aC(col);if(vd_h.selected&& !vd_m.vd_mK()&&vd_m.vd_bR()!=vdConst.vd_cq){vd_m.vd_mn(vdConst.ActionHighLightColor);vd_bx(vd_h,vd_m,vd_a);vd_m.vd_pp();}if(vd_hh==null&& !vd_h.BoundingBox&&vd_m.vd_bR()!=vdConst.vd_cq){vd_cR.clear();vd_bx(vd_h,vd_cR,vd_a);vd_h.BoundingBox=vd_cR.vd_gu.vd_gl();}};function vd_nI(vd_dq,vd_fF,vd_m,vd_a){if(!vd_m.vd_bN||vd_m.vd_bR()==vdConst.vd_cq){vd_iu(vd_dq,vd_fF,vd_m,vd_a,true);return;}vd_m.vd_lH(1);vd_iu(vd_dq,vd_fF,vd_m,vd_a,true);if(vd_m.vd_qq){vd_m.vd_lH(2);vd_iu(vd_dq,vd_fF,vd_m,vd_a,true);}vd_m.vd_lH(3);};function vd_iu(vd_dq,vd_fF,vd_m,vd_a,vd_kj){if(vd_dq==undefined||vd_dq.Items==undefined||vd_dq.Items.length==undefined)return;var k=0;for(k=0;k<vd_dq.Items.length;k++){vd_Cf(vd_dq,vd_fF,vd_m,vd_a,k,vd_kj);}};function vd_Cf(vd_dq,vd_fF,vd_m,vd_a,i,vd_kj){vd_fF=vd_fF||(typeof vd_dq.Items[i]=='string');if(vd_fF)vd_bx(vd_L.GetEntityItem(vd_dq.Items[i]),vd_m,vd_a,i,vd_kj);else{vd_bx(vd_dq.Items[i],vd_m,vd_a,i,vd_kj);}};function vd_BI(vd_H,vd_A,vd_S){if(!vd_H)return;for(var i=vd_H[0].length-1;i>=0;i--){var pos=i;var vd_h=vd_H[0][pos];if(!vd_h)return;if(vd_h._t===vdConst.vdLine_code){vd_BT(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdInsert_code){vd_qj(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdPolyface_code){vd_CJ(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vd3DFace_code){vd_Ci(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdText_code){vd_qj(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdAttrib_code){vd_qj(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdPolyline_code){vd_Cs(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdRect_code){vd_yT(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdImage_code){vd_yT(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdCircle_code){vd_Ch(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdArc_code){vd_Cw(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdEllipse_code){vd_CA(pos,vd_H,vd_A,vd_S);}else if(vd_h._t===vdConst.vdPoint_code){vd_BB(pos,vd_H,vd_A,vd_S);}if(vd_S.length>vdConst.OsnapMaxItems)break;}};function vd_p(pos,vd_H,pt){var ret=vdgeo.newpoint(pt[X],pt[Y],pt[Z]);for(var i=pos;i>=0;i--){if(!vd_H[0][i].EcsMatrix)continue;vdgeo.vd_pK(vd_H[0][i].EcsMatrix,ret[X],ret[Y],ret[Z],ret);}vdgeo.vd_pK(vd_F.vd_bt(),ret[X],ret[Y],ret[Z],ret);return ret;};function vd_BT(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,vd_h.StartPoint);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,vd_h.EndPoint);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){pt=vd_p(pos,vd_H,vdgeo.MidPoint(vd_h.StartPoint,vd_h.EndPoint));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_Cs(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];if(vd_h.SPlineFlag&&vd_h.SPlineFlag!==vdConst.SplineFlagSTANDARD)return;var pt;var vd_dT=vd_H[1];if(vd_dT!==undefined){var sp=vd_h.VertexList.Items[vd_dT];var ep;if(vd_dT>=vd_h.VertexList.Items.length-1)ep=vd_h.VertexList.Items[0];else ep=vd_h.VertexList.Items[vd_dT+1];if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,sp);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,ep);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){var success=vdgeo.Bulge2Arc(sp,ep);if(!success){pt=vd_p(pos,vd_H,vdgeo.MidPoint(sp,ep));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}else{var Center=success[0];var radius=success[1];var vd_dH=success[2];var vd_dg=success[3];pt=vd_p(pos,vd_H,vdgeo.pointPolar(Center,vd_dH+vdgeo.FixAngle(vd_dg-vd_dH)*0.5,radius));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}}}};function vd_CJ(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;var vd_dT=vd_H[1];if(vd_dT===undefined)return;var pos4=vd_dT%5;var sp=vd_h.VertexList.Items[Math.abs(vd_h.FaceList.Items[vd_dT])-1];var ep;if(pos4==3)ep=vd_h.VertexList.Items[Math.abs(vd_h.FaceList.Items[vd_dT-3])-1];else ep=vd_h.VertexList.Items[Math.abs(vd_h.FaceList.Items[vd_dT+1])-1];if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,sp);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,ep);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){pt=vd_p(pos,vd_H,vdgeo.MidPoint(sp,ep));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_Ci(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;var p0=vd_h.VertexList.Items[0],p1=vd_h.VertexList.Items[1],p2=vd_h.VertexList.Items[2],p3=vd_h.VertexList.Items[3];if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,p0);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,p1);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,p2);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,p3);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){pt=vd_p(pos,vd_H,vdgeo.MidPoint(p0,p1));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_p(pos,vd_H,vdgeo.MidPoint(p1,p2));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_p(pos,vd_H,vdgeo.MidPoint(p2,p3));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_p(pos,vd_H,vdgeo.MidPoint(p3,p0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_yT(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;var p0=vdgeo.newpoint(0,0,0),p1=vdgeo.newpoint(vd_h.Width,0,0),p2=vdgeo.newpoint(vd_h.Width,vd_h.Height,0),p3=vdgeo.newpoint(0,vd_h.Height,0);if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,p0);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,p1);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,p2);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,p3);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){pt=vd_p(pos,vd_H,vdgeo.MidPoint(p0,p1));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_p(pos,vd_H,vdgeo.MidPoint(p1,p2));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_p(pos,vd_H,vdgeo.MidPoint(p2,p3));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);pt=vd_p(pos,vd_H,vdgeo.MidPoint(p3,p0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}if((vd_A&vdConst.OsnapMode_INS)){pt=vd_p(pos,vd_H,p0);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_INS]);}};function vd_Ch(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;if((vd_A&vdConst.OsnapMode_CEN)){pt=vd_p(pos,vd_H,vdgeo.newpoint(0,0,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}if((vd_A&vdConst.OsnapMode_QUA)){pt=vd_p(pos,vd_H,vdgeo.newpoint(vd_h.Radius,0,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);pt=vd_p(pos,vd_H,vdgeo.newpoint(0,vd_h.Radius,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);pt=vd_p(pos,vd_H,vdgeo.newpoint(-vd_h.Radius,0,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);pt=vd_p(pos,vd_H,vdgeo.newpoint(0,-vd_h.Radius,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_QUA]);}};function vd_Cw(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;var Center=vdgeo.newpoint(0,0,0);if((vd_A&vdConst.OsnapMode_CEN)){pt=vd_p(pos,vd_H,Center);vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,vdgeo.pointPolar(Center,vd_h.StartAngle,vd_h.Radius));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,vdgeo.pointPolar(Center,vd_h.EndAngle,vd_h.Radius));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){pt=vd_p(pos,vd_H,vdgeo.pointPolar(Center,vd_h.StartAngle+vdgeo.FixAngle(vd_h.EndAngle-vd_h.StartAngle)*0.5,vd_h.Radius));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_CA(pos,vd_H,vd_A,vd_S){var vd_h=vd_H[0][pos];var pt;if((vd_A&vdConst.OsnapMode_CEN)){pt=vd_p(pos,vd_H,vdgeo.newpoint(0,0,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_CEN]);}if((vd_A&vdConst.OsnapMode_END)){pt=vd_p(pos,vd_H,vdgeo.vd_oc(vd_h.StartAngle,vd_h.MajorLength,vd_h.MinorLength));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);pt=vd_p(pos,vd_H,vdgeo.vd_oc(vd_h.EndAngle,vd_h.MajorLength,vd_h.MinorLength));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_END]);}if((vd_A&vdConst.OsnapMode_MID)){pt=vd_p(pos,vd_H,vdgeo.vd_oc(vd_h.StartAngle+vdgeo.FixAngle(vd_h.EndAngle-vd_h.StartAngle)*0.5,vd_h.MajorLength,vd_h.MinorLength));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_MID]);}};function vd_BB(pos,vd_H,vd_A,vd_S){var pt;if((vd_A&vdConst.OsnapMode_NODE)){pt=vd_p(pos,vd_H,vdgeo.newpoint(0,0,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_NODE]);}};function vd_qj(pos,vd_H,vd_A,vd_S){var pt;if((vd_A&vdConst.OsnapMode_INS)){pt=vd_p(pos,vd_H,vdgeo.newpoint(0,0,0));vd_S.push([pt[X],pt[Y],pt[Z],vdConst.OsnapMode_INS]);}};this.SetOsnapMode=function(mode){var vd_a=vd_x();if(vd_a==null)return;vd_a.vd_fn=mode;};this.GetOsnapMode=function(){var vd_a=vd_x();if(vd_a==null)return vdConst.OsnapMode_NONE;if(!vd_a.vd_fn)return vdConst.OsnapMode_NONE;var ret=vd_a.vd_fn;return ret;};this.vd_FP=function(){var vd_a=vd_x();if(vd_a==null)return true;return(vd_a.vd_fn&&(vd_a.vd_fn&vdConst.OsnapMode_DISABLE));};this.EnableOsnapMode=function(bval){var vd_a=vd_x();if(vd_a==null)return;if(!vd_a.vd_fn)vd_a.vd_fn=vdConst.OsnapMode_NONE;if((vd_a.vd_fn&vdConst.OsnapMode_DISABLE))vd_a.vd_fn^=vdConst.OsnapMode_DISABLE;if(!bval)vd_a.vd_fn|=vdConst.OsnapMode_DISABLE;};this.vd_FL=function(x,y,vd_js,vd_cm){var vd_A=vd_L.GetOsnapMode();if(vd_A==vdConst.OsnapMode_NONE)return null;if(vd_A&vdConst.OsnapMode_DISABLE)return null;if(vd_F.vd_bs())return null;if(!vd_F.vd_bG|| !vd_F.vd_y.vd_fG||vd_F.vd_y.vd_fG.length===0)return null;x=vdgeo.vd_R(x);y=vdgeo.vd_R(y);if(x<0||x>=vd_F.width)return null;if(y<0||y>=vd_F.height)return null;var vd_uT=vdgeo.vd_ax(x,y,0,vd_F.vd_bI);if(!vd_js)vd_js=vd_L.PickSize;if(!vd_cm)vd_cm=vd_L.IgnoreLockLayers;var vd_eQ=Math.max(vdgeo.vd_R(vd_js*0.5),1);var vd_gr=[];var vd_S=[];var vd_dR=null;if((vd_A&vdConst.OsnapMode_NEA))vd_dR=[0,0,0,0];var px,py;for(var p=0;p<vd_eQ;p++){for(var ix= -p;ix<=p;ix++){px=x+ix;py=y-p;vd_oz(px,py,vd_A,vd_S,vd_gr,vd_dR,vd_cm);py=y+p;vd_oz(px,py,vd_A,vd_S,vd_gr,vd_dR,vd_cm);}for(var iy= -p+1;iy<p;iy++){px=x-p;py=y+iy;vd_oz(px,py,vd_A,vd_S,vd_gr,vd_dR,vd_cm);px=x+p;py=y+iy;vd_oz(px,py,vd_A,vd_S,vd_gr,vd_dR,vd_cm);}}vd_gr.length=0;if(vd_S.length>0){vd_S.sort(function(a,b){return vdgeo.Distance2D(a,vd_uT)-vdgeo.Distance2D(b,vd_uT);});if(vd_dR&&vd_dR[3]===vdConst.OsnapMode_NEA){var vd_ix=vdgeo.vd_ax(vd_S[0][X],vd_S[0][Y],vd_S[0][Z],vd_F.vd_aH);if(vd_ix[X]<x-vd_eQ||vd_ix[X]>x+vd_eQ||vd_ix[Y]<y-vd_eQ||vd_ix[Y]>y+vd_eQ){return vd_dR;}}return vd_S[0];}if(vd_dR&&vd_dR[3]===vdConst.OsnapMode_NEA)return vd_dR;return null;};function vd_oz(px,py,vd_A,vd_S,vd_gr,vd_dR,vd_cm){var c=0;if(px<0||px>=vd_F.width||py<0||py>=vd_F.height)return;var ipos=py*vd_F.width+px;var ret=vd_F.vd_y.vd_fG[ipos];if(vd_dR&&vd_dR[3]==0&&vd_F.vd_y.vd_cn[ipos]!=undefined&&vd_F.vd_y.vd_cn[ipos].length>0){var z=vd_F.vd_y.vd_mY(px,py);var pt=vdgeo.vd_ax(px,py,z,vd_F.vd_bI);vd_dR[X]=pt[X];vd_dR[Y]=pt[Y];vd_dR[Z]=pt[Z];vd_dR[3]=vdConst.OsnapMode_NEA;}if(!ret)return;if(vd_Fr(vd_gr,ret))return;vd_gr.push(ret);vd_BI(ret,vd_A,vd_S);};function vd_Fr(arr,obj){for(var i=0;i<arr.length;i++){if(arr[i][0].length===obj[0].length&&arr[i][1]===obj[1]&&arr[i][0][arr[i][0].length-1]==obj[0][obj[0].length-1])return true;}return false;};function vd_nZ(layout){if(layout==null)return null;if(layout.BoundingBox)return layout.BoundingBox;vd_cR.clear();vd_nI(layout.Entities,true,vd_cR,vd_x());layout.BoundingBox=vd_cR.vd_gu.vd_gl();return layout.BoundingBox;};this.GetExtents=function(){return vd_nZ(vd_L.GetActiveLayout());};var vd_pZ=true;this.EnableRedraw=function(vd_tk){var ret=vd_pZ;vd_pZ=vd_tk;return ret;};var vd_dO=0;this.redraw=function(vd_oX,vd_FS){if(!vd_pZ)return;if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=null;var t1_0,t1_1;t1_0=new Date().getTime();var vd_a=vd_x();var layout=vd_L.GetActiveLayout();vd_eb(layout,vd_oX);vd_F.vd_y.vd_fa=true;if(vd_a!=null){vd_F.vd_kT(vd_a.Palette,layout.BkColorEx);}vd_F.clear();if(vd_a!=null&& !vd_FS){var vd_jH=vd_F.vd_gv(layout.ShowHidenEdges);vd_nI(layout.Entities,true,vd_F,vd_a);vd_F.vd_gv(vd_jH);}vd_L.Refresh();vd_F.vd_y.vd_sX();vd_la=null;t1_1=new Date().getTime();vd_dO=t1_1-t1_0;vd_Ek();};this.GetXREFS=function(){if(!vd_nU())return[];if(!vd_nU().vd_jn)vd_nU().vd_jn=[];return vd_nU().vd_jn;};function vd_EN(vd_wP,vd_Ar,vd_ta,blockref){var vd_L=this;this.target=vd_wP;this.Block=blockref;this.KeyFile=vd_Ar;this.OriginalSingleFileName=vdConst.vd_xd(vd_ta);this.OriginalPath=vd_ta;this.UrlPath=vd_ta;this.documentdata=new vd_ut(vd_wP);this.Cancel=false;this.load=function(){if(vd_L.documentdata&& !vd_L.documentdata.vd_K&&vd_L.documentdata.vd_jD==""){if(vd_L.target.vdLoadXref)vd_L.target.vdLoadXref(vd_L);if(!vd_L.Cancel){setTimeout(vd_L.target.vd_qo(vd_L.documentdata,vd_L.UrlPath,false,function(){vd_L.target.UpdateLayout();setTimeout(vd_L.target.redraw,0);if(vd_L.target.vdXrefLoaded)vd_L.target.vdXrefLoaded(vd_L);}),0);return true;}}return false;};return this;};function vd_Ek(){var vd_cb=vd_L.GetXREFS();for(var idoc=0;idoc<vd_cb.length;idoc++){if(vd_cb[idoc].load())return;}};function vd_uw(){vd_L.canvas.title="";};function vd_CM(vd_nM,vd_ox){var vd_P=Math.max(vd_ox[X],vd_nM[X]);var vd_W=Math.min(vd_ox[X],vd_nM[X]);var vd_u=Math.max(vd_ox[Y],vd_nM[Y]);var vd_O=Math.min(vd_ox[Y],vd_nM[Y]);var w=vd_P-vd_W;var h=vd_u-vd_O;var l1=vd_F.width/w;var l2=vd_F.height/h;var l=Math.min(l1,l2);return(vd_F.height/l);};this.zoomwindow=function(np1,np2,vd_GA){var layout=vd_L.GetActiveLayout();if(layout==null)return;var p1=vdgeo.newpoint(np1[X],np1[Y],np1[Z]);var p2=vdgeo.newpoint(np2[X],np2[Y],np2[Z]);var vd_bM=vdgeo.vd_cw(layout.World2ViewMatrix);if(!vd_GA){if(vd_F.vd_bA&&vd_F.vd_bN){var _p1=vdgeo.vd_ax(p1[X],p1[Y],p1[Z],vd_F.vd_aH);var _p2=vdgeo.vd_ax(p2[X],p2[Y],p2[Z],vd_F.vd_aH);if(vd_F.vd_wY(_p1[X],_p1[Y])&&vd_F.vd_wY(_p2[X],_p2[Y])){var z=vd_F.vd_y.vd_FI(_p1[X],_p2[X],_p1[Y],_p2[Y]);p1=vdgeo.vd_ax(_p1[X],_p1[Y],z,vd_F.vd_bI);p2=vdgeo.vd_ax(_p2[X],_p2[Y],z,vd_F.vd_bI);vd_bM=vdgeo.vd_cw(vd_F.vd_bt());}}}var vd_r=vdgeo.MidPoint(p1,p2);var vd_gj,vd_lt,vd_if,vd_lV,vd_ke;var vd_jM=Math.abs(p2[X]-p1[X]);var vd_kY=Math.abs(p2[Y]-p1[Y]);var vd_iB=0;var vd_fQ=vd_L.canvas.width/vd_L.canvas.height;if(!layout.FocalLength)layout.FocalLength=0.05;if(!layout.LensAngle)layout.LensAngle=60.0;if(vd_jM/vd_kY<vd_fQ){vd_gj=vdgeo.DegreesToRadians(layout.LensAngle)/2;vd_lt=vd_kY/2;vd_iB=vd_lt/Math.tan(vd_gj);}else{vd_if=2.0*layout.FocalLength*Math.tan(vdgeo.DegreesToRadians(layout.LensAngle/2.0));vd_lV=vdgeo.RadiansToDegrees(Math.atan(vd_if*vd_fQ*0.5/layout.FocalLength))*2.0;vd_gj=vdgeo.DegreesToRadians(vd_lV)/2;vd_ke=vd_jM/2;vd_iB=vd_ke/Math.tan(vd_gj);}vd_r[Z]=Math.max(p1[Z],p2[Z])+vd_iB;var vd_v=vd_CM(p1,p2);var vd_s=new vd_jS(vd_L,vd_r[X],vd_r[Y],vd_r[Z],vd_v,vd_bM);if(vd_L.vdUpdateView!=null)vd_L.vdUpdateView(vd_s);if(!vd_s.Cancel){layout.ViewSize=vd_s.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_s.ViewCenterX,vd_s.ViewCenterY,vd_s.ViewCenterZ);layout.World2ViewMatrix=vd_s.vd_pr;vd_eb(layout);}};this.zoomExtents=function(){var layout=vd_L.GetActiveLayout();if(layout==null)return;var vd_ls=vd_L.GetExtents();if(vd_ls==null)return;var box=vdgeo.vd_qP(layout.World2ViewMatrix,vd_ls);var bmin=vdgeo.newpoint(box[0],box[1],box[2]);var bmax=vdgeo.newpoint(box[3],box[4],box[5]);vd_L.zoomwindow(bmin,bmax,true);};this.SetStdView=function(vd_fL){var layout=vd_L.GetActiveLayout();if(layout==null)return;var vd_dK=vdgeo.newpoint(0.0,0.0,1.0);if(vd_fL===vdConst.StdView_TOP){vd_dK=vdgeo.newpoint(0.0,0.0,1.0);}else if(vd_fL===vdConst.StdView_BOTTOM){vd_dK=vdgeo.newpoint(0.0,0.0,-1.0);}else if(vd_fL===vdConst.StdView_FRONT){vd_dK=vdgeo.newpoint(0.0,-1.0,0.0);}else if(vd_fL===vdConst.StdView_BACK){vd_dK=vdgeo.newpoint(0.0,1.0,0.0);}else if(vd_fL===vdConst.StdView_LEFT){vd_dK=vdgeo.newpoint(-1.0,0.0,0.0);}else if(vd_fL===vdConst.StdView_RIGHT){vd_dK=vdgeo.newpoint(1.0,0.0,0.0);}else if(vd_fL===vdConst.StdView_ISO_NE){vd_dK=vdgeo.newpoint(1.0,1.0,1.0);}else if(vd_fL===vdConst.StdView_ISO_NW){vd_dK=vdgeo.newpoint(-1.0,1.0,1.0);}else if(vd_fL===vdConst.StdView_ISO_SE){vd_dK=vdgeo.newpoint(1.0,-1.0,1.0);}else if(vd_fL===vdConst.StdView_ISO_SW){vd_dK=vdgeo.newpoint(-1.0,-1.0,1.0);}var mat=vdgeo.vd_l();vdgeo.vd_jc(mat,vd_dK);layout.World2ViewMatrix=mat;vd_L.zoomExtents();};this.LookAt=function(vd_nR,vd_xp,vd_yn){var mat=vdgeo.vd_l();vdgeo.vd_af(mat,vd_yn);var vd_dK=vdgeo.VectorDirection(vd_xp,vd_nR);vdgeo.vd_aG(mat,vd_dK);vdgeo.vd_Y(mat,vd_nR[X],vd_nR[Y],vd_nR[Z]);vdgeo.vd_hR(mat);var layout=vd_L.GetActiveLayout();layout.ViewCenter=vdgeo.newpoint(0,0,0);layout.World2ViewMatrix=mat;vd_eb(layout);if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=setTimeout(vd_L.redraw,0);};function vd_sy(v,normalize){var layout=vd_L.GetActiveLayout();if(!layout)return null;var vd_bM=layout.World2ViewMatrix;var v2w=vdgeo.vd_bc(vd_bM);var newV=vdgeo.vd_jh(v2w,v[0],v[1],v[2],normalize);return newV;};this.MoveView=function(dx,dy,dz){if(dx===0&&dy===0&&dz===0)return;var origin=vd_L.ViewToWorld(vdgeo.newpoint(0,0,0));var dir,vd_kI,toPt;dir=vd_sy(vdgeo.newpoint(0,0,-1),true);v=vd_sy(vdgeo.newpoint(dx,dy,dz),false);if(!dir|| !v)return;vd_kI=vdgeo.newpoint(origin[X]+v[X],origin[Y]+v[Y],origin[Z]+v[Z]);toPt=vdgeo.newpoint(vd_kI[X]+dir[X],vd_kI[Y]+dir[Y],vd_kI[Z]+dir[Z]);vd_L.LookAt(vd_kI,toPt,0);};this.RotateView=function(vd_HV,vd_ym){var pt=vdgeo.newpoint(0,0,0);var vd_lA=vd_sy([0,0,-1],true);var vd_xN=vdgeo.GetAngle(pt,vd_lA);var vd_xv=Math.sqrt(vd_lA[X]*vd_lA[X]+vd_lA[Y]*vd_lA[Y]);var vd_zr=vdgeo.GetAngle(pt,[vd_xv,vd_lA[Z],0]);var dir=vdgeo.pointPolar(pt,vd_HV+vd_xN,1);var vd_gV=vd_ym+vd_zr;if(vd_gV>vdgeo.PI)vd_gV=vd_gV-vdgeo.VD_TWOPI;vd_gV=Math.min(vd_gV,vdgeo.HALF_PI*0.95);vd_gV=Math.max(vd_gV,-vdgeo.HALF_PI*0.95);dir[Z]=Math.tan(vd_gV);vdgeo.vd_cD(dir);var origin=vd_L.ViewToWorld(pt);var dest=vdgeo.newpoint(origin[X]+dir[X],origin[Y]+dir[Y],origin[Z]+dir[Z]);vd_L.LookAt(origin,dest,0);};this.SetViewAngles=function(vd_Av,tilt,vd_zK,origin){var layout=vd_L.GetActiveLayout();if(!layout.ViewCenter)layout.ViewCenter=vdgeo.newpoint(0,0,0);var vd_ru=vdgeo.vd_bc(layout.World2ViewMatrix);if(!origin)origin=vdgeo.vd_M(vd_ru,layout.ViewCenter);origin=vdgeo.vd_M(layout.World2ViewMatrix,origin);var mat=vdgeo.vd_l();vdgeo.vd_fD(mat);vdgeo.vd_Ez(mat,tilt);vdgeo.vd_af(mat,vdgeo.PI+vd_Av);vdgeo.vd_aM(mat,-1,-1,-1);var dir=vdgeo.vd_jh(mat,1,0,0,true);vdgeo.vd_fD(mat);vdgeo.vd_jc(mat,dir);vdgeo.vd_af(mat,vdgeo.VD_TWOPI-vd_zK);layout.ViewCenter=origin;layout.World2ViewMatrix=mat;vd_eb(layout);if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=setTimeout(vd_L.redraw,0);};var vd_xb=100;this.SetBlockSize=function(value){vd_xb=value;};this.vd_uq=function(){return Math.max(20,vd_xb);};this.SetRenderMode=function(mode){var layout=vd_L.GetActiveLayout();if(!layout)return;var vd_a=vd_x();if(vd_a.Model==layout){vd_L.EnableWebGL(mode==vdConst.RENDERMODE_SHADE_GL||mode==vdConst.RENDERMODE_RENDER_GL);}if(mode==vdConst.RENDERMODE_SHADE_GL)layout.RenderMode=vdConst.RENDERMODE_SHADE;else if(mode==vdConst.RENDERMODE_RENDER_GL)layout.RenderMode=vdConst.RENDERMODE_RENDER;else layout.RenderMode=mode;if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=setTimeout(vd_L.redraw,0);};this.vd_lg=false;this.EnableWebGL=function(value){vd_L.vd_lg=value;};this.WebGLisActive=function(value){return vd_F.vd_bs();};this.GetViewBox=function(){if(vd_x()==null)return null;return{left:vd_F.vd_au.left,bottom:vd_F.vd_au.bottom,right:vd_F.vd_au.right,top:vd_F.vd_au.top};};this.GetPixelSize=function(){if(vd_x()==null)return 0.0;return vd_F.GetPixelSize();};this.vd_uZ=function(from,tox,toy,vd_cL){var layout=vd_L.GetActiveLayout();if(layout==null)return;var vd_lb=from[X];var vd_kJ=from[Y];var vd_jK=from[Z];var x=tox-vd_lb;var y=toy-vd_kJ;if(x==0&&y==0)return;var vd_r=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);var vd_v=layout.ViewSize;var vd_ps=vdgeo.vd_cw(layout.World2ViewMatrix);var vd_cI=vd_F.vd_y.vd_cI;var zFar=vd_F.vd_y.zFar;var org=vdgeo.vd_ax(vd_lb,vd_kJ,vd_jK,vd_F.vd_bI);if(vd_F.vd_bA&&vd_F.vd_bN){if(vd_cI<0)org=vdgeo.newpoint(vd_r[X],vd_r[Y],vd_r[Z]);else org=vdgeo.newpoint(org[X]+vd_r[X],org[Y]+vd_r[Y],org[Z]+vd_r[Z]);}if(vd_dd){if(!vd_dd.vd_rc){vd_dd.vd_rc=[vd_ps,org];}else{org=vd_dd.vd_rc[1];vd_ps=vd_dd.vd_rc[0];}}var vd_yr=1;var dz=vd_yr*vdgeo.VD_TWOPI*0.5*x/vd_F.width;var dx=vd_yr*vdgeo.PI*0.5*y/vd_F.height;var v=vdgeo.vd_jh(vd_ps,0,0,1,true);var vd_bM;vd_bM=vdgeo.vd_l();vdgeo.vd_fx(vd_bM,vd_ps);vdgeo.vd_Y(vd_bM,-org[X],-org[Y],-org[Z]);vdgeo.vd_Dv(vd_bM,v,dz);vdgeo.vd_Dw(vd_bM,dx);vdgeo.vd_Y(vd_bM,org[X],org[Y],org[Z]);var vd_s=new vd_jS(vd_L,vd_r[X],vd_r[Y],vd_r[Z],vd_v,vd_bM);if(vd_L.vdUpdateView!=null)vd_L.vdUpdateView(vd_s);if(!vd_s.Cancel){layout.ViewSize=vd_s.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_s.ViewCenterX,vd_s.ViewCenterY,vd_s.ViewCenterZ);layout.World2ViewMatrix=vd_s.vd_pr;vd_eb(layout);if(vd_cL!=undefined&&vd_cL>=0){if(vd_cL===0)vd_L.redraw();else vd_nC(vd_kW,vd_sI);}}};this.scroll=function(from,tox,toy,vd_cL){var layout=vd_L.GetActiveLayout();if(layout==null)return;var vd_lb=from[X];var vd_kJ=from[Y];var vd_jK=from[Z];var x=tox-vd_lb;var y=toy-vd_kJ;if(x==0&&y==0)return;vd_xo(vd_jK);var vd_bM=vdgeo.vd_cw(layout.World2ViewMatrix);var vd_v=layout.ViewSize;var vd_r=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);if(vd_F.vd_bA&&vd_F.vd_bN){var z=vd_jK;var fv=vdgeo.vd_ax(vd_lb,vd_kJ,z,vd_F.vd_bI);var tv=vdgeo.vd_ax(tox,toy,z,vd_F.vd_bI);var dx=tv[X]-fv[X];var dy=tv[Y]-fv[Y];vd_r[X]-=dx;vd_r[Y]-=dy;}else{vd_r[X]-=vd_F.GetPixelSize()*x;vd_r[Y]+=vd_F.GetPixelSize()*y;}var vd_s=new vd_jS(vd_L,vd_r[X],vd_r[Y],vd_r[Z],vd_v,vd_bM);if(vd_L.vdUpdateView!=null)vd_L.vdUpdateView(vd_s);if(!vd_s.Cancel){layout.ViewSize=vd_s.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_s.ViewCenterX,vd_s.ViewCenterY,vd_s.ViewCenterZ);layout.World2ViewMatrix=vd_s.vd_pr;vd_eb(layout);if(vd_cL!=undefined&&vd_cL>=0){if(vd_cL===0)vd_L.redraw();else vd_xk(vd_cL);}vd_dd=[vdgeo.vd_R(tox),vdgeo.vd_R(toy),vd_jK];}};this.zoomScale=function(x,y,Delta,vd_cL){if(Delta==0||Delta==1)return;var layout=vd_L.GetActiveLayout();if(layout==null)return;vd_xo(vd_F.vd_y.vd_mY(x,y));var vd_bM=vdgeo.vd_cw(layout.World2ViewMatrix);var vd_v=vd_F.vd_v;var vd_r=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);if(vd_F.vd_bA&&vd_F.vd_bN){var vd_cI=vd_F.vd_y.vd_cI;var zFar=vd_F.vd_y.zFar;var vd_kk=Math.abs(zFar);var vd_DY=Math.abs(vd_cI-zFar)*0.05;var z=vd_la[1];var fv=vdgeo.vd_ax(x,y,z,vd_F.vd_bI);if(z!=1.0){vd_kk=Math.abs(fv[Z]);}vd_kk=Math.max(vd_DY,vd_kk);vd_kk*=(1-Delta);var pp=vdgeo.vd_ax(fv[X],fv[Y],fv[Z]+vd_kk,vd_F.vd_aH);var tv=vdgeo.vd_ax(pp[X],pp[Y],z,vd_F.vd_bI);var dx=tv[X]-fv[X];var dy=tv[Y]-fv[Y];vd_r[X]+=dx;vd_r[Y]+=dy;vd_r[Z]-=vd_kk;}else{vd_v*=Delta;var vd_vR=vdgeo.vd_M(vd_F.vd_bI,vdgeo.newpoint(x,y,0));var vd_ad=vd_v/vd_F.height;if(x!=undefined&&y!=undefined)vd_r=vdgeo.newpoint(vd_vR[X]+(vd_F.width/2.0-x)*vd_ad,vd_vR[Y]+(y-vd_F.height/2.0)*vd_ad,vd_r[Z]);}var vd_s=new vd_jS(vd_L,vd_r[X],vd_r[Y],vd_r[Z],vd_v,vd_bM);if(vd_L.vdUpdateView!=null)vd_L.vdUpdateView(vd_s);if(!vd_s.Cancel){layout.ViewSize=vd_s.ViewSize;layout.ViewCenter=vdgeo.newpoint(vd_s.ViewCenterX,vd_s.ViewCenterY,vd_s.ViewCenterZ);layout.World2ViewMatrix=vd_s.vd_pr;vd_eb(layout);if(vd_cL==undefined||vd_cL<0)return;else if(vd_cL===0)vd_L.redraw();else vd_xk(vd_cL);}};this.vd_zY=function(vd_gZ,vd_fl,pos1,pos2,vd_qu){if((vd_qu&(vdConst.DEFAULT_ZOOMSCALE|vdConst.DEFAULT_ROTATE3D))==0)return;var vd_pH=vd_gZ[X]-vd_fl[X];var vd_qc=vd_gZ[Y]-vd_fl[Y];var dx=pos1[X]-pos2[X];var dy=pos1[Y]-pos2[Y];var vd_ze=(vd_gZ[X]+vd_fl[X])/2;var vd_yb=(vd_gZ[Y]+vd_fl[Y])/2;var vd_Cz=Math.sqrt(vd_pH*vd_pH+vd_qc*vd_qc);var vd_zt=Math.sqrt(dx*dx+dy*dy);var scale=vd_Cz/vd_zt;var vd_fH=vdgeo.newpoint(vd_ze,vd_yb,0);var vd_wv=vdgeo.vd_ax(pos1[X],pos1[Y],1,vd_F.vd_bI);var vd_vQ=vdgeo.vd_ax(pos2[X],pos2[Y],1,vd_F.vd_bI);var vd_ol=vdgeo.vd_ax(vd_gZ[X],vd_gZ[Y],1,vd_F.vd_bI);var vd_nL=vdgeo.vd_ax(vd_fl[X],vd_fl[Y],1,vd_F.vd_bI);var dx1=vd_ol[X]-vd_wv[X];var dy1=vd_ol[Y]-vd_wv[Y];var dx2=vd_nL[X]-vd_vQ[X];var dy2=vd_nL[Y]-vd_vQ[Y];var vd_CQ=Math.sqrt(dx1*dx1+dy1*dy1);var vd_By=Math.sqrt(dx2*dx2+dy2*dy2);var vd_oB=Math.atan2(vd_qc,vd_pH);var vd_oG=Math.atan2(dy,dx);vd_fH=vdgeo.newpoint((vd_ol[X]+vd_nL[X])/2,(vd_ol[Y]+vd_nL[Y])/2,0);if(vd_CQ<vd_By){vd_oB+=vdgeo.PI;vd_oG+=vdgeo.PI;}vd_oB=vdgeo.FixAngle(vd_oB);vd_oG=vdgeo.FixAngle(vd_oG);var rot=vdgeo.FixAngle(vd_oG-vd_oB);var layout=vd_L.GetActiveLayout();var vd_bM=vdgeo.vd_cw(layout.World2ViewMatrix);if((vd_qu&vdConst.DEFAULT_ROTATE3D)){vdgeo.vd_Y(vd_bM,-vd_fH[X],-vd_fH[Y],-vd_fH[Z]);vdgeo.vd_af(vd_bM,-rot);vdgeo.vd_Y(vd_bM,vd_fH[X],vd_fH[Y],vd_fH[Z]);}var vd_v=layout.ViewSize;var vd_r=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);if((vd_qu&vdConst.DEFAULT_ZOOMSCALE)){vd_v=layout.ViewSize*scale;var angle=vdgeo.GetAngle(vd_fH,layout.ViewCenter);var dist=vdgeo.Distance2D(vd_fH,layout.ViewCenter)*scale;vd_r=vdgeo.pointPolar(vd_fH,angle,dist);}var vd_s=new vd_jS(vd_L,vd_r[X],vd_r[Y],vd_r[Z],vd_v,vd_bM);if(vd_L.vdUpdateView!=null)vd_L.vdUpdateView(vd_s);if(!vd_s.Cancel){layout.World2ViewMatrix=vd_bM;layout.ViewSize=vd_v;layout.ViewCenter=vd_r;vd_eb(layout);vd_nC(vd_kW,vd_sI);}};var vd_aX=null;function vd_sI(){if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=null;var vd_a=vd_x();if(!vd_a)return;var layout=vd_L.GetActiveLayout();if(!layout)return;var vd_fY=vd_F.vd_bG;if(vd_F.vd_bs()){if(vd_dO>vd_oh){vd_F.vd_bG=false;}vd_L.redraw(true);var vd_lI=vd_F.vd_bG!=vd_fY;vd_F.vd_bG=vd_fY;if(vd_lI)setTimeout(vd_L.redraw,Math.max(vd_mH,vd_dO));return;}var vd_uS=vd_F.vd_aQ;var vd_An=vd_F.vd_eK;var vd_tr=vd_F.RenderMode;var vd_tT=vd_F.vd_bN;var vd_Ab=vd_L.GetImageInterpolationMode();if(vd_dO>vd_oh){vd_L.SetImageInterpolationMode(vdConst.InterpolationMode_Nearest);vd_F.vd_bG=false;if(!vd_F.vd_bs()){if(vd_dO>vd_oh){vd_F.vd_aQ=false;if(vd_dO>vd_Ac){vd_F.RenderMode=vdConst.vd_pB;}}}}vd_L.redraw(true);var vd_lI=vd_F.vd_bG!=vd_fY||vd_F.vd_aQ!=vd_uS||vd_F.RenderMode!=vd_tr||vd_F.vd_bN!=vd_tT;vd_L.SetImageInterpolationMode(vd_Ab);vd_F.vd_bG=vd_fY;vd_F.vd_aQ=vd_uS;vd_F.vd_eK=vd_An;vd_F.RenderMode=vd_tr;vd_F.vd_bN=vd_tT;if(vd_lI)setTimeout(vd_L.redraw,Math.max(vd_mH,vd_dO));};function vd_nC(vd_ko,vd_FD){if(vd_dO>0&&vd_dO<vd_ko)vd_ko=vd_dO;if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=setTimeout(vd_FD,vd_ko);};var vd_la=null;function vd_xo(vd_pk){if(vd_la==null){vd_DI();vd_la=[vdgeo.vd_cw(vd_F.vd_bI),vd_pk];}};function vd_xk(vd_ko){var layout=vd_L.GetActiveLayout();if(layout==null)return;vd_eb(layout);if(vd_F.vd_bs()||(vd_F.vd_bA&&vd_F.vd_bN)){vd_nC(vd_kW,vd_sI);}else{var vd_Bq=vdgeo.vd_iM(vd_la[0],vd_F.vd_aH);vd_CD(vd_Bq);vd_uw();var vd_Gp=vd_kW;vd_kW=500;vd_nC(vd_ko,vd_Ds);vd_kW=vd_Gp;}};function vd_Ds(){if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=null;var vd_fY=vd_F.vd_bG;if(vd_dO>vd_oh){vd_F.vd_bG=false;}vd_L.redraw(true);var vd_lI=vd_F.vd_bG!=vd_fY;vd_F.vd_bG=vd_fY;if(vd_lI)vd_aX=setTimeout(vd_L.redraw,Math.max(vd_mH,vd_dO));};this.UndoHistory=function(){var vd_a=vd_x();if(vd_a==null)return null;return vd_a.UndoHistory;};this.GetDocument=function(){return vd_x();};this.SetDocument=function(document){if(!document||vd_ai==null)return false;vd_ai.vd_K=document;vd_sm();return true;};this.GetActiveLayout=function(){var vd_a=vd_x();if(vd_a==null)return null;if(!vd_a.ActiveLayOutRef){if(vd_a.LayOuts==undefined||vd_a.LayOuts[vd_a.ActiveLayOut]==undefined)vd_a.ActiveLayOutRef=vd_a.Model;else vd_a.ActiveLayOutRef=vd_a.LayOuts.Items[vd_a.LayOuts[vd_a.ActiveLayOut]];}return vd_a.ActiveLayOutRef;};this.SetActiveLayout=function(layout){var vd_a=vd_x();if(vd_a==null)return;if(!layout)layout=vd_a.Model;vd_a.ActiveLayOutRef=layout;vd_a.ActiveLayOut='h_'+layout.HandleId.toString();if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=setTimeout(vd_L.redraw,0);};this.NumLayouts=function(){var vd_a=vd_x();if(vd_a==null)return 0;if(vd_a.LayOuts==undefined)return 0;return vd_a.LayOuts.Items.length;};this.GetActiveLayoutId=function(){var vd_a=vd_x();if(vd_a==null)return-1;if(vd_a.LayOuts==undefined)return-1;var vd_ss=vd_a.LayOuts[vd_x().ActiveLayOut];if(vd_ss==undefined)vd_ss= -1;return vd_ss;};this.SetActiveLayoutId=function(id){var vd_a=vd_x();if(vd_a==null)return;id=Math.max(-1,id);if(id>=vd_L.NumLayouts())id= -1;var layout=null;if(id== -1)layout=vd_a.Model;else layout=vd_a.LayOuts.Items[id];vd_L.SetActiveLayout(layout);};this.FindLayout=function(name){var vd_a=vd_x();if(vd_a==null)return null;name=name.toLowerCase();if(name=="model"|| !vd_a.LayOuts)return-1;for(var i=0;i<vd_a.LayOuts.Items.length;i++){var layout=vd_a.LayOuts.Items[i];var vd_er=layout.Name.toLowerCase();if(vd_er==name)return i;}return-1;};this.GetLayouts=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[vd_a.Model];if(vd_a.LayOuts){for(var i=0;i<vd_a.LayOuts.Items.length;i++){var layout=vd_a.LayOuts.Items[i];ret.push(layout);}}return ret;};this.GetBlocks=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[];for(var i=0;i<vd_a.Blocks.Items.length;i++){var block=vd_L.GetDictItem(vd_a.Blocks,vd_a.Blocks.Items[i]);ret.push(block);}return ret;};this.GetImages=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[];for(var i=0;i<vd_a.Images.Items.length;i++){var vd_U=vd_L.GetDictItem(vd_a.Images,vd_a.Images.Items[i]);ret.push(vd_U);}return ret;};this.GetLayers=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[];for(var i=0;i<vd_a.Layers.Items.length;i++){var layer=vd_L.GetDictItem(vd_a.Layers,vd_a.Layers.Items[i]);ret.push(layer);}return ret;};this.FindLayer=function(name){var vd_a=vd_x();if(vd_a==null)return null;name=name.toLowerCase();for(var i=0;i<vd_a.Layers.Items.length;i++){var layer=vd_L.GetDictItem(vd_a.Layers,vd_a.Layers.Items[i]);var vd_er=layer.Name.toLowerCase();if(vd_er==name)return layer;}return null;};this.FindLineType=function(name){var vd_a=vd_x();if(vd_a==null)return null;name=name.toLowerCase();for(var i=0;i<vd_a.LineTypes.Items.length;i++){var vd_yO=vd_L.GetDictItem(vd_a.LineTypes,vd_a.LineTypes.Items[i]);var vd_er=vd_yO.Name.toLowerCase();if(vd_er==name)return vd_yO;}return null;};this.GetLineTypes=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[];for(var i=0;i<vd_a.LineTypes.Items.length;i++){var linetype=vd_L.GetDictItem(vd_a.LineTypes,vd_a.LineTypes.Items[i]);ret.push(linetype);}return ret;};this.FindTextStyle=function(name){var vd_a=vd_x();if(vd_a==null)return null;name=name.toLowerCase();for(var i=0;i<vd_a.TextStyles.Items.length;i++){var vd_wf=vd_L.GetDictItem(vd_a.TextStyles,vd_a.TextStyles.Items[i]);var vd_er=vd_wf.Name.toLowerCase();if(vd_er==name)return vd_wf;}return null;};this.GetTextStyles=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[];for(var i=0;i<vd_a.TextStyles.Items.length;i++){var textstyle=vd_L.GetDictItem(vd_a.TextStyles,vd_a.TextStyles.Items[i]);ret.push(textstyle);}return ret;};this.SetActiveLayer=function(layer){var vd_a=vd_x();if(vd_a==null)return;if(layer==null)layer=vd_L.GetDictItem(vd_a.Layers,vd_a.Layers.Items[0]);vd_a.ActiveLayer='h_'+layer.HandleId.toString();};this.SetActiveLineType=function(lt){var vd_a=vd_x();if(vd_a==null)return;if(lt==null)lt=vd_L.GetDictItem(vd_a.LineTypes,vd_a.LineTypes.Items[0]);vd_a.ActiveLineType='h_'+lt.HandleId.toString();};this.SetActiveTextStyle=function(style){var vd_a=vd_x();if(vd_a==null)return;if(style==null)style=vd_L.GetDictItem(vd_a.TextStyles,vd_a.TextStyles.Items[0]);vd_a.ActiveTextStyle='h_'+style.HandleId.toString();};this.SetActivePenWidth=function(pw){var vd_a=vd_x();if(vd_a==null)return;vd_a.ActivePenWidth=pw;};this.SetActiveLineWeight=function(lw){var vd_a=vd_x();if(vd_a==null)return;vd_a.ActiveLineWeight=lw;};this.SetActivePenColor=function(col){var vd_a=vd_x();if(vd_a==null)return;vd_a.ActivePenColor=col;};this.GetActivePenColor=function(){var vd_a=vd_x();if(vd_a==null)return null;return vd_a.ActivePenColor;};this.GetActiveHatchProperties=function(){var vd_a=vd_x();if(vd_a==null)return null;var vd_J=vd_a.ActiveHatchProperties;if(!vd_J){vd_J=vd_L.createNewHatchProperties();vd_a.ActiveHatchProperties=vd_J;}return vd_a.ActiveHatchProperties;};this.GetActiveThickness=function(){var vd_a=vd_x();if(vd_a==null)return 0.0;if(!vd_a.vd_mZ)return 0.0;return vd_a.vd_mZ;};this.SetActiveThickness=function(thickness){var vd_a=vd_x();if(vd_a==null)return;vd_a.vd_mZ=thickness;};this.SetActiveHatchProperties=function(vd_Ie){var vd_a=vd_x();if(vd_a==null)return;vd_a.ActiveHatchProperties=vd_Ie;};this.vd_FX=function(name){var vd_a=vd_x();if(vd_a==null)return null;if(!name)return null;name=name.toLowerCase();for(var i=0;i<vd_a.HatchPatterns.Items.length;i++){var hpat=vd_L.GetDictItem(vd_a.HatchPatterns,vd_a.HatchPatterns.Items[i]);var vd_GC=hpat.Name.toLowerCase();if(vd_GC==name)return hpat;}return null;};this.GetHatchPatterns=function(){var vd_a=vd_x();if(vd_a==null)return null;var ret=[];for(var i=0;i<vd_a.HatchPatterns.Items.length;i++){var vd_Gh=vd_L.GetDictItem(vd_a.HatchPatterns,vd_a.HatchPatterns.Items[i]);ret.push(vd_Gh);}return ret;};this.createNewHatchProperties=function(vd_fR,FillBkColor,FillColor,vd_gX,vd_gb){if(!vd_fR&& !FillBkColor&& !FillColor||vd_fR=="")return null;var vd_mo=vd_L.vd_FX(vd_fR);if(!vd_mo)return null;var vd_uW='h_0';var Dpi=false;if(vd_mo){vd_uW='h_'+vd_mo.HandleId;Dpi=vd_L.vd_Fo(vd_mo.Name)}var vd_o;if(FillBkColor)vd_o=FillBkColor;else vd_o={};var color;if(FillColor)color=FillColor;else color={};if(!vd_gb)vd_gb=0.0;if(!vd_gX)vd_gX=1.0;return{HatchPattern:vd_uW,IsDpi:Dpi,DrawBoundary:false,FillBkColor:vd_o,FillColor:color,HatchAngle:vd_gb,HatchScale:vd_gX,gradientTypeProp:0,gradientColor2:undefined,gradientAngle:0,HatchOrigin:[0,0,0]};};this.vd_Fo=function(vd_gg){return(vd_gg.toUpperCase().indexOf("U10")>=0||vd_gg.toUpperCase().indexOf("U20")>=0||vd_gg.toUpperCase().indexOf("U10_45")>=0||vd_gg.toUpperCase().indexOf("U10_135")>=0||vd_gg.toUpperCase().indexOf("U10_90")>=0||vd_gg.toUpperCase().indexOf("U10_45_135")>=0);};this.vd_nj=function(vd_ba){if(!vd_ba)return null;var ret={};ret.HatchPattern=vd_ba.HatchPattern;ret.IsDpi=vd_ba.IsDpi;ret.DrawBoundary=vd_ba.DrawBoundary;ret.FillBkColor=vdConst.vd_pm(vd_ba.FillBkColor);ret.FillColor=vdConst.vd_pm(vd_ba.FillColor);ret.HatchAngle=vd_ba.HatchAngle;ret.HatchScale=vd_ba.HatchScale;ret.gradientTypeProp=vd_ba.gradientTypeProp;if(vd_ba.gradientColor2)ret.gradientColor2=vd_ba.gradientColor2.concat([]);ret.gradientAngle=vd_ba.gradientAngle;if(vd_ba.HatchOrigin)ret.HatchOrigin=vd_ba.HatchOrigin.concat([]);if(vd_ba.Solid2dTransparency!==undefined)ret.Solid2dTransparency=vd_ba.Solid2dTransparency;return ret;};this.FindBlock=function(name){var vd_a=vd_x();if(vd_a==null)return null;name=name.toLowerCase();for(var i=0;i<vd_a.Blocks.Items.length;i++){var block=vd_L.GetDictItem(vd_a.Blocks,vd_a.Blocks.Items[i]);var vd_er=block.Name.toLowerCase();if(vd_er==name)return block;}return null;};this.GetEntityPosition=function(vd_G,vd_ah){if(!vd_G|| !vd_G.HandleId)return-1;var vd_a=vd_x();if(!vd_a)return-1;var layout=vd_L.GetActiveLayout();if(!layout)return-1;if(!vd_ah)vd_ah=layout.Entities;var hid='h_'+vd_G.HandleId.toString();var p=vd_ah.Items.indexOf(hid);return p;};this.SetEntityPosition=function(vd_G,pos,vd_ah){if(!vd_G|| !vd_G.HandleId)return-1;var vd_a=vd_x();if(!vd_a)return-1;var layout=vd_L.GetActiveLayout();if(!layout)return-1;if(!vd_ah)vd_ah=layout.Entities;var hid='h_'+vd_G.HandleId.toString();var p=vd_ah.Items.indexOf(hid);if(p<0)return-1;if(!pos||pos<0)pos=0;if(pos>=vd_ah.Items.length-1)pos=vd_ah.Items.length-1;if(p==pos)return pos;vd_ah.Items.splice(p,1);vd_ah.Items.splice(pos,0,hid);return pos;};this.vd_eP=function(){var vd_a=vd_x();return vdConst.vd_wq(vd_a);};this.vd_aZ=function(vd_uO,ent){if(!ent.HandleId|| !vd_uO.Items)return;var hid='h_'+ent.HandleId.toString();if(vd_x()[hid])return;vd_uO.Items.push(hid);vd_x()[hid]=ent;};this.CopyObjects=function(entities){var vd_wG=[];var doc=vd_L.GetDocument();var layout=vd_L.GetActiveLayout();for(var i=0;i<entities.length;i++){var ent=entities[i];var obj=vdConst.cloneEntity(ent);obj.HandleId=vd_L.vd_eP();vd_L.vd_aZ(layout.Entities,obj);vd_wG.push(obj);var perc=i/entities.length*100;}return vd_wG;};this.vd_dQ=function(vd_C,vd_a,vd_Fy){if(!vd_Fy)vd_C.HandleId=vd_L.vd_eP();vd_C.LineType=vd_a.ActiveLineType;vd_C.Layer=vd_a.ActiveLayer;vd_C.PenColor=vdConst.vd_pm(vd_L.GetActivePenColor());vd_C.PenWidth=vd_a.ActivePenWidth;vd_C.LineWeight=vd_a.ActiveLineWeight;if(vd_a.vd_il)vd_C.LineTypeScale=vd_a.vd_il;};this.AddText=function(vd_AK,height,vd_ih,vd_sb,vd_ir,rotation,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdText_code;vd_C.InsertionPoint=vd_ih;vd_C.TextString=vd_AK;vd_C.Rotation=rotation;vd_C.Height=1;vd_C.Style=vd_a.ActiveTextStyle;var ts=vd_L.GetDictItem(vd_a.TextStyles,vd_a.ActiveTextStyle);if(ts){if(!height&&ts.Height)vd_C.Height=ts.Height;if(vd_sb==undefined&&ts.HorJustify!=undefined)vd_C.HorJustify=ts.HorJustify;if(vd_ir==undefined&&ts.VerJustify!=undefined)vd_C.VerJustify=ts.VerJustify;}if(height)vd_C.Height=height;if(vd_sb!=undefined)vd_C.HorJustify=vd_sb;if(vd_ir!=undefined)vd_C.VerJustify=vd_ir;vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddCone=function(p1,BaseRadius,TopRadius,hei,num,vd_aj,entities){var VertexList=[];var FaceList=[];var i=0;var k=0;var vd_nK;var p2=[p1[X],p1[Y],p1[Z]];p2[Z]+=hei;for(i=0;i<num;i++){vd_nK=vdgeo.pointPolar(p1,i*vdgeo.VD_TWOPI/num,BaseRadius);VertexList.push(vd_nK);}for(i=0;i<num;i++){vd_nK=vdgeo.pointPolar(p2,i*vdgeo.VD_TWOPI/num,TopRadius);VertexList.push(vd_nK);}for(i=0;i<num-2;i++){k= -1;FaceList.push(k);k= -(i+2);FaceList.push(k);k= -(i+3);FaceList.push(k);FaceList.push(k);k= -1;FaceList.push(k);k= -(1+num);FaceList.push(k);k= -(i+2+num);FaceList.push(k);k= -(i+3+num);FaceList.push(k);FaceList.push(k);k= -1;FaceList.push(k);}for(i=0;i<num;i++){k=i+1;FaceList.push(k);k=(i+1)+num;FaceList.push(k);k=(i+2)+num;if(i==num-1)k=1+num;FaceList.push(k);k=i+2;if(i==num-1)k=1;FaceList.push(k);k= -1;FaceList.push(k);}return vd_L.AddPolyface(VertexList,FaceList,vd_aj,entities);};this.AddSphere=function(p1,rad,lon,lat,vd_aj,entities){var vd_zc=vdgeo.VD_TWOPI/lon;var vd_At=vdgeo.PI/lat;var k=0,l=0,i=0;var a,sa,va,dp,dh;var pt;var VertexList=[];var FaceList=[];for(k=0;k<lon+1;k++){a=k*vd_zc;sa=vdgeo.PI/ -2.0;for(l=0;l<lat+1;l++){va=sa+l*vd_At;dp=rad*Math.cos(va);dh=rad*Math.sin(va);pt=vdgeo.pointPolar(p1,a,dp);pt[Z]+=dh;VertexList.push(pt);}}for(k=0;k<lon;k++){for(l=0;l<lat;l++){i=l+(k*(lat+1));i+=1;FaceList.push(i);i=(l+1)+(k*(lat+1));i+=1;FaceList.push(i);i=(l+1)+(k+1)*(lat+1);i+=1;if(k==lon-1){i=(l+1);i+=1;}FaceList.push(i);i=l+(k+1)*(lat+1);i+=1;if(k==lon-1){i=l;i+=1;}FaceList.push(i);i= -1;FaceList.push(i);}}return vd_L.AddPolyface(VertexList,FaceList,vd_aj,entities);};this.AddBox=function(p1,len,wid,hei,rot,vd_aj,entities){var VertexList=[[0,0,0],[len,0,0],[len,wid,0],[0,wid,0],[0,0,hei],[len,0,hei],[len,wid,hei],[0,wid,hei]];var FaceList=[1,2,3,4,-1,5,6,7,8,-1,1,2,6,5,-1,2,3,7,6,-1,3,4,8,7,-1,4,1,5,8,-1];var mat=vdgeo.vd_l();vdgeo.vd_af(mat,rot);vdgeo.vd_Y(mat,p1[X],p1[Y],p1[Z]);VertexList=vdgeo.vd_ff(mat,VertexList);return vd_L.AddPolyface(VertexList,FaceList,vd_aj,entities);};this.TriangulatePolyface=function(vd_hP,precision){if(!vd_hP|| !vd_hP._t||vd_hP._t!=vdConst.vdPolyface_code)return false;if(!precision)precision=8;var ret=vd_sN.vd_wc(vd_hP.VertexList.Items,precision);var vd_dF=[];for(var i=0;i<ret.length;i+=3){vd_dF.push(ret[i]+1);vd_dF.push(ret[i+1]+1);vd_dF.push(ret[i+2]+1);vd_dF.push(ret[i+2]+1);vd_dF.push(-1);}vd_hP.FaceList.Items=vd_dF;vdcanvas.UpdateFig(vd_hP);return true;};this.AddHeatMap=function(points,vd_sM,precision,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();if(!precision)precision=8;var ret=vd_sN.vd_wc(points,precision);var vd_dF=[];for(var i=0;i<ret.length;i+=3){vd_dF.push(ret[i]+1);vd_dF.push(ret[i+1]+1);vd_dF.push(ret[i+2]+1);vd_dF.push(ret[i+2]+1);vd_dF.push(-1);}var pf=vd_L.AddPolyface(points,vd_dF,false,entities);pf.GradientColors={Items:[]};for(var i=0;i<vd_sM.length;i+=2){pf.GradientColors.Items.push({Key:vd_sM[i],Value:vd_sM[i+1]});}pf.GradientColors.Items.sort(function(a,b){return a.Key-b.Key});if(vd_aj){vd_bx(pf,vd_F,vd_a);vd_L.Refresh(false);}return pf;};this.AddPolyface=function(points,vd_EX,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdPolyface_code;vd_C.VertexList={Items:points};vd_C.FaceList={Items:vd_EX};if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddArc=function(center,radius,vd_rx,vd_qa,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdArc_code;vd_C.Center=center;vd_C.Radius=radius;vd_C.StartAngle=vd_rx;vd_C.EndAngle=vd_qa;vd_C.HatchProperties=vd_L.vd_nj(vd_L.GetActiveHatchProperties());vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddCircle=function(center,radius,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdCircle_code;vd_C.Center=center;vd_C.Radius=radius;vd_C.HatchProperties=vd_L.vd_nj(vd_L.GetActiveHatchProperties());vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddEllipse=function(center,vd_Dx,vd_De,vd_Eh,vd_rx,vd_qa,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdEllipse_code;vd_C.Center=center;vd_C.MajorAngle=vd_Eh;vd_C.MajorLength=vd_Dx;vd_C.MinorLength=vd_De;vd_C.StartAngle=vd_rx;vd_C.EndAngle=vd_qa;vd_C.HatchProperties=vd_L.vd_nj(vd_L.GetActiveHatchProperties());vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddLine=function(vd_hu,vd_gF,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdLine_code;vd_C.StartPoint=vd_hu;vd_C.EndPoint=vd_gF;vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddPolyline=function(vd_bT,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};var k,i;var vd_bV;vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdPolyline_code;vd_C.VertexList={};vd_C.VertexList.Items=[];for(k=0;k<vd_bT.length;k++){vd_bV=vd_bT[k];for(i=vd_bV.length;i<4;i++)vd_bV.push(0.0);vd_C.VertexList.Items.push(vd_bV);}vd_C.SamplePoints=null;vd_C.HatchProperties=vd_L.vd_nj(vd_L.GetActiveHatchProperties());vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddRect2=function(insertion,width,height,rotation,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdRect_code;vd_C.InsertionPoint=insertion;vd_C.Width=width;vd_C.Height=height;vd_C.Rotation=rotation;vd_C.HatchProperties=vd_L.vd_nj(vd_L.GetActiveHatchProperties());vd_C.Thickness=vd_L.GetActiveThickness();if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.AddRect=function(vd_tb,vd_uI,vd_aj,entities){return vd_L.AddRect2(vd_tb,vd_uI[X]-vd_tb[X],vd_uI[Y]-vd_tb[Y],0,vd_aj,entities);};this.AddAttribDef=function(block,height,rotation,tag,value,vd_ih){if(!block|| !block._t||block._t!=vdConst.vdBlock_code)return null;var vd_a=vd_x();var vd_C={};vd_L.vd_dQ(vd_C,vd_a);vd_C.AlignmentPoint=[0,0,0];vd_C._t=vdConst.vdAttribDef_code;vd_C.TagString=tag;vd_C.PromptString="Prompt";vd_C.ValueString=value;vd_C.TextString=tag;vd_C.Height=1.0;vd_C.Style=vd_a.ActiveTextStyle;var ts=vd_L.GetDictItem(vd_a.TextStyles,vd_a.ActiveTextStyle);if(ts){if(!height&&ts.Height)vd_C.Height=ts.Height;if(ts.HorJustify!=undefined)vd_C.HorJustify=ts.HorJustify;if(ts.VerJustify!=undefined)vd_C.VerJustify=ts.VerJustify;}if(height)vd_C.Height=height;vd_C.InsertionPoint=vd_ih;vd_C.Rotation=rotation;vd_L.vd_aZ(block.Entities,vd_C);return vd_C;};this.GetAttribValue=function(tag,vd_ac){if(!vd_ac|| !vd_ac._t||vd_ac._t!=vdConst.vdInsert_code)return null;if(!vd_ac.Attributes)return null;for(var i=0;i<vd_ac.Attributes.Items.length;i++){var vd_rV=vd_ac.Attributes.Items[i].TagString.toLowerCase();if(vd_rV==tag.toLowerCase())return vd_ac.Attributes.Items[i].ValueString;}return null;};this.SetAttribValue=function(tag,value,vd_ac){if(!vd_ac|| !vd_ac._t||vd_ac._t!=vdConst.vdInsert_code)return false;if(!vd_ac.Attributes)return false;for(var i=0;i<vd_ac.Attributes.Items.length;i++){var attr=vd_ac.Attributes.Items[i];var vd_rV=attr.TagString.toLowerCase();if(vd_rV==tag.toLowerCase()){attr.ValueString=value;attr.TextString=value;vd_L.UpdateFig(vd_ac);vd_L.UpdateFig(attr);vd_L.UpdateLayout(vd_L.GetActiveLayout());return true;}}return false;};this.AddBlockFromFile=function(filename,vd_gN,vd_FM){if(!filename|| !vd_gN)return null;var vd_C=vd_L.FindBlock(vd_gN);if(vd_C&& !vd_FM)return vd_C;if(!vd_C)vd_C=vd_L.AddBlock(vd_gN);if(!vd_C)return null;vd_C.ExternalReferencePath=filename;vd_C.ExternalReference=null;return vd_C;};this.AddBlock=function(vd_gN,vd_tL){var vd_C=vd_L.FindBlock(vd_gN);if(vd_C)return vd_C;var vd_a=vd_x();vd_C={};vd_C.Name=vd_gN;vd_C.HandleId=vd_L.vd_eP();vd_C.Entities={Items:[]};if(vd_tL)vd_C.Origin=vd_tL;vd_C.StretchBlock=0;vd_C._t=vdConst.vdBlock_code;vd_L.vd_aZ(vd_a.Blocks,vd_C);return vd_C;};function vd_Ef(vd_ac,attribute){if(!vd_ac.Attributes)vd_ac.Attributes={Items:[]};var vd_a=vd_x();var vd_C={AlignmentPoint:(attribute.AlignmentPoint)?attribute.AlignmentPoint:[0,0,0],Bold:(attribute.Bold)?attribute.Bold:false,ExtrusionVector:(attribute.ExtrusionVector)?attribute.ExtrusionVector:[0,0,1],Flag:(attribute.Flag)?attribute.Flag:0,HandleId:vd_L.vd_eP(),Height:(attribute.Height)?attribute.Height:1,InsertionPoint:(attribute.InsertionPoint)?attribute.InsertionPoint:[0,0,0],Layer:(attribute.Layer)?attribute.Layer:vd_a.Layers[0],LineType:(attribute.LineType)?attribute.LineType:undefined,LineTypeScale:(attribute.LineTypeScale)?attribute.LineTypeScale:1,ObliqueAngle:(attribute.ObliqueAngle)?attribute.ObliqueAngle:0,PenColor:(attribute.PenColor)?attribute.PenColor:{ColorFlag:192},Rotation:(attribute.Rotation)?attribute.Rotation:0,Style:(attribute.Style)?attribute.Style:undefined,TagString:(attribute.TagString)?attribute.TagString:undefined,TextLine:(attribute.TextLine)?attribute.TextLine:0,TextString:(attribute.ValueString)?attribute.ValueString:undefined,Thickness:(attribute.Thickness)?attribute.Thickness:0,ValueString:(attribute.ValueString)?attribute.ValueString:undefined,WidthFactor:(attribute.WidthFactor)?attribute.WidthFactor:1,InVisibleMode:(attribute.InVisibleMode===true)?attribute.InVisibleMode:false,_t:vdConst.vdAttrib_code};vd_ac.Attributes["h_"+vd_C.HandleId]=vd_ac.Attributes.Items.length;vd_ac.Attributes.Items.push(vd_C);vd_g.vd_gO(vd_ac.EcsMatrix,vd_C,vd_L);vd_L.UpdateFig(vd_C);return vd_C;};this.AddBlockSymbol=function(vd_gN,vd_ih,scale,rotation,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var block=vd_L.FindBlock(vd_gN);if(block==null)return null;var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdInsert_code;vd_C.InsertionPoint=vd_ih;vd_C.Xscale=scale;vd_C.Yscale=scale;vd_C.Rotation=rotation;vd_C.Block='h_'+block.HandleId.toString();vd_cR.clear();vd_bx(vd_C,vd_cR,vd_a);vd_C.BoundingBox=vd_cR.vd_gu.vd_gl();for(var i=0;i<block.Entities.Items.length;i++){var attribute=vd_L.GetEntityItem(block.Entities.Items[i]);if(attribute._t==vdConst.vdAttribDef_code){vd_Ef(vd_C,attribute);}}if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}var bbox=vd_C.BoundingBox;vd_L.UpdateFig(vd_C);vd_C.BoundingBox=bbox;return vd_C;};this.GetEntityBBox=function(vd_C){if(!vd_C.BoundingBox){var vd_a=vd_x();vd_cR.clear();vd_bx(vd_C,vd_cR,vd_a);vd_C.BoundingBox=vd_cR.vd_gu.vd_gl();}return vd_C.BoundingBox;};this.MaxImageSize=768*720;this.AddImage=function(vd_mD,vd_hf,vd_ih,vd_xL,rotation,vd_aj,entities){var layout=vd_L.GetActiveLayout();if(layout==null)return null;var vd_a=vd_x();var vd_Q=vd_L.vd_Ao(vd_mD);if(vd_Q==null)return null;var vd_C={};vd_L.vd_dQ(vd_C,vd_a,entities&& !entities.Items);vd_C._t=vdConst.vdImage_code;vd_C.InsertionPoint=vd_ih;vd_C.ImageDefinition='h_'+vd_Q.HandleId.toString();vd_C.Display=5;vd_C.Rotation=rotation;vd_C.Width=vd_xL;vd_C.ImageScale=vd_xL;vd_C.Height=vd_C.Width*vd_Q.OriginalHeight/vd_Q.OriginalWidth;if(entities)vd_L.vd_aZ(entities,vd_C);else vd_L.vd_aZ(layout.Entities,vd_C);if(!vd_Q.bytes&&vd_hf&&vd_ai){var vd_ge=document.createElement("img");vd_ge.setAttribute("src",vd_hf);vd_ge.onload=function(evt){vd_ai.vd_vN(evt.target,vd_Q);vd_C.Height=vd_C.Width*vd_Q.OriginalHeight/vd_Q.OriginalWidth;vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}}}else{vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}}return vd_C;};this.AddLayout=function(vd_mE){var vd_a=vd_x();if(!vd_a)return-1;if(vd_mE.toLowerCase()=="model"||vd_mE.toLowerCase()==vd_a.Model.Name.toLowerCase())return-1;var vd_lR=vd_L.FindLayout(vd_mE);if(vd_lR>=0)return vd_lR;if(!vd_a.LayOuts)vd_a.LayOuts={Items:[]};vd_lR=vd_a.LayOuts.Items.length;var vd_C={_t:vdConst.vdLayout_code,HandleId:vd_L.vd_eP(),Name:vd_mE,FocalLength:0.05,PerspectiveMod:0,LensAngle:60,ViewCenter:[0,0,0],RenderMode:0,ViewSize:1.0,World2ViewMatrix:vdgeo.vd_l(),BkColorEx:[0,0,0,0],ShowHidenEdges:false,Printer:{PrintWindow:[0,0,0,210,297,0],PrintScale:[1,1],HandleId:vd_L.vd_eP(),margins:[0,0,0,0],Resolution:96,paperSize:[0,0,827,1169],LandScape:false},Entities:{Items:[]}};vd_a.LayOuts.Items.push(vd_C);vd_a.LayOuts['h_'+vd_C.HandleId.toString()]=vd_lR;return vd_lR;};this.AddViewport=function(insertion,width,height,vd_r,vd_v,vd_aj){var vd_a=vd_x();if(!vd_a)return null;var layout=vd_L.GetActiveLayout();if(layout==null||layout==vd_a.Model)return null;var vd_C={};var vd_lC=insertion[X];var vd_mC=insertion[Y];var vd_vM=vd_lC+width;var vd_vi=vd_mC+height;if(width<0){vd_lC=vd_lC+width;vd_vM=insertion[X];}if(height<0){vd_mC=vd_mC+height;vd_vi=insertion[Y];}vd_L.vd_dQ(vd_C,vd_a);vd_C._t=vdConst.vdViewport_code;vd_C.InsertionPoint=insertion;vd_C.Width=width;vd_C.Height=height;vd_C.ViewSize=10.0;vd_C.ViewCenter=[0,0,0];if(vd_r)vd_C.ViewCenter=vd_r;if(vd_v)vd_C.ViewSize=vd_v;if(vd_a.Model.BoundingBox){if(!vd_r)vd_C.ViewCenter=[(vd_a.Model.BoundingBox[0]+vd_a.Model.BoundingBox[3])/2.0,(vd_a.Model.BoundingBox[1]+vd_a.Model.BoundingBox[4])/2.0,0];if(!vd_v){var vd_EB=vd_a.Model.BoundingBox[3]-vd_a.Model.BoundingBox[0];var vd_Eg=vd_a.Model.BoundingBox[4]-vd_a.Model.BoundingBox[1];var l1=Math.abs(width)/vd_EB;var l2=Math.abs(height)/vd_Eg;var l=Math.min(l1,l2);vd_C.ViewSize=Math.abs(height)/l;}}vd_C.BoundingBox=[vd_lC,vd_mC,0,vd_vM,vd_vi,0];vd_C.LensAngle=60;vd_C.FocalLength=0.05;vd_C.PerspectiveMod=0;vd_C.ShowHidenEdges=false;vd_C.RenderMode=0;vd_C.World2ViewMatrix=vdgeo.vd_l();vd_C.BkColorEx=[0,0,0,0];vd_L.vd_aZ(layout.Entities,vd_C);vd_L.UpdateLayout(layout);if(vd_aj){vd_bx(vd_C,vd_F,vd_a);vd_L.Refresh(false);}return vd_C;};this.vd_FE=function(name){var vd_a=vd_x();if(vd_a==null)return null;name=name.toLowerCase();for(var i=0;i<vd_a.Images.Items.length;i++){var vd_Q=vd_L.GetDictItem(vd_a.Images,vd_a.Images.Items[i]);var vd_Im=vd_Q.Name.toLowerCase();if(vd_Im==name)return vd_Q;}return null;};this.vd_Ao=function(vd_mD){var doc=vd_x();if(doc==null)return null;var vd_Q=vd_L.vd_FE(vd_mD);if(vd_Q)return vd_Q;vd_Q={};vd_Q.HandleId=vd_L.vd_eP();vd_Q.Name=vd_mD;vd_Q._t=vdConst.vdImageDef_code;vd_Q.Transparency=[0,0,0,0];vd_Q.OriginalWidth=1;vd_Q.OriginalHeight=1;vd_Q.width=1;vd_Q.height=1;vd_L.vd_aZ(doc.Images,vd_Q);return vd_Q;};this.FindView=function(name){var vd_a=vd_x();if(vd_a==null)return null;if(!vd_a.Views|| !vd_a.Views.Items)return null;name=name.toLowerCase();for(var i=0;i<vd_a.Views.Items.length;i++){var view=vd_a.Views.Items[i];var vd_Ai=view.Name.toLowerCase();if(vd_Ai==name)return view;}return null;};this.AddView=function(vd_xm){var vd_a=vd_x();if(vd_a==null)return null;var layout=vd_L.GetActiveLayout();if(layout==null)return;var view=vd_L.FindView(vd_xm);if(view)return view;view={};view._t=vdConst.vdView_code;view.HandleId=vd_L.vd_eP();view.Name=vd_xm;view.ViewLayout='h_'+layout.HandleId.toString();view.ViewSize=layout.ViewSize;view.ViewWorldToViewMatrix=vdgeo.vd_cw(layout.World2ViewMatrix);view.ViewPerspectiveMod=layout.PerspectiveMod;view.ViewRenderMode=layout.RenderMode;view.ViewCenter=vdgeo.newpoint(layout.ViewCenter[X],layout.ViewCenter[Y],layout.ViewCenter[Z]);view.ViewFocalLength=layout.FocalLength;view.ViewLensAngle=layout.LensAngle;if(!vd_a.Views)vd_a.Views={};if(!vd_a.Views.Items)vd_a.Views.Items=[];vd_a.Views["h_"+view.HandleId.toString()]=vd_a.Views.Items.length;vd_a.Views.Items.push(view);return view;};this.SetActiveView=function(vd_kx){var vd_a=vd_x();if(vd_a==null)return null;var layout=vd_L.GetActiveLayout();var view=null;if(vd_kx){if(typeof vd_kx==='string')view=vd_L.FindView(vd_kx);else if(typeof vd_kx==='object')view=vd_kx;}if(view){vd_a.ActiveView='h_'+view.HandleId.toString();vd_a.vd_gK=view;if(vd_a.LayOuts&&view.ViewLayout&&vd_a.LayOuts[view.ViewLayout]!==undefined)layout=vd_a.LayOuts.Items[vd_a.LayOuts[view.ViewLayout]];else layout=vd_a.Model;layout.ViewSize=view.ViewSize;layout.World2ViewMatrix=vdgeo.vd_cw(view.ViewWorldToViewMatrix);layout.PerspectiveMod=view.ViewPerspectiveMod;layout.RenderMode=view.ViewRenderMode;layout.ViewCenter=vdgeo.newpoint(view.ViewCenter[X],view.ViewCenter[Y],view.ViewCenter[Z]);layout.FocalLength=view.ViewFocalLength;layout.LensAngle=view.ViewLensAngle;}else{vd_a.ActiveView='h_0';vd_a.vd_gK=null;}vd_L.SetActiveLayout(layout);};this.GetActiveView=function(){var vd_a=vd_x();if(vd_a==null)return null;if(!vd_a.vd_gK){if(vd_a.ActiveView&&vd_a.Views&&vd_a.Views.Items&&vd_a.Views[vd_a.ActiveView])vd_a.vd_gK=vd_a.Views.Items[vd_a.Views[vd_a.ActiveView]];}return vd_a.vd_gK;};this.vd_FB=function(layer,vd_a){if(!layer)return true;var vd_hT=vd_a.vd_sK;if(!vd_hT)vd_hT=vd_a.vd_gK;if(vd_hT){if(vd_hT.FrozenLayers&&vd_hT.FrozenLayers['h_'+layer.HandleId.toString()])return true;if(vd_hT.IgnoreFrozenLayers)return false;}return layer.Frozen;};this.AddLayer=function(vd_gQ){var doc=vd_x();if(doc==null)return null;var layer=vd_L.FindLayer(vd_gQ);if(layer)return layer;layer={};layer.HandleId=vd_L.vd_eP();layer.LineType=doc.ActiveLineType;layer.LineWeight=doc.ActiveLineWeight;layer.Name=vd_gQ;layer.PenColor=vdConst.vd_pm(vd_L.GetActivePenColor());layer._t=vdConst.vdLayer_code;vd_L.vd_aZ(doc.Layers,layer);return layer;};function vd_BS(vd_iH){if(vd_vC(vd_iH))return true;if(vd_iH.constructor===Array){for(var i=0;i<vd_iH.length;i++)if(!vd_vC(vd_iH[i]))return false;}else return false;return true;};function vd_vC(vd_h){return(typeof vd_h==="string"||typeof vd_h==="number"||typeof vd_h==="boolean");};this.AddXProperty=function(vd_G,name,vd_h){if(!vd_G|| !name||vd_h==null||vd_h==undefined)return null;if(!vd_G.HandleId|| !vd_G._t||vd_G._t<1||vd_G._t>100)return null;if(!vd_BS(vd_h))return null;if(!vd_G.XProperties)vd_G.XProperties={Items:[]};var vd_iH={Name:name,PropValue:vd_h};vd_G.XProperties.Items.push(vd_iH);return vd_iH;};this.GetXProperty=function(vd_G,name){if(!vd_G|| !name)return null;if(!vd_G.XProperties||vd_G.XProperties.Items.length==0)return null;for(var i=0;i<vd_G.XProperties.Items.length;i++)if(vd_G.XProperties.Items[i].Name===name)return vd_G.XProperties.Items[i];return null;};this.GetEntitiesFromLayer=function(vd_gQ){var ret=[];var layer=vd_L.FindLayer(vd_gQ);if(!layer)return ret;vd_gQ=vd_gQ.toLowerCase();var vd_Fq=vd_L.FindLayer("0");var vd_mi;var vd_qi=vd_L.GetDocument().LayOuts;var lNum=0;if(vd_qi)lNum=vd_qi.Items.length;var entities;for(var d=0;d<=lNum;d++){var layout;if(d==lNum)layout=vd_L.GetDocument().Model;else layout=vd_qi.Items[d];entities=layout.Entities;if(!entities)continue;for(var i=0;i<entities.Items.length;i++){vd_qK=vd_L.GetEntityItem(entities.Items[i]);if(!vd_qK)continue;if(!vd_qK.Layer)vd_mi=vd_Fq;else vd_mi=vd_L.GetDocument()[vd_qK.Layer];if(!vd_mi)continue;if(vd_mi.Name.toLowerCase()==vd_gQ)ret.push(vd_qK);}}return ret;};this.GetEntityFromPoint=function(x,y){return vd_F.GetEntityFromPoint(x,y,vd_L.PickSize,vd_L.IgnoreLockLayers);};this.GetEntitiesFromBox=function(xmin,ymin,xmax,ymax){return vd_F.GetEntitiesFromBox(vdgeo.vd_R(xmin),vdgeo.vd_R(ymin),vdgeo.vd_R(xmax),vdgeo.vd_R(ymax),vd_L.IgnoreLockLayers);};this.GetEntitiesInWindowBox=function(xmin,ymin,xmax,ymax){return vd_F.GetEntitiesInWindowBox(vdgeo.vd_R(xmin),vdgeo.vd_R(ymin),vdgeo.vd_R(xmax),vdgeo.vd_R(ymax),vd_L.IgnoreLockLayers);};this.PixelToWorld=function(ptX,ptY){var vd_Dd=vdgeo.vd_bc(vd_F.vd_eG());return vdgeo.vd_ax(ptX,ptY,1,vd_Dd);};this.WorldToPixel=function(vd_xV){return vdgeo.vd_fZ(vd_xV,vd_F.vd_eG());};this.WorldToView=function(pt){return vdgeo.vd_M(vd_F.vd_bt(),pt);};this.ViewToWorld=function(pt){var vd_ru=vdgeo.vd_bc(vd_F.vd_bt());return vdgeo.vd_M(vd_ru,pt);};this.ViewToPixel=function(pt){return vdgeo.vd_fZ(pt,vd_F.vd_aH);};this.PixelToView=function(pt){return vdgeo.vd_fZ(pt,vd_F.vd_bI);};this.PointAt_GPS=function(lat,lon){var doc=vd_L.GetDocument();if(!doc|| !doc.FileProperties|| !doc.FileProperties.Gps_Map)return null;var ne=vd_cx.vd_Gz(lat,lon);return vdgeo.vd_ax(ne[0],ne[1],0,doc.FileProperties.Gps_Map.NorthEastToWorld);};this.GPS_AtPoint=function(pt){var doc=vd_L.GetDocument();if(!doc|| !doc.FileProperties|| !doc.FileProperties.Gps_Map)return null;var w2ne=vdgeo.vd_bc(doc.FileProperties.Gps_Map.NorthEastToWorld);var npt=vdgeo.vd_fZ(pt,w2ne);return vd_cx.vd_ET(npt[Y],npt[X]);};var ctx=null;var vd_dW=null;var vd_gE=null;this.Refresh=function(blc){var img=null;if(blc!=false){var vd_a=vd_x();if(vd_a!=null)img=vd_a.Palette._lc;}vd_F.vd_y.vd_vg(img);vd_F.vd_y.Refresh();vd_uw();};function vd_DI(){var vd_aY=vd_L.canvas.width;var vd_bn=vd_L.canvas.height;if(vd_dW==null){vd_dW=document.createElement("CANVAS");vd_dW.setAttribute("width",vd_aY);vd_dW.setAttribute("height",vd_bn);vd_gE=vd_dW.getContext("2d");}vd_F.vd_y.vd_vr();vd_gE.putImageData(vd_F.vd_y.vd_uz(),0,0,0,0,vd_aY,vd_bn);};function vd_CD(vd_hn){if(!ctx)return;var vd_aY=vd_L.canvas.width;var vd_bn=vd_L.canvas.height;ctx.fillStyle=vdgdi.vd_ha(vd_F.vd_ed(-1));ctx.fillRect(0,0,vd_aY,vd_bn);var vd_gM=vdgeo.vd_M(vd_hn,vdgeo.newpoint(0,0,0));var vd_ja=vdgeo.vd_M(vd_hn,vdgeo.newpoint(vd_aY,vd_bn,0));ctx.drawImage(vd_dW,0,0,vd_aY,vd_bn,vdgeo.vd_R(vd_gM[X]),vdgeo.vd_R(vd_gM[Y]),vdgeo.vd_R(vd_ja[X]-vd_gM[X]),vdgeo.vd_R(vd_ja[Y]-vd_gM[Y]));vd_F.vd_y.vd_sX();};this.printToImageData=function(vd_om,vd_zu,vd_sS,vd_kz,vd_o,vd_uj,res){var layout=vd_L.GetActiveLayout();if(layout==null)return;var vd_a=vd_x();var vd_gn=layout.Printer;var resolution=vd_gn.Resolution;var margins=vd_gn.margins;var vd_md=vd_gn.PrintScale;var vd_bW=vd_gn.PrintWindow;var vd_wm=vd_gn.LandScape;if(res){resolution=res;}var vd_eg=vdgeo.vd_R(resolution*vd_gn.paperSize[2]/100);var vd_hH=vdgeo.vd_R(resolution*vd_gn.paperSize[3]/100);if(vd_sS!=undefined){vd_wm=false;vd_eg=vdgeo.vd_R(resolution*vd_sS[0]/100);vd_hH=vdgeo.vd_R(resolution*vd_sS[1]/100);}if(vd_kz!=undefined){margins=[vd_kz,vd_kz,vd_kz,vd_kz];}if(vd_wm){var tmp=vd_eg;vd_eg=vd_hH;vd_hH=tmp;}if(vd_om==vdConst.PRINT_WINDOW_FLAG_EXTENTS){var vd_ls=vd_L.GetExtents();if(vd_ls!=null){var box=vdgeo.vd_qP(layout.World2ViewMatrix,vd_ls);vd_bW=box;if(vdgeo.AreEqual(box[3]-box[0],0.0,vdgeo.DefaultLinearEquality)||vdgeo.AreEqual(box[4]-box[1],0.0,vdgeo.DefaultLinearEquality))vd_om=vdConst.PRINT_WINDOW_FLAG_VIEW;}}if(vd_om==vdConst.PRINT_WINDOW_FLAG_VIEW){vd_bW=[vd_F.vd_au.left,vd_F.vd_au.bottom,0,vd_F.vd_au.right,vd_F.vd_au.top,0];}if(vd_zu==vdConst.PRINT_SCALE_FLAG_FIT){var vd_lM=25.4*vd_eg/resolution;var vd_mW=25.4*vd_hH/resolution;vd_lM-=25.4*margins[0]/100;vd_lM-=25.4*margins[2]/100;vd_mW-=25.4*margins[1]/100;vd_mW-=25.4*margins[3]/100;var w=vd_bW[3]-vd_bW[0];var h=vd_bW[4]-vd_bW[1];if(vdgeo.AreEqual(w,0.0,vdgeo.DefaultScaleEquality)||vdgeo.AreEqual(h,0.0,vdgeo.DefaultScaleEquality)){vd_md=[1,1];}else{if((vd_lM/w)<(vd_mW/h)){vd_md=[1,w/vd_lM];}else{vd_md=[1,h/vd_mW];}}}var vd_FA=vd_md[0]/vd_md[1];var vd_pP=resolution*vd_FA/25.4;var vd_uQ=1.0/vd_pP;var vd_dU=vdgeo.vd_R(vd_pP*(vd_bW[3]-vd_bW[0]));var vd_hJ=vdgeo.vd_R(vd_pP*(vd_bW[4]-vd_bW[1]));var vd_sL=vdgeo.vd_R(resolution*margins[0]/100);var vd_tl=vdgeo.vd_R(resolution*margins[1]/100);var vd_tu=vdgeo.vd_R(resolution*margins[2]/100);var vd_vP=vdgeo.vd_R(resolution*margins[3]/100);if((vd_sL+vd_dU)>(vd_eg-vd_tu))vd_dU=vd_eg-vd_tu-vd_sL;if((vd_tl+vd_hJ)>(vd_hH-vd_vP))vd_hJ=vd_hJ-vd_vP-vd_tl;var nw=vd_dU*vd_uQ;var nh=vd_hJ*vd_uQ;var vc=vdgeo.newpoint(vd_bW[0]+nw*0.5,vd_bW[1]+nh*0.5,0);var vs=nh;var vd_gj,vd_lt,vd_if,vd_lV,vd_ke;var vd_jM=Math.abs(vd_bW[3]-vd_bW[0]);var vd_kY=Math.abs(vd_bW[4]-vd_bW[1]);var vd_iB=0;var vd_fQ=vd_dU/vd_hJ;if(!layout.FocalLength)layout.FocalLength=0.05;if(!layout.LensAngle)layout.LensAngle=60.0;if(vd_jM/vd_kY<vd_fQ){vd_gj=vdgeo.DegreesToRadians(layout.LensAngle)/2;vd_lt=vd_kY/2;vd_iB=vd_lt/Math.tan(vd_gj);}else{vd_if=2.0*layout.FocalLength*Math.tan(vdgeo.DegreesToRadians(layout.LensAngle/2.0));vd_lV=vdgeo.RadiansToDegrees(Math.atan(vd_if*vd_fQ*0.5/layout.FocalLength))*2.0;vd_gj=vdgeo.DegreesToRadians(vd_lV)/2;vd_ke=vd_jM/2;vd_iB=vd_ke/Math.tan(vd_gj);}vc[Z]=Math.max(vd_bW[5],vd_bW[2])+vd_iB;if(vd_om==vdConst.PRINT_WINDOW_FLAG_VIEW)vc=layout.ViewCenter;vd_eg=vdgeo.vd_qT(vd_eg);vd_dU=vdgeo.vd_qT(vd_dU);var vd_fb=null;var vd_fp=null;var vd_cW=null;var vd_ik=null;try{vd_fb=document.createElement("CANVAS");vd_fb.setAttribute("width",vd_eg);vd_fb.setAttribute("height",vd_hH);vd_fp=vd_fb.getContext("2d");vd_cW=new vd_rz(vd_L,0,0,vd_dU,vd_hJ,null);vd_cW.vd_sG(vd_F);vd_cW.vd_bG=false;vd_ik=vd_fp.createImageData(vd_dU,vd_hJ);}catch(ex){vd_fb=null;vd_fp=null;vd_cW=null;vd_ik=null;}if(vd_ik==null)return null;vd_cW.vd_y.vd_iY(vd_ik,vd_dU,vd_hJ,true);if(vd_o==undefined)vd_o=[255,255,255,255];vd_cW.update(vs,vc,layout.World2ViewMatrix,vd_nZ(layout),layout.FocalLength,layout.LensAngle,layout.PerspectiveMod==1,layout.RenderMode,layout.Sections,vd_a.Lights);vd_cW.vd_kT(vd_a.Palette,vd_o);vd_cW.clear();var vd_jH=vd_cW.vd_gv(layout.ShowHidenEdges);vd_nI(layout.Entities,true,vd_cW,vd_a);vd_cW.vd_gv(vd_jH);vd_cW.vd_y.vd_vg(vd_a.Palette._lc);vd_fp.fillStyle=vdgdi.vd_ha(vd_o);vd_fp.fillRect(0,0,vd_eg,vd_hH);vd_fp.putImageData(vd_ik,vd_sL,vd_tl);if(vd_uj!=undefined&&vd_uj>0){vd_fp.strokeStyle=vdgdi.vd_ha(vd_cW.vd_iz());vd_fp.lineWidth=vd_uj;vd_fp.strokeRect(0,0,vd_eg,vd_hH);}vd_cW.vd_y.vd_iY(null);var ret=vd_fb.toDataURL();vd_fb=null;vd_fp=null;vd_cW=null;vd_ik=null;vd_L.vd_cp.vd_xO(vd_F);return ret;};var Action=new vd_FH(vd_L);this.ActiveAction=function(){return Action;};this.SetActionOrthoMode=function(mode){return Action.vd_qb(mode);};this.SetActionOsnapColor=function(color){var ret=Action.vd_sf;if(color[3]===undefined)color[3]=255;Action.vd_sf=color;return ret;};this.SetActionOsnapSize=function(size){var ret=Action.vd_rM;Action.vd_rM=size;return ret;};this.SetActionLineColor=function(color){var ret=Action.vd_qG;Action.vd_qG=color;return ret;};this.SetActionLineWidth=function(lw){var ret=Action.vd_jv;Action.vd_jv=lw;return ret;};this.SetActionFillColor=function(vd_pU){var ret=Action.vd_jQ;Action.vd_jQ=vd_pU;return ret;};this.SetActionCrossFillColor=function(vd_pU){var ret=Action.vd_lJ;Action.vd_lJ=vd_pU;return ret;};this.GetUserPoint=function(vd_lr){Action.cancel();Action.vd_lS=vd_lr;Action.actionType=vdConst.ACTION_POINT_WORLD;Action.start();};this.GetUserLine=function(vd_lr,vd_iO){Action.cancel();Action.vd_lS=vd_lr;Action.actionType=vdConst.ACTION_LINE_WORLD;Action.start();Action.vd_xT(vd_iO);};this.GetUserRect=function(vd_lr,vd_iO){Action.cancel();Action.vd_lS=vd_lr;Action.actionType=vdConst.ACTION_RECT_VIEW;Action.start();Action.vd_xT(vd_iO);};this.CmdMove=function(entities,from,to,vd_cz){vd_lz(this,{vd_bL:1,entities:entities,vd_bb:from,vd_ae:to},vd_cz);};this.CmdScale=function(entities,from,scale,vd_cz){vd_lz(this,{vd_bL:2,entities:entities,vd_bb:from,vd_ae:scale},vd_cz);};this.CmdRotate=function(entities,from,rotation,vd_cz){vd_lz(this,{vd_bL:3,entities:entities,vd_bb:from,vd_ae:rotation},vd_cz);};this.CmdCopy=function(entities,from,to,vd_cz){vd_lz(this,{vd_bL:4,entities:entities,vd_bb:from,vd_ae:to},vd_cz);};this.CmdSelect=function(vd_cz,entities){vd_lz(this,{vd_bL:0,entities:entities},vd_cz);};this.vd_lO=function(action,status){if(action.vd_lS!=null)action.vd_lS(action,status);if(status==='draw'&&vd_L.vdActionDraw!=null)vd_L.vdActionDraw(action);};function vd_eb(layout,vd_oX){if(layout){var vd_a=vd_x();vd_F.update(layout.ViewSize,layout.ViewCenter,layout.World2ViewMatrix,vd_nZ(layout),layout.FocalLength,layout.LensAngle,layout.PerspectiveMod===1,(vd_oX===true? -1:layout.RenderMode),layout.Sections,vd_a.Lights);}else vd_F.update(10,vdgeo.newpoint(0,0,0),vdgeo.vd_l(),null,0.05,30,false,(vd_oX===true? -1:undefined));};this.vd_hG=function(){return ctx;};this.vd_z=function(){return vd_F;};this.SaveDocument=function(vd_iT){vd_cc.vd_lu(vd_L,vd_iT);};this.SelectDocument=function(vd_em,vd_lc){vd_L.vd_qo(vd_ai,vd_em,vd_lc,vd_sm);};function vd_xY(vd_jy){var vd_lm=vd_x();if(!vd_lm)return;var vd_a=vd_jy.vd_K;if(!vd_a)return;var vd_Gf=vd_jy.vd_oR.mergeFlags&1;var vd_AS=vd_lm.Model.Entities.Items;var vd_yU=vd_a.Model.Entities.Items;for(var i=0;i<vd_yU.length;i++){var hid=vd_yU[i];var vd_G=vd_a[hid];if(!vd_G)continue;if(!vd_lm[hid]){vd_lm[hid]=vd_G;vd_AS.push(hid);}else{if(vd_Gf)vd_lm[hid]=vd_G;}}if(vd_jy.vd_oR.vd_nT)vd_jy.vd_oR.vd_nT({vdcanvas:vd_L,mergedoc:vd_a,mergeFlags:vd_jy.vd_oR.mergeFlags});if(vd_aX!=null)clearTimeout(vd_aX);vd_aX=setTimeout(vd_L.redraw,0);};this.MergeDocument=function(filename,vd_nT,mergeFlags,vd_jA){var documentdata=new vd_ut(vd_L);documentdata.vd_oR={mergeFlags:mergeFlags,vd_nT:vd_nT};if(!vd_jA)vd_L.vd_qo(documentdata,filename,false,vd_xY);else documentdata.LoadDocument(filename,false,vd_xY,vd_jA);};this.SelectDocumentBlob=function(vd_jA,vd_em){if(!vd_ai)return;vd_ai.LoadDocument(vd_em,false,vd_sm,vd_jA);};function vd_HJ(){if(typeof XMLHttpRequest!="undefined"){return new XMLHttpRequest();}else if(typeof ActiveXObject!="undefined"){return new ActiveXObject("Microsoft.XMLHTTP");}else{return null;}};this.vd_qo=function(vd_qS,vd_em,vd_lc,vd_gR){if(!vd_qS)return;var _url=vd_em;if(vd_lc)_url+="?timestamp="+new Date().getTime();var vd_eZ=vd_HJ();if(!vd_eZ)return;if(!vd_gR)vd_gR=vd_L.redraw;vd_L.vd_cF.start(vd_L.MessagesDictionary.PROGRESS_DOWNLOAD,true);try{var done=false;vd_eZ.onprogress=function(evt){if(evt.lengthComputable)vd_L.vd_cF.Progress(evt.loaded,evt.total);else vd_L.vd_cF.Progress(evt.loaded/100,1);};vd_eZ.onreadystatechange=function(){if(vd_eZ.readyState==4&& !done){done=true;vd_L.vd_cF.end();if(vd_eZ.status==200||vd_eZ.status==0){vd_qS.LoadDocument(_url,false,vd_gR);}else{vd_L.vd_dN(vdConst.Err_LoadFile,vd_eZ.status,_url);}}};vd_eZ.open("GET",_url,true);vd_eZ.send();}catch(ex){done=true;vd_qS.LoadDocument(_url,false,vd_gR);}};var vd_ai=null;var vd_pi=null;function vd_nU(){if(!vd_pi)return vd_ai;return vd_pi;};function vd_x(){if(vd_ai==null)return null;return vd_ai.vd_K;};function vd_sm(vd_jy){vd_dO=0;vd_F.vd_nW();Action.cancel();var vd_a=vd_x();vd_L.scriptCommand=new vd_yW(vd_L);if(vd_a!=null){var layout=vd_L.GetActiveLayout();vd_F.vd_kT(vd_a.Palette,layout.BkColorEx);if(vd_a.LineTypeScale==undefined)vd_a.LineTypeScale=1.0;if(vd_L.vdAfterOpenDocument!=null)vd_L.vdAfterOpenDocument(vd_L);vd_L.SetActiveLayout(layout);}};this.SetSize=function(width,height,vd_o){if(vd_L.canvas==null)return;if(width){width=vdgeo.vd_qT(width);vd_L.canvas.setAttribute("width",width);if(vd_L.canvas.style)vd_L.canvas.style.width=width.toString()+"px";}if(height){height=vdgeo.vd_R(height);vd_L.canvas.setAttribute("height",height);if(vd_L.canvas.style)vd_L.canvas.style.height=height.toString()+"px";}width=vd_L.canvas.clientWidth?vd_L.canvas.clientWidth:vd_L.canvas.width;height=vd_L.canvas.clientHeight?vd_L.canvas.clientHeight:vd_L.canvas.height;if(vd_F!=null&&width==vd_F.width&&height==vd_F.height)return;if(vd_F!=null){vd_F.vd_y.vd_iY(null);vd_F.destroy();}vd_L.canvas.setAttribute("width",width);vd_L.canvas.setAttribute("height",height);vd_dW=null;vd_gE=null;ctx=vd_L.canvas.getContext("2d");var vd_vc=vd_F;vd_F=new vd_rz(vd_L,0,0,width,height,ctx);vd_cR.vd_zE(vd_F);vd_F.vd_sG(vd_vc);vd_vc=null;vd_F.vd_y.vd_iY(ctx.getImageData(0,0,width,height),width,height);vd_F.vd_kT(null,vd_o);Action.resize();setTimeout(vd_L.redraw);};function vd_dl(elem,vd_kD,vd_jV,vd_bj){if(elem.addEventListener)elem.addEventListener(vd_kD,vd_jV,vd_bj);else if(elem.attachEvent)elem.attachEvent('on'+vd_kD,vd_jV);};function vd_cK(elem,vd_kD,vd_jV,vd_bj){if(elem.removeEventListener)elem.removeEventListener(vd_kD,vd_jV,vd_bj);else if(elem.detachEvent)elem.detachEvent('on'+vd_kD,vd_jV);};var vd_bj=true;var vd_rZ=false;var vd_yG=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";function vd_Ey(){vd_dl(vd_L.canvas,'mousemove',vd_vx,vd_bj);vd_dl(vd_L.canvas,'mouseout',vd_wC,vd_bj);vd_dl(vd_L.canvas,'mouseover',vd_wb,vd_bj);vd_dl(vd_L.canvas,'mousedown',vd_vu,vd_bj);vd_dl(vd_L.canvas,'mouseup',vd_wl,vd_bj);vd_dl(vd_L.canvas,vd_yG,vd_vG,vd_bj);vd_dl(vd_L.canvas,'click',vd_to,vd_bj);vd_dl(vd_L.canvas,'contextmenu',vd_vB,vd_bj);vd_rZ=true;};function vd_yR(){if(!vd_rZ)return;vd_cK(vd_L.canvas,'mousemove',vd_vx,vd_bj);vd_cK(vd_L.canvas,'mouseout',vd_wC,vd_bj);vd_cK(vd_L.canvas,'mouseover',vd_wb,vd_bj);vd_cK(vd_L.canvas,'mousedown',vd_vu,vd_bj);vd_cK(vd_L.canvas,'mouseup',vd_wl,vd_bj);vd_cK(vd_L.canvas,vd_yG,vd_vG,vd_bj);vd_cK(vd_L.canvas,'click',vd_to,vd_bj);vd_cK(vd_L.canvas,'contextmenu',vd_vB,vd_bj);vd_rZ=false;};function vd_uV(e){vd_L.SetSize();};this.Init=function(vd_fT,width,height,vd_o){vd_L.canvas=document.getElementById(vd_fT);vd_L.canvas.tabindex='0';vd_L.canvas.style.cursor="crosshair";vd_dl(window,"resize",vd_uV,vd_bj);vd_dl(vd_L.canvas,"touchstart",vd_xw,vd_bj);vd_dl(vd_L.canvas,"touchend",vd_oO,vd_bj);vd_dl(vd_L.canvas,"touchcancel",vd_yj,vd_bj);vd_dl(vd_L.canvas,"touchleave",vd_xE,vd_bj);vd_dl(vd_L.canvas,"touchmove",vd_yB,vd_bj);vd_dl(window,"keydown",vd_xh,vd_bj);vd_Ey();vd_L.SetSize(width,height,vd_o);if(vd_ai)vd_ai.vd_tz();vd_ai=new vd_ut(vd_L);vd_pi=vd_ai;};this.vd_xB=function(){vd_cK(window,"resize",vd_uV,vd_bj);vd_cK(vd_L.canvas,"touchstart",vd_xw,vd_bj);vd_cK(vd_L.canvas,"touchend",vd_oO,vd_bj);vd_cK(vd_L.canvas,"touchcancel",vd_yj,vd_bj);vd_cK(vd_L.canvas,"touchleave",vd_xE,vd_bj);vd_cK(vd_L.canvas,"touchmove",vd_yB,vd_bj);vd_cK(window,"keydown",vd_xh,vd_bj);vd_yR();vd_F.vd_y.vd_iY(null);vd_F.destroy();vd_F=null;vd_L.canvas=null;ctx=null;vd_dW=null;vd_gE=null;if(vd_ai)vd_ai.vd_tz();vd_ai=null;vd_pi=null;};function vd_DE(vd_sQ){this.target=vd_sQ;var vd_L=this;this.Info="";this.percent=1000;var vd_me=0;var vd_lE=0;this.Cancel=false;var vd_rg=false;this.start=function(info,async,total){vd_rg=async;vd_L.Info=info;vd_L.Progress(-1000,1);if(total!=undefined)vd_lE=total;vd_me=0;return vd_L.Cancel;};this.end=function(){if(vd_L.percent!==1000)vd_L.Progress(100,100);vd_me=0;vd_lE=0;vd_L.percent=1000;vd_L.Info="";vd_rg=false;return vd_L.Cancel;};function vd_vo(current,total){if(total!=undefined)vd_lE=total;if(current==undefined)vd_me++;else vd_me=current;var vd_st=0;if(vd_lE>0)vd_st=Number((100*vd_me/vd_lE).toFixed(0));if(vd_st==vd_L.percent)return false;vd_L.percent=vd_st;return true;};function vd_ub(){if(vd_gm!=null)clearTimeout(vd_gm);vd_gm=null;vd_L.Cancel=false;if(vd_L.target.vdprogress!=null)vd_L.target.vdprogress(vd_L);if(!vd_L.Cancel&&vd_rg===true){if(vd_L.percent<0||vd_L.percent>=100)vd_L.target.Refresh();else{var vd_vX=24;var vd_wn=vdgeo.vd_R(vd_vX/2);vd_L.target.vd_hG().globalAlpha=80/255;vd_L.target.vd_hG().lineWidth=vd_vX;vd_L.target.vd_hG().strokeStyle=vdgdi.vd_ha([0,0,128]);vd_L.target.vd_hG().beginPath();vd_L.target.vd_hG().moveTo(0,vd_wn);vd_L.target.vd_hG().lineTo(vdgeo.vd_R(vd_L.target.canvas.width*vd_L.percent/100),vd_wn);vd_L.target.vd_hG().stroke();vd_L.target.vd_hG().globalAlpha=1;}}};var vd_gm=null;this.vd_GN=function(current,total){vd_vo(current,total);if(vd_gm!=null)clearTimeout(vd_gm);vd_gm=null;vd_gm=setTimeout(vd_ub,5);};this.Progress=function(current,total){var ret=vd_vo(current,total);if(ret)vd_ub();return ret;};return this;};this.vd_cF=new vd_DE(vd_L);function vd_BP(sender,vd_FK,vd_EG,vd_Ev,p1,p2){var vd_L=this;this.NumTouchs=vd_FK;this.PrevPos1=vd_EG;this.PrevPos2=vd_Ev;this.Pos1=p1;this.Pos2=p2;this.target=sender;this.Cancel=false;this.toString=function(){var ret=vd_L.NumTouchs.toString();if(vd_L.PrevPos1!=null)ret+=(' , '+vd_L.PrevPos1[X].toString()+' , '+vd_L.PrevPos1[Y].toString());else ret+=", null";if(vd_L.Pos1!=null)ret+=(' , '+vd_L.Pos1[X].toString()+' , '+vd_L.Pos1[Y].toString());else ret+=", null";if(vd_L.PrevPos2!=null)ret+=(' , '+vd_L.PrevPos2[X].toString()+' , '+vd_L.PrevPos2[Y].toString());else ret+=", null";if(vd_L.Pos2!=null)ret+=(' , '+vd_L.Pos2[X].toString()+' , '+vd_L.Pos2[Y].toString());else ret+=", null";return ret;};return this;};function vd_eW(sender,button,vd_iL,pos,pPos,vd_hW,skey){var vd_L=this;this.mousebutton=button;this.skey=skey;this.istouched=vd_iL;this.xPix=vdgeo.vd_R(pos[X]);this.yPix=vdgeo.vd_R(pos[Y]);this.prevPos=pPos;this.Delta=vd_hW;var vd_fq=vd_F.vd_pe(pos[X],pos[Y]);this.x=vd_fq[X];this.y=vd_fq[Y];this.z=vd_fq[Z];this.target=sender;this.Cancel=false;this.toString=function(){var ret="";ret+=(vd_L.mousebutton.toString()+' ,'+(vd_L.istouched===true?"true":"false")+' ,');ret+=(vd_L.xPix.toString()+' '+vd_L.yPix.toString()+' ,');ret+=((vd_L.prevPos!=null?(vd_L.prevPos[X].toString()+' '+vd_L.prevPos[Y].toString()):'null')+' ');return ret;};return this;};this.vdAfterOpenDocument=function(e){};this.vdAfterSaveDocument=function(e){};this.vdmousemoveAfter=function(e){};this.vdmousemove=function(e){};this.vdmousedown=function(e){};this.vdmouseup=function(e){};this.vdmousewheel=function(e){};this.vdmouseout=function(e){};this.vddblclick=function(e){};this.vdclick=function(e){};this.vdtouchMove=function(e){};this.vdprogress=function(e){};this.vdPrompt=function(e,msg){};this.vdKeyDown=function(e){};this.vdError=function(sender,vd_uY,vd_xr,info){};this.vdLoadXref=function(e){};this.vdXrefLoaded=function(e){};this.vdSelectionModified=null;this.vdActionDraw=null;function vd_jS(sender,vx,vy,vz,vs,vd_bM){this.target=sender;this.ViewCenterX=vx;this.ViewCenterY=vy;this.ViewCenterZ=vz;this.ViewSize=vs;this.vd_pr=vd_bM;this.Cancel=false;};this.vdUpdateView=function(e){};this.vd_dN=function(vd_uY,vd_xr,info){if(vd_L.vdError!=null)vd_L.vdError(vd_L,vd_uY,vd_xr,info);};this.MessagesDictionary={SELECT_ENTITIES:'Select entities',SPECIFY_REFERENCE_POINT:'Specify reference point',SPECIFY_START_POINT:'Specify start point',SPECIFY_SECOND_POINT:'Specify second point',SPECIFY_END_POINT:'Specify end point',SPECIFY_NEXT_POINT:'Specify next point',SPECIFY_CENTER_POINT:'Specify center point',SPECIFY_RADIUS:'Specify radius',SPECIFY_FIRST_CORNER:'Specify first corner',SPECIFY_OTHER_CORNER:'Specify other corner',SPECIFY_INSERTION_POINT:'Specify insertion point',SPECIFY_SCALE:'Specify scale',SPECIFY_ROTATION:'Specify rotation',PROGRESS_DOWNLOAD:'Download drawing...',PROGRESS_READ_DRAWING:'Read drawing...'};this.Prompt=function(msg){if(vd_L.vdPrompt!=null)vd_L.vdPrompt(this,msg);};function vd_Cq(obj){if(obj==undefined)obj=vd_L.canvas;var vd_wg=0,vd_wZ=0;if(obj.offsetParent){do{vd_wg+=obj.offsetLeft;vd_wZ+=obj.offsetTop;obj=obj.offsetParent;}while(obj);return[vd_wg,vd_wZ];}return[obj.offsetLeft,obj.offsetTop];};function vd_cd(evt,target){if(evt.offsetX&&evt.offsetY)return[vdgeo.vd_R(evt.offsetX),vdgeo.vd_R(evt.offsetY)];var vd_vn=vd_Cq(target);return[vdgeo.vd_R(evt.pageX-vd_vn[X]),vdgeo.vd_R(evt.pageY-vd_vn[Y])];};this.vd_gP=function(pos){return pos[X]>=0&&pos[X]<vd_L.canvas.width&&pos[Y]>=0&&pos[Y]<vd_L.canvas.height;};var vd_mL=false;var vd_qC=false;var vd_pw=false;function vd_oY(){vd_mL=false;vd_qC=false;vd_pw=false;};function vd_ea(e){var ret=0;if(e.altKey)ret+=1;if(e.ctrlKey)ret+=2;if(e.shiftKey)ret+=4;return ret;};function vd_go(e){if(vd_mL)return 1;if(vd_qC)return 2;if(vd_pw)return 3;return 0;};var vd_cB=[];function vd_ns(vd_HT){for(var i=0;i<vd_cB.length;i++){if(vd_HT==vd_cB[i][0])return i;}return-1;};function cancelBubble(e){var evt=e?e:window.event;if(evt.stopPropagation)evt.stopPropagation();if(evt.cancelBubble!=null)evt.cancelBubble=true;};function vd_hg(e){var evt=e?e:window.event;if(evt.preventDefault)evt.preventDefault();evt.returnValue=false;return false;};var vd_cE=true;var vd_ow=0;var vd_rh=0;var vd_mT=null;function vd_to(evt,vd_iL){var ret=false;var vd_s;var date=new Date();var vd_AZ=date.getTime();vd_ow=(vd_AZ<=(vd_rh+500))?(vd_ow+1):1;vd_rh=date.getTime();var vd_jr;if(vd_iL)vd_jr=vd_cd(evt.touches[0],evt.target);else vd_jr=vd_cd(evt,evt.target);if(vd_ow===2){vd_ow=0;vd_rh=0;if(vd_mT!=null){var xdif=Math.abs(vd_jr[X]-vd_mT[X]);var ydif=Math.abs(vd_jr[Y]-vd_mT[Y]);if((xdif<20)&&(ydif<20)){vd_s=new vd_eW(vd_L,vd_go(evt),vd_iL==true,vd_jr,null,0,vd_ea(evt));if(vd_L.vddblclick!=null)vd_L.vddblclick(vd_s);if(!vd_s.Cancel){Action.dblclick(vd_s);}ret=true;}}}if(ret==false){vd_s=new vd_eW(vd_L,vd_go(evt),false,vd_jr,null,0,vd_ea(evt));if(vd_L.vdclick!=null)vd_L.vdclick(vd_s);if(!vd_s.Cancel){Action.click(vd_s);ret=(vd_iL!==true);}}if(vd_iL)vd_mT=vd_cd(evt.touches[0],evt.target);else vd_mT=vd_cd(evt,evt.target);return ret;};function vd_vB(e){e.preventDefault();return false;};function vd_xw(evt){vd_no(evt,true);vd_dd=null;vd_yR();Action.vd_pW();var touches=evt.touches;var pos;vd_cB.length=0;for(var i=0;i<touches.length;i++){pos=vd_cd(touches[i],evt.target);if(!vd_L.vd_gP(pos))continue;vd_cB.push([touches[i].identifier,pos]);}if(touches.length==1&&vd_cB.length==1){if(vd_to(evt,true))return vd_hg(evt);pos=vd_cd(touches[0],evt.target);var vd_s=new vd_eW(vd_L,1,true,pos,null,0,vd_ea(evt));if(vd_L.vdmousedown!=null)vd_L.vdmousedown(vd_s);if(!vd_s.Cancel){Action.mousedown(vd_s);}}cancelBubble(evt);return vd_hg(evt);};function vd_oO(evt){vd_no(evt,false);vd_dd=null;Action.vd_pW();var touches=evt.changedTouches;if(vd_cB.length==1&&touches.length==1&&evt.touches.length==0&&vd_ns(touches[0].identifier)!= -1){pos=vd_cd(touches[0],evt.target);var vd_s=new vd_eW(vd_L,1,true,pos,null,0,vd_ea(evt));if(vd_L.vdmouseup!=null)vd_L.vdmouseup(vd_s);if(!vd_s.Cancel){if(vd_L.vdmouseout!=null)vd_L.vdmouseout(vd_s);if(!vd_s.Cancel)Action.mouseup(vd_s);}}vd_cB.length=0;return vd_cE;};function vd_xE(evt){return vd_oO(evt);};function vd_yj(evt){return vd_oO(evt);};function vd_yB(evt){Action.vd_pW();var touches=evt.changedTouches;if(evt.touches.length==evt.targetTouches.length){if(evt.touches.length==1&&touches.length==1&&vd_cB.length==1&&vd_ns(touches[0].identifier)!= -1){var pos=vd_cd(touches[0],evt.target);if(vd_dd==null)vd_dd=[pos[0],pos[1],vd_F.vd_y.vd_mY(pos[0],pos[1])];var distance=vdgeo.Distance2D(pos,vd_dd);if(!vdgeo.AreEqual(distance,0,0)){var vd_s=new vd_eW(vd_L,1,true,pos,vd_dd,0,vd_ea(evt));if(vd_L.vdmousemove!=null)vd_L.vdmousemove(vd_s);if(!vd_s.Cancel){Action.mousemove(vd_s);if(vd_L.vdmousemoveAfter!=null)vd_L.vdmousemoveAfter(vd_s);}}}else if(evt.touches.length==2&&touches.length==2&&vd_cB.length==2){var pos1=null;var pos2=null;var idx1= -1;var idx2= -1;var vd_gZ=null;var vd_fl=null;idx1=vd_ns(touches[0].identifier);idx2=vd_ns(touches[1].identifier);if(idx1!== -1&&idx2!== -1){pos1=vd_cd(touches[0],evt.target);pos2=vd_cd(touches[1],evt.target);vd_gZ=vd_cB[idx1][1];vd_fl=vd_cB[idx2][1];vd_cB.splice(idx1,1,[vd_cB[idx1][0],pos1]);vd_cB.splice(idx2,1,[vd_cB[idx2][0],pos2]);if(vd_L.vd_gP(pos1)&&vd_L.vd_gP(pos2)){vd_s=new vd_BP(vd_L,2,vd_gZ,vd_fl,pos1,pos2);if(vd_L.vdtouchMove!=null)vd_L.vdtouchMove(vd_s);if(!vd_s.Cancel){Action.vd_AP(vd_s);}}}}cancelBubble(evt);return vd_hg(evt);}return vd_cE;};var vd_dd=null;function vd_vx(e){var pos=vd_cd(e,e.target);if(!vd_L.vd_gP(pos))return vd_cE;if(vd_dd==null)vd_dd=[pos[0],pos[1],vd_F.vd_y.vd_mY(pos[0],pos[1])];var distance=vdgeo.Distance2D(pos,vd_dd);if(!vdgeo.AreEqual(distance,0,0)){var vd_s=new vd_eW(vd_L,vd_go(e),e.istouched,pos,vd_dd,0,vd_ea(e));if(vd_L.vdmousemove!=null)vd_L.vdmousemove(vd_s);if(!vd_s.Cancel){Action.mousemove(vd_s);if(vd_L.vdmousemoveAfter!=null)vd_L.vdmousemoveAfter(vd_s);cancelBubble(e);return vd_hg(e);}}return vd_cE;};function vd_vG(e){var pos=vd_cd(e,e.target);if(!vd_L.vd_gP(pos))return vd_cE;var Delta=e.detail?(e.detail* -1):e.wheelDelta;Delta=(Delta<0?vd_L.MouseWheelZoomScale:(1/vd_L.MouseWheelZoomScale));var vd_s=new vd_eW(vd_L,vd_go(e),e.istouched,pos,null,Delta,vd_ea(e));if(vd_L.vdmousewheel!=null)vd_L.vdmousewheel(vd_s);if(!vd_s.Cancel){Action.mousewheel(vd_s);cancelBubble(e);return vd_hg(e);}return vd_cE;};function vd_no(e,vd_GV){e.preventDefault();vd_oY();if(('ontouchstart'in document.documentElement)||('ontouchstart'in window))vd_mL=true;else if(e.which==1)vd_mL=true;else if(e.which==2)vd_qC=true;else if(e.which==3)vd_pw=true;};function vd_vu(e){vd_no(e,true);vd_dd=null;var pos=vd_cd(e,e.target);if(!vd_L.vd_gP(pos))return vd_cE;var vd_s=new vd_eW(vd_L,vd_go(e),e.istouched,pos,null,0,vd_ea(e));if(vd_L.vdmousedown!=null)vd_L.vdmousedown(vd_s);if(!vd_s.Cancel){Action.mousedown(vd_s);cancelBubble(e);return vd_hg(e);}return vd_cE;};function vd_wl(e){vd_dd=null;var pos=vd_cd(e,e.target);if(!vd_L.vd_gP(pos)){Action.cancel();return vd_cE;}vd_no(e,false);var vd_s=new vd_eW(vd_L,vd_go(e),e.istouched,pos,null,0,vd_ea(e));if(vd_L.vdmouseup!=null)vd_L.vdmouseup(vd_s);if(!vd_s.Cancel){Action.mouseup(vd_s);cancelBubble(e);vd_oY();return vd_hg(e);}vd_oY();return vd_cE;};function vd_wb(e){var pos=vd_cd(e,e.target);var vd_s=new vd_eW(vd_L,vd_go(e),e.istouched,pos,null,0,vd_ea(e));Action.mouseover(vd_s);return vd_cE;};function vd_wC(e){vd_oY();var pos=vd_cd(e,e.target);var vd_s=new vd_eW(vd_L,vd_go(e),e.istouched,pos,null,0,vd_ea(e));if(vd_L.vdmouseout!=null)vd_L.vdmouseout(vd_s);if(!vd_s.Cancel){Action.mouseout(vd_s);cancelBubble(e);return vd_hg(e);}return vd_cE;};function vd_xh(e){if(vd_L.vdKeyDown!=null)vd_L.vdKeyDown(e);if(e.Cancel!==true)Action.keydown(e);return vd_cE;};return this;};function vd_EV(vd_sO){var vd_L=this;var vd_df=vd_sO;var vd_hA=0;var vd_iJ=false;this.Enable=true;var vd_be=[];var vd_ee=[];function vd_kv(_obj,vd_gg,vd_zI){this.obj=_obj;this.name=vd_gg;this.value=vd_zI;};function vd_ue(value){this.undogoup=value;};Object.defineProperty(vd_L,'UndoStack',{get:function(){return vd_be;},});function vd_uB(obj){if(!vdConst.vd_Iq(obj))return;vd_df.UpdateFig(obj);vd_iJ=true;};function vd_DP(){if(!vd_be||vd_be.length==0)return-1;var vd_bF=vd_be[vd_be.length-1];vd_be.length-=1;if(!vd_ee)vd_ee=[];if(vd_bF.name==='special_transform'){vd_bF.value.reverse();vd_ee.push(new vd_kv(vd_bF.obj,vd_bF.name,vd_bF.value));vd_g.vd_gO(vd_bF.value[0],vd_bF.obj);}else{vd_ee.push(new vd_kv(vd_bF.obj,vd_bF.name,vd_bF.obj[vd_bF.name]));vd_bF.obj[vd_bF.name]=vd_bF.value;}vd_uB(vd_bF.obj);if(vd_bF.obj['undogoup']!=undefined)vd_hA+=(vd_bF.obj['undogoup']? -1:1);return vd_hA;};function vd_DH(){if(!vd_ee||vd_ee.length==0)return-1;var vd_bF=vd_ee[vd_ee.length-1];vd_ee.length-=1;if(!vd_be)vd_be=[];if(vd_bF.name==='special_transform'){vd_bF.value.reverse();vd_be.push(new vd_kv(vd_bF.obj,vd_bF.name,vd_bF.value));vd_g.vd_gO(vd_bF.value[0],vd_bF.obj);}else{vd_be.push(new vd_kv(vd_bF.obj,vd_bF.name,vd_bF.obj[vd_bF.name]));vd_bF.obj[vd_bF.name]=vd_bF.value;}vd_uB(vd_bF.obj);if(vd_bF.obj['undogoup']!=undefined)vd_hA+=(vd_bF.obj['undogoup']? -1:1);return vd_hA;};this.Clear=function(){vd_be=[];vd_ee=[];vd_hA=0;};this.store=function(obj,name,value){if(!vd_L.Enable)return;if(!vd_be)vd_be=[];if(value==undefined)value=obj[name];vd_be.push(new vd_kv(obj,name,value));};this.group_start=function(){vd_L.store(new vd_ue(false),'undogoup',true);};this.group_end=function(){if(vd_be&&vd_be.length>0&&vd_be[vd_be.length-1].name==='undogoup'&&vd_be[vd_be.length-1].value===true){vd_be.pop();return;}vd_L.store(new vd_ue(true),'undogoup',false);};this.undo=function(){vd_iJ=false;do{}while(vd_DP()>0);if(vd_iJ)vd_df.UpdateLayout();vd_iJ=false;};this.redo=function(){vd_iJ=false;do{}while(vd_DH()>0);if(vd_iJ)vd_df.UpdateLayout();vd_iJ=false;};return this;};var vd_tE={};vd_tE.chk=function(vd_df,palette){var s;var k;if(palette._lc){var vl=[String.fromCharCode(104,116,116,112,58,47,47,100,101,118,46,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,58,47,47,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,58,47,47,119,119,119,46,118,100,114,97,119,46,99,111,109,47),String.fromCharCode(104,116,116,112,58,47,47,119,119,119,46,118,100,114,97,119,98,111,120,46,99,111,109,47),String.fromCharCode(104,116,116,112,115,58,47,47,119,119,119,46,118,100,114,97,119,98,111,120,46,99,111,109,47),];var u=decodeURI(document.location.href.split('?')[0]);for(k=0;k<vl.length;k++){palette._lc._a1=u.substring(0,vl[k].length)==vl[k];if(palette._lc._a1)break;}var lv=vd_df[String.fromCharCode(108,105,99,118,97,108)];if(!palette._lc._a1&&lv){var suc1=false;for(k=0;k<lv.length;k++){s=base64.vd_vm(base64.vd_wF(lv[k].split('').reverse().join('')));suc1=document._lc.indexOf(s)>=0;if(suc1)break;}if(suc1){for(k=0;k<lv.length;k++){s=base64.vd_vm(base64.vd_wF(lv[k].split('').reverse().join('')));palette._lc._a1=u.indexOf(s)>=0;if(palette._lc._a1)break;}}}}};function vd_ut(vd_sO){var vd_L=this;var vd_df=vd_sO;this.vd_vU=new vd_Eu();this.FileName="";this.vd_jD="";this.Loaded=false;this.vd_K=null;var vd_Hu=false;var vd_iK=null;var vd_kB=false;var vd_cH=[];function vd_DZ(){var vd_lW=document.getElementsByTagName('head')[0];for(var k=0;k<vd_cH.length;k++){vd_cH[k].onreadystatechange=null;vd_cH[k].onload=null;vd_cH[k].readyState='none';vd_cH[k].innerHTML="";vd_lW.removeChild(vd_cH[k]);}vd_cH=[];};function vd_uN(e){var id= -1;for(var k=0;k<vd_cH.length;k++){if(vd_cH[k]===e.target){id=k;break;}}if(id=== -1)return;var vd_lW=document.getElementsByTagName('head')[0];vd_cH[id].onreadystatechange=null;vd_cH[id].onload=null;vd_cH[id].readyState='none';vd_cH[id].innerHTML="";vd_lW.removeChild(vd_cH[id]);vd_cH.splice(id,1);};this.vd_AI=function(item){return vd_L.vd_K[item];};this.vd_Ak=function(vd_ah,vd_fs){if(!vd_fs)return null;return vd_ah.Items[vd_ah[vd_fs]];};this.vd_wk=function(vd_ah,vd_fs){if(!vd_fs)return null;return vd_L.vd_K[vd_fs];};this.vd_eO=vd_L.vd_wk;this.vd_qn=false;function vd_Di(){if(!vd_L.vd_K.Lights)vd_L.vd_K.Lights={};if(!vd_L.vd_K.Lights.Default){vd_L.vd_K.Lights.Default={};vd_L.vd_K.Lights.Default.Enable=true;}if(!vd_L.vd_K.Lights.Default.Name)vd_L.vd_K.Lights.Default.Name='default';if(!vd_L.vd_K.Lights.Default.SpotFallOff)vd_L.vd_K.Lights.Default.SpotFallOff=0;if(!vd_L.vd_K.Lights.Default.SpotAngle)vd_L.vd_K.Lights.Default.SpotAngle=180;if(!vd_L.vd_K.Lights.Default.TypeOfLight)vd_L.vd_K.Lights.Default.TypeOfLight=1001;if(!vd_L.vd_K.Lights.Default.color)vd_L.vd_K.Lights.Default.color=[255,255,255,255];if(!vd_L.vd_K.Lights.Default.Intensity)vd_L.vd_K.Lights.Default.Intensity=1;if(!vd_L.vd_K.Lights.Default.Position)vd_L.vd_K.Lights.Default.Position=[0,0,0];if(!vd_L.vd_K.Lights.Default.Direction)vd_L.vd_K.Lights.Default.Direction=[0,0,-1];};function vd_CY(){var vd_nc=vd_L.vd_K.LineTypes;if(vd_nc==undefined)return;for(var i=0;i<vd_nc.Items.length;i++){var linetype=vd_L.vd_eO(vd_nc,vd_nc.Items[i]);if(!linetype||linetype.Segments==undefined)continue;for(var j=0;j<linetype.Segments.Items.length;j++){var vd_j=linetype.Segments.Items[j];if(vd_j.Shape!=undefined&&vd_j.Shape!=null)continue;if(vd_j.Flag!=vdConst.LINETYPE_FLAG_TTF_TEXT&&vd_j.Flag!=vdConst.LINETYPE_FLAG_SHX_TEXT)continue;if(vd_j.Flag===vdConst.LINETYPE_FLAG_TTF_TEXT){if(vd_j.ShapeText.length>0){vd_j.Shapenumber=vd_j.ShapeText.charCodeAt(0);}else continue;}vd_j.ShapeStyleRef=vd_L.vd_eO(vd_L.vd_K.TextStyles,vd_j.ShapeStyle);if(vd_j.ShapeStyleRef==null||vd_j.ShapeStyleRef.FontFileVDS==null)continue;if(vd_j.ShapeStyleRef.FontFileVDS==null)continue;var vd_fN=vd_j.ShapeStyleRef.FontFileVDS.Shapes['h_'+vd_j.Shapenumber.toString()];if(vd_fN==undefined)continue;var shape=vd_j.ShapeStyleRef.FontFileVDS.Shapes.Items[vd_fN];if(shape==null)continue;vd_j.Shape=shape;if(vd_j.ShapeRotation==undefined)vd_j.ShapeRotation=0.0;if(vd_j.ShapeOffsetX==undefined)vd_j.ShapeOffsetX=0.0;if(vd_j.ShapeOffsetY==undefined)vd_j.ShapeOffsetY=0.0;}}};this.vd_vN=function(vd_sw,vd_U){var vd_mQ=vd_sw.width;var vd_lX=vd_sw.height;if(vd_mQ==0||vd_lX==0)return undefined;var vd_dm=(vd_U.Transparency&&vd_U.Transparency[3]===255)?vd_U.Transparency:null;var vd_pb=(parseInt(vd_df.MaxImageSize))||768*720;vd_pb=(vd_pb<300*300)?768*720:vd_pb;var div=1;var width=vd_mQ;var height=vd_lX;while(((width/div)*(height/div))>vd_pb)div++;width/=div;height/=div;width=vdgeo.vd_R(width);height=vdgeo.vd_R(height);var bytes=[];var vd_dW=document.createElement("CANVAS");vd_dW.setAttribute("width",width);vd_dW.setAttribute("height",height);var vd_gE=vd_dW.getContext("2d");vd_gE.globalCompositeOperation="copy";vd_gE.drawImage(vd_sw,0,0,vd_mQ,vd_lX,0,0,width,height);var vd_mk=vd_gE.getImageData(0,0,width,height);bytes.length=height;var r,g,b,a;var wlen=width*4;for(var h=height-1;h>=0;h--){var start=h*width*4;var _h=height-h-1;bytes[_h]=[];bytes[_h].length=width*4;var k=0;for(var w=0;w<wlen;w+=4){r=vd_mk.data[start+w];g=vd_mk.data[start+w+1];b=vd_mk.data[start+w+2];a=vd_mk.data[start+w+3];if(a!==0&&vd_dm&&r===vd_dm[0]&&g===vd_dm[1]&&b===vd_dm[2])a=0;bytes[_h][k]=r;k++;bytes[_h][k]=g;k++;bytes[_h][k]=b;k++;bytes[_h][k]=a;k++;}}vd_U.bytes=bytes;vd_U.bytescount=4;vd_U.width=width;vd_U.height=height;if(vd_U.OriginalWidth==1)vd_U.OriginalWidth=vd_mQ;if(vd_U.OriginalHeight==1)vd_U.OriginalHeight=vd_lX;};var vd_lk=0;function vd_tV(vd_U){if(!vd_U)return;var vd_dm=(vd_U.Transparency&&vd_U.Transparency[3]===255)?vd_U.Transparency:null;var r,g,b,a;if(vd_U.bytes&& !vd_U.bytescount){var bytes=[];bytes.length=vd_U.height;for(var h=0;h<vd_U.height;h++){var vd_jl=[];vd_jl.length=vd_U.width*4;bytes[h]=vd_jl;var k=0;for(var w=0;w<vd_U.width;w++){b=vd_U.bytes[h][w*3];g=vd_U.bytes[h][w*3+1];r=vd_U.bytes[h][w*3+2];a=255;if(vd_dm&&r===vd_dm[0]&&g===vd_dm[1]&&b===vd_dm[2])a=0;vd_jl[k]=r;k++;vd_jl[k]=g;k++;vd_jl[k]=b;k++;vd_jl[k]=a;k++;}}vd_U.bytes=bytes;vd_U.bytescount=4;return;}if(!vd_U.jpegData||vd_U.bytes)return;vd_lk++;var vd_ge=document.createElement("img");var iformat=vd_U.iformat?vd_U.iformat:"jpg";vd_ge.setAttribute("src","data:image/"+iformat+";base64,"+vd_U.jpegData);vd_ge.setAttribute("width",vd_U.width);vd_ge.setAttribute("height",vd_U.height);vd_ge.vd_tj=vd_U;vd_ge.onload=function(evt){var vd_tj=evt.target.vd_tj;vd_L.vd_vN(evt.target,vd_tj);vd_lk--;if(vd_lk===0){if(vd_iK)vd_iK(vd_L);vd_kQ();}}};function vd_Ee(){var vd_mg=vd_L.vd_K.Images;if(!vd_mg)return;for(var i=0;i<vd_mg.Items.length;i++){var vd_U=vd_L.vd_eO(vd_mg,vd_mg.Items[i]);vd_tV(vd_U);}};function vd_DM(){var palette=vd_L.vd_K.Palette;vd_tV(palette._lc);for(var i=0;i<palette.Items.length;i++){if(palette.Items[i].MaterialImageRef!=undefined)continue;palette.Items[i].MaterialImageRef=vd_L.vd_eO(vd_L.vd_K.Images,palette.Items[i].MaterialImage);}vd_tE.chk(vd_df,palette);};function vd_Ej(){var vd_lD=vd_L.vd_K.TextStyles;if(vd_lD==undefined)return;for(var i=0;i<vd_lD.Items.length;i++){var style;if(vd_L.vd_qn){style=vd_lD.Items[i];}else{style=vd_L.vd_K[vd_lD.Items[i]];}if(style.FontFileVDS==null||style.FontFileVDS==undefined){try{style.FontFileVDS=vd_L.vd_K[style.Font];}catch(ex){style.FontFileVDS=null;}}}};function vd_CL(){vd_L.vd_K.UndoHistory=new vd_EV(vd_df);vd_lk=0;vd_L.vd_K.pathname=vd_L.vd_jD;if(vd_L.vd_K.LineTypeScale==undefined)vd_L.vd_K.LineTypeScale=1.0;if(vd_L.vd_K.LayOuts==undefined||vd_L.vd_K.LayOuts[vd_L.vd_K.ActiveLayOut]==undefined)vd_L.vd_K.ActiveLayOutRef=vd_L.vd_K.Model;else vd_L.vd_K.ActiveLayOutRef=vd_L.vd_K.LayOuts.Items[vd_L.vd_K.LayOuts[vd_L.vd_K.ActiveLayOut]];if(vd_L.vd_K.ActiveView&&vd_L.vd_K.Views&&vd_L.vd_K.Views.Items&&vd_L.vd_K.Views[vd_L.vd_K.ActiveView])vd_L.vd_K.vd_gK=vd_L.vd_K.Views.Items[vd_L.vd_K.Views[vd_L.vd_K.ActiveView]];if(vd_L.vd_K.Images==undefined)vd_L.vd_K.Images={Items:[]};vd_L.vd_K.ActiveLineTypeRef=vd_L.vd_eO(vd_L.vd_K.LineTypes,vd_L.vd_K.ActiveLineType);vd_L.vd_K.ActiveTextStyleRef=vd_L.vd_eO(vd_L.vd_K.TextStyles,vd_L.vd_K.ActiveTextStyle);vd_L.vd_K.ActiveLayerRef=vd_L.vd_eO(vd_L.vd_K.Layers,vd_L.vd_K.ActiveLayer);vd_L.vd_K.vd_fn=vdConst.OsnapMode_DISABLE;vd_Ej();vd_CY();vd_Di();vd_DM();vd_Ee();vd_L.vd_vU.SelectDocument(vd_L.vd_K);if(vd_lk===0){if(vd_iK)vd_iK(vd_L);vd_kQ();}};function vd_uk(){if(!vd_jp)vd_kF(null,5000);else{try{eval(vd_jp);if(_vdDocTmp){vd_L.vd_eO=vd_L.vd_Ak;vd_L.vd_qn=true;vd_ud();}vd_um();}catch(ex){vd_kF(ex,6000);}}};this.Empty=function(){vd_kQ();vd_DZ();if(vd_L.vd_jn){for(var idoc=0;idoc<vd_L.vd_jn.length;idoc++){if(vd_L.vd_jn[idoc].documentdata){vd_L.vd_jn[idoc].documentdata.Empty();}}vd_L.vd_jn=[];}vd_L.vd_K=null;};this.vd_tz=function(){vd_L.Empty();vd_df=null;};function vd_um(){vd_jp=null;if(vd_dt)vd_dt.length=0;vd_dt=null;_vdDocTmp=null;};function vd_kF(ex,timeout){vd_kQ();vd_L.Loaded=true;vd_L.vd_K=null;vd_df.vd_cF.end();vd_df.vd_dN(vdConst.Err_LoadFile,1000+timeout,(ex?ex.message:""));vd_kB=false;};function progress(i){vd_df.vd_cF.Progress(i,100);};function vd_ud(){vd_df.vd_cF.end();if(!_vdDocument)vd_df.vd_dN(vdConst.Err_LoadFile,-101,vd_L.vd_jD);vd_L.Loaded=true;vd_L.vd_K=_vdDocument;if(vd_L.vd_K){vd_CL();}else{vd_kQ();}vd_kB=false;};function vd_kQ(){vd_um();vd_iK=null;_vdDocument=null;vd_lk=0;};function vd_Ib(vd_wL,codetype){var vd_lW=document.getElementsByTagName('head')[0];var js1=document.createElement('script');js1.setAttribute('type','text/javascript');if(codetype===0){js1.setAttribute('src',vd_wL);vd_L.vd_jD=decodeURI(js1.src);document._lc=vd_L.vd_jD;}else{js1.innerHTML=vd_wL;}vd_lW.appendChild(js1);vd_cH.push(js1);js1.onerror=function(e){vd_uN(e);vd_kF(null,1000);};js1.onreadystatechange=function(e){if(e.readyState=="loaded"||e.readyState=='complete'||e.target.readyState=="loaded"||e.target.readyState=='complete'){e.readyState="complete";vd_uN(e);if(_vdDocTmp){vd_ve(_vdDocTmp);}}};js1.onload=function(e){e.readyState='complete';e.target.onreadystatechange(e);}};this.vd_xI=function(){return vd_kB;};this.LoadDocument=function(vd_em,vd_lc,vd_gR,vd_jA){if(vd_kB)return;vd_kB=true;vd_L.Empty();if(!vd_gR)vd_gR=vd_df.redraw;vd_df.vd_cF.start(vd_df.MessagesDictionary.PROGRESS_READ_DRAWING,true);vd_iK=vd_gR;vd_L.vd_eO=vd_L.vd_wk;vd_L.vd_qn=false;vd_L.Loaded=false;vd_L.FileName=vd_em;vd_L.vd_jD=vd_em;document._p=progress;document._l=vd_ud;document._e=vd_kF;document._d=vd_ve;var _url=vd_em;if(vd_lc)_url+="?timestamp="+new Date().getTime();if(vd_jA){document._lc=vd_em;eval(vd_jA);}else{vd_Ib(_url,0);}};function __a(vd_ch,r,w){try{progress(vdgeo.vd_R(100*r/vd_ch.length));if(r==vd_ch.length){vd_uk();w=undefined;return;}for(var c=0;c<vd_ch[r].length;c++){var entry="";var k=vd_ch[r][c];if(r===0&&c===0){w=String.fromCharCode(k);vd_jp=w;continue;}if(vd_dt[k]){entry=vd_dt[k];}else{if(k===vd_dt.length){entry=w+w.charAt(0);}else{vd_jp=undefined;w=undefined;vd_uk();return;}}vd_jp+=entry;vd_dt.push(w+entry.charAt(0));w=entry;entry=undefined;}vd_ch[r].length=0;vd_ch[r]=null;r++;}catch(ex){vd_kF(ex,r);return;}setTimeout(function(){__a(vd_ch,r,w)},0);};var vd_jp=undefined;var vd_dt=undefined;function vd_ve(vd_ch){var w,r=0;vd_jp=undefined;vd_dt=[];for(var i=0;i<256;i+=1)vd_dt[i]=String.fromCharCode(i);r=0;setTimeout(function(){__a(vd_ch,r,w)},0);};return this;};function vd_CX(){var vd_L=this;var vd_eJ=[];this.AttachCanvas=function(vd_fT,width,height,vd_o){vd_L.DettachCanvas(vd_fT);var vd_rB=new vd_bS();vd_rB.Init(vd_fT,width,height,vd_o);vd_eJ.push(vd_rB);return vd_rB;};this.DettachCanvas=function(vd_fT){var id= -1;for(var i=0;i<vd_eJ.length;i++){if(vd_eJ[i].canvas.id===vd_fT){vd_eJ[i].vd_xB();id=i;break;}}if(id=== -1)return;vd_eJ.splice(id,1);};this.vdrawObject=function(vd_fT){if(!vd_fT){if(vd_eJ.length>0)return vd_eJ[vd_eJ.length-1];return null;}for(var i=0;i<vd_eJ.length;i++){if(vd_eJ[i].canvas.id===vd_fT)return vd_eJ[i];}return null;};return this;};var vdmanager=new vd_CX();var vd_g={};vd_g.vd_gO=function(mat,vd_G,vdcanvas){if(vdgeo.vd_qN(mat))return;if(vd_G._t===vdConst.vdLine_code)vd_g.vd_Da(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdPolyline_code)vd_g.vd_Dz(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdText_code)vd_g.vd_qH(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdRect_code)vd_g.vd_xK(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdCircle_code)vd_g.vd_DJ(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdEllipse_code)vd_g.vd_DN(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdArc_code)vd_g.vd_Dt(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdImage_code)vd_g.vd_xK(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdInsert_code)vd_g.vd_Et(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vd3DFace_code)vd_g.vd_Er(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdPolyface_code)vd_g.vd_DG(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdAttrib_code)vd_g.vd_qH(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdAttribDef_code)vd_g.vd_qH(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdInfinityLine_code)vd_g.vd_Df(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdPoint_code)vd_g.vd_DD(mat,vd_G,vdcanvas);else if(vd_G._t===vdConst.vdPolyhatch_code)vd_g.vd_EL(mat,vd_G,vdcanvas);else if(vd_G.Explode!=undefined)vd_g.vd_Dq(mat,vd_G,vdcanvas);if(vdcanvas)vdcanvas.UpdateFig(vd_G);};vd_g.vd_gw=function(mat,vd_gG,vdcanvas){if(vd_gG.Thickness){vd_gG.Thickness=vd_gG.Thickness*vdgeo.vd_hX(mat)[2];}if(vd_gG.ExtrusionVector){vd_gG.ExtrusionVector=vdgeo.vd_jh(mat,vd_gG.ExtrusionVector[0],vd_gG.ExtrusionVector[1],vd_gG.ExtrusionVector[2],true);}};vd_g.vd_dw=function(mat,figure,vdcanvas){if(figure.PenWidth){figure.PenWidth=figure.PenWidth*vd_g.vd_qx(mat);}};vd_g.vd_nq=function(mat,vd_G,vdcanvas){if(!vd_G.HatchProperties)return;if(!vdgeo.vd_kM(mat)){var scale=vd_g.vd_qx(mat);var rotation=vdgeo.GetAngle(new vdgeo.newpoint(0,0,0),vdgeo.vd_ji(mat));if(!vd_G.HatchProperties.HatchAngle)vd_G.HatchProperties.HatchAngle=0;vd_G.HatchProperties.HatchAngle=vd_G.HatchProperties.HatchAngle+rotation;if(!vd_G.HatchProperties.HatchScale)vd_G.HatchProperties.HatchScale=1;vd_G.HatchProperties.HatchScale=vd_G.HatchProperties.HatchScale*scale;}};vd_g.vd_Da=function(mat,line,vdcanvas){line.StartPoint=vdgeo.vd_M(mat,line.StartPoint);line.EndPoint=vdgeo.vd_M(mat,line.EndPoint);vd_g.vd_dw(mat,line,vdcanvas);};vd_g.vd_Dt=function(mat,arc,vdcanvas){arc.Center=vdgeo.vd_M(mat,arc.Center);arc.Radius=arc.Radius*vd_g.vd_qx(mat);if(vdgeo.vd_kM(mat)){var tmp=arc.StartAngle;arc.StartAngle=vdgeo.VD_TWOPI-arc.EndAngle;arc.EndAngle=vdgeo.VD_TWOPI-tmp;}var vd_da=vdgeo.vd_mv(mat);arc.StartAngle=arc.StartAngle+vd_da;arc.EndAngle=arc.EndAngle+vd_da;vd_g.vd_nq(mat,arc,vdcanvas);vd_g.vd_gw(mat,arc,vdcanvas);vd_g.vd_dw(mat,arc,vdcanvas);};vd_g.vd_DJ=function(mat,circle,vdcanvas){circle.Center=vdgeo.vd_M(mat,circle.Center);circle.Radius=circle.Radius*vd_g.vd_qx(mat);vd_g.vd_nq(mat,circle,vdcanvas);vd_g.vd_gw(mat,circle,vdcanvas);vd_g.vd_dw(mat,circle,vdcanvas);};vd_g.vd_FV=function(ellipse,vdcanvas){var tmp;if(ellipse.MinorLength>ellipse.MajorLength){tmp=ellipse.MajorLength;ellipse.MajorLength=ellipse.MinorLength;ellipse.MinorLength=tmp;ellipse.MajorAngle=ellipse.MajorAngle+vdgeo.vdgeo.VD_TWOPI;ellipse.StartAngle=ellipse.StartAngle-vdgeo.HALF_PI;vd_HC.EndAngle=ellipse.EndAngle-vdgeo.HALF_PI;ellipse.MajorAngle=vdgeo.FixAngle(ellipse.MajorAngle);ellipse.StartAngle=vdgeo.FixAngle(ellipse.StartAngle);ellipse.EndAngle=vdgeo.FixAngle(ellipse.EndAngle);}};vd_g.vd_DN=function(mat,ellipse,vdcanvas){if(!ellipse.MajorAngle)ellipse.MajorAngle=0.0;ellipse.Center=vdgeo.vd_M(mat,ellipse.Center);var vd_aw=vdgeo.vd_hX(mat);ellipse.MajorLength*=vd_aw[X];ellipse.MinorLength*=vd_aw[Y];if(vdgeo.vd_kM(mat)){var tmp=ellipse.StartAngle;ellipse.StartAngle=vdgeo.VD_TWOPI-ellipse.EndAngle;ellipse.EndAngle=vdgeo.VD_TWOPI-tmp;}var vd_da=vdgeo.vd_mv(mat);ellipse.StartAngle=ellipse.StartAngle+vd_da;ellipse.EndAngle=ellipse.EndAngle+vd_da;ellipse.MajorAngle+=vd_da;vd_g.vd_FV(ellipse,vdcanvas);vd_g.vd_nq(mat,ellipse,vdcanvas);vd_g.vd_gw(mat,ellipse,vdcanvas);vd_g.vd_dw(mat,ellipse,vdcanvas);};vd_g.vd_xK=function(mat,rect,vdcanvas){rect.InsertionPoint=vdgeo.vd_M(mat,rect.InsertionPoint);var vd_aw=vdgeo.vd_hX(mat);var vd_da=vdgeo.vd_mv(mat);rect.Width=rect.Width*vd_aw[X];rect.Height=rect.Height*vd_aw[Y];rect.Rotation+=vd_da;vd_g.vd_nq(mat,rect,vdcanvas);vd_g.vd_gw(mat,rect,vdcanvas);vd_g.vd_dw(mat,rect,vdcanvas);};vd_g.vd_Df=function(mat,vd_eC,vdcanvas){vd_eC.BasePoint=vdgeo.vd_M(mat,vd_eC.BasePoint);if(vd_eC.Direction)vd_eC.Direction=vdgeo.vd_jh(mat,vd_eC.Direction[0],vd_eC.Direction[1],vd_eC.Direction[2]);vd_g.vd_gw(mat,vd_eC,vdcanvas);vd_g.vd_dw(mat,vd_eC,vdcanvas);};vd_g.vd_Dz=function(mat,polyline,vdcanvas){polyline.VertexList.Items=vdgeo.vd_nJ(mat,polyline.VertexList.Items);vd_g.vd_nq(mat,polyline,vdcanvas);vd_g.vd_gw(mat,polyline,vdcanvas);vd_g.vd_dw(mat,polyline,vdcanvas);};vd_g.vd_qH=function(mat,text,vdcanvas){var vd_aw=vdgeo.vd_hX(mat);var vd_da=vdgeo.vd_mv(mat);text.InsertionPoint=vdgeo.vd_M(mat,text.InsertionPoint);if(text.Flag==vdConst.VdConstTextstyle_BACKWARD)vd_da-=vdgeo.PI;text.Rotation+=vdgeo.FixAngle(vd_da);if(!vdgeo.AreEqual(vd_aw[Y],1.0,vdgeo.DefaultLinearEquality))text.Height*=Math.abs(vd_aw[Y]);if(text.WidthFactor&& !((vdgeo.AreEqual(vd_aw[Y],1.0,vdgeo.DefaultLinearEquality))&&(vdgeo.AreEqual(vd_aw[X],1.0,vdgeo.DefaultScaleEquality))))text.WidthFactor*=Math.abs(vd_aw[X]/vd_aw[Y]);if(text.AlignmentPoint)text.AlignmentPoint=vdgeo.vd_M(mat,text.AlignmentPoint);vd_g.vd_gw(mat,text,vdcanvas);vd_g.vd_dw(mat,text,vdcanvas);};vd_g.vd_Et=function(mat,vd_bU,vdcanvas){var i=0;if(vd_bU.Attributes){for(i=0;i<vd_bU.Attributes.Items.length;i++){vd_g.vd_gO(mat,vd_bU.Attributes.Items[i],vdcanvas);}}if(vd_bU.ExtrusionVector)vd_bU.ExtrusionVector=vdgeo.vd_jh(mat,vd_bU.ExtrusionVector[0],vd_bU.ExtrusionVector[1],vd_bU.ExtrusionVector[2],true);vd_bU.InsertionPoint=vdgeo.vd_M(mat,vd_bU.InsertionPoint);var vd_da=vdgeo.vd_mv(mat);vd_bU.Rotation+=vd_da;var vd_aw=vdgeo.vd_hX(mat);vd_bU.Xscale*=vd_aw[X];vd_bU.Yscale*=vd_aw[Y];vd_bU.Zscale*=vd_aw[Z];if(!vd_bU.RowDist)vd_bU.RowDist=0;if(!vd_bU.ColumnDist)vd_bU.ColumnDist=0;vd_bU.RowDist*=vd_aw[Y];vd_bU.ColumnDist*=vd_aw[X];vd_g.vd_dw(mat,vd_bU,vdcanvas);};vd_g.vd_Er=function(mat,vd_rn,vdcanvas){vd_rn.VertexList.Items=vdgeo.vd_ff(mat,vd_rn.VertexList.Items);vd_g.vd_dw(mat,vd_rn,vdcanvas);};vd_g.vd_DG=function(mat,vd_sk,vdcanvas){vd_sk.VertexList.Items=vdgeo.vd_ff(mat,vd_sk.VertexList.Items);vd_g.vd_dw(mat,vd_sk,vdcanvas);};vd_g.vd_DD=function(mat,vd_fW,vdcanvas){vd_fW.InsertionPoint=vdgeo.vd_M(mat,vd_fW.InsertionPoint);if(vd_fW.ExtrusionVector)vd_fW.ExtrusionVector=vdgeo.vd_jh(mat,vd_fW.ExtrusionVector[0],vd_fW.ExtrusionVector[1],vd_fW.ExtrusionVector[2],true);vd_g.vd_dw(mat,vd_fW,vdcanvas);};vd_g.vd_EL=function(mat,vd_iX,vdcanvas){var temp;var i=0,j=0;for(i=0;i<vd_iX.Curves.Items.length;i++){temp=vd_iX.Curves.Items[i];for(j=0;j<temp.Items.length;j++)temp.Items[j]=vdgeo.vd_M(mat,temp.Items[j]);}for(i=0;i<vd_iX.OutLines.Items.length;i++){temp=vd_iX.OutLines.Items[i];for(j=0;j<temp.Items.length;j++)temp.Items[j]=vdgeo.vd_M(mat,temp.Items[j]);}vd_g.vd_gw(mat,vd_iX,vdcanvas);vd_g.vd_dw(mat,vd_iX,vdcanvas);};vd_g.vd_Dq=function(mat,vd_G,vdcanvas){var i=0;for(i=0;i<vd_G.Explode.Items.length;i++){vd_g.vd_gO(mat,vd_G.Explode.Items[i],vdcanvas);}vd_g.vd_dw(mat,vd_G,vdcanvas);};vd_g.vd_qx=function(mat){var vd_aw=vdgeo.vd_hX(mat);if(vdgeo.AreEqual(Math.abs(vd_aw[0]),Math.abs(vd_aw[1]),vdgeo.DefaultVectorEquality))return vd_aw[0];return 1.0;};function vd_lz(vdcanvas,vd_zv,vd_cz){vdcanvas.ActiveAction().cancel();vd_nD=vd_cz;vdcanvas.ActiveAction().vd_k=vd_zv;vdcanvas.ActiveAction().customData=null;vdcanvas.GetUserPoint(vd_lh);};var vd_nD;function vd_oJ(action){var vdcanvas=action.vdrawOwner();var customData=action.customData;if(!action.IsStarted()){action.vd_CT();if(action.vd_c==='select'&&action.IsCanceled())vd_nD=null;action.vd_c=null;}if(customData){for(var k=0;k<customData.length;k++){var fig=customData[k];fig.selected=false;}vdcanvas.redraw();if(vd_nD)vd_nD(action);}};function vd_tZ(mat,vd_bL,action,vd_bb,vd_ae,vdcanvas){var ret=vdgeo.vd_cw(mat);if(vd_bL==1||vd_bL==4)vdgeo.vd_Y(ret,vd_ae[X]-vd_bb[X],vd_ae[Y]-vd_bb[Y],vd_ae[Z]-vd_bb[Z]);else if(vd_bL==2){var scale;if(Array.isArray(vd_ae)){scale=vdgeo.Distance2D(vd_bb,vd_ae);if(vdcanvas.ActionScaleMode==1){if(action.vd_k&&action.vd_k.entities){if(!action.vd_k.vd_eX){var vd_kL=new vd_nn();for(var i=0;i<action.vd_k.entities.length;i++){vd_kL.vd_sl(action.vd_k.entities[i].BoundingBox);}if(vd_kL.vd_iy)action.vd_k.vd_eX=1.0;else{action.vd_k.vd_eX=1.0/Math.max(vd_kL.vd_cl[0]-vd_kL.vd_cv[0],vd_kL.vd_cl[1]-vd_kL.vd_cv[1]);}}scale*=action.vd_k.vd_eX;}}}else{scale=vd_ae;}if(!vdgeo.AreEqual(scale,0.0,vdgeo.DefaultLinearEquality)){vdgeo.vd_Y(ret,-vd_bb[X],-vd_bb[Y],-vd_bb[Z]);vdgeo.vd_aM(ret,scale,scale,scale);vdgeo.vd_Y(ret,vd_bb[X],vd_bb[Y],vd_bb[Z]);}}else if(vd_bL==3){var angle;if(Array.isArray(vd_ae)){angle=vdgeo.GetAngle(vd_bb,vd_ae);vd_ae=angle;}else{angle=vd_ae;}vdgeo.vd_Y(ret,-vd_bb[X],-vd_bb[Y],-vd_bb[Z]);vdgeo.vd_af(ret,angle);vdgeo.vd_Y(ret,vd_bb[X],vd_bb[Y],vd_bb[Z]);}return ret;};function vd_DA(){this.userselectedCount=0;this.ItemIndex= -1;this.selectedItem=null;this.cancel=false;this.finish=false;this.action=null;};function vd_lh(action,status){if(!action.vd_c)action.vd_c='select';var vdcanvas=action.vdrawOwner();var vd_f=action.vd_dY();var vd_m=vd_f[0];var vd_fo,from,to,vd_sr,fig,p1;var k,i;if(action.vd_c=='select'){if(status=='start'){if(!action.customData)action.customData=[];if(action.vd_k&&action.vd_k.entities){action.customData=action.vd_k.entities;for(i=0;i<action.customData.length;i++){action.customData[i].selected=true;}if(!action.vd_k.vd_bb|| !action.vd_k.vd_ae){vd_m.vd_mn(vdConst.ActionHighLightColor);vdcanvas.ActionDrawEntities(action.customData,true);vd_m.vd_pp();}action.cancel(1);}else vdcanvas.Prompt(vdcanvas.MessagesDictionary.SELECT_ENTITIES);}else if(status=='end'){vdcanvas.Prompt('');if(!action.IsCanceled()){var ret=null;if(action.actionType==vdConst.ACTION_POINT_WORLD){p1=vdcanvas.WorldToPixel(action.ResValue);fig=vdcanvas.GetEntityFromPoint(p1[X],p1[Y]);if(!fig){vdcanvas.GetUserRect(vd_lh,action.ResValue);}else{ret=[fig];}}else{p1=vdcanvas.ViewToPixel(action.ResValue[0]);var p2=vdcanvas.ViewToPixel(action.ResValue[1]);var vd_uu=(p1[X]>p2[X]);if(vd_uu)ret=vdcanvas.GetEntitiesFromBox(p1[X],p1[Y],p2[X],p2[Y]);else ret=vdcanvas.GetEntitiesInWindowBox(p1[X],p1[Y],p2[X],p2[Y]);}var vd_hI=new vd_DA();if(ret&&ret.length>0){var vd_oy=[];for(i=0;i<ret.length;i++){vdcanvas.GroupsManager.vd_wE(ret[i],vd_oy);}if(!action.customData)action.customData=[];for(i=0;i<vd_oy.length;i++){var fig=vd_oy[i];fig.vd_tw=undefined;if(fig.selected)continue;if(vdcanvas.vdSelectionModified){vd_hI.userselectedCount=vd_oy.length;vd_hI.ItemIndex=i;vd_hI.action=action;vd_hI.selectedItem=fig;vd_hI.cancel=false;vdcanvas.vdSelectionModified(vd_hI);if(vd_hI.cancel)continue;}fig.selected=true;action.customData.push(fig);if(vd_hI.finish)break;}vd_m.vd_mn(vdConst.ActionHighLightColor);vdcanvas.ActionDrawEntities(action.customData,true);vd_m.vd_pp();}if(vd_hI.finish){if(!action.customData||action.vd_k.vd_bL==0){vd_oJ(action);return;}action.vd_c='PickReference';}if(!action.IsStarted())vdcanvas.GetUserPoint(vd_lh);}else{if(!action.customData||action.vd_k.vd_bL==0){vd_oJ(action);return;}action.vd_c='PickReference';vdcanvas.GetUserPoint(vd_lh);}}}else if(action.vd_c=='PickReference'){if(status=='start'){if(action.vd_k.vd_bb){action.cancel();}else vdcanvas.Prompt(vdcanvas.MessagesDictionary.SPECIFY_REFERENCE_POINT);}else if(status=='end'){vdcanvas.Prompt('');if(action.vd_k.vd_bb){action.vd_c='PickPoint2';vdcanvas.GetUserLine(vd_lh,action.vd_k.vd_bb);}else if(!action.IsCanceled()){action.vd_c='PickPoint2';vdcanvas.GetUserLine(vd_lh,action.ResValue);}else{vd_oJ(action);}}}else if(action.vd_c=='PickPoint2'){if(status=='start'){if(action.vd_k.vd_ae)action.cancel();else vdcanvas.Prompt(vdcanvas.MessagesDictionary.SPECIFY_SECOND_POINT);}else if(status=='draw'){to=vd_f[1];from=vd_f[2];vd_fo=vdgeo.vd_l();vd_fo=vd_tZ(vd_fo,action.vd_k.vd_bL,action,from,to,vdcanvas);vd_m.vd_aN(vd_fo);vd_m.vd_mn();for(k=0;k<action.customData.length;k++){fig=action.customData[k];vdcanvas.DrawEntity(fig,vd_m);}vd_m.vd_pp();vd_m.vd_bE();}else if(status=='end'){vdcanvas.Prompt('');if(!action.IsCanceled()||action.vd_k.vd_ae){if(action.vd_k.vd_bb)from=action.vd_k.vd_bb;else if(Array.isArray(action.ResValue[0]))from=action.ResValue[0];else from=action.ResValue;if(action.vd_k.vd_ae)to=action.vd_k.vd_ae;else if(Array.isArray(action.ResValue[1]))to=action.ResValue[1];else to=action.ResValue;vd_fo=vdgeo.vd_l();vd_fo=vd_tZ(vd_fo,action.vd_k.vd_bL,action,from,to,vdcanvas);if(action.vd_k.vd_bL==4){var entities=vdcanvas.CopyObjects(action.customData);if(action.customData){for(var k=0;k<action.customData.length;k++){var fig=action.customData[k];fig.selected=false;}}action.customData=entities;}else{if(action.vd_k.vd_bL==2&&Array.isArray(to))action.ResValue[1]=vdgeo.Distance2D(from,to);else if(action.vd_k.vd_bL==3&&Array.isArray(to))action.ResValue[1]=vdgeo.GetAngle(from,to);}action.vd_k.matrix=vd_fo;for(k=0;k<action.customData.length;k++){fig=action.customData[k];vd_g.vd_gO(vd_fo,fig,vdcanvas);vdcanvas.UpdateFig(fig);}vdcanvas.UpdateLayout();}vd_oJ(action);}}};function vd_yW(vdcanvas){var vd_L=this;var vd_q=vdcanvas;var vd_d=[];var vd_tq=[];var vd_aU=true;var vd_iS=[];var vd_iP=null;var vd_bh=null;this.enableScript=function(vd_tk){var ret=vd_aU;vd_aU=vd_tk;return ret;};this.isActive=function(){return vd_aU;};this.getCommands=function(){return vd_d;};this.clearCommands=function(){return vd_d=[];};this.parseCommands=function(vd_et){if(!vd_et)vd_et=vd_d;for(var i=0;i<vd_et.length;i++){vd_DV(vd_et[i],false);}};function vd_uP(entities,replace){var k=0,index=0;var fig;var h='';var command='';if(replace)vd_L.clearSelection();if(entities&&entities.length>0){if(vd_aU)command+='select ';for(k=0;k<entities.length;k++){fig=entities[k];h='h_'+fig.HandleId.toString();index=vd_iS.indexOf(h);if(index== -1){if(vd_aU)command+=h+' ';vd_iS.push(h);}if(vd_aU){if(((k+1)%10)==0){vd_d.push(command);command='select ';}}}if(vd_aU)vd_d.push(command);}};this.clearSelection=function(){vd_iS=[];if(vd_aU)vd_d.push('select -all');};this.select=function(entities,vd_al){vd_iP=vd_al;vd_q.CmdSelect(vd_cz,entities);};this.erase=function(){var k;var selection=vd_L.ActiveSelection();if(selection.length==0)return;vd_q.UndoHistory().group_start();for(k=0;k<selection.length;k++){fig=selection[k];vd_q.UndoHistory().store(fig,"Deleted");fig.Deleted=true;}vd_q.UndoHistory().group_end();vd_q.UpdateLayout();if(vd_aU){vd_d.push("erase");}vd_L.clearSelection();};this.move=function(from,to,vd_al){var selection=vd_L.ActiveSelection();if(selection.length==0)return;vd_iP=vd_al;vd_q.CmdMove(selection,from,to,vd_cz);};this.scale=function(from,scale,vd_al){var selection=vd_L.ActiveSelection();if(selection.length==0)return;vd_iP=vd_al;vd_q.CmdScale(selection,from,scale,vd_cz);};this.rotate=function(from,rotation,vd_al){var selection=vd_L.ActiveSelection();if(selection.length==0)return;vd_iP=vd_al;vd_q.CmdRotate(selection,from,rotation,vd_cz);};this.copy=function(from,to,vd_al){var selection=vd_L.ActiveSelection();if(selection.length==0)return;vd_iP=vd_al;vd_q.CmdCopy(selection,from,to,vd_cz);};this.ActiveSelection=function(){var ret=[];var fig;for(k=0;k<vd_iS.length;k++){fig=vd_q.GetEntityItem(vd_iS[k]);if(!fig)continue;ret.push(fig);}return ret;};function vd_cz(action){var fig;var h='';var k=0;var index=0;var command='';if(action.vd_k.vd_bL==0){vd_uP(action.customData,true);}else{if(!action.customData||action.customData.length==0)return;if(vd_q.UndoHistory().Enable&&action.vd_k.matrix){var vd_fo=action.vd_k.matrix;var vd_sr=vdgeo.vd_bc(vd_fo);vd_q.UndoHistory().group_start();for(k=0;k<action.customData.length;k++){fig=action.customData[k];if(action.vd_k.vd_bL==4)vd_q.UndoHistory().store(fig,"Deleted",true);else vd_q.UndoHistory().store(fig,'special_transform',[vd_fo,vd_sr]);}vd_q.UndoHistory().group_end();}if(vd_aU){var vd_mR=null;var vd_mO=null;if(action.vd_k.vd_bL===4){var vd_a=vd_q.GetDocument();vd_d.push("chandle "+(vd_a.HandleCurrent-1).toString());}if(!action.ResValue){if(action.vd_k){vd_uP(action.customData,true);vd_mR=action.vd_k.vd_bb;vd_mO=action.vd_k.vd_ae;}}else{vd_mR=action.ResValue[0];vd_mO=action.ResValue[1];}if(vd_mR&&vd_mO){command=vd_BY(action.vd_k.vd_bL,[action.customData,vd_mR,vd_mO]);vd_d.push(command);}}}if(vd_iP)vd_iP(vd_q);};function vd_BY(actionType,vd_N){var command;switch(actionType){case 1:command="move {0} {1}";command=command.replace("{0}",vd_ag(vd_N[1]));command=command.replace("{1}",vd_ag(vd_N[2]));break;case 2:command="scale {0} {1}";command=command.replace("{0}",vd_ag(vd_N[1]));command=command.replace("{1}",vd_N[2]);break;case 3:command="rotate {0} {1}";command=command.replace("{0}",vd_ag(vd_N[1]));command=command.replace("{1}",vd_N[2]);break;case 4:command="copy {0} {1}";command=command.replace("{0}",vd_ag(vd_N[1]));command=command.replace("{1}",vd_ag(vd_N[2]));break;default:return;}return command;};function vd_BX(points){var ret="";var point;for(var i=0;i<points.length;i++){point=points[i];ret+=vd_ag(point);if(i!=points.length-1)ret+=" ";}return ret;};function vd_ag(point){var ret="";for(var i=0;i<point.length;i++){ret+=point[i].toString();if(i!=point.length-1)ret+=",";}return ret;};function vd_CS(vd_vA,vd_io,vd_ib){var h,i,index;var vd_km=vd_vA[0]=='-';var vd_eB=vd_vA;if(vd_km)vd_eB=vd_eB.substr(1);if(vd_eB.search("all")==0){if(vd_km){vd_ib=[];return;}for(i=0;i<vd_io.Items.length;i++){h=vd_io.Items[i];index=vd_ib.indexOf(h);if(index>=0)continue;vd_ib.push(vd_io.Items[i]);}}else if(vd_eB.search("last")==0){if(vd_io.Items.length>0){h=vd_io.Items[vd_io.Items.length-1];vd_q.GroupsManager.vd_ph(h,vd_ib,vd_km);}}else if(vd_eB.search("h_")==0){vd_q.GroupsManager.vd_ph(vd_eB,vd_ib,vd_km);}else if(vd_eB.search("w_")==0||vd_eB.search("c_")==0){var items=vd_eB.split("_");var p1=vd_q.ViewToPixel(vd_az(items[1]));var p2=vd_q.ViewToPixel(vd_az(items[2]));var xmin=Math.min(p1[X],p2[X]);var xmax=Math.max(p1[X],p2[X]);var ymin=Math.min(p1[Y],p2[Y]);var ymax=Math.max(p1[Y],p2[Y]);var ents;if(vd_eB.search("c_")==0)ents=vd_q.GetEntitiesFromBox(xmin,ymin,xmax,ymax);else ents=vd_q.GetEntitiesInWindowBox(xmin,ymin,xmax,ymax);for(i=0;i<ents.length;i++){h='h_'+ents[i].HandleId.toString();vd_q.GroupsManager.vd_ph(h,vd_ib,vd_km);}}};function vd_az(point){var pt=[0,0,0];var vd_tC=point.split(",");for(var i=0;i<vd_tC.length;i++){pt[i]=Number(vd_tC[i]);}return pt;};this.layer=function(name){var vd_a=vd_q.GetDocument();if(vd_a==null)return;var vd_qv=vd_q.FindLayer(name);if(vd_qv==null)return;var vd_CE=vd_q.GetDictItem(vd_a.Layers,vd_a.ActiveLayer);if(vd_qv==vd_CE)return;vd_q.UndoHistory().store(vd_a,"ActiveLayer");vd_q.SetActiveLayer(vd_qv);if(vd_aU)vd_d.push("layer "+name);};this.layout=function(name){var vd_a=vd_q.GetDocument();if(vd_a==null)return;var clid=vd_q.GetActiveLayoutId();var nlid=vd_q.FindLayout(name);if(clid==nlid)return;vd_q.UndoHistory().group_start();vd_q.UndoHistory().store(vd_a,"ActiveLayOut");vd_q.UndoHistory().store(vd_a,"ActiveLayOutRef");vd_q.UndoHistory().group_end();vd_q.SetActiveLayoutId(nlid);vd_iS=[];if(vd_aU)vd_d.push("layout "+name);};this.color=function(vd_Ca){var vd_a=vd_q.GetDocument();if(vd_a==null)return;var vd_CF=vdConst.colorToString(vd_a.ActivePenColor);var color=vdConst.colorFromString(vd_Ca);var vd_va=vdConst.colorToString(color);if(vd_CF==vd_va)return;vd_q.UndoHistory().store(vd_a,"ActivePenColor");vd_q.SetActivePenColor(color);if(vd_aU)vd_d.push("color "+vd_va);};this.linetype=function(name){var vd_a=vd_q.GetDocument();if(vd_a==null)return;var vd_qR=vd_q.FindLineType(name);if(vd_qR==null)return;var vd_CH=vd_q.GetDictItem(vd_a.LineTypes,vd_a.ActiveLineType);if(vd_qR==vd_CH)return;vd_q.UndoHistory().store(vd_a,"ActiveLineType");vd_q.SetActiveLineType(vd_qR);if(vd_aU)vd_d.push("linetype "+name);};this.lineweight=function(vd_dp){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(vd_a.ActiveLineWeight==vd_dp)return;vd_q.UndoHistory().store(vd_a,"ActiveLineWeight");vd_q.SetActiveLineWeight(vd_dp);if(vd_aU)vd_d.push("lineweight "+vd_dp.toString());};this.ltscale=function(vd_dp){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(!vd_a.vd_il)vd_a.vd_il=1.0;if(vd_a.vd_il==vd_dp)return;vd_q.UndoHistory().store(vd_a,"vd_il");vd_a.vd_il=vd_dp;if(vd_aU)vd_d.push("ltscale "+vd_dp.toString());};this.penwidth=function(vd_dp){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(vd_a.ActivePenWidth==vd_dp)return;vd_q.UndoHistory().store(vd_a,"ActivePenWidth");vd_q.SetActivePenWidth(vd_dp);if(vd_aU)vd_d.push("penwidth "+vd_dp.toString());};this.thickness=function(vd_dp){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(vd_a.vd_mZ==vd_dp)return;vd_q.UndoHistory().store(vd_a,"vd_mZ");vd_q.SetActiveThickness(vd_dp);if(vd_aU)vd_d.push("thickness "+vd_dp.toString());};var vd_ic=false;function vd_fz(){if(!vd_ic)return 0.0;var vd_a=vd_q.GetDocument();if(vd_a==null)return 0.0;if(vd_a.doublelinewidth===undefined)vd_a.doublelinewidth=0.25;return vd_a.doublelinewidth;};this.doublelinewidth=function(vd_dp){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(vd_a.doublelinewidth==vd_dp)return;vd_q.UndoHistory().store(vd_a,"doublelinewidth");vd_a.doublelinewidth=vd_dp;if(vd_aU)vd_d.push("doublelinewidth "+vd_dp.toString());};this.hatch=function(vd_fR,FillBkColor,FillColor,vd_gX,vd_gb,vd_dm,vd_qW){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(vd_fR==undefined)vd_fR='none';if(!FillBkColor)FillBkColor='byblock';if(!FillColor)FillColor='byblock';if(vd_gb==undefined)vd_gb=0;if(vd_gX==undefined)vd_gX=1;var vd_Gb=vdConst.colorFromString(FillBkColor);var vd_Fs=vdConst.colorFromString(FillColor);var nh=vd_q.createNewHatchProperties(vd_fR,vd_Gb,vd_Fs,vd_gX,vd_gb);if(nh&&vd_dm!==undefined)nh.Solid2dTransparency=vd_dm;if(nh&&vd_qW!==undefined)nh.DrawBoundary=vd_qW==1;if(vd_a.ActiveHatchProperties===nh)return;vd_q.UndoHistory().store(vd_a,"ActiveHatchProperties");vd_a.ActiveHatchProperties=nh;if(vd_aU)vd_d.push("hatch "+vd_fR+" "+FillBkColor+" "+FillColor+" "+vd_gX.toString()+" "+vd_gb.toString()+" "+(vd_dm!==undefined?vd_dm.toString():"255")+" "+(vd_qW===1?"1":"0"));};this.textstyle=function(name,height,vd_xQ,vd_yp){var vd_a=vd_q.GetDocument();if(vd_a==null)return;var vd_wT=vd_q.GetDictItem(vd_a.TextStyles,vd_a.ActiveTextStyle);var vd_eF=false;vd_q.UndoHistory().group_start();var ts=vd_q.FindTextStyle(name);if(ts&&ts!=vd_wT){vd_q.UndoHistory().store(vd_a,"ActiveTextStyle");vd_q.SetActiveTextStyle(ts);vd_eF=true;}else{ts=vd_wT;}if(ts.Height!=height){vd_q.UndoHistory().store(ts,"Height");ts.Height=height;vd_eF=true;}switch(vd_xQ){case "left":if(ts.HorJustify!=vdConst.VdConstHorJust_VdTextHorLeft){vd_q.UndoHistory().store(ts,"HorJustify");ts.HorJustify=vdConst.VdConstHorJust_VdTextHorLeft;vd_eF=true;}break;case "right":if(ts.HorJustify!=vdConst.VdConstHorJust_VdTextHorRight){vd_q.UndoHistory().store(ts,"HorJustify");ts.HorJustify=vdConst.VdConstHorJust_VdTextHorRight;vd_eF=true;}break;case "center":if(ts.HorJustify!=vdConst.VdConstHorJust_VdTextHorCenter){vd_q.UndoHistory().store(ts,"HorJustify");ts.HorJustify=vdConst.VdConstHorJust_VdTextHorCenter;vd_eF=true;}break;}switch(vd_yp){case "bottom":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerBottom){vd_q.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerBottom;vd_eF=true;}break;case "top":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerTop){vd_q.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerTop;vd_eF=true;}break;case "center":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerCen){vd_q.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerCen;vd_eF=true;}break;case "base":if(ts.VerJustify!=vdConst.VdConstVerJust_VdTextVerBaseLine){vd_q.UndoHistory().store(ts,"VerJustify");ts.VerJustify=vdConst.VdConstVerJust_VdTextVerBaseLine;vd_eF=true;}break;}vd_q.UndoHistory().group_end();if(vd_eF&&vd_aU)vd_d.push("textstyle "+" "+ts.Name+" "+ts.Height.toString()+" "+vd_xQ+" "+vd_yp);};this.tooltip=function(name){var vd_a=vd_q.GetDocument();if(vd_a==null)return;if(vd_a.vd_ju==undefined)vd_a.vd_ju="";if(vd_a.vd_ju==name)return;vd_q.UndoHistory().store(vd_a,"vd_ju");vd_a.vd_ju=name;if(vd_aU)vd_d.push("tooltip "+name);};function vd_wS(vd_Ah){var vd_vT=vd_Ah.split(" ");var vd_V=[];var val,i;for(i=0;i<vd_vT.length;i++){val=vd_vT[i].trim();if(val=="")continue;vd_V.push(val);}return vd_V;};function vd_DV(vd_eB,vd_aj){var vd_a=vd_q.GetDocument();if(vd_a==null)return;var layout=vd_q.GetActiveLayout();if(layout==null)return;var vd_bT=[];var vd_bV;var from,to,mat,k,i,fig,base,vd_sr;var vd_V=vd_wS(vd_eB);var command="__"+vd_V[0].toLowerCase();switch(command){case "__layer":vd_L.layer(vd_V[1]);break;case "__color":vd_L.color(vd_V[1]);break;case "__linetype":vd_L.linetype(vd_V[1]);break;case "__ltscale":vd_L.ltscale(Number(vd_V[1]));break;case "__lineweight":vd_L.lineweight(Number(vd_V[1]));break;case "__penwidth":vd_L.penwidth(Number(vd_V[1]));break;case "__thickness":vd_L.thickness(Number(vd_V[1]));break;case "__doublelinewidth":vd_L.doublelinewidth(Number(vd_V[1]));break;case "__tooltip":vd_L.tooltip(vd_V[1]);break;case "__textstyle":vd_L.textstyle(vd_V[1],Number(vd_V[2]),vd_V[3],vd_V[4]);break;case "_hatch":vd_L.hatch(vd_V[1],vd_V[2],vd_V[3],Number(vd_V[4]),vdgeo.DegreesToRadians(Number(vd_V[5])),Number(vd_V[6]),Number(vd_V[7]));break;case "__layout":vd_L.layout(vd_V[1]);break;case "__chandle":vd_a.HandleCurrent=Math.max(vd_a.HandleCurrent,Number(vd_V[1]));break;case "__line":vd_L.line([vd_az(vd_V[1]),vd_az(vd_V[2])]);break;case "__polyline":{vd_bT=[];for(i=1;i<vd_V.length;i++){vd_bV=vd_az(vd_V[i]);while(vd_bV.length<4)vd_bV.push(0);vd_bT.push(vd_bV);}vd_L.polyline(vd_bT);}break;case "__doubleline":{vd_bT=[];for(i=1;i<vd_V.length;i++){vd_bV=vd_az(vd_V[i]);while(vd_bV.length<4)vd_bV.push(0);vd_bT.push(vd_bV);}vd_L.doubleline(vd_bT);}break;case "__doublelinerect":vd_L.doublelinerect([vd_az(vd_V[1]),Number(vd_V[2]),Number(vd_V[3]),vdgeo.DegreesToRadians(Number(vd_V[4]))]);break;case "__spline1":{vd_bT=[];for(i=1;i<vd_V.length;i++){vd_bV=vd_az(vd_V[i]);while(vd_bV.length<4)vd_bV.push(0);vd_bT.push(vd_bV);}vd_L.polyline(vd_bT,0,1);}break;case "__spline2":{vd_bT=[];for(i=1;i<vd_V.length;i++){vd_bV=vd_az(vd_V[i]);while(vd_bV.length<4)vd_bV.push(0);vd_bT.push(vd_bV);}vd_L.polyline(vd_bT,0,2);}break;case "__spline4":{vd_bT=[];for(i=1;i<vd_V.length;i++){vd_bV=vd_az(vd_V[i]);while(vd_bV.length<4)vd_bV.push(0);vd_bT.push(vd_bV);}vd_L.polyline(vd_bT,0,4);}break;case "__rect":vd_L.rect([vd_az(vd_V[1]),Number(vd_V[2]),Number(vd_V[3]),vdgeo.DegreesToRadians(Number(vd_V[4]))]);break;case "__circle":vd_L.circle([vd_az(vd_V[1]),Number(vd_V[2])]);break;case "__arc":vd_L.arc([vd_az(vd_V[1]),Number(vd_V[2]),vdgeo.DegreesToRadians(Number(vd_V[3])),vdgeo.DegreesToRadians(Number(vd_V[4]))]);break;case "__ellipse":vd_aP(vd_q.AddEllipse(vd_az(vd_V[1]),Number(vd_V[2]),Number(vd_V[3]),vdgeo.DegreesToRadians(Number(vd_V[4])),vdgeo.DegreesToRadians(Number(vd_V[5])),vdgeo.DegreesToRadians(Number(vd_V[6]))));break;case "__text":vd_L.text(vd_V[1],[vd_az(vd_V[2]),vdgeo.DegreesToRadians(Number(vd_V[3]))]);break;case "__image":vd_L.image(vd_V[1],vd_V[2],[vd_az(vd_V[3]),Number(vd_V[4]),vdgeo.DegreesToRadians(Number(vd_V[5]))]);break;case "__dimvar":vd_L.dimvar(vd_V[1],vd_V[2]);break;case "__dim":vd_L.dim([vd_az(vd_V[1]),vd_az(vd_V[2]),vd_az(vd_V[3]),vd_V[4]]);break;case "__blockref":vd_L.blockref(vd_V[1],[vd_az(vd_V[2]),Number(vd_V[3]),vdgeo.DegreesToRadians(Number(vd_V[4]))]);break;case "__select":{var entities=layout.Entities;for(i=1;i<vd_V.length;i++){vd_CS(vd_V[i].toLowerCase(),entities,vd_iS);}}break;case "__erase":vd_L.erase();break;case "__move":vd_L.move(vd_az(vd_V[1]),vd_az(vd_V[2]));break;case "__rotate":vd_L.rotate(vd_az(vd_V[1]),vdgeo.DegreesToRadians(Number(vd_V[2])));break;case "__scale":vd_L.scale(vd_az(vd_V[1]),Number(vd_V[2]));break;case "__copy":vd_L.copy(vd_az(vd_V[1]),vd_az(vd_V[2]));break;case "__undogroup":vd_L.undogroup(vd_V[1]);break;default:vd_q.Prompt("Wrong script command : "+command);break;}};this.undogroup=function(value){if(value.toLowerCase()=='begin'){vd_q.UndoHistory().group_start();}else{vd_q.UndoHistory().group_end();}if(vd_aU)vd_d.push("undogroup "+value);};function vd_xR(vd_et,vd_AF){var vd_hA=0;while(vd_et.length>0){var vd_mu=vd_et[vd_et.length-1].toLowerCase();if(vd_mu.substr(0,9)=='undogroup'){var vd_V=vd_wS(vd_mu);vd_hA+=vd_V[1].toLowerCase()=='begin'? -1:1;}vd_AF.push(vd_et.pop());if(vd_et.length==0)break;vd_mu=vd_et[vd_et.length-1].toLowerCase();if(vd_hA==0&&vd_mu.substr(0,6)!='select'&&vd_mu.substr(0,7)!='chandle')break;}};this.undo=function(){vd_q.UndoHistory().undo();if(vd_aU){vd_xR(vd_d,vd_tq);}};this.redo=function(){vd_q.UndoHistory().redo();if(vd_aU){vd_xR(vd_tq,vd_d);}};function vd_aP(Figure,vd_aj,refresh){if(!Figure)return;var vd_a=vd_q.GetDocument();if(!Figure.HandleId){var layout=vd_q.GetActiveLayout();Figure.HandleId=vd_q.vd_eP();if(vd_a.vd_ju)Figure.ToolTip=vd_a.vd_ju;vd_q.vd_aZ(layout.Entities,Figure);}vd_q.UpdateFig(Figure);vd_q.UndoHistory().store(Figure,"Deleted",true);if(vd_aU){vd_d.push("chandle "+(vd_a.HandleCurrent-1).toString());if(Figure._t==vdConst.vdLine_code){vd_d.push("line "+vd_ag(Figure.StartPoint)+" "+vd_ag(Figure.EndPoint));}else if(Figure._t==vdConst.vdPolyline_code){var vd_lT=vd_BX(Figure.VertexList.Items);if(Figure.Flag===1)vd_lT+=" "+vd_ag(Figure.VertexList.Items[0]);if(Figure.SPlineFlag===vdConst.SplineFlagSTANDARD){var vd_nl="polyline ";if(vd_fz()>0)vd_nl="doubleline ";vd_d.push(vd_nl+vd_lT);}else if(Figure.SPlineFlag===vdConst.SplineFlagFITTING){vd_d.push("spline1 "+vd_lT);}else if(Figure.SPlineFlag===vdConst.SplineFlagCONTROLPOINTS){vd_d.push("spline2 "+vd_lT);}else if(Figure.SPlineFlag===vdConst.SplineFlagQUADRATIC){vd_d.push("spline4 "+vd_lT);}}else if(Figure._t==vdConst.vdRect_code){var vd_nl="rect ";if(vd_fz()>0)vd_nl="doublelinerect ";vd_d.push(vd_nl+vd_ag(Figure.InsertionPoint)+" "+Figure.Width.toString()+" "+Figure.Height.toString()+" "+Figure.Rotation.toString());}else if(Figure._t==vdConst.vdCircle_code){vd_d.push("circle "+vd_ag(Figure.Center)+" "+Figure.Radius.toString());}else if(Figure._t==vdConst.vdArc_code){vd_d.push("arc "+vd_ag(Figure.Center)+" "+Figure.Radius.toString()+" "+vdgeo.RadiansToDegrees(Figure.StartAngle).toString()+" "+vdgeo.RadiansToDegrees(Figure.EndAngle).toString());}else if(Figure._t==vdConst.vdText_code){vd_d.push("text "+Figure.TextString+" "+vd_ag(Figure.InsertionPoint)+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdImage_code){var vd_Q=vd_q.GetDictItem(vd_a.Images,Figure.ImageDefinition);vd_d.push("image "+vd_Q.Name+" "+(vd_Q.FileName?vd_Q.FileName:"@")+" "+vd_ag(Figure.InsertionPoint)+" "+Figure.ImageScale.toString()+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdInsert_code){var bdef=vd_q.GetDictItem(vd_a.Blocks,Figure.Block);vd_d.push("blockref "+bdef.Name+" "+vd_ag(Figure.InsertionPoint)+" "+Figure.Xscale.toString()+" "+vdgeo.RadiansToDegrees(Figure.Rotation).toString());}else if(Figure._t==vdConst.vdDimension_code){vd_d.push("dim "+vd_ag(vd_ar.vd_my)+" "+vd_ag(vd_ar.vd_nx)+" "+vd_ag(vd_ar.vd_mb)+" "+vd_ar.text);}}if(vd_aj)vd_q.DrawEntity(Figure);if(refresh)vd_q.Refresh();};function vd_an(action){vd_ic=false;if(action){var fig=action.Figure;action.Figure=null;action.vd_c=null;action.vd_eX=1.0;if(vd_bh)vd_bh(vd_q,fig);}};this.doubleline=function(vd_N,closed,vd_jE,vd_al){vd_ic=true;vd_L.polyline(vd_N,closed,vd_jE,vd_al);};this.polyline=function(vd_N,closed,vd_jE,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;var vd_dh=vd_fz();if(vd_N){var Figure=vd_q.AddPolyline(vd_N,false,{});if(vd_dh!=0){var vd_fu=[];for(var i=0;i<Figure.VertexList.Items.Count;i++){vd_fu.push(vd_dh);vd_fu.push(vd_dh);}Figure.Widths={Items:vd_fu};}if(vd_jE)Figure.SPlineFlag=vd_jE;if(closed)Figure.Flag=1;vd_ic=false;vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}var fig=vd_q.AddPolyline([],false,{});if(vd_dh!=0){fig.Widths={Items:[]};}fig.SPlineFlag=0;if(vd_jE)fig.SPlineFlag=vd_jE;if(closed)fig.Flag=1;vd_q.ActiveAction().Figure=fig;vd_q.GetUserPoint(vd_uU);};function vd_uU(action,status){var vd_f=action.vd_dY();var pt;if(status=='start'){if(action.Figure.VertexList.Items.length==0)vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_START_POINT);else{vd_q.ActionDrawEntities([action.Figure]);vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_NEXT_POINT);}}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){pt=[vd_f[1][X],vd_f[1][Y],vd_f[1][Z],0.0];var vd_qg=false;if(action.Figure.VertexList.Items.length==0){action.Figure.VertexList.Items=[pt];vd_qg=true;}else{if(!vdgeo.vd_fI(pt,action.Figure.VertexList.Items[action.Figure.VertexList.Items.length-1],vd_q.GetPixelSize())){action.Figure.VertexList.Items.push(pt);vd_qg=true;}}if(vd_qg&&action.Figure.Widths){var vd_dh=vd_fz();action.Figure.Widths.Items.push(vd_dh);action.Figure.Widths.Items.push(vd_dh);}vd_q.GetUserLine(vd_uU,pt);}else{if(action.vd_Bt==0)action.Figure=null;if(action.Figure!=null&&((action.Figure.SPlineFlag==0&&action.Figure.VertexList.Items.length>1)||action.Figure.VertexList.Items.length>2))vd_aP(action.Figure,true,true);vd_an(action);}}else if(status=='draw'){if(action.Figure.VertexList.Items.length>0){var vd_m=vd_f[0];var vd_zX=action.Figure.SPlineFlag;if(action.Figure.VertexList.Items.length<2)action.Figure.SPlineFlag=0;pt=[vd_f[1][X],vd_f[1][Y],vd_f[1][Z],0.0];var vd_tO= !vdgeo.vd_fI(pt,action.Figure.VertexList.Items[action.Figure.VertexList.Items.length-1],vd_q.GetPixelSize());if(vd_tO){action.Figure.VertexList.Items.push(pt);if(action.Figure.Widths){var vd_dh=vd_fz();action.Figure.Widths.Items.push(vd_dh);action.Figure.Widths.Items.push(vd_dh);}}vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);if(vd_tO){action.Figure.VertexList.Items.pop();if(action.Figure.Widths){action.Figure.Widths.Items.pop();action.Figure.Widths.Items.pop();}}action.Figure.SPlineFlag=vd_zX;vd_q.UpdateFig(action.Figure);}}};this.circle=function(vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;if(vd_N){var Figure=vd_q.AddCircle(vd_N[0],vd_N[1],false,{});vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}vd_q.GetUserPoint(vd_us);};function vd_us(action,status){if(!action.vd_c)action.vd_c='PickCenter';var vd_f=action.vd_dY();if(action.vd_c=='PickCenter'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_CENTER_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure=vd_q.AddCircle(action.ResValue,0.0,false,{});action.vd_c='PickRadius';vd_q.GetUserLine(vd_us,action.ResValue);}else{vd_an(action);}}}else if(action.vd_c=='PickRadius'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_RADIUS);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Radius=vdgeo.Distance2D(vd_f[1],vd_f[2]);vd_aP(action.Figure,true,true);}vd_an(action);}else if(status=='draw'){if(action.Figure){var vd_m=vd_f[0];action.Figure.Radius=vdgeo.Distance2D(vd_f[1],vd_f[2]);vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}};this.line=function(vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;if(vd_N){var Figure=vd_q.AddLine(vd_N[0],vd_N[1],false,{});vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}vd_q.GetUserPoint(vd_sd);};function vd_sd(action,status){if(!action.vd_c)action.vd_c='PickStart';var vd_f=action.vd_dY();if(action.vd_c=='PickStart'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.vd_c='PickNext';vd_q.GetUserLine(vd_sd,vd_f[1]);}else{vd_an(action);}}}else if(action.vd_c=='PickNext'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_NEXT_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure=vd_q.AddLine(vd_f[2],vd_f[1],false,{});vd_aP(action.Figure,true,true);vd_q.GetUserLine(vd_sd,vd_f[1]);}else{vd_an(action);}}}};this.arc=function(vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;if(vd_N){var Figure=vd_q.AddArc(vd_N[0],vd_N[1],vd_N[2],vd_N[3],false,{});vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}vd_q.GetUserPoint(vd_sB);};function vd_sB(action,status){if(!action.vd_c)action.vd_c='PickCenter';var vd_f=action.vd_dY();if(action.vd_c=='PickCenter'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_CENTER_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure=vd_q.AddArc(action.ResValue,0.0,0.0,0.0,false,{});action.vd_c='PickStartPoint';vd_q.GetUserLine(vd_sB,action.ResValue);}else{vd_an(action);}}}else if(action.vd_c=='PickStartPoint'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Radius=vdgeo.Distance2D(vd_f[2],vd_f[1]);action.Figure.StartAngle=vdgeo.GetAngle(vd_f[2],vd_f[1]);action.vd_c='PickEndPoint';vd_q.GetUserLine(vd_sB,vd_f[2]);}else{vd_an(action);}}}else if(action.vd_c=='PickEndPoint'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_END_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.EndAngle=vdgeo.GetAngle(vd_f[2],vd_f[1]);vd_aP(action.Figure,true,true);}vd_an(action);}else if(status=='draw'){if(action.Figure){var vd_m=vd_f[0];action.Figure.EndAngle=vdgeo.GetAngle(vd_f[2],vd_f[1]);vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}};this.doublelinerect=function(vd_N,vd_al){vd_ic=true;vd_L.rect(vd_N,vd_al);};function vd_rN(rect){var vd_aO=[[0,0,0],[1,0,0],[1,1,0],[0,1,0]];var mat=vdgeo.vd_l();vdgeo.vd_aM(mat,rect.Width,rect.Height,1.0);vdgeo.vd_af(mat,rect.Rotation);vdgeo.vd_Y(mat,rect.InsertionPoint[X],rect.InsertionPoint[Y],rect.InsertionPoint[Z]);vd_aO=vdgeo.vd_ff(mat,vd_aO);var Figure=vd_q.AddPolyline(vd_aO,false,{});Figure.HatchProperties=rect.HatchProperties;Figure.Thickness=rect.Thickness;Figure.LineType=rect.LineType;Figure.Layer=rect.Layer;Figure.PenColor=rect.PenColor;Figure.PenWidth=rect.PenWidth;Figure.LineWeight=rect.LineWeight;Figure.LineTypeScale=rect.LineTypeScale;var vd_dh=vd_fz();Figure.Widths={Items:[vd_dh,vd_dh,vd_dh,vd_dh,vd_dh,vd_dh,vd_dh,vd_dh]};Figure.Flag=1;return Figure;};this.rect=function(vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;if(vd_N){var Figure=vd_q.AddRect2(vd_N[0],vd_N[1],vd_N[2],vd_N[3],false,{});if(vd_fz()!=0)Figure=vd_rN(Figure);vd_ic=false;vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}vd_q.GetUserPoint(vd_tm);};function vd_tm(action,status){if(!action.vd_c)action.vd_c='Pick1';var vd_m;var vd_f=action.vd_dY();if(action.vd_c=='Pick1'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_FIRST_CORNER);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure=vd_q.AddRect(action.ResValue,action.ResValue,false,{});action.vd_c='Pick2';vd_q.GetUserLine(vd_tm,action.ResValue);}else{vd_an(action);}}}else if(action.vd_c=='Pick2'){if(status=='start'){action.vd_zC=action.vd_qb(false);action.vd_qw=false;vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_OTHER_CORNER);}else if(status=='end'){action.vd_qb(action.vd_zC);vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Width=vd_f[1][X]-vd_f[2][X];action.Figure.Height=vd_f[1][Y]-vd_f[2][Y];if(vd_fz()!=0)action.Figure=vd_rN(action.Figure);vd_aP(action.Figure,true,true);}vd_an(action);}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.Width=vd_f[1][X]-vd_f[2][X];action.Figure.Height=vd_f[1][Y]-vd_f[2][Y];var vd_pS=action.Figure;if(vd_fz()!=0)vd_pS=vd_rN(action.Figure);vd_q.UpdateFig(vd_pS);vd_q.DrawEntity(vd_pS,vd_m);}}}};this.blockref=function(name,vd_N,vd_al){var action=vd_q.ActiveAction();action.cancel();vd_bh=vd_al;if(vd_N){var Figure=vd_q.AddBlockSymbol(name,vd_N[0],vd_N[1],vd_N[2]);vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}action.Figure=vd_q.AddBlockSymbol(name,[0,0,0],1.0,0.0,false,{});var bbox=vd_q.GetEntityBBox(action.Figure);action.vd_eX=1.0;if(vd_q.ActionScaleMode==1&&bbox)action.vd_eX=1.0/Math.max(bbox[3]-bbox[0],bbox[4]-bbox[1]);vd_q.GetUserPoint(vd_su);};function vd_su(action,status){if(!action.vd_c)action.vd_c='PickInsertion';var scale;var vd_m;var vd_f=action.vd_dY();if(action.vd_c=='PickInsertion'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_INSERTION_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.InsertionPoint=action.ResValue;action.vd_c='PickScale';vd_q.GetUserLine(vd_su,action.ResValue);}else{vd_an(action);}}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.InsertionPoint=vd_f[1];vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}else if(action.vd_c=='PickScale'){if(status=='start'){vd_q.ActionDrawEntities([action.Figure]);vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_SCALE);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){if(!action.vd_eX)action.vd_eX=1.0;scale=vdgeo.Distance2D(vd_f[2],vd_f[1])*action.vd_eX;action.Figure.Xscale=scale;action.Figure.Yscale=scale;action.vd_c='PickRotation';vd_q.GetUserLine(vd_su,vd_f[2]);}else{action.Figure.Xscale=1.0;action.Figure.Yscale=1.0;vd_aP(action.Figure,true,true);vd_an(action);}}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];if(!action.vd_eX)action.vd_eX=1.0;scale=vdgeo.Distance2D(vd_f[2],vd_f[1])*action.vd_eX;action.Figure.Xscale=scale;action.Figure.Yscale=scale;vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}else if(action.vd_c=='PickRotation'){if(status=='start'){vd_q.ActionDrawEntities([action.Figure]);vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_ROTATION);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Rotation=vdgeo.GetAngle(vd_f[2],vd_f[1]);}else{action.Figure.Rotation=0.0;}vd_aP(action.Figure,true,true);vd_an(action);}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.Rotation=vdgeo.GetAngle(vd_f[2],vd_f[1]);vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}};this.text=function(vd_aE,vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;if(vd_N){var Figure=vd_q.AddText(vd_aE,0,vd_N[0],undefined,undefined,vd_N[1]);vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}vd_q.ActiveAction().Figure=vd_q.AddText(vd_aE,0,[0,0,0],undefined,undefined,0.0,false,{});vd_q.GetUserPoint(vd_uM);};function vd_uM(action,status){if(!action.vd_c)action.vd_c='PickInsertion';var scale;var vd_m;var vd_f=action.vd_dY();if(action.vd_c=='PickInsertion'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_INSERTION_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.InsertionPoint=action.ResValue;action.vd_c='PickRotation';vd_q.GetUserLine(vd_uM,action.ResValue);}else{vd_an(action);}}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.InsertionPoint=vd_f[1];vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}else if(action.vd_c=='PickRotation'){if(status=='start'){vd_q.ActionDrawEntities([action.Figure]);vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_ROTATION);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Rotation=vdgeo.GetAngle(vd_f[2],vd_f[1]);}else{action.Figure.Rotation=0.0;}vd_aP(action.Figure,true,true);vd_an(action);}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.Rotation=vdgeo.GetAngle(vd_f[2],vd_f[1]);vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}};this.image=function(vd_xF,vd_hf,vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;var Figure;if(vd_N){Figure=vd_q.AddImage(vd_xF,vd_hf,vd_N[0],vd_N[1],vd_N[2],false,{});Figure.FileName=vd_hf;vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}Figure=vd_q.AddImage(vd_xF,vd_hf,[0,0,0],1.0,0.0,false,{});Figure.FileName=vd_hf;vd_q.ActiveAction().Figure=Figure;vd_q.GetUserPoint(vd_sJ);};function vd_sJ(action,status){if(!action.vd_c)action.vd_c='Pick1';var vd_a=vd_q.GetDocument();var vd_Q=null;var vd_m;var vd_f=action.vd_dY();if(action.vd_c=='Pick1'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_FIRST_CORNER);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.InsertionPoint=action.ResValue;action.vd_c='Pick2';vd_q.GetUserLine(vd_sJ,action.ResValue);}else{vd_an(action);}}}else if(action.vd_c=='Pick2'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_OTHER_CORNER);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Width=vd_f[1][X]-vd_f[2][X];action.Figure.ImageScale=action.Figure.Width;if(vd_a)vd_Q=vd_q.GetDictItem(vd_a.Images,action.Figure.ImageDefinition);if(vd_Q)action.Figure.Height=action.Figure.Width*vd_Q.OriginalHeight/vd_Q.OriginalWidth;else action.Figure.Height=vd_f[1][Y]-vd_f[2][Y];action.vd_vI=vdgeo.GetAngle(vd_f[2],vd_f[1]);action.vd_c='Pick3';vd_q.GetUserLine(vd_sJ,vd_f[2]);}else{vd_an(action);}}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.Width=vd_f[1][X]-vd_f[2][X];action.Figure.ImageScale=action.Figure.Width;if(vd_a)vd_Q=vd_q.GetDictItem(vd_a.Images,action.Figure.ImageDefinition);if(vd_Q)action.Figure.Height=action.Figure.Width*vd_Q.OriginalHeight/vd_Q.OriginalWidth;else action.Figure.Height=vd_f[1][Y]-vd_f[2][Y];vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}else if(action.vd_c=='Pick3'){if(status=='start'){vd_q.ActionDrawEntities([action.Figure]);vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_ROTATION);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.Figure.Rotation=vdgeo.GetAngle(vd_f[2],vd_f[1])-action.vd_vI;}else{action.Figure.Rotation=0.0;}vd_aP(action.Figure,true,true);vd_an(action);}else if(status=='draw'){if(action.Figure){vd_m=vd_f[0];action.Figure.Rotation=vdgeo.GetAngle(vd_f[2],vd_f[1])-action.vd_vI;vd_q.UpdateFig(action.Figure);vd_q.DrawEntity(action.Figure,vd_m);}}}};var vd_ar={vd_lK:new vd_En()};this.dimvar=function(name,value){name=name.toUpperCase();vd_q.UndoHistory().store(vd_ar.vd_lK,name);vd_ar.vd_lK[name]=value;if(vd_aU)vd_d.push("dimvar "+name+" "+value);};this.dim=function(vd_N,vd_al){vd_q.ActiveAction().cancel();vd_bh=vd_al;var Figure;if(vd_N&&vd_N[0]&&vd_N[1]){vd_ar.vd_my=vd_N[0];vd_ar.vd_nx=vd_N[1];vd_ar.vd_mb=vd_N[2];vd_ar.text=vd_N[3];if(!vd_ar.text)vd_ar.text='';Figure=vd_ar.vd_lK.vd_rG(vd_q,vd_ar.vd_my,vd_ar.vd_nx,vd_ar.vd_mb,vd_ar.text,{});vd_aP(Figure,false,false);if(vd_bh)vd_bh(vd_q,Figure);return;}vd_q.GetUserPoint(vd_rO);};function vd_rO(action,status){if(!action.vd_c)action.vd_c='Pick1';var vd_a=vd_q.GetDocument();var vd_Q=null;var vd_m;var vd_f=action.vd_dY();if(action.vd_c=='Pick1'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_START_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){action.vd_c='Pick2';vd_q.GetUserLine(vd_rO,action.ResValue);}else{vd_an(action);}}}else if(action.vd_c=='Pick2'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_END_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){vd_ar.vd_my=vd_f[2];vd_ar.vd_nx=vd_f[1];action.vd_c='Pick3';vd_q.GetUserLine(vd_rO,vd_f[1]);}else{vd_an(action);}}}else if(action.vd_c=='Pick3'){if(status=='start'){vd_q.Prompt(vd_q.MessagesDictionary.SPECIFY_INSERTION_POINT);}else if(status=='end'){vd_q.Prompt('');if(!action.IsCanceled()){vd_ar.vd_mb=vd_f[1];vd_ar.text='';action.Figure=vd_ar.vd_lK.vd_rG(vd_q,vd_ar.vd_my,vd_ar.vd_nx,vd_ar.vd_mb,vd_ar.text,{});}else{action.Figure=null;}vd_aP(action.Figure,true,true);vd_an(action);}else if(status=='draw'){vd_m=vd_f[0];var figure=vd_ar.vd_lK.vd_rG(vd_q,vd_ar.vd_my,vd_ar.vd_nx,vd_f[1],'',{});vd_q.DrawEntity(figure,vd_m);}}};return this;} 